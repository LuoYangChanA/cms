!function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}__webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{enumerable:!0,get:getter})},__webpack_require__.r=function(exports){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(exports,"__esModule",{value:!0})},__webpack_require__.t=function(value,mode){if(1&mode&&(value=__webpack_require__(value)),8&mode)return value;if(4&mode&&"object"==typeof value&&value&&value.__esModule)return value;var ns=Object.create(null);if(__webpack_require__.r(ns),Object.defineProperty(ns,"default",{enumerable:!0,value:value}),2&mode&&"string"!=typeof value)for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module.default}:function getModuleExports(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p="/",__webpack_require__(__webpack_require__.s=0)}([function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _routes_src_routes_scss__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1),_routes_src_routes_scss__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_routes_src_routes_scss__WEBPACK_IMPORTED_MODULE_0__),$,Routes,Route,RouteSettingsModal;$=jQuery,Routes=Garnish.Base.extend({tokens:null,routes:null,$container:null,$addRouteBtn:null,sorter:null,init:function init(){this.tokens={},this.routes=[],this.$container=$("#routes");for(var $routes=this.getRoutes(),i=0;i<$routes.length;i++){var route=new Route($routes[i]);this.routes.push(route)}this.sorter=new Garnish.DragSort($routes,{axis:Garnish.Y_AXIS,onSortChange:this.updateRouteOrder.bind(this)}),this.$addRouteBtn=$("#add-route-btn"),this.addListener(this.$addRouteBtn,"click","addRoute")},getRoutes:function getRoutes(){return this.$container.children()},updateRouteOrder:function updateRouteOrder(){for(var $routes=this.getRoutes(),data={},i=0;i<$routes.length;i++)data["routeUids["+i+"]"]=$($routes[i]).attr("data-uid");Craft.postActionRequest("routes/update-route-order",data,(function(response,textStatus){"success"===textStatus&&(response.success?Craft.cp.displayNotice(Craft.t("app","New route order saved.")):Craft.cp.displayError(Craft.t("app","Couldn’t save new route order.")))}))},addRoute:function addRoute(){new RouteSettingsModal}}),Route=Garnish.Base.extend({$container:null,uid:null,siteUid:null,$siteLabel:null,$uri:null,$template:null,modal:null,init:function init(container){this.$container=$(container),this.uid=this.$container.data("uid"),this.siteUid=this.$container.data("site-uid"),this.$siteLabel=this.$container.find(".site:first"),this.$uri=this.$container.find(".uri:first"),this.$template=this.$container.find(".template:first"),this.addListener(this.$container,"click","edit")},edit:function edit(){this.modal?this.modal.show():this.modal=new RouteSettingsModal(this)},updateHtmlFromModal:function updateHtmlFromModal(){var i;if(Craft.isMultiSite)if(this.siteUid){for(i=0;i<Craft.sites.length;i++)if(Craft.sites[i].uid==this.siteUid){this.$siteLabel.text(Craft.sites[i].name);break}}else this.$siteLabel.text(Craft.t("app","Global"));var uriHtml="";for(i=0;i<this.modal.uriInput.elements.length;i++){var $elem=this.modal.uriInput.elements[i];this.modal.uriInput.isText($elem)?uriHtml+=Craft.escapeHtml($elem.val()):uriHtml+=$elem.prop("outerHTML")}this.$uri.html(uriHtml),this.$template.text(this.modal.$templateInput.val())}}),RouteSettingsModal=Garnish.Modal.extend({route:null,$heading:null,$uriInput:null,$uriErrors:null,uriElements:null,$templateInput:null,$saveBtn:null,$cancelBtn:null,$spinner:null,$deleteBtn:null,loading:!1,init:function init(route){this.route=route;var tokenHtml="<h4>"+Craft.t("app","Add a token")+"</h4>";for(var name in Craft.routes.tokens){var pattern;Craft.routes.tokens.hasOwnProperty(name)&&(tokenHtml+='<div class="token" data-name="'+name+'" data-value="'+Craft.routes.tokens[name]+'"><span>'+name+"</span></div>")}var containerHtml='<form class="modal fitted route-settings" accept-charset="UTF-8"><div class="header"><h1></h1></div><div class="body"><div class="uri-field field"><div class="heading"><label for="uri">'+Craft.t("app","If the URI looks like this")+':</label></div><div class="input">',i;if(Craft.isMultiSite&&(containerHtml+='<div class="flex"><div class="flex-grow">'),containerHtml+='<div id="uri" class="text uri ltr"></div>',Craft.isMultiSite){for(containerHtml+='</div><div class="select"><select class="site"><option value="">'+Craft.t("app","Global")+"</option>",i=0;i<Craft.sites.length;i++){var siteInfo=Craft.sites[i];containerHtml+='<option value="'+siteInfo.uid+'">'+Craft.escapeHtml(siteInfo.name)+"</option>"}containerHtml+="</select></div></div>"}containerHtml+='</div><div class="uri-tokens">'+tokenHtml+'</div></div><div class="template-field field"><div class="heading"><label for="template">'+Craft.t("app","Load this template")+':</label></div><div class="input"><input id="template" type="text" class="text fullwidth template ltr"></div></div></div><div class="footer"><div class="buttons right last"><button type="button" class="btn cancel">'+Craft.t("app","Cancel")+'</button><button type="submit" class="btn submit">'+Craft.t("app","Save")+'</button><div class="spinner" style="display: none;"></div></div><a class="delete">'+Craft.t("app","Delete")+"</a></div></form>";var $container=$(containerHtml).appendTo(Garnish.$bod);if(this.$heading=$container.find("h1:first"),this.$siteInput=$container.find(".site:first"),this.$uriInput=$container.find(".uri:first"),this.$templateInput=$container.find(".template:first"),this.$saveBtn=$container.find(".submit:first"),this.$cancelBtn=$container.find(".cancel:first"),this.$spinner=$container.find(".spinner:first"),this.$deleteBtn=$container.find(".delete:first"),this.route||this.$deleteBtn.hide(),this.uriInput=new Garnish.MixedInput(this.$uriInput,{dir:"ltr"}),this.route?this.$heading.html(Craft.t("app","Edit Route")):this.$heading.html(Craft.t("app","Create a new route")),this.route){this.$siteInput.val(this.route.siteUid);var uriNodes=this.route.$uri.prop("childNodes");for(i=0;i<uriNodes.length;i++){var node=uriNodes[i],text;Garnish.isTextNode(node)?this.uriInput.addTextElement().setVal(node.nodeValue):this.addUriVar(node)}var templateVal=this.route.$template.text();this.$templateInput.val(templateVal)}this.base($container);var $uriVars=this.$container.find(".uri-tokens").children("div");this.addListener($uriVars,"mousedown",(function(event){this.addUriVar(event.currentTarget)})),this.addListener(this.$container,"submit","saveRoute"),this.addListener(this.$cancelBtn,"click","cancel"),this.addListener(this.$deleteBtn,"click","deleteRoute")},addUriVar:function addUriVar(elem){var $uriVar=$(elem).clone().attr("tabindex","0");this.uriInput.addElement($uriVar),this.addListener($uriVar,"keydown",(function(event){var _this=this;switch(event.keyCode){case Garnish.LEFT_KEY:setTimeout((function(){_this.uriInput.focusPreviousElement($uriVar)}),1);break;case Garnish.RIGHT_KEY:setTimeout((function(){_this.uriInput.focusNextElement($uriVar)}),1);break;case Garnish.DELETE_KEY:setTimeout((function(){_this.uriInput.removeElement($uriVar)}),1),event.preventDefault()}}))},show:function show(){var _this2=this;this.route&&(this.$heading.html(Craft.t("app","Edit Route")),this.$deleteBtn.show()),setTimeout((function(){if(_this2.uriInput.elements.length){var $firstElem=_this2.uriInput.elements[0];_this2.uriInput.setFocus($firstElem),_this2.uriInput.setCarotPos($firstElem,0)}else _this2.$uriInput.trigger("focus")}),100),this.base()},saveRoute:function saveRoute(event){var _this3=this;if(event.preventDefault(),!this.loading){this.$container.find(".uri-field .input").removeClass("errors"),this.$uriErrors&&(this.$uriErrors.remove(),this.$uriErrors=null);var data={siteUid:this.$siteInput.val()},$elem,val;this.route&&(data.routeUid=this.route.uid);for(var i=0;i<this.uriInput.elements.length;i++)if($elem=this.uriInput.elements[i],this.uriInput.isText($elem)){if(val=$elem.val(),0===i){if(val=Craft.ltrim(val,"/"),Craft.startsWith(val,Craft.actionTrigger+"/"))return void this.addUriError(Craft.t("app","The URI can’t begin with the {setting} config setting.",{setting:"actionTrigger"}));if(Craft.cpTrigger&&Craft.startsWith(val,Craft.cpTrigger+"/"))return void this.addUriError(Craft.t("app","The URI can’t begin with the {setting} config setting.",{setting:"cpTrigger"}))}data["uriParts["+i+"]"]=val}else data["uriParts["+i+"][0]"]=$elem.attr("data-name"),data["uriParts["+i+"][1]"]=$elem.attr("data-value");data.template=this.$templateInput.val(),this.loading=!0,this.$saveBtn.addClass("active"),this.$spinner.show(),Craft.postActionRequest("routes/save-route",data,(function(response,textStatus){if(_this3.$saveBtn.removeClass("active"),_this3.$spinner.hide(),_this3.loading=!1,"success"===textStatus)if(response.success){if(!_this3.route){var routeHtml='<div class="route" data-uid="'+response.routeUid+'"'+(response.siteUid?' data-site-uid="'+response.siteUid+'"':"")+'><div class="uri-container">';Craft.isMultiSite&&(routeHtml+='<span class="site"></span>');var $route=$(routeHtml+='<span class="uri" dir="ltr"></span></div><div class="template" dir="ltr"></div></div>');$route.appendTo("#routes"),_this3.route=new Route($route),_this3.route.modal=_this3,Craft.routes.sorter.addItems($route),1===Craft.routes.sorter.$items.length&&$("#noroutes").addClass("hidden")}_this3.route.siteUid=response.siteUid,_this3.route.updateHtmlFromModal(),_this3.hide(),Craft.cp.displayNotice(Craft.t("app","Route saved."))}else response.errors?response.errors.uri:Craft.cp.displayError(Craft.t("app","Couldn’t save route."))}))}},addUriError:function addUriError(error){this.$container.find(".uri-field .input").addClass("errors"),this.$uriErrors?Craft.ui.addErrorsToList(this.$uriErrors,[error]):(this.$uriErrors=Craft.ui.createErrorList([error]),this.$uriErrors.insertAfter(this.$container.find(".uri-field .input")))},cancel:function cancel(){this.hide(),this.route&&(this.route.modal=null)},deleteRoute:function deleteRoute(){confirm(Craft.t("app","Are you sure you want to delete this route?"))&&(Craft.postActionRequest("routes/delete-route",{routeUid:this.route.uid},(function(response,textStatus){"success"===textStatus&&Craft.cp.displayNotice(Craft.t("app","Route deleted."))})),Craft.routes.sorter.removeItems(this.route.$container),this.route.$container.remove(),this.hide(),0===Craft.routes.sorter.$items.length&&$("#noroutes").removeClass("hidden"))}}),Craft.routes=new Routes},function(module,exports,__webpack_require__){var content=__webpack_require__(2);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[module.i,content,""]]),content.locals&&(module.exports=content.locals);var add,update=(0,__webpack_require__(3).default)("494ab141",content,!0,{})},function(module,exports,__webpack_require__){},function(module,__webpack_exports__,__webpack_require__){"use strict";function listToStyles(parentId,list){for(var styles=[],newStyles={},i=0;i<list.length;i++){var item=list[i],id=item[0],css,media,sourceMap,part={id:parentId+":"+i,css:item[1],media:item[2],sourceMap:item[3]};newStyles[id]?newStyles[id].parts.push(part):styles.push(newStyles[id]={id:id,parts:[part]})}return styles}__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return addStylesClient}));var hasDocument="undefined"!=typeof document;if("undefined"!=typeof DEBUG&&DEBUG&&!hasDocument)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var stylesInDom={},head=hasDocument&&(document.head||document.getElementsByTagName("head")[0]),singletonElement=null,singletonCounter=0,isProduction=!1,noop=function(){},options=null,ssrIdKey="data-vue-ssr-id",isOldIE="undefined"!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function addStylesClient(parentId,list,_isProduction,_options){isProduction=_isProduction,options=_options||{};var styles=listToStyles(parentId,list);return addStylesToDom(styles),function update(newList){for(var mayRemove=[],i=0;i<styles.length;i++){var item=styles[i],domStyle;(domStyle=stylesInDom[item.id]).refs--,mayRemove.push(domStyle)}newList?addStylesToDom(styles=listToStyles(parentId,newList)):styles=[];for(var i=0;i<mayRemove.length;i++){var domStyle;if(0===(domStyle=mayRemove[i]).refs){for(var j=0;j<domStyle.parts.length;j++)domStyle.parts[j]();delete stylesInDom[domStyle.id]}}}}function addStylesToDom(styles){for(var i=0;i<styles.length;i++){var item=styles[i],domStyle=stylesInDom[item.id];if(domStyle){domStyle.refs++;for(var j=0;j<domStyle.parts.length;j++)domStyle.parts[j](item.parts[j]);for(;j<item.parts.length;j++)domStyle.parts.push(addStyle(item.parts[j]));domStyle.parts.length>item.parts.length&&(domStyle.parts.length=item.parts.length)}else{for(var parts=[],j=0;j<item.parts.length;j++)parts.push(addStyle(item.parts[j]));stylesInDom[item.id]={id:item.id,refs:1,parts:parts}}}}function createStyleElement(){var styleElement=document.createElement("style");return styleElement.type="text/css",head.appendChild(styleElement),styleElement}function addStyle(obj){var update,remove,styleElement=document.querySelector("style["+ssrIdKey+'~="'+obj.id+'"]');if(styleElement){if(isProduction)return noop;styleElement.parentNode.removeChild(styleElement)}if(isOldIE){var styleIndex=singletonCounter++;styleElement=singletonElement||(singletonElement=createStyleElement()),update=applyToSingletonTag.bind(null,styleElement,styleIndex,!1),remove=applyToSingletonTag.bind(null,styleElement,styleIndex,!0)}else styleElement=createStyleElement(),update=applyToTag.bind(null,styleElement),remove=function(){styleElement.parentNode.removeChild(styleElement)};return update(obj),function updateStyle(newObj){if(newObj){if(newObj.css===obj.css&&newObj.media===obj.media&&newObj.sourceMap===obj.sourceMap)return;update(obj=newObj)}else remove()}}var replaceText=(textStore=[],function(index,replacement){return textStore[index]=replacement,textStore.filter(Boolean).join("\n")}),textStore;function applyToSingletonTag(styleElement,index,remove,obj){var css=remove?"":obj.css;if(styleElement.styleSheet)styleElement.styleSheet.cssText=replaceText(index,css);else{var cssNode=document.createTextNode(css),childNodes=styleElement.childNodes;childNodes[index]&&styleElement.removeChild(childNodes[index]),childNodes.length?styleElement.insertBefore(cssNode,childNodes[index]):styleElement.appendChild(cssNode)}}function applyToTag(styleElement,obj){var css=obj.css,media=obj.media,sourceMap=obj.sourceMap;if(media&&styleElement.setAttribute("media",media),options.ssrId&&styleElement.setAttribute(ssrIdKey,obj.id),sourceMap&&(css+="\n/*# sourceURL="+sourceMap.sources[0]+" */",css+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap))))+" */"),styleElement.styleSheet)styleElement.styleSheet.cssText=css;else{for(;styleElement.firstChild;)styleElement.removeChild(styleElement.firstChild);styleElement.appendChild(document.createTextNode(css))}}}]);
//# sourceMappingURL=routes.min.js.map