!function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}__webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{enumerable:!0,get:getter})},__webpack_require__.r=function(exports){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(exports,"__esModule",{value:!0})},__webpack_require__.t=function(value,mode){if(1&mode&&(value=__webpack_require__(value)),8&mode)return value;if(4&mode&&"object"==typeof value&&value&&value.__esModule)return value;var ns=Object.create(null);if(__webpack_require__.r(ns),Object.defineProperty(ns,"default",{enumerable:!0,value:value}),2&mode&&"string"!=typeof value)for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module.default}:function getModuleExports(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p="/",__webpack_require__(__webpack_require__.s=1)}([function(module,__webpack_exports__,__webpack_require__){"use strict";function listToStyles(parentId,list){for(var styles=[],newStyles={},i=0;i<list.length;i++){var item=list[i],id=item[0],css,media,sourceMap,part={id:parentId+":"+i,css:item[1],media:item[2],sourceMap:item[3]};newStyles[id]?newStyles[id].parts.push(part):styles.push(newStyles[id]={id:id,parts:[part]})}return styles}__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return addStylesClient}));var hasDocument="undefined"!=typeof document;if("undefined"!=typeof DEBUG&&DEBUG&&!hasDocument)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var stylesInDom={},head=hasDocument&&(document.head||document.getElementsByTagName("head")[0]),singletonElement=null,singletonCounter=0,isProduction=!1,noop=function(){},options=null,ssrIdKey="data-vue-ssr-id",isOldIE="undefined"!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function addStylesClient(parentId,list,_isProduction,_options){isProduction=_isProduction,options=_options||{};var styles=listToStyles(parentId,list);return addStylesToDom(styles),function update(newList){for(var mayRemove=[],i=0;i<styles.length;i++){var item=styles[i],domStyle;(domStyle=stylesInDom[item.id]).refs--,mayRemove.push(domStyle)}newList?addStylesToDom(styles=listToStyles(parentId,newList)):styles=[];for(var i=0;i<mayRemove.length;i++){var domStyle;if(0===(domStyle=mayRemove[i]).refs){for(var j=0;j<domStyle.parts.length;j++)domStyle.parts[j]();delete stylesInDom[domStyle.id]}}}}function addStylesToDom(styles){for(var i=0;i<styles.length;i++){var item=styles[i],domStyle=stylesInDom[item.id];if(domStyle){domStyle.refs++;for(var j=0;j<domStyle.parts.length;j++)domStyle.parts[j](item.parts[j]);for(;j<item.parts.length;j++)domStyle.parts.push(addStyle(item.parts[j]));domStyle.parts.length>item.parts.length&&(domStyle.parts.length=item.parts.length)}else{for(var parts=[],j=0;j<item.parts.length;j++)parts.push(addStyle(item.parts[j]));stylesInDom[item.id]={id:item.id,refs:1,parts:parts}}}}function createStyleElement(){var styleElement=document.createElement("style");return styleElement.type="text/css",head.appendChild(styleElement),styleElement}function addStyle(obj){var update,remove,styleElement=document.querySelector("style["+ssrIdKey+'~="'+obj.id+'"]');if(styleElement){if(isProduction)return noop;styleElement.parentNode.removeChild(styleElement)}if(isOldIE){var styleIndex=singletonCounter++;styleElement=singletonElement||(singletonElement=createStyleElement()),update=applyToSingletonTag.bind(null,styleElement,styleIndex,!1),remove=applyToSingletonTag.bind(null,styleElement,styleIndex,!0)}else styleElement=createStyleElement(),update=applyToTag.bind(null,styleElement),remove=function(){styleElement.parentNode.removeChild(styleElement)};return update(obj),function updateStyle(newObj){if(newObj){if(newObj.css===obj.css&&newObj.media===obj.media&&newObj.sourceMap===obj.sourceMap)return;update(obj=newObj)}else remove()}}var replaceText=(textStore=[],function(index,replacement){return textStore[index]=replacement,textStore.filter(Boolean).join("\n")}),textStore;function applyToSingletonTag(styleElement,index,remove,obj){var css=remove?"":obj.css;if(styleElement.styleSheet)styleElement.styleSheet.cssText=replaceText(index,css);else{var cssNode=document.createTextNode(css),childNodes=styleElement.childNodes;childNodes[index]&&styleElement.removeChild(childNodes[index]),childNodes.length?styleElement.insertBefore(cssNode,childNodes[index]):styleElement.appendChild(cssNode)}}function applyToTag(styleElement,obj){var css=obj.css,media=obj.media,sourceMap=obj.sourceMap;if(media&&styleElement.setAttribute("media",media),options.ssrId&&styleElement.setAttribute(ssrIdKey,obj.id),sourceMap&&(css+="\n/*# sourceURL="+sourceMap.sources[0]+" */",css+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap))))+" */"),styleElement.styleSheet)styleElement.styleSheet.cssText=css;else{for(;styleElement.firstChild;)styleElement.removeChild(styleElement.firstChild);styleElement.appendChild(document.createTextNode(css))}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _cp_src_css_craft_scss__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2),_cp_src_css_craft_scss__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_cp_src_css_craft_scss__WEBPACK_IMPORTED_MODULE_0__),_cp_src_js_Craft_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(4),_cp_src_js_Craft_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_cp_src_js_Craft_js__WEBPACK_IMPORTED_MODULE_1__),_cp_src_js_BaseElementEditor_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(5),_cp_src_js_BaseElementEditor_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_cp_src_js_BaseElementEditor_js__WEBPACK_IMPORTED_MODULE_2__),_cp_src_js_BaseElementIndex_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(6),_cp_src_js_BaseElementIndex_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_cp_src_js_BaseElementIndex_js__WEBPACK_IMPORTED_MODULE_3__),_cp_src_js_BaseElementIndexView_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(7),_cp_src_js_BaseElementIndexView_js__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_cp_src_js_BaseElementIndexView_js__WEBPACK_IMPORTED_MODULE_4__),_cp_src_js_BaseElementSelectInput_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(8),_cp_src_js_BaseElementSelectInput_js__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(_cp_src_js_BaseElementSelectInput_js__WEBPACK_IMPORTED_MODULE_5__),_cp_src_js_BaseElementSelectorModal_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(9),_cp_src_js_BaseElementSelectorModal_js__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(_cp_src_js_BaseElementSelectorModal_js__WEBPACK_IMPORTED_MODULE_6__),_cp_src_js_BaseInputGenerator_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(10),_cp_src_js_BaseInputGenerator_js__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(_cp_src_js_BaseInputGenerator_js__WEBPACK_IMPORTED_MODULE_7__),_cp_src_js_Tabs_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(11),_cp_src_js_Tabs_js__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(_cp_src_js_Tabs_js__WEBPACK_IMPORTED_MODULE_8__),_cp_src_js_AdminTable_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(12),_cp_src_js_AdminTable_js__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(_cp_src_js_AdminTable_js__WEBPACK_IMPORTED_MODULE_9__),_cp_src_js_AssetEditor_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(13),_cp_src_js_AssetEditor_js__WEBPACK_IMPORTED_MODULE_10___default=__webpack_require__.n(_cp_src_js_AssetEditor_js__WEBPACK_IMPORTED_MODULE_10__),_cp_src_js_AssetImageEditor_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(14),_cp_src_js_AssetImageEditor_js__WEBPACK_IMPORTED_MODULE_11___default=__webpack_require__.n(_cp_src_js_AssetImageEditor_js__WEBPACK_IMPORTED_MODULE_11__),_cp_src_js_AssetIndex_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(15),_cp_src_js_AssetIndex_js__WEBPACK_IMPORTED_MODULE_12___default=__webpack_require__.n(_cp_src_js_AssetIndex_js__WEBPACK_IMPORTED_MODULE_12__),_cp_src_js_AssetSelectInput_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(16),_cp_src_js_AssetSelectInput_js__WEBPACK_IMPORTED_MODULE_13___default=__webpack_require__.n(_cp_src_js_AssetSelectInput_js__WEBPACK_IMPORTED_MODULE_13__),_cp_src_js_AssetSelectorModal_js__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(17),_cp_src_js_AssetSelectorModal_js__WEBPACK_IMPORTED_MODULE_14___default=__webpack_require__.n(_cp_src_js_AssetSelectorModal_js__WEBPACK_IMPORTED_MODULE_14__),_cp_src_js_AuthManager_js__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(18),_cp_src_js_AuthManager_js__WEBPACK_IMPORTED_MODULE_15___default=__webpack_require__.n(_cp_src_js_AuthManager_js__WEBPACK_IMPORTED_MODULE_15__),_cp_src_js_CP_js__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(19),_cp_src_js_CP_js__WEBPACK_IMPORTED_MODULE_16___default=__webpack_require__.n(_cp_src_js_CP_js__WEBPACK_IMPORTED_MODULE_16__),_cp_src_js_CategoryIndex_js__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(20),_cp_src_js_CategoryIndex_js__WEBPACK_IMPORTED_MODULE_17___default=__webpack_require__.n(_cp_src_js_CategoryIndex_js__WEBPACK_IMPORTED_MODULE_17__),_cp_src_js_CategorySelectInput_js__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(21),_cp_src_js_CategorySelectInput_js__WEBPACK_IMPORTED_MODULE_18___default=__webpack_require__.n(_cp_src_js_CategorySelectInput_js__WEBPACK_IMPORTED_MODULE_18__),_cp_src_js_Chart_js__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(22),_cp_src_js_Chart_js__WEBPACK_IMPORTED_MODULE_19___default=__webpack_require__.n(_cp_src_js_Chart_js__WEBPACK_IMPORTED_MODULE_19__),_cp_src_js_ColorInput_js__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(23),_cp_src_js_ColorInput_js__WEBPACK_IMPORTED_MODULE_20___default=__webpack_require__.n(_cp_src_js_ColorInput_js__WEBPACK_IMPORTED_MODULE_20__),_cp_src_js_CustomizeSourcesModal_js__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__(24),_cp_src_js_CustomizeSourcesModal_js__WEBPACK_IMPORTED_MODULE_21___default=__webpack_require__.n(_cp_src_js_CustomizeSourcesModal_js__WEBPACK_IMPORTED_MODULE_21__),_cp_src_js_DataTableSorter_js__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__(25),_cp_src_js_DataTableSorter_js__WEBPACK_IMPORTED_MODULE_22___default=__webpack_require__.n(_cp_src_js_DataTableSorter_js__WEBPACK_IMPORTED_MODULE_22__),_cp_src_js_DeleteUserModal_js__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__(26),_cp_src_js_DeleteUserModal_js__WEBPACK_IMPORTED_MODULE_23___default=__webpack_require__.n(_cp_src_js_DeleteUserModal_js__WEBPACK_IMPORTED_MODULE_23__),_cp_src_js_DraftEditor_js__WEBPACK_IMPORTED_MODULE_24__=__webpack_require__(27),_cp_src_js_DraftEditor_js__WEBPACK_IMPORTED_MODULE_24___default=__webpack_require__.n(_cp_src_js_DraftEditor_js__WEBPACK_IMPORTED_MODULE_24__),_cp_src_js_DynamicGenerator_js__WEBPACK_IMPORTED_MODULE_25__=__webpack_require__(28),_cp_src_js_DynamicGenerator_js__WEBPACK_IMPORTED_MODULE_25___default=__webpack_require__.n(_cp_src_js_DynamicGenerator_js__WEBPACK_IMPORTED_MODULE_25__),_cp_src_js_EditableTable_js__WEBPACK_IMPORTED_MODULE_26__=__webpack_require__(29),_cp_src_js_EditableTable_js__WEBPACK_IMPORTED_MODULE_26___default=__webpack_require__.n(_cp_src_js_EditableTable_js__WEBPACK_IMPORTED_MODULE_26__),_cp_src_js_ElementActionTrigger_js__WEBPACK_IMPORTED_MODULE_27__=__webpack_require__(30),_cp_src_js_ElementActionTrigger_js__WEBPACK_IMPORTED_MODULE_27___default=__webpack_require__.n(_cp_src_js_ElementActionTrigger_js__WEBPACK_IMPORTED_MODULE_27__),_cp_src_js_ElementThumbLoader_js__WEBPACK_IMPORTED_MODULE_28__=__webpack_require__(31),_cp_src_js_ElementThumbLoader_js__WEBPACK_IMPORTED_MODULE_28___default=__webpack_require__.n(_cp_src_js_ElementThumbLoader_js__WEBPACK_IMPORTED_MODULE_28__),_cp_src_js_ElevatedSessionForm_js__WEBPACK_IMPORTED_MODULE_29__=__webpack_require__(32),_cp_src_js_ElevatedSessionForm_js__WEBPACK_IMPORTED_MODULE_29___default=__webpack_require__.n(_cp_src_js_ElevatedSessionForm_js__WEBPACK_IMPORTED_MODULE_29__),_cp_src_js_ElevatedSessionManager_js__WEBPACK_IMPORTED_MODULE_30__=__webpack_require__(33),_cp_src_js_ElevatedSessionManager_js__WEBPACK_IMPORTED_MODULE_30___default=__webpack_require__.n(_cp_src_js_ElevatedSessionManager_js__WEBPACK_IMPORTED_MODULE_30__),_cp_src_js_EntryIndex_js__WEBPACK_IMPORTED_MODULE_31__=__webpack_require__(34),_cp_src_js_EntryIndex_js__WEBPACK_IMPORTED_MODULE_31___default=__webpack_require__.n(_cp_src_js_EntryIndex_js__WEBPACK_IMPORTED_MODULE_31__),_cp_src_js_FieldLayoutDesigner_js__WEBPACK_IMPORTED_MODULE_32__=__webpack_require__(35),_cp_src_js_FieldLayoutDesigner_js__WEBPACK_IMPORTED_MODULE_32___default=__webpack_require__.n(_cp_src_js_FieldLayoutDesigner_js__WEBPACK_IMPORTED_MODULE_32__),_cp_src_js_FieldToggle_js__WEBPACK_IMPORTED_MODULE_33__=__webpack_require__(36),_cp_src_js_FieldToggle_js__WEBPACK_IMPORTED_MODULE_33___default=__webpack_require__.n(_cp_src_js_FieldToggle_js__WEBPACK_IMPORTED_MODULE_33__),_cp_src_js_Grid_js__WEBPACK_IMPORTED_MODULE_34__=__webpack_require__(37),_cp_src_js_Grid_js__WEBPACK_IMPORTED_MODULE_34___default=__webpack_require__.n(_cp_src_js_Grid_js__WEBPACK_IMPORTED_MODULE_34__),_cp_src_js_HandleGenerator_js__WEBPACK_IMPORTED_MODULE_35__=__webpack_require__(38),_cp_src_js_HandleGenerator_js__WEBPACK_IMPORTED_MODULE_35___default=__webpack_require__.n(_cp_src_js_HandleGenerator_js__WEBPACK_IMPORTED_MODULE_35__),_cp_src_js_ImageUpload_js__WEBPACK_IMPORTED_MODULE_36__=__webpack_require__(39),_cp_src_js_ImageUpload_js__WEBPACK_IMPORTED_MODULE_36___default=__webpack_require__.n(_cp_src_js_ImageUpload_js__WEBPACK_IMPORTED_MODULE_36__),_cp_src_js_InfoIcon_js__WEBPACK_IMPORTED_MODULE_37__=__webpack_require__(40),_cp_src_js_InfoIcon_js__WEBPACK_IMPORTED_MODULE_37___default=__webpack_require__.n(_cp_src_js_InfoIcon_js__WEBPACK_IMPORTED_MODULE_37__),_cp_src_js_LightSwitch_js__WEBPACK_IMPORTED_MODULE_38__=__webpack_require__(41),_cp_src_js_LightSwitch_js__WEBPACK_IMPORTED_MODULE_38___default=__webpack_require__.n(_cp_src_js_LightSwitch_js__WEBPACK_IMPORTED_MODULE_38__),_cp_src_js_Listbox_js__WEBPACK_IMPORTED_MODULE_39__=__webpack_require__(42),_cp_src_js_Listbox_js__WEBPACK_IMPORTED_MODULE_39___default=__webpack_require__.n(_cp_src_js_Listbox_js__WEBPACK_IMPORTED_MODULE_39__),_cp_src_js_LivePreview_js__WEBPACK_IMPORTED_MODULE_40__=__webpack_require__(43),_cp_src_js_LivePreview_js__WEBPACK_IMPORTED_MODULE_40___default=__webpack_require__.n(_cp_src_js_LivePreview_js__WEBPACK_IMPORTED_MODULE_40__),_cp_src_js_PasswordInput_js__WEBPACK_IMPORTED_MODULE_41__=__webpack_require__(44),_cp_src_js_PasswordInput_js__WEBPACK_IMPORTED_MODULE_41___default=__webpack_require__.n(_cp_src_js_PasswordInput_js__WEBPACK_IMPORTED_MODULE_41__),_cp_src_js_Preview_js__WEBPACK_IMPORTED_MODULE_42__=__webpack_require__(45),_cp_src_js_Preview_js__WEBPACK_IMPORTED_MODULE_42___default=__webpack_require__.n(_cp_src_js_Preview_js__WEBPACK_IMPORTED_MODULE_42__),_cp_src_js_PreviewFileModal_js__WEBPACK_IMPORTED_MODULE_43__=__webpack_require__(46),_cp_src_js_PreviewFileModal_js__WEBPACK_IMPORTED_MODULE_43___default=__webpack_require__.n(_cp_src_js_PreviewFileModal_js__WEBPACK_IMPORTED_MODULE_43__),_cp_src_js_ProgressBar_js__WEBPACK_IMPORTED_MODULE_44__=__webpack_require__(47),_cp_src_js_ProgressBar_js__WEBPACK_IMPORTED_MODULE_44___default=__webpack_require__.n(_cp_src_js_ProgressBar_js__WEBPACK_IMPORTED_MODULE_44__),_cp_src_js_PromptHandler_js__WEBPACK_IMPORTED_MODULE_45__=__webpack_require__(48),_cp_src_js_PromptHandler_js__WEBPACK_IMPORTED_MODULE_45___default=__webpack_require__.n(_cp_src_js_PromptHandler_js__WEBPACK_IMPORTED_MODULE_45__),_cp_src_js_SlidePicker_js__WEBPACK_IMPORTED_MODULE_46__=__webpack_require__(49),_cp_src_js_SlidePicker_js__WEBPACK_IMPORTED_MODULE_46___default=__webpack_require__.n(_cp_src_js_SlidePicker_js__WEBPACK_IMPORTED_MODULE_46__),_cp_src_js_SlideRuleInput_js__WEBPACK_IMPORTED_MODULE_47__=__webpack_require__(50),_cp_src_js_SlideRuleInput_js__WEBPACK_IMPORTED_MODULE_47___default=__webpack_require__.n(_cp_src_js_SlideRuleInput_js__WEBPACK_IMPORTED_MODULE_47__),_cp_src_js_SlugGenerator_js__WEBPACK_IMPORTED_MODULE_48__=__webpack_require__(51),_cp_src_js_SlugGenerator_js__WEBPACK_IMPORTED_MODULE_48___default=__webpack_require__.n(_cp_src_js_SlugGenerator_js__WEBPACK_IMPORTED_MODULE_48__),_cp_src_js_Structure_js__WEBPACK_IMPORTED_MODULE_49__=__webpack_require__(52),_cp_src_js_Structure_js__WEBPACK_IMPORTED_MODULE_49___default=__webpack_require__.n(_cp_src_js_Structure_js__WEBPACK_IMPORTED_MODULE_49__),_cp_src_js_StructureDrag_js__WEBPACK_IMPORTED_MODULE_50__=__webpack_require__(53),_cp_src_js_StructureDrag_js__WEBPACK_IMPORTED_MODULE_50___default=__webpack_require__.n(_cp_src_js_StructureDrag_js__WEBPACK_IMPORTED_MODULE_50__),_cp_src_js_StructureTableSorter_js__WEBPACK_IMPORTED_MODULE_51__=__webpack_require__(54),_cp_src_js_StructureTableSorter_js__WEBPACK_IMPORTED_MODULE_51___default=__webpack_require__.n(_cp_src_js_StructureTableSorter_js__WEBPACK_IMPORTED_MODULE_51__),_cp_src_js_TableElementIndexView_js__WEBPACK_IMPORTED_MODULE_52__=__webpack_require__(55),_cp_src_js_TableElementIndexView_js__WEBPACK_IMPORTED_MODULE_52___default=__webpack_require__.n(_cp_src_js_TableElementIndexView_js__WEBPACK_IMPORTED_MODULE_52__),_cp_src_js_TagSelectInput_js__WEBPACK_IMPORTED_MODULE_53__=__webpack_require__(56),_cp_src_js_TagSelectInput_js__WEBPACK_IMPORTED_MODULE_53___default=__webpack_require__.n(_cp_src_js_TagSelectInput_js__WEBPACK_IMPORTED_MODULE_53__),_cp_src_js_ThumbsElementIndexView_js__WEBPACK_IMPORTED_MODULE_54__=__webpack_require__(57),_cp_src_js_ThumbsElementIndexView_js__WEBPACK_IMPORTED_MODULE_54___default=__webpack_require__.n(_cp_src_js_ThumbsElementIndexView_js__WEBPACK_IMPORTED_MODULE_54__),_cp_src_js_UI_js__WEBPACK_IMPORTED_MODULE_55__=__webpack_require__(58),_cp_src_js_UI_js__WEBPACK_IMPORTED_MODULE_55___default=__webpack_require__.n(_cp_src_js_UI_js__WEBPACK_IMPORTED_MODULE_55__),_cp_src_js_Uploader_js__WEBPACK_IMPORTED_MODULE_56__=__webpack_require__(59),_cp_src_js_Uploader_js__WEBPACK_IMPORTED_MODULE_56___default=__webpack_require__.n(_cp_src_js_Uploader_js__WEBPACK_IMPORTED_MODULE_56__),_cp_src_js_UriFormatGenerator_js__WEBPACK_IMPORTED_MODULE_57__=__webpack_require__(60),_cp_src_js_UriFormatGenerator_js__WEBPACK_IMPORTED_MODULE_57___default=__webpack_require__.n(_cp_src_js_UriFormatGenerator_js__WEBPACK_IMPORTED_MODULE_57__)},function(module,exports,__webpack_require__){var content=__webpack_require__(3);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[module.i,content,""]]),content.locals&&(module.exports=content.locals);var add,update=(0,__webpack_require__(0).default)("6a6cacd0",content,!0,{})},function(module,exports,__webpack_require__){},function(module,exports){function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _iterableToArray(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}var rxhtmlTag=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi;jQuery.htmlPrefilter=function(html){return html.replace(rxhtmlTag,"<$1></$2>")},$.extend(Craft,{navHeight:48,index:function index(arr,key){if(!$.isArray(arr))throw"The first argument passed to Craft.index() must be an array.";return arr.reduce((function(index,obj,i){return index["string"==typeof key?obj[key]:key(obj,i)]=obj,index}),{})},group:function group(arr,key){if(!$.isArray(arr))throw"The first argument passed to Craft.group() must be an array.";var index={};return arr.reduce((function(grouped,obj,i){var thisKey="string"==typeof key?obj[key]:key(obj,i);return index.hasOwnProperty(thisKey)||(index[thisKey]=[[],thisKey],grouped.push(index[thisKey])),index[thisKey][0].push(obj),grouped}),[])},t:function t(category,message,params){return void 0!==Craft.translations[category]&&void 0!==Craft.translations[category][message]&&(message=Craft.translations[category][message]),params?this.formatMessage(message,params):message},formatMessage:function formatMessage(pattern,args){var tokens;if(!1===(tokens=this._tokenizePattern(pattern)))throw"Message pattern is invalid.";for(var i=0;i<tokens.length;i++){var token=tokens[i];if("object"===_typeof(token)&&!1===(tokens[i]=this._parseToken(token,args)))throw"Message pattern is invalid."}return tokens.join("")},_tokenizePattern:function _tokenizePattern(pattern){var depth=1,start,pos,chars=_toConsumableArray(pattern);if(-1===(start=pos=chars.indexOf("{")))return[pattern];for(var tokens=[chars.slice(0,pos).join("")];;){var open=chars.indexOf("{",pos+1),close=chars.indexOf("}",pos+1);if(-1===open&&(open=!1),-1===close&&(close=!1),!1===open&&!1===close)break;if(!1===open&&(open=chars.length),close>open?(depth++,pos=open):(depth--,pos=close),0===depth&&(tokens.push(chars.slice(start+1,pos).join("").split(",",3)),start=pos+1,tokens.push(chars.slice(start,open).join("")),start=open),0!==depth&&(!1===open||!1===close))break}return 0===depth&&tokens},_parseToken:function _parseToken(token,args){var _this=this,param=Craft.trim(token[0]);if(void 0===args[param])return"{".concat(token.join(","),"}");var arg=args[param],type=void 0!==token[1]?Craft.trim(token[1]):"none";switch(type){case"number":return function(){var format=void 0!==token[2]?Craft.trim(token[2]):null;if(null!==format&&"integer"!==format)throw"Message format 'number' is only supported for integer values.";var number=Craft.formatNumber(arg),pos;return null===format&&-1!==(pos="".concat(arg).indexOf("."))&&(number+=".".concat(arg.substr(pos+1))),number}();case"none":return arg;case"select":return function(){if(void 0===token[2])return!1;for(var select=_this._tokenizePattern(token[2]),c=select.length,message=!1,i=0;i+1<c;i++){if(Garnish.isArray(select[i])||!Garnish.isArray(select[i+1]))return!1;var selector=Craft.trim(select[i++]);(!1===message&&"other"===selector||selector==arg)&&(message=select[i].join(","))}return!1!==message&&_this.formatMessage(message,args)}();case"plural":return function(){if(void 0===token[2])return!1;for(var plural=_this._tokenizePattern(token[2]),c=plural.length,message=!1,offset=0,i=0;i+1<c;i++){if("object"===_typeof(plural[i])||"object"!==_typeof(plural[i+1]))return!1;var selector=Craft.trim(plural[i++]),selectorChars=_toConsumableArray(selector);if(1===i&&"offset:"===selector.substring(0,7)){var pos=_toConsumableArray(selector.replace(/[\n\r\t]/g," ")).indexOf(" ",7);if(-1===pos)throw"Message pattern is invalid.";offset=parseInt(Craft.trim(selectorChars.slice(7,pos).join(""))),selector=Craft.trim(selectorChars.slice(pos+1,pos+1+selectorChars.length).join(""))}(!1===message&&"other"===selector||"="===selector[0]&&parseInt(selectorChars.slice(1,1+selectorChars.length).join(""))===arg||"one"===selector&&arg-offset==1)&&(message=("string"==typeof plural[i]?[plural[i]]:plural[i]).map((function(p){return p.replace("#",arg-offset)})).join(","))}return!1!==message&&_this.formatMessage(message,args)}();default:throw"Message format '".concat(type,"' is not supported.")}},formatDate:function formatDate(date){return"object"!==_typeof(date)&&(date=new Date(date)),$.datepicker.formatDate(Craft.datepickerOptions.dateFormat,date)},formatNumber:function formatNumber(number,format){var formatter;return void 0===format&&(format=",.0f"),d3.formatLocale(d3FormatLocaleDefinition).format(format)(number)},shortcutText:function shortcutText(key,shift,alt){return"Mac"===Craft.clientOs?(alt?"⌥":"")+(shift?"⇧":"")+"⌘"+key:"Ctrl+"+(alt?"Alt+":"")+(shift?"Shift+":"")+key},escapeHtml:function escapeHtml(str){return $("<div/>").text(str).html()},escapeRegex:function escapeRegex(str){return str.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},getText:function getText(str){return $("<div/>").html(str).text()},encodeUriComponent:function encodeUriComponent(str){str=encodeURIComponent(str);var differences={"!":"%21","*":"%2A","'":"%27","(":"%28",")":"%29"};for(var chr in differences){var re=new RegExp("\\"+chr,"g");str=str.replace(re,differences[chr])}return str},selectFullValue:function selectFullValue(input){var $input=$(input),val=$input.val();if(void 0!==$input[0].setSelectionRange){var length=2*val.length;$input[0].setSelectionRange(0,length)}else $input.val(val)},formatInputId:function formatInputId(inputName){return this.rtrim(inputName.replace(/[\[\]\\]+/g,"-"),"-")},getUrl:function getUrl(path,params,baseUrl){"string"!=typeof path&&(path="");var anchor="";if($.isPlainObject(params)){var aParams=[];for(var name in params)if(params.hasOwnProperty(name)){var value=params[name];"#"===name?anchor=value:null!==value&&""!==value&&aParams.push(name+"="+value)}params=aParams}params=Garnish.isArray(params)?params.join("&"):Craft.trim(params,"&?");var apos=path.indexOf("#");-1!==apos&&(anchor||(anchor=path.substr(apos+1)),path=path.substr(0,apos));var qpos=path.indexOf("?"),url;if(-1!==qpos&&(params=path.substr(qpos+1)+(params?"&"+params:""),path=path.substr(0,qpos)),-1!==path.search("://")||"/"===path[0])return path+(params?"?"+params:"")+(anchor?"#"+anchor:"");if(path=Craft.trim(path,"/"),baseUrl){if(url=baseUrl,path&&Craft.pathParam){var pathMatch=url.match(new RegExp("[&?]"+Craft.escapeRegex(Craft.pathParam)+"=[^&]+"));pathMatch&&(url=url.replace(pathMatch[0],Craft.rtrim(pathMatch[0],"/")+"/"+path),path="")}}else url=Craft.baseUrl;if(-1!==(qpos=url.indexOf("?"))&&(params=url.substr(qpos+1)+(params?"&"+params:""),url=url.substr(0,qpos)),!Craft.omitScriptNameInUrls&&path)if(Craft.usePathInfo||!Craft.pathParam)-1===url.search(Craft.scriptName)&&(url=Craft.rtrim(url,"/")+"/"+Craft.scriptName);else{if(params&&params.substr(0,Craft.pathParam.length+1)===Craft.pathParam+"="){var basePath,endPath=params.indexOf("&");-1!==endPath?(basePath=params.substring(2,endPath),params=params.substr(endPath+1)):(basePath=params.substr(2),params=null),path=(basePath=Craft.rtrim(basePath))+(path?"/"+path:"")}params=Craft.pathParam+"="+path+(params?"&"+params:""),path=null}return path&&(url=Craft.rtrim(url,"/")+"/"+path),params&&(url+="?"+params),anchor&&(url+="#"+anchor),url},getCpUrl:function getCpUrl(path,params){return this.getUrl(path,params,Craft.baseCpUrl)},getSiteUrl:function getSiteUrl(path,params){return this.getUrl(path,params,Craft.baseSiteUrl)},getActionUrl:function getActionUrl(path,params){return Craft.getUrl(path,params,Craft.actionUrl)},redirectTo:function redirectTo(url){document.location.href=this.getUrl(url)},getCsrfInput:function getCsrfInput(){return Craft.csrfTokenName?'<input type="hidden" name="'+Craft.csrfTokenName+'" value="'+Craft.csrfTokenValue+'"/>':""},postActionRequest:function postActionRequest(action,data,callback,options){"function"==typeof data&&(options=callback,callback=data,data={}),(options=options||{}).contentType&&options.contentType.match(/\bjson\b/)&&("object"===_typeof(data)&&(data=JSON.stringify(data)),options.contentType="application/json; charset=utf-8");var jqXHR=$.ajax($.extend({url:Craft.getActionUrl(action),type:"POST",dataType:"json",headers:this._actionHeaders(),data:data,success:callback,error:function error(jqXHR,textStatus,errorThrown){4===jqXHR.readyState&&(void 0!==Craft.cp?Craft.cp.displayError():alert(Craft.t("app","A server error occurred.")),callback&&callback(null,textStatus,jqXHR))}},options));return"function"==typeof options.send&&options.send(jqXHR),jqXHR},_waitingOnAjax:!1,_ajaxQueue:[],queueActionRequest:function queueActionRequest(action,data,callback,options){"function"==typeof data&&(options=callback,callback=data,data=void 0),Craft._ajaxQueue.push([action,data,callback,options]),Craft._waitingOnAjax||Craft._postNextActionRequestInQueue()},_postNextActionRequestInQueue:function _postNextActionRequestInQueue(){Craft._waitingOnAjax=!0;var args=Craft._ajaxQueue.shift();Craft.postActionRequest(args[0],args[1],(function(data,textStatus,jqXHR){args[2]&&"function"==typeof args[2]&&args[2](data,textStatus,jqXHR),Craft._ajaxQueue.length?Craft._postNextActionRequestInQueue():Craft._waitingOnAjax=!1}),args[3])},_actionHeaders:function _actionHeaders(){var headers={"X-Registered-Asset-Bundles":Object.keys(Craft.registeredAssetBundles).join(","),"X-Registered-Js-Files":Object.keys(Craft.registeredJsFiles).join(",")};return Craft.csrfTokenValue&&(headers["X-CSRF-Token"]=Craft.csrfTokenValue),headers},sendActionRequest:function sendActionRequest(method,action,options){var _this2=this;return new Promise((function(resolve,reject){(options=options?$.extend({},options):{}).method=method,options.url=Craft.getActionUrl(action),options.headers=$.extend({"X-Requested-With":"XMLHttpRequest"},options.headers||{},_this2._actionHeaders()),options.params=$.extend({},options.params||{},{v:(new Date).getTime()}),axios.request(options).then(resolve).catch(reject)}))},sendApiRequest:function sendApiRequest(method,uri,options){var _this3=this;return new Promise((function(resolve,reject){var cancelToken=(options=options?$.extend({},options):{}).cancelToken||null;_this3._getApiHeaders(cancelToken).then((function(apiHeaders){options.method=method,options.baseURL=Craft.baseApiUrl,options.url=uri,options.headers=$.extend(apiHeaders,options.headers||{}),options.params=$.extend(Craft.apiParams||{},options.params||{},{v:(new Date).getTime()}),_this3._apiHeaders||(options.params.processCraftHeaders=1),Craft.httpProxy&&(options.proxy=Craft.httpProxy),axios.request(options).then((function(apiResponse){_this3._processApiHeaders(apiResponse.headers,cancelToken).then((function(){resolve(apiResponse.data)})).catch(reject)})).catch(reject)})).catch(reject)}))},_loadingApiHeaders:!1,_apiHeaders:null,_apiHeaderWaitlist:[],_getApiHeaders:function _getApiHeaders(cancelToken){var _this4=this;return new Promise((function(resolve,reject){_this4._loadingApiHeaders?_this4._apiHeaderWaitlist.push([resolve,reject]):_this4._apiHeaders?resolve(_this4._apiHeaders):(_this4._loadingApiHeaders=!0,_this4.sendActionRequest("POST","app/api-headers",{cancelToken:cancelToken}).then((function(response){_this4._loadingApiHeaders?resolve(response.data):reject(e)})).catch((function(e){_this4._rejectApiRequests(reject,e)})))}))},_processApiHeaders:function _processApiHeaders(headers,cancelToken){var _this5=this;return new Promise((function(resolve,reject){_this5._apiHeaders?resolve():_this5.sendActionRequest("POST","app/process-api-response-headers",{data:{headers:headers},cancelToken:cancelToken}).then((function(response){if(_this5._loadingApiHeaders)for(_this5._apiHeaders=response.data,_this5._loadingApiHeaders=!1,resolve();_this5._apiHeaderWaitlist.length;)_this5._apiHeaderWaitlist.shift()[0](_this5._apiHeaders);else reject(e)})).catch((function(e){_this5._rejectApiRequests(reject,e)}))}))},_rejectApiRequests:function _rejectApiRequests(reject,e){for(this._loadingApiHeaders=!1,reject(e);this._apiHeaderWaitlist.length;)this._apiHeaderWaitlist.shift()[1](e)},clearCachedApiHeaders:function clearCachedApiHeaders(){for(this._apiHeaders=null,this._loadingApiHeaders=!1;this._apiHeaderWaitlist.length;)this._apiHeaderWaitlist.shift()[1]()},downloadFromUrl:function downloadFromUrl(method,url,body){return new Promise((function(resolve,reject){var request=new XMLHttpRequest;request.open(method,url,!0),"object"===_typeof(body)?(request.setRequestHeader("Content-Type","application/json; charset=UTF-8"),body=JSON.stringify(body)):request.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),request.responseType="blob",request.onload=function(){if(200===request.status){var disposition=request.getResponseHeader("content-disposition"),matches=/"([^"]*)"/.exec(disposition),filename=null!=matches&&matches[1]?matches[1]:"Download",contentType=request.getResponseHeader("content-type"),blob=new Blob([request.response],{type:contentType}),link=document.createElement("a");link.href=window.URL.createObjectURL(blob),link.download=filename,document.body.appendChild(link),link.click(),document.body.removeChild(link),resolve()}else reject()},request.send(body)}))},stringToArray:function stringToArray(str){if("string"!=typeof str)return str;for(var arr=str.split(","),i=0;i<arr.length;i++)arr[i]=$.trim(arr[i]);return arr},findDeltaData:function findDeltaData(oldData,newData,deltaNames,callback,initialDeltaValues){oldData="string"==typeof oldData?oldData:"",newData="string"==typeof newData?newData:"",deltaNames.sort((function(a,b){return a.length===b.length?0:a.length>b.length?1:-1})),void 0===initialDeltaValues&&(initialDeltaValues=Craft.initialDeltaValues);for(var groupedOldParams=this._groupParamsByDeltaNames(oldData.split("&"),deltaNames,!1,initialDeltaValues),groupedNewParams=this._groupParamsByDeltaNames(newData.split("&"),deltaNames,!0,!1),params=groupedNewParams.__root__,modifiedDeltaNames=[],n=0;n<deltaNames.length;n++)(Craft.inArray(deltaNames[n],Craft.modifiedDeltaNames)||"object"===_typeof(groupedNewParams[deltaNames[n]])&&("object"!==_typeof(groupedOldParams[deltaNames[n]])||JSON.stringify(groupedOldParams[deltaNames[n]])!==JSON.stringify(groupedNewParams[deltaNames[n]])))&&((params=params.concat(groupedNewParams[deltaNames[n]])).push("modifiedDeltaNames[]="+deltaNames[n]),callback&&callback(deltaNames[n],groupedNewParams[deltaNames[n]]));return params.join("&")},_groupParamsByDeltaNames:function _groupParamsByDeltaNames(params,deltaNames,withRoot,initialValues){var grouped={};withRoot&&(grouped.__root__=[]);var encodeURIComponentExceptEqualChar=function encodeURIComponentExceptEqualChar(o){return encodeURIComponent(o).replace("%3D","=")};params=params.map((function(p){return decodeURIComponent(p)}));paramLoop:for(var p=0;p<params.length;p++){for(var n=deltaNames.length-1;n>=0;n--){var paramName=params[p].substr(0,deltaNames[n].length+1);if(paramName===deltaNames[n]+"="||paramName===deltaNames[n]+"["){void 0===grouped[deltaNames[n]]&&(grouped[deltaNames[n]]=[]),grouped[deltaNames[n]].push(encodeURIComponentExceptEqualChar(params[p]));continue paramLoop}}withRoot&&grouped.__root__.push(encodeURIComponentExceptEqualChar(params[p]))}if(initialValues)for(var name in initialValues)initialValues.hasOwnProperty(name)&&(grouped[name]=[encodeURIComponent(name)+"="+$.param(initialValues[name])]);return grouped},expandPostArray:function expandPostArray(arr){var expanded={},i;for(var key in arr)if(arr.hasOwnProperty(key)){var value=arr[key],m=key.match(/^(\w+)(\[.*)?/),keys;if(m[2])for(keys=m[2].match(/\[[^\[\]]*\]/g),i=0;i<keys.length;i++)keys[i]=keys[i].substring(1,keys[i].length-1);else keys=[];keys.unshift(m[1]);var parentElem=expanded;for(i=0;i<keys.length;i++)i<keys.length-1?("object"!==_typeof(parentElem[keys[i]])&&(keys[i+1]&&parseInt(keys[i+1])!=keys[i+1]?parentElem[keys[i]]={}:parentElem[keys[i]]=[]),parentElem=parentElem[keys[i]]):(keys[i]||(keys[i]=parentElem.length),parentElem[keys[i]]=value)}return expanded},createForm:function createForm(data){var $form=$("<form/>",{attr:{method:"post",action:"","accept-charset":"UTF-8"}});if("string"==typeof data)for(var values=data.split("&"),chunks,i=0;i<values.length;i++)chunks=values[i].split("=",2),$("<input/>",{type:"hidden",name:decodeURIComponent(chunks[0]),value:decodeURIComponent(chunks[1]||"")}).appendTo($form);return $form},compare:function compare(obj1,obj2,sortObjectKeys){if(_typeof(obj1)!==_typeof(obj2))return!1;if("object"===_typeof(obj1)){if(obj1.length!==obj2.length)return!1;if(obj1 instanceof Array!=obj2 instanceof Array)return!1;if(!(obj1 instanceof Array))if(void 0===sortObjectKeys||!0===sortObjectKeys){if(!Craft.compare(Craft.getObjectKeys(obj1).sort(),Craft.getObjectKeys(obj2).sort()))return!1}else if(!Craft.compare(Craft.getObjectKeys(obj1),Craft.getObjectKeys(obj2)))return!1;for(var i in obj1)if(obj1.hasOwnProperty(i)&&!Craft.compare(obj1[i],obj2[i]))return!1;return!0}return obj1===obj2},getObjectKeys:function getObjectKeys(obj){var keys=[];for(var key in obj)obj.hasOwnProperty(key)&&keys.push(key);return keys},escapeChars:function escapeChars(chars){Garnish.isArray(chars)||(chars=chars.split());for(var escaped="",i=0;i<chars.length;i++)escaped+="\\"+chars[i];return escaped},ltrim:function ltrim(str,chars){if(!str)return str;void 0===chars&&(chars=" \t\n\r\0\v");var re=new RegExp("^["+Craft.escapeChars(chars)+"]+");return str.replace(re,"")},rtrim:function rtrim(str,chars){if(!str)return str;void 0===chars&&(chars=" \t\n\r\0\v");var re=new RegExp("["+Craft.escapeChars(chars)+"]+$");return str.replace(re,"")},trim:function trim(str,chars){return str=Craft.ltrim(str,chars),str=Craft.rtrim(str,chars)},startsWith:function startsWith(str,substr){return str.substr(0,substr.length)===substr},filterArray:function filterArray(arr,callback){for(var filtered=[],i=0;i<arr.length;i++){var include;(include="function"==typeof callback?callback(arr[i],i):arr[i])&&filtered.push(arr[i])}return filtered},inArray:function inArray(elem,arr){return $.isPlainObject(arr)&&(arr=Object.values(arr)),arr.includes(elem)},removeFromArray:function removeFromArray(elem,arr){var index=$.inArray(elem,arr);return-1!==index&&(arr.splice(index,1),!0)},getLast:function getLast(arr){return arr.length?arr[arr.length-1]:null},uppercaseFirst:function uppercaseFirst(str){return str.charAt(0).toUpperCase()+str.slice(1)},lowercaseFirst:function lowercaseFirst(str){return str.charAt(0).toLowerCase()+str.slice(1)},parseUrl:function parseUrl(url){var m=url.match(/^(?:(https?):\/\/|\/\/)([^\/\:]*)(?:\:(\d+))?(\/[^\?]*)?(?:\?([^#]*))?(#.*)?/);return m?{scheme:m[1],host:m[2]+(m[3]?":"+m[3]:""),hostname:m[2],port:m[3]||null,path:m[4]||"/",query:m[5]||null,hash:m[6]||null}:{}},isSameHost:function isSameHost(url){var requestUrlInfo=this.parseUrl(document.location.href);if(!requestUrlInfo)return!1;var urlInfo=this.parseUrl(url);return!!urlInfo&&requestUrlInfo.host===urlInfo.host},secondsToHumanTimeDuration:function secondsToHumanTimeDuration(seconds,showSeconds){void 0===showSeconds&&(showSeconds=!0);var secondsInWeek=604800,secondsInDay=86400,secondsInHour=3600,secondsInMinute=60,weeks=Math.floor(seconds/604800);seconds%=604800;var days=Math.floor(seconds/86400);seconds%=86400;var hours=Math.floor(seconds/3600),minutes;seconds%=3600,showSeconds?(minutes=Math.floor(seconds/60),seconds%=60):(minutes=Math.round(seconds/60),seconds=0);var timeComponents=[];return weeks&&timeComponents.push(weeks+" "+(1===weeks?Craft.t("app","week"):Craft.t("app","weeks"))),days&&timeComponents.push(days+" "+(1===days?Craft.t("app","day"):Craft.t("app","days"))),hours&&timeComponents.push(hours+" "+(1===hours?Craft.t("app","hour"):Craft.t("app","hours"))),!minutes&&(showSeconds||weeks||days||hours)||timeComponents.push(minutes+" "+(1===minutes?Craft.t("app","minute"):Craft.t("app","minutes"))),!seconds&&(!showSeconds||weeks||days||hours||minutes)||timeComponents.push(seconds+" "+(1===seconds?Craft.t("app","second"):Craft.t("app","seconds"))),timeComponents.join(", ")},asciiString:function asciiString(str,charMap){str=str.normalize("NFC");for(var asciiStr="",_char,i=0;i<str.length;i++)_char=str.charAt(i),asciiStr+="string"==typeof(charMap||Craft.asciiCharMap)[_char]?(charMap||Craft.asciiCharMap)[_char]:_char;return asciiStr},randomString:function randomString(length){for(var result="",characters="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=0;i<length;i++)result+=characters.charAt(Math.floor(62*Math.random()));return result},createErrorList:function createErrorList(errors){for(var $ul=$(document.createElement("ul")).addClass("errors"),i=0;i<errors.length;i++){var $li=$(document.createElement("li"));$li.appendTo($ul),$li.html(errors[i])}return $ul},appendHeadHtml:function appendHeadHtml(html){if(html){var $existingCss=$("link[href]");if($existingCss.length){for(var existingCss=[],href,i=0;i<$existingCss.length;i++)href=$existingCss.eq(i).attr("href").replace(/&/g,"&amp;"),existingCss.push(Craft.escapeRegex(href));var regexp=new RegExp('<link\\s[^>]*href="(?:'+existingCss.join("|")+')".*?><\/script>',"g");html=html.replace(regexp,"")}$("head").append(html)}},appendFootHtml:function appendFootHtml(html){if(html){var $existingJs=$("script[src]");if($existingJs.length){for(var existingJs=[],src,i=0;i<$existingJs.length;i++)src=$existingJs.eq(i).attr("src").replace(/&/g,"&amp;"),existingJs.push(Craft.escapeRegex(src));var regexp=new RegExp('<script\\s[^>]*src="(?:'+existingJs.join("|")+')".*?><\/script>',"g");html=html.replace(regexp,"")}Garnish.$bod.append(html)}},initUiElements:function initUiElements($container){$(".grid",$container).grid(),$(".info",$container).infoicon(),$(".checkbox-select",$container).checkboxselect(),$(".fieldtoggle",$container).fieldtoggle(),$(".lightswitch",$container).lightswitch(),$(".nicetext",$container).nicetext(),$(".formsubmit",$container).formsubmit(),$(".menubtn",$container).menubtn(),$(".datetimewrapper",$container).datetime(),$("a",$container).each((function(){this.hostname.length&&this.hostname!==location.hostname&&void 0===$(this).attr("target")&&$(this).attr("rel","noopener").attr("target","_blank")}))},_elementIndexClasses:{},_elementSelectorModalClasses:{},_elementEditorClasses:{},registerElementIndexClass:function registerElementIndexClass(elementType,func){if(void 0!==this._elementIndexClasses[elementType])throw"An element index class has already been registered for the element type “"+elementType+"”.";this._elementIndexClasses[elementType]=func},registerElementSelectorModalClass:function registerElementSelectorModalClass(elementType,func){if(void 0!==this._elementSelectorModalClasses[elementType])throw"An element selector modal class has already been registered for the element type “"+elementType+"”.";this._elementSelectorModalClasses[elementType]=func},registerElementEditorClass:function registerElementEditorClass(elementType,func){if(void 0!==this._elementEditorClasses[elementType])throw"An element editor class has already been registered for the element type “"+elementType+"”.";this._elementEditorClasses[elementType]=func},createElementIndex:function createElementIndex(elementType,$container,settings){var func;return new(func=void 0!==this._elementIndexClasses[elementType]?this._elementIndexClasses[elementType]:Craft.BaseElementIndex)(elementType,$container,settings)},createElementSelectorModal:function createElementSelectorModal(elementType,settings){var func;return new(func=void 0!==this._elementSelectorModalClasses[elementType]?this._elementSelectorModalClasses[elementType]:Craft.BaseElementSelectorModal)(elementType,settings)},createElementEditor:function createElementEditor(elementType,element,settings){var func;return void 0===settings&&$.isPlainObject(element)?(settings=element,element=null):"object"!==_typeof(settings)&&(settings={}),settings.elementType||(settings.elementType=elementType),new(func=void 0!==this._elementEditorClasses[elementType]?this._elementEditorClasses[elementType]:Craft.BaseElementEditor)(element,settings)},getLocalStorage:function getLocalStorage(key,defaultValue){return key="Craft-"+Craft.systemUid+"."+key,"undefined"!=typeof localStorage&&void 0!==localStorage[key]?JSON.parse(localStorage[key]):defaultValue},setLocalStorage:function setLocalStorage(key,value){if("undefined"!=typeof localStorage){key="Craft-"+Craft.systemUid+"."+key;try{localStorage[key]=JSON.stringify(value)}catch(e){}}},removeLocalStorage:function removeLocalStorage(key){"undefined"!=typeof localStorage&&localStorage.removeItem("Craft-".concat(Craft.systemUid,".").concat(key))},getCookie:function getCookie(name){return document.cookie.replace(new RegExp("(?:(?:^|.*;\\s*)Craft-".concat(Craft.systemUid,":").concat(name,"\\s*\\=\\s*([^;]*).*$)|^.*$")),"$1")},setCookie:function setCookie(name,value,options){options=$.extend({},this.defaultCookieOptions,options);var cookie="Craft-".concat(Craft.systemUid,":").concat(name,"=").concat(encodeURIComponent(value));options.path&&(cookie+=";path=".concat(options.path)),options.domain&&(cookie+=";domain=".concat(options.domain)),options.maxAge?cookie+=";max-age-in-seconds=".concat(options.maxAge):options.expires&&(cookie+=";expires=".concat(options.expires.toUTCString())),options.secure&&(cookie+=";secure"),document.cookie=cookie},removeCookie:function removeCookie(name){this.setCookie(name,"",new Date("1970-01-01T00:00:00"))},getElementInfo:function getElementInfo(element){var $element=$(element);return $element.hasClass("element")||($element=$element.find(".element:first")),{id:$element.data("id"),siteId:$element.data("site-id"),label:$element.data("label"),status:$element.data("status"),url:$element.data("url"),hasThumb:$element.hasClass("hasthumb"),$element:$element}},setElementSize:function setElementSize(element,size){var $element=$(element);if("small"!==size&&"large"!==size&&(size="small"),!$element.hasClass(size)){var otherSize="small"===size?"large":"small";if($element.addClass(size).removeClass(otherSize),$element.hasClass("hasthumb")){var $oldImg=$element.find("> .elementthumb > img"),imgSize,$newImg=$("<img/>",{sizes:("small"===size?"30":"100")+"px",srcset:$oldImg.attr("srcset")||$oldImg.attr("data-pfsrcset")});$oldImg.replaceWith($newImg),picturefill({elements:[$newImg[0]]})}}},submitForm:function submitForm($form,options){if(void 0===options&&(options={}),!options.confirm||confirm(options.confirm)){if(options.action&&$("<input/>",{type:"hidden",name:"action",val:options.action}).appendTo($form),options.redirect&&$("<input/>",{type:"hidden",name:"redirect",val:options.redirect}).appendTo($form),options.params)for(var name in options.params){var value=options.params[name];$("<input/>",{type:"hidden",name:name,val:value}).appendTo($form)}options.retainScroll&&this.setLocalStorage("scrollY",window.scrollY),$form.trigger($.extend({type:"submit"},options.data))}},trapFocusWithin:function trapFocusWithin(container){var $container=$(container);$container.on("keydown.focus-trap",(function(ev){if(9===ev.keyCode){var $focusableElements=$container.find(":focusable"),index=$focusableElements.index(document.activeElement);-1!==index&&(0===index&&ev.shiftKey?(ev.preventDefault(),ev.stopPropagation(),$focusableElements.last().focus()):index!==$focusableElements.length-1||ev.shiftKey||(ev.preventDefault(),ev.stopPropagation(),$focusableElements.first().focus()))}}))},setFocusWithin:function setFocusWithin(container){$(container).find(":focusable:first").focus()}}),$.extend($.fn,{animateLeft:function animateLeft(pos,duration,easing,complete){return"ltr"===Craft.orientation?this.velocity({left:pos},duration,easing,complete):this.velocity({right:pos},duration,easing,complete)},animateRight:function animateRight(pos,duration,easing,complete){return"ltr"===Craft.orientation?this.velocity({right:pos},duration,easing,complete):this.velocity({left:pos},duration,easing,complete)},disable:function disable(){return this.each((function(){var $elem=$(this);$elem.addClass("disabled"),$elem.data("activatable")&&$elem.removeAttr("tabindex")}))},enable:function enable(){return this.each((function(){var $elem=$(this);$elem.removeClass("disabled"),$elem.data("activatable")&&$elem.attr("tabindex","0")}))},grid:function grid(){return this.each((function(){var $container=$(this),settings={};$container.data("item-selector")&&(settings.itemSelector=$container.data("item-selector")),$container.data("cols")&&(settings.cols=parseInt($container.data("cols"))),$container.data("max-cols")&&(settings.maxCols=parseInt($container.data("max-cols"))),$container.data("min-col-width")&&(settings.minColWidth=parseInt($container.data("min-col-width"))),$container.data("mode")&&(settings.mode=$container.data("mode")),$container.data("fill-mode")&&(settings.fillMode=$container.data("fill-mode")),$container.data("col-class")&&(settings.colClass=$container.data("col-class")),$container.data("snap-to-grid")&&(settings.snapToGrid=!!$container.data("snap-to-grid")),new Craft.Grid(this,settings)}))},infoicon:function infoicon(){return this.each((function(){new Craft.InfoIcon(this)}))},checkboxselect:function checkboxselect(){return this.each((function(){$.data(this,"checkboxselect")||new Garnish.CheckboxSelect(this)}))},fieldtoggle:function fieldtoggle(){return this.each((function(){$.data(this,"fieldtoggle")||new Craft.FieldToggle(this)}))},lightswitch:function lightswitch(settings,settingName,settingValue){return"settings"===settings?("string"==typeof settingName?(settings={})[settingName]=settingValue:settings=settingName,this.each((function(){var obj=$.data(this,"lightswitch");obj&&obj.setSettings(settings)}))):($.isPlainObject(settings)||(settings={}),this.each((function(){var thisSettings=$.extend({},settings);Garnish.hasAttr(this,"data-value")&&(thisSettings.value=$(this).attr("data-value")),Garnish.hasAttr(this,"data-indeterminate-value")&&(thisSettings.indeterminateValue=$(this).attr("data-indeterminate-value")),$.data(this,"lightswitch")||new Craft.LightSwitch(this,thisSettings)})))},nicetext:function nicetext(){return this.each((function(){$.data(this,"nicetext")||new Garnish.NiceText(this)}))},formsubmit:function formsubmit(){return this.on("click",(function(ev){var $btn=$(ev.currentTarget),params=$btn.data("params")||{};$btn.data("param")&&(params[$btn.data("param")]=$btn.data("value"));var $anchor=$btn.data("menu")?$btn.data("menu").$anchor:$btn,$form=$anchor.attr("data-form")?$("#"+$anchor.attr("data-form")):$anchor.closest("form");Craft.submitForm($form,{confirm:$btn.data("confirm"),action:$btn.data("action"),redirect:$btn.data("redirect"),params:params,data:$.extend({customTrigger:$btn},$btn.data("event-data"))})}))},menubtn:function menubtn(){return this.each((function(){var $btn=$(this);if(!$btn.data("menubtn")&&$btn.next().hasClass("menu")){var settings={};$btn.data("menu-anchor")&&(settings.menuAnchor=$btn.data("menu-anchor")),new Garnish.MenuBtn($btn,settings)}}))},datetime:function datetime(){return this.each((function(){var $wrapper=$(this),$inputs=$wrapper.find('input:not([name$="[timezone]"])'),checkValue=function checkValue(){for(var hasValue=!1,i=0;i<$inputs.length;i++)if($inputs.eq(i).val()){hasValue=!0;break}if(hasValue){if(!$wrapper.children(".clear-btn").length)var $btn=$("<button/>",{type:"button",class:"clear-btn",title:Craft.t("app","Clear"),"aria-label":Craft.t("app","Clear")}).appendTo($wrapper).on("click",(function(){for(var _i=0;_i<$inputs.length;_i++)$inputs.eq(_i).val("");$btn.remove(),$inputs.first().focus()}))}else $wrapper.children(".clear-btn").remove()};$inputs.on("change",checkValue),checkValue()}))}}),Garnish.NiceText.charsLeftHtml=function(charsLeft){return Craft.t("app",'<span class="visually-hidden">Characters left:</span> {chars, number}',{chars:charsLeft})},Garnish.$doc.ready((function(){Craft.initUiElements()}))},function(module,exports){function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}Craft.BaseElementEditor=Garnish.Base.extend({$element:null,elementId:null,siteId:null,deltaNames:null,initialData:null,$header:null,$toolbar:null,$tabContainer:null,$editLink:null,$sidebarBtn:null,$loadSpinner:null,$body:null,$fieldsContainer:null,$sidebar:null,$footer:null,$siteSelectContainer:null,$siteSelect:null,$siteSpinner:null,$cancelBtn:null,$saveBtn:null,$saveSpinner:null,slideout:null,tabManager:null,showingSidebar:!1,cancelToken:null,ignoreFailedRequest:!1,initialDeltaValues:null,init:function init(element,settings){var _this=this;void 0===settings&&$.isPlainObject(element)&&(settings=element,element=null),this.$element=$(element),this.setSettings(settings,Craft.BaseElementEditor.defaults),this.$header=$("<header/>",{class:"pane-header"}),this.$toolbar=$("<div/>",{class:"ee-toolbar"}).appendTo(this.$header),this.$tabContainer=$("<div/>",{class:"pane-tabs"}).appendTo(this.$toolbar),this.$loadSpinner=$("<div/>",{class:"spinner",title:Craft.t("app","Loading"),"aria-label":Craft.t("app","Loading")}).appendTo(this.$toolbar),this.$editLink=$("<a/>",{target:"_blank",class:"btn hidden",title:Craft.t("app","Open the full edit page in a new tab"),"aria-label":Craft.t("app","Open the full edit page in a new tab"),"data-icon":"external"}).appendTo(this.$toolbar),this.$sidebarBtn=$("<button/>",{type:"button",class:"btn hidden sidebar-btn",title:Craft.t("app","Show sidebar"),"aria-label":Craft.t("app","Show sidebar"),"data-icon":"sidebar-".concat(Garnish.ltr?"right":"left")}).appendTo(this.$toolbar),this.addListener(this.$sidebarBtn,"click",(function(ev){ev.preventDefault(),_this.showingSidebar?_this.hideSidebar():_this.showSidebar()})),this.$body=$("<div/>",{class:"ee-body"}),this.$fieldsContainer=$("<div/>",{class:"fields"}).appendTo(this.$body),this.$sidebar=$("<div/>",{class:"ee-sidebar hidden"}).appendTo(this.$body),Craft.trapFocusWithin(this.$sidebar),this.$footer=$("<div/>",{class:"ee-footer hidden"});var $siteSelectOuterContainer=$("<div/>",{class:"ee-site-select"}).appendTo(this.$footer);this.$siteSelectContainer=$("<div/>",{class:"select hidden"}).appendTo($siteSelectOuterContainer),this.$siteSelect=$("<select/>").appendTo(this.$siteSelectContainer),this.$siteSpinner=$("<div/>",{class:"spinner hidden"}).appendTo($siteSelectOuterContainer),this.$cancelBtn=$("<button/>",{type:"button",class:"btn",text:Craft.t("app","Cancel")}).appendTo(this.$footer),this.$saveBtn=$("<button/>",{type:"submit",class:"btn submit",text:Craft.t("app","Save")}).appendTo(this.$footer),this.$saveSpinner=$("<div/>",{class:"spinner hidden"}).appendTo(this.$footer);var $contents=this.$header.add(this.$body).add(this.$footer);this.slideout=new Craft.Slideout($contents,{containerElement:"form",containerAttributes:{action:"",method:"post",novalidate:"",class:"element-editor"},closeOnEsc:!1,closeOnShadeClick:!1}),this.slideout.$container.data("elementEditor",this),this.slideout.on("beforeClose",(function(){_this.hideSidebar()})),this.slideout.on("close",(function(){_this.trigger("closeSlideout"),_this.destroy()})),Garnish.shortcutManager.registerShortcut({keyCode:Garnish.S_KEY,ctrl:!0},(function(){_this.saveElement()})),Garnish.shortcutManager.registerShortcut(Garnish.ESC_KEY,(function(){_this.maybeCloseSlideout()})),this.addListener(this.$cancelBtn,"click",(function(){_this.maybeCloseSlideout()})),this.addListener(this.slideout.$shade,"click",(function(){_this.maybeCloseSlideout()})),this.addListener(this.slideout.$container,"click",(function(ev){var $target=$(event.target);!_this.showingSidebar||$target.closest(_this.$sidebarBtn).length||$target.closest(_this.$sidebar).length||_this.hideSidebar()})),this.addListener(this.slideout.$container,"submit",(function(ev){ev.preventDefault(),_this.saveElement()})),this.addListener(this.$siteSelect,"change","switchSite"),this.load().then((function(){_this.onShowHud(),_this.onCreateForm(_this.$body)}))},setElementAttribute:function setElementAttribute(name,value){this.settings.attributes||(this.settings.attributes={}),null===value?delete this.settings.attributes[name]:this.settings.attributes[name]=value},getBaseData:function getBaseData(){var data=$.extend({},this.settings.params);return this.settings.siteId?data.siteId=this.settings.siteId:this.$element&&this.$element.data("site-id")&&(data.siteId=this.$element.data("site-id")),this.settings.elementId?data.elementId=this.settings.elementId:this.$element&&this.$element.data("id")&&(data.elementId=this.$element.data("id")),this.settings.elementType&&(data.elementType=this.settings.elementType),this.settings.attributes&&(data.attributes=this.settings.attributes),this.settings.prevalidate&&(data.prevalidate=1),data},load:function load(data){var _this2=this;return new Promise((function(resolve,reject){_this2.trigger("beforeLoad"),_this2.trigger("beginLoading"),_this2.showLoadSpinner(),_this2.onBeginLoading(),_this2.cancelToken&&(_this2.ignoreFailedRequest=!0,_this2.cancelToken.cancel()),_this2.cancelToken=axios.CancelToken.source(),Craft.sendActionRequest("POST","elements/get-editor-html",{cancelToken:_this2.cancelToken.token,data:$.extend(_this2.getBaseData(),data||{},{includeSites:Craft.isMultiSite&&_this2.settings.showSiteSwitcher})}).then((function(response){_this2.hideLoadSpinner(),_this2.trigger("load"),_this2.trigger("endLoading"),_this2.onEndLoading(),_this2.cancelToken=null,null===_this2.initialDeltaValues&&(_this2.initialDeltaValues=response.data.initialDeltaValues),_this2.updateForm(response.data,!0),_this2.cancelToken=null,resolve()})).catch((function(e){_this2.hideLoadSpinner(),_this2.onEndLoading(),_this2.cancelToken=null,_this2.ignoreFailedRequest||(Craft.cp.displayError(),reject(e)),_this2.ignoreFailedRequest=!1}))}))},showHeader:function showHeader(){this.$header.removeClass("hidden")},hideHeader:function hideHeader(){this.$header.addClass("hidden")},showLoadSpinner:function showLoadSpinner(){this.showHeader(),this.$loadSpinner.removeClass("hidden")},hideLoadSpinner:function hideLoadSpinner(){this.$loadSpinner.addClass("hidden")},switchSite:function switchSite(){var _this3=this;if(!this.isDirty()||confirm(Craft.t("app","Switching sites will lose unsaved changes. Are you sure you want to switch sites?"))){var newSiteId=this.$siteSelect.val();newSiteId!=this.siteId&&(this.$siteSpinner.removeClass("hidden"),this.load({siteId:newSiteId}).then((function(){_this3.$siteSpinner.addClass("hidden")})).catch((function(){_this3.$siteSpinner.addClass("hidden"),_this3.$siteSelect.val(_this3.siteId)})))}else this.$siteSelect.val(this.siteId)},updateForm:function updateForm(data,refreshInitialData){var _this4=this;this.tabManager&&(this.$tabContainer.html(""),this.tabManager.destroy(),this.tabManager=null),this.siteId=data.siteId,this.$fieldsContainer.html(data.fieldHtml);var showHeader=!1;if(data.sites&&data.sites.length>1){showHeader=!0,this.$siteSelectContainer.removeClass("hidden"),this.$siteSelect.html("");for(var i=0;i<data.sites.length;i++){var siteInfo=data.sites[i],$option=$("<option/>",{value:siteInfo.id,text:siteInfo.name}).appendTo(this.$siteSelect);siteInfo.id==data.siteId&&$option.attr("selected","selected")}}else this.$siteSelectContainer.addClass("hidden");data.tabHtml&&(showHeader=!0,this.$tabContainer.replaceWith(this.$tabContainer=$(data.tabHtml)),this.tabManager=new Craft.Tabs(this.$tabContainer),this.tabManager.on("deselectTab",(function(ev){$(ev.$tab.attr("href")).addClass("hidden")})),this.tabManager.on("selectTab",(function(ev){$(ev.$tab.attr("href")).removeClass("hidden"),Garnish.$win.trigger("resize"),_this4.$body.trigger("scroll")}))),data.editUrl?(showHeader=!0,this.$editLink.removeClass("hidden").attr("href",data.editUrl)):this.$editLink&&this.$editLink.addClass("hidden"),data.sidebarHtml?(showHeader=!0,this.$sidebarBtn.removeClass("hidden"),this.$sidebar.html(data.sidebarHtml),Craft.initUiElements(this.$sidebar),(new Craft.ElementThumbLoader).load($(this.$sidebar)),this.$sidebar.find("a").each((function(){this.hostname.length&&void 0===$(this).attr("target")&&$(this).attr("target","_blank")}))):this.$sidebarBtn&&(this.$sidebarBtn.addClass("hidden"),this.$sidebar.addClass("hidden")),showHeader?this.showHeader():this.hideHeader(),this.$footer.removeClass("hidden"),!1!==refreshInitialData&&(this.deltaNames=data.deltaNames),Garnish.requestAnimationFrame((function(){Craft.appendHeadHtml(data.headHtml),Craft.appendFootHtml(data.footHtml),Craft.initUiElements(_this4.$fieldsContainer),refreshInitialData&&(_this4.initialData=_this4.slideout.$container.serialize()),Garnish.isMobileBrowser()||Craft.setFocusWithin(_this4.$fieldsContainer),_this4.trigger("updateForm")}))},showSidebar:function showSidebar(){var _this5=this;this.showingSidebar||(this.$body.scrollTop(0).addClass("no-scroll"),this.$sidebar.off("transitionend.element-editor").css(this._closedSidebarStyles()).removeClass("hidden"),this.$sidebar[0].offsetWidth,this.$sidebar.css(this._openedSidebarStyles()),Garnish.isMobileBrowser()||this.$sidebar.one("transitionend.element-editor",(function(){Craft.setFocusWithin(_this5.$sidebar)})),this.$sidebarBtn.addClass("active").attr({title:Craft.t("app","Hide sidebar"),"aria-label":Craft.t("app","Hide sidebar")}),Garnish.$win.trigger("resize"),this.$sidebar.trigger("scroll"),Garnish.shortcutManager.addLayer(),Garnish.shortcutManager.registerShortcut(Garnish.ESC_KEY,(function(){_this5.hideSidebar()})),this.showingSidebar=!0)},hideSidebar:function hideSidebar(){var _this6=this;this.showingSidebar&&(this.$body.removeClass("no-scroll"),this.$sidebar.off("transitionend.element-editor").css(this._closedSidebarStyles()).one("transitionend.element-editor",(function(){_this6.$sidebar.addClass("hidden")})),this.$sidebarBtn.removeClass("active").attr({title:Craft.t("app","Show sidebar"),"aria-label":Craft.t("app","Show sidebar")}),Garnish.shortcutManager.removeLayer(),this.showingSidebar=!1)},_openedSidebarStyles:function _openedSidebarStyles(){return _defineProperty({},Garnish.ltr?"right":"left","0")},_closedSidebarStyles:function _closedSidebarStyles(){return _defineProperty({},Garnish.ltr?"right":"left","-350px")},saveElement:function saveElement(){var _this7=this,validators=this.settings.validators;if($.isArray(validators))for(var i=0;i<validators.length;i++)if($.isFunction(validators[i])&&!validators[i].call())return!1;this.$saveSpinner.removeClass("hidden");var data=$.param(this.getBaseData())+"&"+this.slideout.$container.serialize();data=Craft.findDeltaData(this.initialData,data,this.deltaNames,null,this.initialDeltaValues),Craft.postActionRequest("elements/save-element",data,(function(response,textStatus){if(_this7.$saveSpinner.addClass("hidden"),"success"===textStatus)if(response.success){if(_this7.$element&&_this7.siteId==_this7.$element.data("site-id")){var $title=_this7.$element.find(".title"),$a=$title.find("a");$a.length&&response.cpEditUrl?($a.attr("href",response.cpEditUrl),$a.text(response.newTitle)):$title.text(response.newTitle)}_this7.settings.elementType&&Craft.elementTypeNames[_this7.settings.elementType]&&Craft.cp.displayNotice(Craft.t("app","{type} saved.",{type:Craft.elementTypeNames[_this7.settings.elementType][0]})),_this7.closeSlideout(),_this7.trigger("saveElement",{response:response}),_this7.onSaveElement(response),_this7.settings.onSaveElement(response),Craft.cp.runQueue()}else _this7.updateForm(response,!1),Garnish.shake(_this7.slideout.$container)}))},isDirty:function isDirty(){return null!==this.initialData&&this.slideout.$container.serialize()!==this.initialData},maybeCloseSlideout:function maybeCloseSlideout(){this.slideout.isOpen&&(this.isDirty()&&!confirm("Are you sure you want to close the editor? Any changes will be lost.")||this.closeSlideout())},closeSlideout:function closeSlideout(){this.slideout.close(),this.onHideHud(),this.cancelToken&&(this.ignoreFailedRequest=!0,this.cancelToken.cancel())},destroy:function destroy(){this.slideout.destroy(),delete this.slideout,this.base()},loadHud:function loadHud(){this.load()},maybeCloseHud:function maybeCloseHud(){this.maybeCloseSlideout()},closeHud:function closeHud(){this.closeSlideout()},reloadForm:function reloadForm(data,callback){this.load(data).then((function(){callback("success")})).catch((function(){callback("error")}))},onBeginLoading:function onBeginLoading(){this.settings.onBeginLoading()},onEndLoading:function onEndLoading(){this.settings.onEndLoading()},onSaveElement:function onSaveElement(response){},onCreateForm:function onCreateForm($form){this.settings.onCreateForm($form)},onShowHud:function onShowHud(){this.trigger("showHud"),this.settings.onShowHud()},onHideHud:function onHideHud(){this.trigger("hideHud"),this.settings.onHideHud()}},{defaults:{showSiteSwitcher:!0,elementId:null,elementType:null,siteId:null,attributes:null,params:null,prevalidate:!1,elementIndex:null,onSaveElement:$.noop,validators:[],onShowHud:$.noop,onHideHud:$.noop,onBeginLoading:$.noop,onEndLoading:$.noop,onCreateForm:$.noop}})},function(module,exports){function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}Craft.BaseElementIndex=Garnish.Base.extend({initialized:!1,elementType:null,instanceState:null,sourceStates:null,sourceStatesStorageKey:null,searchTimeout:null,sourceSelect:null,$container:null,$main:null,isIndexBusy:!1,$sidebar:null,showingSidebar:null,sourceKey:null,sourceViewModes:null,$source:null,sourcesByKey:null,$visibleSources:null,$customizeSourcesBtn:null,customizeSourcesModal:null,$toolbar:null,toolbarOffset:null,$search:null,searching:!1,searchText:null,trashed:!1,drafts:!1,$clearSearchBtn:null,$statusMenuBtn:null,$statusMenuContainer:null,statusMenu:null,status:null,$siteMenuBtn:null,siteMenu:null,siteId:null,$sortMenuBtn:null,sortMenu:null,$sortAttributesList:null,$sortDirectionsList:null,$scoreSortAttribute:null,$structureSortAttribute:null,$elements:null,$viewModeBtnContainer:null,viewModeBtns:null,viewMode:null,view:null,_autoSelectElements:null,$countSpinner:null,$countContainer:null,page:1,resultSet:null,totalResults:null,$exportBtn:null,actions:null,actionsHeadHtml:null,actionsFootHtml:null,$selectAllContainer:null,$selectAllCheckbox:null,showingActionTriggers:!1,exporters:null,exportersByType:null,_$detachedToolbarItems:null,_$triggers:null,_ignoreFailedRequest:!1,_cancelToken:null,init:function init(elementType,$container,settings){var _this=this;if(this.elementType=elementType,this.$container=$container,this.setSettings(settings,Craft.BaseElementIndex.defaults),this.instanceState=this.getDefaultInstanceState(),this.sourceStates={},this.settings.storageKey&&$.extend(this.instanceState,Craft.getLocalStorage(this.settings.storageKey),{}),this.sourceStatesStorageKey="BaseElementIndex."+this.elementType+"."+this.settings.context,$.extend(this.sourceStates,Craft.getLocalStorage(this.sourceStatesStorageKey,{})),this.$main=this.$container.find(".main"),this.$toolbar=this.$container.find(this.settings.toolbarSelector),this.$statusMenuBtn=this.$toolbar.find(".statusmenubtn:first"),this.$statusMenuContainer=this.$statusMenuBtn.parent(),this.$siteMenuBtn=this.$container.find(".sitemenubtn:first"),this.$sortMenuBtn=this.$toolbar.find(".sortmenubtn:first"),this.$search=this.$toolbar.find(".search:first input:first"),this.$clearSearchBtn=this.$toolbar.find(".search:first > .clear"),this.$sidebar=this.$container.find(".sidebar:first"),this.$customizeSourcesBtn=this.$sidebar.find(".customize-sources"),this.$elements=this.$container.find(".elements:first"),this.$countSpinner=this.$container.find("#count-spinner"),this.$countContainer=this.$container.find("#count-container"),this.$exportBtn=this.$container.find("#export-btn"),this.settings.hideSidebar&&(this.$sidebar.hide(),$(".body, .content",this.$container).removeClass("has-sidebar")),this.initSources()){if(this.$customizeSourcesBtn.length&&this.addListener(this.$customizeSourcesBtn,"click","createCustomizeSourcesModal"),this.$statusMenuBtn.length&&(this.statusMenu=this.$statusMenuBtn.menubtn().data("menubtn").menu,this.statusMenu.on("optionselect",this._handleStatusChange.bind(this))),this.$siteMenuBtn.length){this.siteMenu=this.$siteMenuBtn.menubtn().data("menubtn").menu;var $option=this.siteMenu.$options.filter(".sel:first");if($option.length||($option=this.siteMenu.$options.first()),$option.length?this._setSite($option.data("site-id")):this.settings.criteria={id:"0"},this.siteMenu.on("optionselect",this._handleSiteChange.bind(this)),this.siteId){var defaultSiteId=this.settings.defaultSiteId||Craft.cp.getSiteId();if(defaultSiteId&&defaultSiteId!=this.siteId){var $storedSiteOption=this.siteMenu.$options.filter('[data-site-id="'+defaultSiteId+'"]:first');$storedSiteOption.length&&$storedSiteOption.trigger("click")}}}else this.settings.criteria&&this.settings.criteria.siteId&&"*"!==this.settings.criteria.siteId?this._setSite(this.settings.criteria.siteId):this._setSite(Craft.siteId);this.settings.criteria&&this.settings.criteria.siteId&&delete this.settings.criteria.siteId,this.addListener(this.$search,"input",(function(){!_this.searching&&_this.$search.val()?_this.startSearching():_this.searching&&!_this.$search.val()&&_this.stopSearching(),_this.searchTimeout&&clearTimeout(_this.searchTimeout),_this.searchTimeout=setTimeout(_this.updateElementsIfSearchTextChanged.bind(_this),500)})),this.addListener(this.$search,"keypress",(function(ev){ev.keyCode===Garnish.RETURN_KEY&&(ev.preventDefault(),_this.searchTimeout&&clearTimeout(_this.searchTimeout),_this.updateElementsIfSearchTextChanged())})),this.addListener(this.$clearSearchBtn,"click",(function(){_this.$search.val(""),_this.searchTimeout&&clearTimeout(_this.searchTimeout),Garnish.isMobileBrowser(!0)||_this.$search.trigger("focus"),_this.stopSearching(),_this.updateElementsIfSearchTextChanged()})),Garnish.isMobileBrowser(!0)||this.$search.trigger("focus"),this.$sortMenuBtn.length&&(this.sortMenu=this.$sortMenuBtn.menubtn().data("menubtn").menu,this.$sortAttributesList=this.sortMenu.$container.children(".sort-attributes"),this.$sortDirectionsList=this.sortMenu.$container.children(".sort-directions"),this.sortMenu.on("optionselect",this._handleSortChange.bind(this))),this.addListener(this.$exportBtn,"click","_showExportHud"),this.initialized=!0,this.afterInit(),this.selectDefaultSource(),this.setPage(Craft.pageNum),this.updateElements(!0)}},afterInit:function afterInit(){this.onAfterInit()},_createCancelToken:function _createCancelToken(){return this._cancelToken=axios.CancelToken.source(),this._cancelToken.token},_cancelRequests:function _cancelRequests(){var _this2=this;this._cancelToken&&(this._ignoreFailedRequest=!0,this._cancelToken.cancel(),Garnish.requestAnimationFrame((function(){_this2._ignoreFailedRequest=!1})))},getSourceContainer:function getSourceContainer(){return this.$sidebar.find("nav > ul")},get $sources(){if(this.sourceSelect)return this.sourceSelect.$items},getSite:function getSite(){var _this3=this;if(this.siteId)return Craft.sites.find((function(s){return s.id==_this3.siteId}))},initSources:function initSources(){var $sources=this._getSourcesInList(this.getSourceContainer());if(0===$sources.length)return!1;this.sourceSelect||(this.sourceSelect=new Garnish.Select(this.$sidebar.find("nav"),{multi:!1,allowEmpty:!1,vertical:!0,onSelectionChange:this._handleSourceSelectionChange.bind(this)})),this.sourcesByKey={};for(var i=0;i<$sources.length;i++)this.initSource($($sources[i]));return!0},selectDefaultSource:function selectDefaultSource(){var sourceKey=this.getDefaultSourceKey(),$source;return sourceKey&&($source=this.getSourceByKey(sourceKey),-1===this.$visibleSources.index($source)&&($source=null)),sourceKey&&$source||($source=this.$visibleSources.first()),this.selectSource($source)},refreshSources:function refreshSources(){var _this4=this;this.sourceSelect.removeAllItems(),this.setIndexBusy(),Craft.sendActionRequest("POST",this.settings.refreshSourcesAction,{data:{context:this.settings.context,elementType:this.elementType}}).then((function(response){_this4.setIndexAvailable(),_this4.getSourceContainer().replaceWith(response.data.html),_this4.initSources(),_this4.selectDefaultSource()})).catch((function(){_this4.setIndexAvailable(),_this4._ignoreFailedRequest||Craft.cp.displayError(Craft.t("app","A server error occurred."))}))},initSource:function initSource($source){this.sourceSelect.addItems($source),this.initSourceToggle($source),this.sourcesByKey[$source.data("key")]=$source,$source.data("hasNestedSources")&&-1!==this.instanceState.expandedSources.indexOf($source.data("key"))&&this._expandSource($source)},initSourceToggle:function initSourceToggle($source){this.deinitSourceToggle($source);var $toggle=this._getSourceToggle($source);$toggle.length?(this.addListener($source,"dblclick","_handleSourceDblClick"),this.addListener($toggle,"click","_handleSourceToggleClick"),$source.data("hasNestedSources",!0)):$source.data("hasNestedSources",!1)},deinitSource:function deinitSource($source){this.sourceSelect.removeItems($source),this.deinitSourceToggle($source),delete this.sourcesByKey[$source.data("key")]},deinitSourceToggle:function deinitSourceToggle($source){$source.data("hasNestedSources")&&(this.removeListener($source,"dblclick"),this.removeListener(this._getSourceToggle($source),"click")),$source.removeData("hasNestedSources")},getDefaultInstanceState:function getDefaultInstanceState(){return{selectedSource:null,expandedSources:[]}},getDefaultSourceKey:function getDefaultSourceKey(){if(this.settings.defaultSource){for(var paths=this.settings.defaultSource.split("/"),path="",i=0;i<paths.length;i++){path+=paths[i];var $source=this.getSourceByKey(path);if(!$source)return this.instanceState.selectedSource;this._expandSource($source),path+="/"}return this._setSite(this.siteId),this.settings.defaultSource}return this.instanceState.selectedSource},getDefaultExpandedSources:function getDefaultExpandedSources(){return this.instanceState.expandedSources},startSearching:function startSearching(){this.$clearSearchBtn.removeClass("hidden"),this.$scoreSortAttribute||(this.$scoreSortAttribute=$('<li><a data-attr="score">'+Craft.t("app","Score")+"</a></li>"),this.sortMenu.addOptions(this.$scoreSortAttribute.children())),this.$scoreSortAttribute.prependTo(this.$sortAttributesList),this.searching=!0,this._updateStructureSortOption(),this.setSortAttribute("score")},stopSearching:function stopSearching(){this.$clearSearchBtn.addClass("hidden"),this.$scoreSortAttribute.detach(),this.searching=!1,this._updateStructureSortOption()},setInstanceState:function setInstanceState(key,value){"object"===_typeof(key)?$.extend(this.instanceState,key):this.instanceState[key]=value,this.storeInstanceState()},storeInstanceState:function storeInstanceState(){this.settings.storageKey&&Craft.setLocalStorage(this.settings.storageKey,this.instanceState)},getSourceState:function getSourceState(source,key,defaultValue){return void 0===this.sourceStates[source]&&(this.sourceStates[source]={}),void 0===key?this.sourceStates[source]:void 0!==this.sourceStates[source][key]?this.sourceStates[source][key]:void 0!==defaultValue?defaultValue:null},getSelectedSourceState:function getSelectedSourceState(key,defaultValue){return this.getSourceState(this.instanceState.selectedSource,key,defaultValue)},setSelecetedSourceState:function setSelecetedSourceState(key,value){var viewState=this.getSelectedSourceState();"object"===_typeof(key)?$.extend(viewState,key):viewState[key]=value,this.sourceStates[this.instanceState.selectedSource]=viewState,Craft.setLocalStorage(this.sourceStatesStorageKey,this.sourceStates)},storeSortAttributeAndDirection:function storeSortAttributeAndDirection(){var attr=this.getSelectedSortAttribute();"score"!==attr&&this.setSelecetedSourceState({order:attr,sort:this.getSelectedSortDirection()})},setPage:function setPage(page){if("index"===this.settings.context){page=Math.max(page,1),this.page=page;var url=document.location.href.replace(/\?.*$/,"").replace(new RegExp("/"+Craft.pageTrigger.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")+"\\d+$"),"").replace(/\/+$/,"");1!==this.page&&("?"!==Craft.pageTrigger[0]&&(url+="/"),url+=Craft.pageTrigger+this.page),history.replaceState({},"",url)}},_resetCount:function _resetCount(){this.resultSet=null,this.totalResults=null},getViewParams:function getViewParams(){var criteria={siteId:this.siteId,search:this.searchText,offset:this.settings.batchSize*(this.page-1),limit:this.settings.batchSize};this.settings.canHaveDrafts&&(this.drafts||"index"===this.settings.context&&!this.status)&&(criteria.drafts=this.drafts||null,criteria.savedDraftsOnly=!0,this.drafts||(criteria.draftOf=!1)),this.trashed&&(criteria.trashed=!0),Garnish.hasAttr(this.$source,"data-override-status")||(criteria.status=this.status),$.extend(criteria,this.settings.criteria);var params={context:this.settings.context,elementType:this.elementType,source:this.instanceState.selectedSource,criteria:criteria,disabledElementIds:this.settings.disabledElementIds,viewState:$.extend({},this.getSelectedSourceState()),paginated:this._isViewPaginated()?1:0};return params.viewState.order=this.getSelectedSortAttribute(),params.viewState.sort=this.getSelectedSortDirection(),"structure"===this.getSelectedSortAttribute()&&(void 0===this.instanceState.collapsedElementIds&&(this.instanceState.collapsedElementIds=[]),params.collapsedElementIds=this.instanceState.collapsedElementIds),this.trigger("registerViewParams",{params:params}),params},updateElements:function updateElements(preservePagination){var _this5=this;if(this.initialized){this._cancelRequests(),this.setIndexBusy(),this.view&&(this.view.destroy(),delete this.view),!0!==preservePagination&&(this.setPage(1),this._resetCount());var params=this.getViewParams();Craft.sendActionRequest("POST",this.settings.updateElementsAction,{data:params,cancelToken:this._createCancelToken()}).then((function(response){_this5.setIndexAvailable(),("index"===_this5.settings.context?Garnish.$scrollContainer:_this5.$main).scrollTop(0),_this5._updateView(params,response.data)})).catch((function(e){_this5.setIndexAvailable(),_this5._ignoreFailedRequest||Craft.cp.displayError(Craft.t("app","A server error occurred."))}))}},updateElementsIfSearchTextChanged:function updateElementsIfSearchTextChanged(){this.searchText!==(this.searchText=this.searching?this.$search.val():null)&&this.updateElements()},showActionTriggers:function showActionTriggers(){this.showingActionTriggers||(this.$toolbar.css("min-height",this.$toolbar.height()),this._$detachedToolbarItems=this.$toolbar.children(),this._$detachedToolbarItems.detach(),this._$triggers?this._$triggers.appendTo(this.$toolbar):this._createTriggers(),this.showingActionTriggers=!0)},submitAction:function submitAction(action,actionParams){var _this6=this,selectedElementIds=this.view.getSelectedElementIds(),totalSelected;if(0!==selectedElementIds.length&&("string"==typeof action&&(action=this._findAction(action)),!action.confirm||confirm(action.confirm))){this._cancelRequests();var viewParams=this.getViewParams();actionParams=actionParams?Craft.expandPostArray(actionParams):{};var params=$.extend(viewParams,action.settings||{},actionParams,{elementAction:action.type,elementIds:selectedElementIds});this.setIndexBusy(),this._autoSelectElements=selectedElementIds,action.download?(Craft.csrfTokenName&&(params[Craft.csrfTokenName]=Craft.csrfTokenValue),Craft.downloadFromUrl("POST",Craft.getActionUrl(this.settings.submitActionsAction),params).then((function(response){_this6.setIndexAvailable()})).catch((function(e){_this6.setIndexAvailable()}))):Craft.sendActionRequest("POST",this.settings.submitActionsAction,{data:params,cancelToken:this._createCancelToken()}).then((function(response){_this6.setIndexAvailable(),response.data.success?(_this6._resetCount(),_this6._updateView(viewParams,response.data),void 0!==response.data.badgeCounts&&_this6._updateBadgeCounts(response.data.badgeCounts),response.data.message&&Craft.cp.displayNotice(response.data.message),_this6.afterAction(action,params)):Craft.cp.displayError(response.data.message)})).catch((function(){_this6.setIndexAvailable()}))}},_findAction:function _findAction(actionClass){for(var i=0;i<this.actions.length;i++)if(this.actions[i].type===actionClass)return this.actions[i];throw"Invalid element action: ".concat(actionClass)},afterAction:function afterAction(action,params){Craft.cp.runQueue(),this.onAfterAction(action,params)},hideActionTriggers:function hideActionTriggers(){this.showingActionTriggers&&(this._$detachedToolbarItems.appendTo(this.$toolbar),this._$triggers.detach(),this.$toolbar.css("min-height",""),this.showingActionTriggers=!1)},updateActionTriggers:function updateActionTriggers(){if(this.actions){var totalSelected=this.view.getSelectedElements().length;0!==totalSelected?(totalSelected===this.view.getEnabledElements().length?(this.$selectAllCheckbox.removeClass("indeterminate"),this.$selectAllCheckbox.addClass("checked"),this.$selectAllContainer.attr("aria-checked","true")):(this.$selectAllCheckbox.addClass("indeterminate"),this.$selectAllCheckbox.removeClass("checked"),this.$selectAllContainer.attr("aria-checked","mixed")),this.showActionTriggers()):(this.$selectAllCheckbox.removeClass("indeterminate checked"),this.$selectAllContainer.attr("aria-checked","false"),this.hideActionTriggers())}},getSelectedElements:function getSelectedElements(){return this.view?this.view.getSelectedElements():$()},getSelectedElementIds:function getSelectedElementIds(){return this.view?this.view.getSelectedElementIds():[]},setStatus:function setStatus(status){var $option=this.statusMenu.$options.filter('a[data-status="'+status+'"]:first');$option.length&&this.statusMenu.selectOption($option[0])},getSortAttributeOption:function getSortAttributeOption(attr){return this.$sortAttributesList.find('a[data-attr="'+attr+'"]:first')},getSelectedSortAttribute:function getSelectedSortAttribute(){return this.$sortAttributesList.find("a.sel:first").data("attr")},setSortAttribute:function setSortAttribute(attr){var $option=this.getSortAttributeOption(attr);if($option.length){this.$sortAttributesList.find("a.sel").removeClass("sel"),$option.addClass("sel");var label=$option.text();this.$sortMenuBtn.attr("title",Craft.t("app","Sort by {attribute}",{attribute:label})),this.$sortMenuBtn.text(label),"score"===attr?this.setSortDirection("desc"):this.setSortDirection($option.data("default-dir")||"asc"),"structure"===attr?this.$sortDirectionsList.find("a").addClass("disabled"):this.$sortDirectionsList.find("a").removeClass("disabled")}},getSortDirectionOption:function getSortDirectionOption(dir){return this.$sortDirectionsList.find("a[data-dir="+dir+"]:first")},getSelectedSortDirection:function getSelectedSortDirection(){return this.$sortDirectionsList.find("a.sel:first").data("dir")},getSelectedViewMode:function getSelectedViewMode(){return this.getSelectedSourceState("mode")||"table"},setSortDirection:function setSortDirection(dir){"desc"!==dir&&(dir="asc"),this.$sortMenuBtn.attr("data-icon",dir),this.$sortDirectionsList.find("a.sel").removeClass("sel"),this.getSortDirectionOption(dir).addClass("sel")},getSourceByKey:function getSourceByKey(key){return void 0===this.sourcesByKey[key]?null:this.sourcesByKey[key]},selectSource:function selectSource($source){if(!$source||!$source.length)return!1;if(this.$source&&this.$source[0]&&this.$source[0]===$source[0]&&$source.data("key")===this.sourceKey)return!1;this.hideActionTriggers(),this.$source=$source,this.sourceKey=$source.data("key"),this.setInstanceState("selectedSource",this.sourceKey),this.sourceSelect.selectItem($source),Craft.cp.updateSidebarMenuLabel(),this.searching&&(this.searchText=null,this.$search.val(""),this.stopSearching()),this.$sortAttributesList.children("li[data-extra]").remove();var $topSource,sortOptions=this.$source.closest("nav > ul > li").children("a").data("sort-options");if(sortOptions)for(var _i=0;_i<sortOptions.length;_i++){var $option=$("<li/>",{"data-extra":!0}).append($("<a/>",{text:sortOptions[_i][0],"data-attr":sortOptions[_i][1]})).appendTo(this.$sortAttributesList);this.sortMenu.addOptions($option.children())}if(Garnish.hasAttr(this.$source,"data-has-structure")?(this.$structureSortAttribute||(this.$structureSortAttribute=$('<li><a data-attr="structure">'+Craft.t("app","Structure")+"</a></li>"),this.sortMenu.addOptions(this.$structureSortAttribute.children())),this.$structureSortAttribute.prependTo(this.$sortAttributesList)):this.$structureSortAttribute&&this.$structureSortAttribute.removeClass("sel").detach(),this.setStoredSortOptionsForSource(),this.$statusMenuBtn.length&&(Garnish.hasAttr(this.$source,"data-override-status")?this.$statusMenuContainer.addClass("hidden"):this.$statusMenuContainer.removeClass("hidden"),this.trashed)){var $firstOption=this.statusMenu.$options.first();this.setStatus($firstOption.data("status"))}if(this.$viewModeBtnContainer&&this.$viewModeBtnContainer.remove(),this.viewModeBtns={},this.viewMode=null,this.sourceViewModes=this.getViewModesForSource(),this.sourceViewModes.length>1){this.$viewModeBtnContainer=$('<div class="btngroup"/>').appendTo(this.$toolbar);for(var i=0;i<this.sourceViewModes.length;i++){var sourceViewMode=this.sourceViewModes[i],$viewModeBtn=$("<button/>",{type:"button",class:"btn"+(void 0!==sourceViewMode.className?" ".concat(sourceViewMode.className):""),"data-view":sourceViewMode.mode,"data-icon":sourceViewMode.icon,"aria-label":sourceViewMode.title,title:sourceViewMode.title}).appendTo(this.$viewModeBtnContainer);this.viewModeBtns[sourceViewMode.mode]=$viewModeBtn,this.addListener($viewModeBtn,"click",{mode:sourceViewMode.mode},(function(ev){this.selectViewMode(ev.data.mode),this.updateElements()}))}}var viewMode=this.getSelectedViewMode();return viewMode&&this.doesSourceHaveViewMode(viewMode)||(viewMode=this.viewMode&&this.doesSourceHaveViewMode(this.viewMode)?this.viewMode:this.sourceViewModes[0].mode),this.selectViewMode(viewMode),this.onSelectSource(),!0},selectSourceByKey:function selectSourceByKey(key){var $source=this.getSourceByKey(key);return!!$source&&this.selectSource($source)},setStoredSortOptionsForSource:function setStoredSortOptionsForSource(){var sortAttr=this.getSelectedSourceState("order"),sortDir=this.getSelectedSourceState("sort");sortAttr&&sortDir||(sortAttr=this.getDefaultSort(),Garnish.isArray(sortAttr)&&(sortDir=sortAttr[1],sortAttr=sortAttr[0])),"asc"!==sortDir&&"desc"!==sortDir&&(sortDir="asc"),this.setSortAttribute(sortAttr),this.setSortDirection(sortDir)},getDefaultSort:function getDefaultSort(){return this.$source&&Garnish.hasAttr(this.$source,"data-default-sort")?this.$source.attr("data-default-sort").split(":"):[this.$sortAttributesList.find("a:first").data("attr"),"asc"]},getViewModesForSource:function getViewModesForSource(){var viewModes=[{mode:"table",title:Craft.t("app","Display in a table"),icon:"list"}];return this.$source&&Garnish.hasAttr(this.$source,"data-has-thumbs")&&viewModes.push({mode:"thumbs",title:Craft.t("app","Display as thumbnails"),icon:"grid"}),viewModes},doesSourceHaveViewMode:function doesSourceHaveViewMode(viewMode){for(var i=0;i<this.sourceViewModes.length;i++)if(this.sourceViewModes[i].mode===viewMode)return!0;return!1},selectViewMode:function selectViewMode(viewMode,force){force||this.doesSourceHaveViewMode(viewMode)||(viewMode=this.sourceViewModes[0].mode),viewMode!==this.viewMode&&(this.viewMode&&void 0!==this.viewModeBtns[this.viewMode]&&this.viewModeBtns[this.viewMode].removeClass("active"),this.viewMode=viewMode,this.setSelecetedSourceState("mode",this.viewMode),void 0!==this.viewModeBtns[this.viewMode]&&this.viewModeBtns[this.viewMode].addClass("active"))},createView:function createView(mode,settings){var viewClass;return new(this.getViewClass(mode))(this,this.$elements,settings)},getViewClass:function getViewClass(mode){switch(mode){case"table":return Craft.TableElementIndexView;case"thumbs":return Craft.ThumbsElementIndexView;default:throw'View mode "'.concat(mode,'" not supported.')}},rememberDisabledElementId:function rememberDisabledElementId(id){var index;-1===$.inArray(id,this.settings.disabledElementIds)&&this.settings.disabledElementIds.push(id)},forgetDisabledElementId:function forgetDisabledElementId(id){var index=$.inArray(id,this.settings.disabledElementIds);-1!==index&&this.settings.disabledElementIds.splice(index,1)},enableElements:function enableElements($elements){$elements.removeClass("disabled").parents(".disabled").removeClass("disabled");for(var i=0;i<$elements.length;i++){var id=$($elements[i]).data("id");this.forgetDisabledElementId(id)}this.onEnableElements($elements)},disableElements:function disableElements($elements){$elements.removeClass("sel").addClass("disabled");for(var i=0;i<$elements.length;i++){var id=$($elements[i]).data("id");this.rememberDisabledElementId(id)}this.onDisableElements($elements)},getElementById:function getElementById(id){return this.view.getElementById(id)},enableElementsById:function enableElementsById(ids){ids=$.makeArray(ids);for(var i=0;i<ids.length;i++){var id=ids[i],$element=this.getElementById(id);$element&&$element.length?this.enableElements($element):this.forgetDisabledElementId(id)}},disableElementsById:function disableElementsById(ids){ids=$.makeArray(ids);for(var i=0;i<ids.length;i++){var id=ids[i],$element=this.getElementById(id);$element&&$element.length?this.disableElements($element):this.rememberDisabledElementId(id)}},selectElementAfterUpdate:function selectElementAfterUpdate(id){null===this._autoSelectElements&&(this._autoSelectElements=[]),this._autoSelectElements.push(id)},addButton:function addButton($button){this.getButtonContainer().append($button)},isShowingSidebar:function isShowingSidebar(){return null===this.showingSidebar&&(this.showingSidebar=this.$sidebar.length&&!this.$sidebar.hasClass("hidden")),this.showingSidebar},getButtonContainer:function getButtonContainer(){if(this.settings.buttonContainer)return $(this.settings.buttonContainer);var $container=$("#action-button");return $container.length||($container=$('<div id="action-button"/>').appendTo($("#header"))),$container},setIndexBusy:function setIndexBusy(){this.$elements.addClass("busy"),this.isIndexBusy=!0},setIndexAvailable:function setIndexAvailable(){this.$elements.removeClass("busy"),this.isIndexBusy=!1},createCustomizeSourcesModal:function createCustomizeSourcesModal(){var modal=new Craft.CustomizeSourcesModal(this,{onHide:function onHide(){modal.destroy()}});return modal},disable:function disable(){this.sourceSelect&&this.sourceSelect.disable(),this.view&&this.view.disable(),this.base()},enable:function enable(){this.sourceSelect&&this.sourceSelect.enable(),this.view&&this.view.enable(),this.base()},onAfterInit:function onAfterInit(){this.settings.onAfterInit(),this.trigger("afterInit")},onSelectSource:function onSelectSource(){this.settings.onSelectSource(this.sourceKey),this.trigger("selectSource",{sourceKey:this.sourceKey})},onSelectSite:function onSelectSite(){this.settings.onSelectSite(this.siteId),this.trigger("selectSite",{siteId:this.siteId})},onUpdateElements:function onUpdateElements(){this.settings.onUpdateElements(),this.trigger("updateElements")},onSelectionChange:function onSelectionChange(){this.settings.onSelectionChange(),this.trigger("selectionChange")},onEnableElements:function onEnableElements($elements){this.settings.onEnableElements($elements),this.trigger("enableElements",{elements:$elements})},onDisableElements:function onDisableElements($elements){this.settings.onDisableElements($elements),this.trigger("disableElements",{elements:$elements})},onAfterAction:function onAfterAction(action,params){this.settings.onAfterAction(action,params),this.trigger("afterAction",{action:action,params:params})},_handleSourceSelectionChange:function _handleSourceSelectionChange(){this.sourceSelect.totalSelected?this.selectSource(this.sourceSelect.$selectedItems)&&this.updateElements():this.sourceSelect.selectItem(this.$visibleSources.first())},_handleActionTriggerSubmit:function _handleActionTriggerSubmit(ev){ev.preventDefault();var $form=$(ev.currentTarget);$form.hasClass("disabled")||$form.data("custom-handler")||this.submitAction($form.data("action"),Garnish.getPostData($form))},_handleMenuActionTriggerSubmit:function _handleMenuActionTriggerSubmit(ev){var $option=$(ev.option);$option.hasClass("disabled")||$option.data("custom-handler")||this.submitAction($option.data("action"))},_handleStatusChange:function _handleStatusChange(ev){this.statusMenu.$options.removeClass("sel");var $option=$(ev.selectedOption).addClass("sel");this.$statusMenuBtn.html($option.html()),this.trashed=!1,this.drafts=!1,this.status=null,Garnish.hasAttr($option,"data-trashed")?this.trashed=!0:Garnish.hasAttr($option,"data-drafts")?this.drafts=!0:this.status=$option.data("status"),this._updateStructureSortOption(),this.updateElements()},_handleSiteChange:function _handleSiteChange(ev){this.siteMenu.$options.removeClass("sel");var $option=$(ev.selectedOption).addClass("sel");this.$siteMenuBtn.html($option.html()),this._setSite($option.data("site-id")),this.onSelectSite()},_setSite:function _setSite(siteId){var firstSite=null===this.siteId,$firstVisibleSource,$source;this.siteId=siteId,this.$visibleSources=$();for(var selectNewSource=!(firstSite||this.$source&&this.$source.length),i=0;i<this.$sources.length;i++)void 0===($source=this.$sources.eq(i)).data("sites")||-1!==$source.data("sites").toString().split(",").indexOf(siteId.toString())?($source.parent().removeClass("hidden"),this.$visibleSources=this.$visibleSources.add($source),$firstVisibleSource||($firstVisibleSource=$source)):($source.parent().addClass("hidden"),this.$source&&this.$source.get(0)==$source.get(0)&&(selectNewSource=!0));this.initialized&&selectNewSource&&this.selectSource($firstVisibleSource);var $headings=this.getSourceContainer().children(".heading"),$heading;for(i=0;i<$headings.length;i++)0!==($heading=$headings.eq(i)).nextUntil(".heading",":not(.hidden)").length?$heading.removeClass("hidden"):$heading.addClass("hidden");this.initialized&&("index"===this.settings.context&&Craft.cp.setSiteId(siteId),this.updateElements())},_handleSortChange:function _handleSortChange(ev){var $option=$(ev.selectedOption);$option.hasClass("disabled")||$option.hasClass("sel")||($option.parent().parent().is(this.$sortAttributesList)?this.setSortAttribute($option.data("attr")):this.setSortDirection($option.data("dir")),this.storeSortAttributeAndDirection(),this.updateElements())},_handleSelectionChange:function _handleSelectionChange(){this.updateActionTriggers(),this.onSelectionChange()},_handleSourceDblClick:function _handleSourceDblClick(ev){this._toggleSource($(ev.currentTarget)),ev.stopPropagation()},_handleSourceToggleClick:function _handleSourceToggleClick(ev){this._toggleSource($(ev.currentTarget).prev("a")),ev.stopPropagation()},_updateStructureSortOption:function _updateStructureSortOption(){var $option=this.getSortAttributeOption("structure");if($option.length)if(this.trashed||this.drafts||this.searching){if($option.addClass("disabled"),"structure"===this.getSelectedSortAttribute()){var $firstOption=this.$sortAttributesList.find("a:not(.disabled):first");this.setSortAttribute($firstOption.data("attr")),this.setSortDirection("asc")}}else $option.removeClass("disabled"),this.setStoredSortOptionsForSource()},_getSourcesInList:function _getSourcesInList($list){return $list.children("li").children("a")},_getChildSources:function _getChildSources($source){var $list=$source.siblings("ul");return this._getSourcesInList($list)},_getSourceToggle:function _getSourceToggle($source){return $source.siblings(".toggle")},_toggleSource:function _toggleSource($source){$source.parent("li").hasClass("expanded")?this._collapseSource($source):this._expandSource($source)},_expandSource:function _expandSource($source){$source.next(".toggle").attr({"aria-expanded":"true","aria-label":Craft.t("app","Hide nested sources")}),$source.parent("li").addClass("expanded");for(var $childSources=this._getChildSources($source),i=0;i<$childSources.length;i++)this.initSource($($childSources[i])),this.$visibleSources&&(this.$visibleSources=this.$visibleSources.add($childSources[i]));var key=$source.data("key");-1===this.instanceState.expandedSources.indexOf(key)&&(this.instanceState.expandedSources.push(key),this.storeInstanceState())},_collapseSource:function _collapseSource($source){$source.next(".toggle").attr({"aria-expanded":"false","aria-label":Craft.t("app","Show nested sources")}),$source.parent("li").removeClass("expanded");for(var $childSources=this._getChildSources($source),_i2=0;_i2<$childSources.length;_i2++)this.deinitSource($($childSources[_i2])),this.$visibleSources=this.$visibleSources.not($childSources[_i2]);var i=this.instanceState.expandedSources.indexOf($source.data("key"));-1!==i&&(this.instanceState.expandedSources.splice(i,1),this.storeInstanceState())},_isViewPaginated:function _isViewPaginated(){return"index"===this.settings.context&&"structure"!==this.getSelectedSortAttribute()},_updateView:function _updateView(params,response){var _this7=this;this.actions&&(this.hideActionTriggers(),this.actions=this.actionsHeadHtml=this.actionsFootHtml=this._$triggers=null),this.$countContainer.length&&(this.$countSpinner.removeClass("hidden"),this.$countContainer.html(""),this._countResults().then((function(total){_this7.$countSpinner.addClass("hidden");var itemLabel=Craft.elementTypeNames[_this7.elementType]?Craft.elementTypeNames[_this7.elementType][2]:"element",itemsLabel=Craft.elementTypeNames[_this7.elementType]?Craft.elementTypeNames[_this7.elementType][3]:"elements";if(_this7._isViewPaginated()){var first=Math.min(_this7.settings.batchSize*(_this7.page-1)+1,total),last=Math.min(first+(_this7.settings.batchSize-1),total),_countLabel=Craft.t("app","{first, number}-{last, number} of {total, number} {total, plural, =1{{item}} other{{items}}}",{first:first,last:last,total:total,item:itemLabel,items:itemsLabel}),$paginationContainer=$('<div class="flex pagination"/>').appendTo(_this7.$countContainer),totalPages=Math.max(Math.ceil(total/_this7.settings.batchSize),1),$prevBtn=$("<div/>",{class:"page-link prev-page"+(_this7.page>1?"":" disabled"),title:Craft.t("app","Previous Page")}).appendTo($paginationContainer),$nextBtn=$("<div/>",{class:"page-link next-page"+(_this7.page<totalPages?"":" disabled"),title:Craft.t("app","Next Page")}).appendTo($paginationContainer);$("<div/>",{class:"page-info",text:_countLabel}).appendTo($paginationContainer),_this7.page>1&&_this7.addListener($prevBtn,"click",(function(){this.removeListener($prevBtn,"click"),this.removeListener($nextBtn,"click"),this.setPage(this.page-1),this.updateElements(!0)})),_this7.page<totalPages&&_this7.addListener($nextBtn,"click",(function(){this.removeListener($prevBtn,"click"),this.removeListener($nextBtn,"click"),this.setPage(this.page+1),this.updateElements(!0)}))}else{var countLabel=Craft.t("app","{total, number} {total, plural, =1{{item}} other{{items}}}",{total:total,item:itemLabel,items:itemsLabel});_this7.$countContainer.text(countLabel)}})).catch((function(){_this7.$countSpinner.addClass("hidden")}))),this.$elements.html(response.html),Craft.appendHeadHtml(response.headHtml),Craft.appendFootHtml(response.footHtml),this.$selectAllContainer=this.$elements.find(".selectallcontainer:first"),response.actions&&response.actions.length?this.$selectAllContainer.length&&(this.actions=response.actions,this.actionsHeadHtml=response.actionsHeadHtml,this.actionsFootHtml=response.actionsFootHtml,this.$selectAllCheckbox=$('<div class="checkbox"/>').prependTo(this.$selectAllContainer),this.$selectAllContainer.attr({role:"checkbox",tabindex:"0","aria-checked":"false","aria-label":Craft.t("app","Select all")}),this.addListener(this.$selectAllContainer,"click",(function(){0===this.view.getSelectedElements().length?this.view.selectAllElements():this.view.deselectAllElements()})),this.addListener(this.$selectAllContainer,"keydown",(function(ev){ev.keyCode===Garnish.SPACE_KEY&&(ev.preventDefault(),$(ev.currentTarget).trigger("click"))}))):(this.$selectAllContainer.siblings().length||this.$selectAllContainer.parent(".header").remove(),this.$selectAllContainer.remove()),this.exporters=response.exporters,this.exportersByType=Craft.index(this.exporters||[],(function(e){return e.type})),this.exporters&&this.exporters.length?this.$exportBtn.removeClass("hidden"):this.$exportBtn.addClass("hidden");var selectable=this.actions||this.settings.selectable;if(this.view=this.createView(this.getSelectedViewMode(),{context:this.settings.context,batchSize:"index"!==this.settings.context||"structure"===this.getSelectedSortAttribute()?this.settings.batchSize:null,params:params,selectable:selectable,multiSelect:this.actions||this.settings.multiSelect,checkboxMode:!!this.actions,onSelectionChange:this._handleSelectionChange.bind(this)}),this._autoSelectElements){if(selectable)for(var i=0;i<this._autoSelectElements.length;i++)this.view.selectElementById(this._autoSelectElements[i]);this._autoSelectElements=null}this.onUpdateElements()},_updateBadgeCounts:function _updateBadgeCounts(badgeCounts){for(var sourceKey in badgeCounts)if(badgeCounts.hasOwnProperty(sourceKey)){var $source=this.getSourceByKey(sourceKey);if($source){var $badge=$source.children(".badge");null!==badgeCounts[sourceKey]?($badge.length||($badge=$('<span class="badge"/>').appendTo($source)),$badge.text(badgeCounts[sourceKey])):$badge&&$badge.remove()}}},_countResults:function _countResults(){var _this8=this;return new Promise((function(resolve,reject){if(null!==_this8.totalResults)resolve(_this8.totalResults);else{var params=_this8.getViewParams();delete params.criteria.offset,delete params.criteria.limit,null===_this8.resultSet&&(_this8.resultSet=Math.floor(1e8*Math.random())),params.resultSet=_this8.resultSet,Craft.sendActionRequest("POST",_this8.settings.countElementsAction,{data:params,cancelToken:_this8._createCancelToken()}).then((function(response){response.data.resultSet==_this8.resultSet?(_this8.totalResults=response.data.count,resolve(response.data.count)):reject()})).catch(reject)}}))},_createTriggers:function _createTriggers(){var triggers=[],safeMenuActions=[],destructiveMenuActions=[],i,$btn;for(i=0;i<this.actions.length;i++){var action=this.actions[i];if(action.trigger){var $form=$('<form id="'+Craft.formatInputId(action.type)+'-actiontrigger"/>').data("action",action).append(action.trigger);this.addListener($form,"submit","_handleActionTriggerSubmit"),triggers.push($form)}else action.destructive?destructiveMenuActions.push(action):safeMenuActions.push(action)}if(safeMenuActions.length||destructiveMenuActions.length){var $menuTrigger=$("<form/>");$btn=$("<button/>",{type:"button",class:"btn menubtn","data-icon":"settings",title:Craft.t("app","Actions")}).appendTo($menuTrigger);var $menu=$('<ul class="menu"/>').appendTo($menuTrigger),$safeList=this._createMenuTriggerList(safeMenuActions,!1),$destructiveList=this._createMenuTriggerList(destructiveMenuActions,!0);$safeList&&$safeList.appendTo($menu),$safeList&&$destructiveList&&$("<hr/>").appendTo($menu),$destructiveList&&$destructiveList.appendTo($menu),triggers.push($menuTrigger)}for(this._$triggers=$(),i=0;i<triggers.length;i++){var $div=$("<div/>").append(triggers[i]);this._$triggers=this._$triggers.add($div)}this._$triggers.appendTo(this.$toolbar),Craft.appendHeadHtml(this.actionsHeadHtml),Craft.appendFootHtml(this.actionsFootHtml),Craft.initUiElements(this._$triggers),$btn&&$btn.data("menubtn").on("optionSelect",this._handleMenuActionTriggerSubmit.bind(this))},_showExportHud:function _showExportHud(){var _this9=this;this.$exportBtn.addClass("active");for(var $form=$("<form/>",{class:"export-form"}),typeOptions=[],i=0;i<this.exporters.length;i++)typeOptions.push({label:this.exporters[i].name,value:this.exporters[i].type});var $typeField=Craft.ui.createSelectField({label:Craft.t("app","Export Type"),options:typeOptions,class:"fullwidth"}).appendTo($form),$formatField=Craft.ui.createSelectField({label:Craft.t("app","Format"),options:[{label:"CSV",value:"csv"},{label:"JSON",value:"json"},{label:"XML",value:"xml"}],class:"fullwidth"}).appendTo($form),$typeSelect=$typeField.find("select");this.addListener($typeSelect,"change",(function(){var type=$typeSelect.val();_this9.exportersByType[type].formattable?$formatField.removeClass("hidden"):$formatField.addClass("hidden")})),$typeSelect.trigger("change");var selectedElementIds=this.view.getSelectedElementIds();if(!selectedElementIds.length)var $limitField=Craft.ui.createTextField({label:Craft.t("app","Limit"),placeholder:Craft.t("app","No limit"),type:"number",min:1}).appendTo($form);$("<button/>",{type:"submit",class:"btn submit fullwidth",text:Craft.t("app","Export")}).appendTo($form);var $spinner=$("<div/>",{class:"spinner hidden"}).appendTo($form),hud;new Garnish.HUD(this.$exportBtn,$form).on("hide",(function(){_this9.$exportBtn.removeClass("active")}));var submitting=!1;this.addListener($form,"submit",(function(ev){if(ev.preventDefault(),!submitting){submitting=!0,$spinner.removeClass("hidden");var params=this.getViewParams();if(delete params.criteria.offset,delete params.criteria.limit,params.type=$typeField.find("select").val(),params.format=$formatField.find("select").val(),selectedElementIds.length)params.criteria.id=selectedElementIds;else{var limit=parseInt($limitField.find("input").val());limit&&!isNaN(limit)&&(params.criteria.limit=limit)}Craft.csrfTokenValue&&(params[Craft.csrfTokenName]=Craft.csrfTokenValue),Craft.downloadFromUrl("POST",Craft.getActionUrl("element-indexes/export"),params).then((function(){submitting=!1,$spinner.addClass("hidden")})).catch((function(){submitting=!1,$spinner.addClass("hidden"),this._ignoreFailedRequest||Craft.cp.displayError(Craft.t("app","A server error occurred."))}))}}))},_createMenuTriggerList:function _createMenuTriggerList(actions,destructive){if(actions&&actions.length){for(var $ul=$("<ul/>"),i=0;i<actions.length;i++)$("<li/>").append($("<a/>",{id:Craft.formatInputId(actions[i].type)+"-actiontrigger",class:destructive?"error":null,data:{action:actions[i]},text:actions[i].name})).appendTo($ul);return $ul}}},{defaults:{context:"index",modal:null,storageKey:null,criteria:null,batchSize:100,disabledElementIds:[],selectable:!1,multiSelect:!1,buttonContainer:null,hideSidebar:!1,toolbarSelector:".toolbar:first",refreshSourcesAction:"element-indexes/get-source-tree-html",updateElementsAction:"element-indexes/get-elements",countElementsAction:"element-indexes/count-elements",submitActionsAction:"element-indexes/perform-action",defaultSiteId:null,defaultSource:null,canHaveDrafts:!1,onAfterInit:$.noop,onSelectSource:$.noop,onSelectSite:$.noop,onUpdateElements:$.noop,onSelectionChange:$.noop,onEnableElements:$.noop,onDisableElements:$.noop,onAfterAction:$.noop}})},function(module,exports){Craft.BaseElementIndexView=Garnish.Base.extend({$container:null,$loadingMoreSpinner:null,$elementContainer:null,$scroller:null,elementIndex:null,thumbLoader:null,elementSelect:null,loadingMore:!1,_totalVisible:null,_morePending:null,_handleEnableElements:null,_handleDisableElements:null,init:function init(elementIndex,container,settings){var _this=this;this.elementIndex=elementIndex,this.$container=$(container),this.setSettings(settings,Craft.BaseElementIndexView.defaults),this.$loadingMoreSpinner=$('<div class="centeralign hidden"><div class="spinner loadingmore"></div></div>').insertAfter(this.$container),this.$elementContainer=this.getElementContainer();var $elements=this.$elementContainer.children();this.setTotalVisible($elements.length),this.setMorePending(this.settings.batchSize&&$elements.length==this.settings.batchSize),this.thumbLoader=new Craft.ElementThumbLoader,this.thumbLoader.load($elements),this.settings.selectable&&(this.elementSelect=new Garnish.Select(this.$elementContainer,$elements.filter(":not(.disabled)"),{multi:this.settings.multiSelect,vertical:this.isVerticalList(),handle:"index"===this.settings.context?".checkbox, .element:first":null,filter:":not(a):not(.toggle)",checkboxMode:this.settings.checkboxMode,onSelectionChange:this.onSelectionChange.bind(this)}),this._handleEnableElements=function(ev){_this.elementSelect.addItems(ev.elements)},this._handleDisableElements=function(ev){_this.elementSelect.removeItems(ev.elements)},this.elementIndex.on("enableElements",this._handleEnableElements),this.elementIndex.on("disableElements",this._handleDisableElements)),"index"===this.settings.context&&(this._handleElementEditing=function(ev){var $target=$(ev.target);if("A"!==$target.prop("nodeName")){var $element;if($target.hasClass("element"))$element=$target;else if(!($element=$target.closest(".element")).length)return;Garnish.hasAttr($element,"data-editable")&&_this.createElementEditor($element)}},this.elementIndex.trashed||(this.addListener(this.$elementContainer,"dblclick",this._handleElementEditing),$.isTouchCapable()&&this.addListener(this.$elementContainer,"taphold",this._handleElementEditing))),this.afterInit(),this.settings.batchSize&&("index"===this.settings.context?this.$scroller=Garnish.$scrollContainer:this.$scroller=this.elementIndex.$main,this.$scroller.scrollTop(0),this.addListener(this.$scroller,"scroll","maybeLoadMore"),this.maybeLoadMore())},getElementContainer:function getElementContainer(){throw"Classes that extend Craft.BaseElementIndexView must supply a getElementContainer() method."},afterInit:function afterInit(){},getAllElements:function getAllElements(){return this.$elementContainer.children()},getEnabledElements:function getEnabledElements(){return this.$elementContainer.children(":not(.disabled)")},getElementById:function getElementById(id){var $element=this.$elementContainer.children('[data-id="'+id+'"]:first');return $element.length?$element:null},getSelectedElements:function getSelectedElements(){if(!this.elementSelect)throw"This view is not selectable.";return this.elementSelect.$selectedItems},getSelectedElementIds:function getSelectedElementIds(){var $selectedElements;try{$selectedElements=this.getSelectedElements()}catch(e){}var ids=[];if($selectedElements)for(var i=0;i<$selectedElements.length;i++)ids.push($selectedElements.eq(i).data("id"));return ids},selectElement:function selectElement($element){if(!this.elementSelect)throw"This view is not selectable.";return this.elementSelect.selectItem($element,!0),!0},selectElementById:function selectElementById(id){if(!this.elementSelect)throw"This view is not selectable.";var $element=this.getElementById(id);return!!$element&&(this.elementSelect.selectItem($element,!0),!0)},selectAllElements:function selectAllElements(){this.elementSelect.selectAll()},deselectAllElements:function deselectAllElements(){this.elementSelect.deselectAll()},isVerticalList:function isVerticalList(){return!1},getTotalVisible:function getTotalVisible(){return this._totalVisible},setTotalVisible:function setTotalVisible(totalVisible){this._totalVisible=totalVisible},getMorePending:function getMorePending(){return this._morePending},setMorePending:function setMorePending(morePending){this._morePending=morePending},maybeLoadMore:function maybeLoadMore(){this.canLoadMore()&&this.loadMore()},canLoadMore:function canLoadMore(){return!(!this.getMorePending()||!this.settings.batchSize)&&(this.$scroller[0]===Garnish.$win[0]?Garnish.$win.innerHeight()+Garnish.$win.scrollTop()>=this.$container.offset().top+(containerHeight=this.$container.height()):this.$scroller.prop("scrollHeight")-this.$scroller.scrollTop()<=(containerHeight=this.$scroller.outerHeight())+15);var containerHeight,winHeight,winScrollTop,containerOffset,containerScrollHeight,containerScrollTop},loadMore:function loadMore(){var _this2=this;this.getMorePending()&&!this.loadingMore&&this.settings.batchSize&&(this.loadingMore=!0,this.$loadingMoreSpinner.removeClass("hidden"),this.removeListener(this.$scroller,"scroll"),Craft.sendActionRequest("POST",this.settings.loadMoreElementsAction,{data:this.getLoadMoreParams()}).then((function(response){_this2.loadingMore=!1,_this2.$loadingMoreSpinner.addClass("hidden");var $newElements=$(response.data.html);_this2.appendElements($newElements),Craft.appendHeadHtml(response.data.headHtml),Craft.appendFootHtml(response.data.footHtml),_this2.elementSelect&&(_this2.elementSelect.addItems($newElements.filter(":not(.disabled)")),_this2.elementIndex.updateActionTriggers()),_this2.setTotalVisible(_this2.getTotalVisible()+$newElements.length),_this2.setMorePending($newElements.length==_this2.settings.batchSize),_this2.addListener(_this2.$scroller,"scroll","maybeLoadMore"),_this2.maybeLoadMore()})).catch((function(e){_this2.loadingMore=!1,_this2.$loadingMoreSpinner.addClass("hidden")})))},getLoadMoreParams:function getLoadMoreParams(){var params=$.extend(!0,{},this.settings.params);return params.criteria.offset=this.getTotalVisible(),params},appendElements:function appendElements($newElements){$newElements.appendTo(this.$elementContainer),this.thumbLoader.load($newElements),this.onAppendElements($newElements)},onAppendElements:function onAppendElements($newElements){this.settings.onAppendElements($newElements),this.trigger("appendElements",{newElements:$newElements})},onSelectionChange:function onSelectionChange(){this.settings.onSelectionChange(),this.trigger("selectionChange")},createElementEditor:function createElementEditor($element){Craft.createElementEditor($element.data("type"),$element,{elementIndex:this.elementIndex})},disable:function disable(){this.elementSelect&&this.elementSelect.disable()},enable:function enable(){this.elementSelect&&this.elementSelect.enable()},destroy:function destroy(){this.$loadingMoreSpinner.remove(),this.thumbLoader.destroy(),delete this.thumbLoader,this.elementSelect&&(this.elementIndex.off("enableElements",this._handleEnableElements),this.elementIndex.off("disableElements",this._handleDisableElements),this.elementSelect.destroy(),delete this.elementSelect),this.base()}},{defaults:{context:"index",batchSize:null,params:null,selectable:!1,multiSelect:!1,checkboxMode:!1,loadMoreElementsAction:"element-indexes/get-more-elements",onAppendElements:$.noop,onSelectionChange:$.noop}})},function(module,exports){function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _iterableToArray(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}Craft.BaseElementSelectInput=Garnish.Base.extend({thumbLoader:null,elementSelect:null,elementSort:null,modal:null,elementEditor:null,$container:null,$elementsContainer:null,$elements:null,$addElementBtn:null,$addElementBtnContainer:null,_initialized:!1,init:function init(settings){var _this=this;if(!$.isPlainObject(settings)){for(var normalizedSettings={},args=["id","name","elementType","sources","criteria","sourceElementId","limit","modalStorageKey","fieldId"],i=0;i<args.length&&void 0!==arguments[i];i++)normalizedSettings[args[i]]=arguments[i];settings=normalizedSettings}this.setSettings(settings,Craft.BaseElementSelectInput.defaults),this.settings.modalStorageKey&&(this.modalStorageKey="BaseElementSelectInput."+this.settings.modalStorageKey),1==this.settings.limit&&(this.settings.sortable=!1),this.$container=this.getContainer(),this.$container.data("elementSelect",this),this.$elementsContainer=this.getElementsContainer(),this.$addElementBtn=this.getAddElementsBtn(),this.$addElementBtn&&(this.$addElementBtnContainer=this.$addElementBtn.parent(".flex"),this.$addElementBtnContainer.length||(this.$addElementBtnContainer=null)),this.thumbLoader=new Craft.ElementThumbLoader,this.initElementSelect(),this.initElementSort(),this.resetElements(),this.$addElementBtn&&this.addListener(this.$addElementBtn,"activate","showModal"),Garnish.requestAnimationFrame((function(){_this._initialized=!0}))},get totalSelected(){return this.$elements.length},getContainer:function getContainer(){return $("#"+this.settings.id)},getElementsContainer:function getElementsContainer(){return this.$container.children(".elements")},getElements:function getElements(){return this.$elementsContainer.children()},getAddElementsBtn:function getAddElementsBtn(){return this.$container.find(".btn.add:first")},initElementSelect:function initElementSelect(){this.settings.selectable&&(this.elementSelect=new Garnish.Select({multi:this.settings.sortable,filter:":not(.delete)"}))},initElementSort:function initElementSort(){var _this2=this;this.settings.sortable&&(this.elementSort=new Garnish.DragSort({container:this.$elementsContainer,filter:this.settings.selectable?function(){return _this2.elementSort.$targetItem.hasClass("sel")?_this2.elementSelect.getSelectedItems():_this2.elementSort.$targetItem}:null,ignoreHandleSelector:".delete",axis:this.getElementSortAxis(),collapseDraggees:!0,magnetStrength:4,helperLagBase:1.5,onSortChange:this.settings.selectable?function(){_this2.elementSelect.resetItemOrder()}:null}))},getElementSortAxis:function getElementSortAxis(){return"list"===this.settings.viewMode?"y":null},canAddMoreElements:function canAddMoreElements(){return!this.settings.limit||this.$elements.length<this.settings.limit},updateAddElementsBtn:function updateAddElementsBtn(){this.canAddMoreElements()?this.enableAddElementsBtn():this.disableAddElementsBtn()},disableAddElementsBtn:function disableAddElementsBtn(){var $btn=this.$addElementBtnContainer||this.$addElementBtn;$btn&&$btn.addClass("hidden")},enableAddElementsBtn:function enableAddElementsBtn(){var $btn=this.$addElementBtnContainer||this.$addElementBtn;$btn&&$btn.removeClass("hidden")},resetElements:function resetElements(){null!==this.$elements?this.removeElements(this.$elements):this.$elements=$(),this.addElements(this.getElements())},addElements:function addElements($elements){var _this3=this;this.thumbLoader.load($elements),this.settings.selectable&&this.elementSelect.addItems($elements),this.settings.sortable&&this.elementSort.addItems($elements),this.settings.editable&&(this._handleShowElementEditor=function(ev){var $element=$(ev.currentTarget);!Garnish.hasAttr($element,"data-editable")||$element.hasClass("disabled")||$element.hasClass("loading")||(_this3.elementEditor=_this3.createElementEditor($element))},this.addListener($elements,"dblclick",this._handleShowElementEditor),$.isTouchCapable()&&this.addListener($elements,"taphold",this._handleShowElementEditor)),$elements.find(".delete").on("click dblclick",(function(ev){_this3.removeElement($(ev.currentTarget).closest(".element")),ev.stopPropagation()})),this.$elements=this.$elements.add($elements),this.updateAddElementsBtn()},createElementEditor:function createElementEditor($element,settings){return settings||(settings={}),settings.prevalidate=this.settings.prevalidate,Craft.createElementEditor(this.settings.elementType,$element,settings)},removeElements:function removeElements($elements){if(this.settings.selectable&&this.elementSelect.removeItems($elements),this.modal){for(var ids=[],i=0;i<$elements.length;i++){var id=$elements.eq(i).data("id");id&&ids.push(id)}ids.length&&this.modal.elementIndex.enableElementsById(ids)}$elements.children("input").prop("disabled",!0),this.$elements=this.$elements.not($elements),this.updateAddElementsBtn(),this.onRemoveElements()},removeElement:function removeElement($element){this.removeElements($element),this.animateElementAway($element,(function(){$element.remove()}))},animateElementAway:function animateElementAway($element,callback){$element.css("z-index",0);var animateCss={opacity:-1};animateCss["margin-"+Craft.left]=-($element.outerWidth()+parseInt($element.css("margin-"+Craft.right))),"list"!==this.settings.viewMode&&0!==this.$elements.length||(animateCss["margin-bottom"]=-($element.outerHeight()+parseInt($element.css("margin-bottom")))),window.draftEditor&&window.draftEditor.pause(),$element.velocity(animateCss,Craft.BaseElementSelectInput.REMOVE_FX_DURATION,(function(){callback(),window.draftEditor&&window.draftEditor.resume()}))},showModal:function showModal(){this.canAddMoreElements()&&(this.modal?this.modal.show():this.modal=this.createModal())},createModal:function createModal(){return Craft.createElementSelectorModal(this.settings.elementType,this.getModalSettings())},getModalSettings:function getModalSettings(){return $.extend({closeOtherModals:!1,storageKey:this.modalStorageKey,sources:this.settings.sources,criteria:this.settings.criteria,multiSelect:1!=this.settings.limit,showSiteMenu:this.settings.showSiteMenu,disabledElementIds:this.getDisabledElementIds(),onSelect:this.onModalSelect.bind(this)},this.settings.modalSettings)},getSelectedElementIds:function getSelectedElementIds(){for(var ids=[],i=0;i<this.$elements.length;i++)ids.push(this.$elements.eq(i).data("id"));return ids},getDisabledElementIds:function getDisabledElementIds(){var ids=this.getSelectedElementIds();return!this.settings.allowSelfRelations&&this.settings.sourceElementId&&ids.push(this.settings.sourceElementId),this.settings.disabledElementIds&&ids.push.apply(ids,_toConsumableArray(this.settings.disabledElementIds)),ids},onModalSelect:function onModalSelect(elements){if(this.settings.limit){var slotsLeft=this.settings.limit-this.$elements.length;elements.length>slotsLeft&&(elements=elements.slice(0,slotsLeft))}this.selectElements(elements),this.updateDisabledElementsInModal()},selectElements:function selectElements(elements){for(var i=0;i<elements.length;i++){var elementInfo=elements[i],$element=this.createNewElement(elementInfo);this.appendElement($element),this.addElements($element),this.animateElementIntoPlace(elementInfo.$element,$element),elementInfo.$element=$element}this.onSelectElements(elements)},createNewElement:function createNewElement(elementInfo){var $element=elementInfo.$element.clone();return Craft.setElementSize($element,"large"===this.settings.viewMode?"large":"small"),$element.addClass("removable"),$element.prepend('<input type="hidden" name="'.concat(this.settings.name).concat(this.settings.single?"":"[]",'" value="').concat(elementInfo.id,'">')+'<a class="delete icon" title="'+Craft.t("app","Remove")+'"></a>'),$element},appendElement:function appendElement($element){$element.appendTo(this.$elementsContainer)},animateElementIntoPlace:function animateElementIntoPlace($modalElement,$inputElement){var origOffset=$modalElement.offset(),destOffset=$inputElement.offset(),$helper=$inputElement.clone().appendTo(Garnish.$bod);$inputElement.css("visibility","hidden"),$helper.css({position:"absolute",zIndex:1e4,top:origOffset.top,left:origOffset.left});var animateCss={top:destOffset.top,left:destOffset.left};$helper.velocity(animateCss,Craft.BaseElementSelectInput.ADD_FX_DURATION,(function(){$helper.remove(),$inputElement.css("visibility","visible")}))},updateDisabledElementsInModal:function updateDisabledElementsInModal(){this.modal.elementIndex&&this.modal.elementIndex.disableElementsById(this.getDisabledElementIds())},getElementById:function getElementById(id){for(var i=0;i<this.$elements.length;i++){var $element=this.$elements.eq(i);if($element.data("id")==id)return $element}},onSelectElements:function onSelectElements(elements){this.trigger("selectElements",{elements:elements}),this.settings.onSelectElements(elements),window.draftEditor&&window.draftEditor.checkForm()},onRemoveElements:function onRemoveElements(){this.trigger("removeElements"),this.settings.onRemoveElements()}},{ADD_FX_DURATION:200,REMOVE_FX_DURATION:200,defaults:{id:null,name:null,fieldId:null,elementType:null,sources:null,criteria:{},allowSelfRelations:!1,sourceElementId:null,disabledElementIds:null,viewMode:"list",single:!1,limit:null,showSiteMenu:!1,modalStorageKey:null,modalSettings:{},onSelectElements:$.noop,onRemoveElements:$.noop,sortable:!0,selectable:!0,editable:!0,prevalidate:!1,editorSettings:{}}})},function(module,exports){Craft.BaseElementSelectorModal=Garnish.Modal.extend({elementType:null,elementIndex:null,$body:null,$selectBtn:null,$sidebar:null,$sources:null,$sourceToggles:null,$main:null,$search:null,$elements:null,$tbody:null,$primaryButtons:null,$secondaryButtons:null,$cancelBtn:null,$footerSpinner:null,init:function init(elementType,settings){this.elementType=elementType,this.setSettings(settings,Craft.BaseElementSelectorModal.defaults);var $container=$('<div class="modal elementselectormodal"></div>').appendTo(Garnish.$bod),$body=$('<div class="body"><div class="spinner big"></div></div>').appendTo($container),$footer=$('<div class="footer"/>').appendTo($container);this.base($container,this.settings),this.$footerSpinner=$('<div class="spinner hidden"/>').appendTo($footer),this.$primaryButtons=$('<div class="buttons right"/>').appendTo($footer),this.$secondaryButtons=$('<div class="buttons left secondary-buttons"/>').appendTo($footer),this.$cancelBtn=$("<button/>",{type:"button",class:"btn",text:Craft.t("app","Cancel")}).appendTo(this.$primaryButtons),this.$selectBtn=$("<button/>",{type:"button",class:"btn disabled submit",text:Craft.t("app","Select")}).appendTo(this.$primaryButtons),this.$body=$body,this.addListener(this.$cancelBtn,"activate","cancel"),this.addListener(this.$selectBtn,"activate","selectElements")},onFadeIn:function onFadeIn(){this.elementIndex?Garnish.isMobileBrowser(!0)||this.elementIndex.$search.trigger("focus"):this._createElementIndex(),this.base()},onSelectionChange:function onSelectionChange(){this.updateSelectBtnState()},updateSelectBtnState:function updateSelectBtnState(){this.$selectBtn&&(this.elementIndex.getSelectedElements().length?this.enableSelectBtn():this.disableSelectBtn())},enableSelectBtn:function enableSelectBtn(){this.$selectBtn.removeClass("disabled")},disableSelectBtn:function disableSelectBtn(){this.$selectBtn.addClass("disabled")},enableCancelBtn:function enableCancelBtn(){this.$cancelBtn.removeClass("disabled")},disableCancelBtn:function disableCancelBtn(){this.$cancelBtn.addClass("disabled")},showFooterSpinner:function showFooterSpinner(){this.$footerSpinner.removeClass("hidden")},hideFooterSpinner:function hideFooterSpinner(){this.$footerSpinner.addClass("hidden")},cancel:function cancel(){this.$cancelBtn.hasClass("disabled")||this.hide()},selectElements:function selectElements(){if(this.elementIndex&&this.elementIndex.getSelectedElements().length){this.elementIndex.view.elementSelect.clearMouseUpTimeout();var $selectedElements=this.elementIndex.getSelectedElements(),elementInfo=this.getElementInfo($selectedElements);this.onSelect(elementInfo),this.settings.disableElementsOnSelect&&this.elementIndex.disableElements(this.elementIndex.getSelectedElements()),this.settings.hideOnSelect&&this.hide()}},getElementInfo:function getElementInfo($selectedElements){for(var info=[],i=0;i<$selectedElements.length;i++){var $element=$($selectedElements[i]),elementInfo=Craft.getElementInfo($element);info.push(elementInfo)}return info},show:function show(){this.updateSelectBtnState(),this.base()},onSelect:function onSelect(elementInfo){this.settings.onSelect(elementInfo)},disable:function disable(){this.elementIndex&&this.elementIndex.disable(),this.base()},enable:function enable(){this.elementIndex&&this.elementIndex.enable(),this.base()},_createElementIndex:function _createElementIndex(){var _this=this,data={context:"modal",elementType:this.elementType,sources:this.settings.sources};null!==this.settings.showSiteMenu&&"auto"!==this.settings.showSiteMenu&&(data.showSiteMenu=this.settings.showSiteMenu?"1":"0"),Craft.postActionRequest("elements/get-modal-body",data,(function(response,textStatus){"success"===textStatus&&(_this.$body.html(response.html),_this.$body.has(".sidebar:not(.hidden)").length&&_this.$body.addClass("has-sidebar"),_this.elementIndex=Craft.createElementIndex(_this.elementType,_this.$body,{context:"modal",modal:_this,storageKey:_this.settings.storageKey,criteria:_this.settings.criteria,disabledElementIds:_this.settings.disabledElementIds,selectable:!0,multiSelect:_this.settings.multiSelect,buttonContainer:_this.$secondaryButtons,onSelectionChange:_this.onSelectionChange.bind(_this),hideSidebar:_this.settings.hideSidebar,defaultSiteId:_this.settings.defaultSiteId,defaultSource:_this.settings.defaultSource}),_this.addListener(_this.elementIndex.$elements,"doubletap",(function(ev,touchData){touchData.firstTap.target===touchData.secondTap.target&&this.selectElements()})))}))}},{defaults:{resizable:!0,storageKey:null,sources:null,criteria:null,multiSelect:!1,showSiteMenu:null,disabledElementIds:[],disableElementsOnSelect:!1,hideOnSelect:!0,onCancel:$.noop,onSelect:$.noop,hideSidebar:!1,defaultSiteId:null,defaultSource:null}})},function(module,exports){Craft.BaseInputGenerator=Garnish.Base.extend({$source:null,$target:null,$form:null,settings:null,listening:null,timeout:null,init:function init(source,target,settings){this.$source=$(source),this.$target=$(target),this.$form=this.$source.closest("form"),this.setSettings(settings),this.startListening()},setNewSource:function setNewSource(source){var listening=this.listening;this.stopListening(),this.$source=$(source),listening&&this.startListening()},startListening:function startListening(){this.listening||(this.listening=!0,this.addListener(this.$source,"input","onSourceTextChange"),this.addListener(this.$target,"input","onTargetTextChange"),this.addListener(this.$form,"submit","onFormSubmit"))},stopListening:function stopListening(){this.listening&&(this.listening=!1,this.timeout&&clearTimeout(this.timeout),this.removeAllListeners(this.$source),this.removeAllListeners(this.$target),this.removeAllListeners(this.$form))},onSourceTextChange:function onSourceTextChange(){this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(this.updateTarget.bind(this),250)},onTargetTextChange:function onTargetTextChange(){this.$target.get(0)===document.activeElement&&this.stopListening()},onFormSubmit:function onFormSubmit(){this.timeout&&clearTimeout(this.timeout),this.updateTarget()},updateTarget:function updateTarget(){if(this.$target.is(":visible")){var sourceVal=this.$source.val();if(void 0!==sourceVal){var targetVal=this.generateTargetValue(sourceVal);this.$target.val(targetVal);for(var i=0;i<this.$target.length;i++)this.$target[i].dispatchEvent(new InputEvent("input",{inputType:"insertText"})),this.$target[i].dispatchEvent(new Event("input"));this.$target.is(":focus")&&Craft.selectFullValue(this.$target)}}},generateTargetValue:function generateTargetValue(sourceVal){return sourceVal}})},function(module,exports){Craft.Tabs=Garnish.Base.extend({$container:null,$ul:null,$menuBtn:null,$tabs:null,$selectedTab:null,$focusableTab:null,menu:null,init:function init(container){var _this=this;this.$container=$(container),this.$ul=this.$container.find("> ul:first"),this.$tabs=this.$ul.find("> li > a"),this.$selectedTab=this.$tabs.filter(".sel:first"),this.$focusableTab=this.$tabs.filter("[tabindex=0]:first"),this.$menuBtn=this.$container.find("> .menubtn:first").menubtn(),this.menu=this.$menuBtn.data("menubtn").menu,this.$container.data("tabs")&&(Garnish.log("Double-instantiating a tab manager on an element"),this.$container.data("tabs").destroy()),this.$container.data("tabs",this);for(var i=0;i<this.$tabs.length;i++){var $a=this.$tabs.eq(i),href=$a.attr("href");href&&"#"===href.charAt(0)&&(this.addListener($a,"keydown",(function(ev){[Garnish.SPACE_KEY,Garnish.RETURN_KEY].includes(ev.keyCode)&&(ev.preventDefault(),_this.selectTab(ev.currentTarget))})),this.addListener($a,"click",(function(ev){ev.preventDefault();var $a=$(ev.currentTarget);_this.selectTab(ev.currentTarget),_this.makeTabFocusable(ev.currentTarget)})),href.substr(1)===window.LOCATION_HASH&&($initialTab=$a)),this.addListener($a,"keydown",(function(ev){var $tab;[Garnish.LEFT_KEY,Garnish.RIGHT_KEY].includes(ev.keyCode)&&$.contains(_this.$ul[0],ev.currentTarget)&&(($tab=ev.keyCode===("ltr"===Craft.orientation?Garnish.LEFT_KEY:Garnish.RIGHT_KEY)?$(ev.currentTarget).parent().prev("li").children("a"):$(ev.currentTarget).parent().next("li").children("a")).length&&(ev.preventDefault(),_this.makeTabFocusable($tab),$tab.focus(),_this.scrollToTab($tab)))}))}this.updateMenuBtn(),Garnish.$win.on("resize",(function(){_this.updateMenuBtn()})),this.menu.$options.on("click",(function(ev){var $option;"#"===$(ev.currentTarget).attr("href").charAt(0)&&ev.preventDefault()})),this.menu.on("optionselect",(function(ev){_this.selectTab($(ev.selectedOption).data("id"))}))},selectTab:function selectTab(tab){var $tab=this._getTab(tab);$tab[0]!==this.$selectedTab[0]&&(this.deselectTab(),this.$selectedTab=$tab.addClass("sel"),this.makeTabFocusable($tab),this.scrollToTab($tab),this.menu.$options.removeClass("sel"),this.menu.$options.filter('[data-id="'.concat($tab.data("id"),'"]')).addClass("sel"),this.trigger("selectTab",{$tab:$tab}))},deselectTab:function deselectTab(){var $tab=this.$selectedTab.removeClass("sel");this.$selectedTab=null,this.trigger("deselectTab",{$tab:$tab})},makeTabFocusable:function makeTabFocusable(tab){var $tab=this._getTab(tab);$tab[0]!==this.$focusableTab[0]&&(this.$focusableTab.attr("tabindex","-1"),this.$focusableTab=$tab.attr("tabindex","0"))},scrollToTab:function scrollToTab(tab){var $tab=this._getTab(tab),scrollLeft=this.$ul.scrollLeft(),tabOffset,elemScrollOffset=$tab.offset().left-this.$ul.offset().left,targetScrollLeft=!1;if(elemScrollOffset<0)targetScrollLeft=scrollLeft+elemScrollOffset-24;else{var tabWidth=$tab.outerWidth(),ulWidth=this.$ul.prop("clientWidth");elemScrollOffset+tabWidth>ulWidth&&(targetScrollLeft=scrollLeft+(elemScrollOffset-(ulWidth-tabWidth))+24)}!1!==targetScrollLeft&&this.$ul.scrollLeft(targetScrollLeft)},updateMenuBtn:function updateMenuBtn(){Math.floor(this.$ul.prop("scrollWidth")-48)>this.$container.prop("clientWidth")?(this.$ul.addClass("scrollable"),this.$menuBtn.removeClass("hidden")):(this.$ul.removeClass("scrollable"),this.$menuBtn.addClass("hidden"))},_getTab:function _getTab(tab){if(tab instanceof jQuery)return tab;if(tab instanceof HTMLElement)return $(tab);if("string"!=typeof tab)throw"Invalid tab ID";var $tab=this.$tabs.filter('[data-id="'.concat(tab,'"]'));if(!$tab.length)throw"Invalid tab ID: ".concat(tab);return $tab}})},function(module,exports){Craft.AdminTable=Garnish.Base.extend({settings:null,totalItems:null,sorter:null,$noItems:null,$table:null,$tbody:null,$deleteBtns:null,init:function init(settings){this.setSettings(settings,Craft.AdminTable.defaults),this.settings.allowDeleteAll||(this.settings.minItems=1),this.$noItems=$(this.settings.noItemsSelector),this.$table=$(this.settings.tableSelector),this.$tbody=this.$table.children("tbody"),this.totalItems=this.$tbody.children().length,this.settings.sortable&&(this.sorter=new Craft.DataTableSorter(this.$table,{onSortChange:this.reorderItems.bind(this)})),this.$deleteBtns=this.$table.find(".delete:not(.disabled)"),this.addListener(this.$deleteBtns,"click","handleDeleteBtnClick"),this.updateUI()},addRow:function addRow(row){if(!(this.settings.maxItems&&this.totalItems>=this.settings.maxItems)){var $row=$(row).appendTo(this.$tbody),$deleteBtn=$row.find(".delete");this.settings.sortable&&this.sorter.addItems($row),this.$deleteBtns=this.$deleteBtns.add($deleteBtn),this.addListener($deleteBtn,"click","handleDeleteBtnClick"),this.totalItems++,this.updateUI()}},reorderItems:function reorderItems(){var _this=this;if(this.settings.sortable){for(var ids=[],i=0;i<this.sorter.$items.length;i++){var id=$(this.sorter.$items[i]).attr(this.settings.idAttribute);ids.push(id)}var data={ids:JSON.stringify(ids)};Craft.postActionRequest(this.settings.reorderAction,data,(function(response,textStatus){"success"===textStatus&&(response.success?(_this.onReorderItems(ids),Craft.cp.displayNotice(Craft.t("app",_this.settings.reorderSuccessMessage))):Craft.cp.displayError(Craft.t("app",_this.settings.reorderFailMessage)))}))}},handleDeleteBtnClick:function handleDeleteBtnClick(event){if(!(this.settings.minItems&&this.totalItems<=this.settings.minItems)){var $row=$(event.target).closest("tr");this.confirmDeleteItem($row)&&this.deleteItem($row)}},confirmDeleteItem:function confirmDeleteItem($row){var name=this.getItemName($row);return confirm(Craft.t("app",this.settings.confirmDeleteMessage,{name:name}))},deleteItem:function deleteItem($row){var _this2=this,data={id:this.getItemId($row)};Craft.postActionRequest(this.settings.deleteAction,data,(function(response,textStatus){"success"===textStatus&&_this2.handleDeleteItemResponse(response,$row)}))},handleDeleteItemResponse:function handleDeleteItemResponse(response,$row){var id=this.getItemId($row),name=this.getItemName($row);response.success?(this.sorter&&this.sorter.removeItems($row),$row.remove(),this.totalItems--,this.updateUI(),this.onDeleteItem(id),Craft.cp.displayNotice(Craft.t("app",this.settings.deleteSuccessMessage,{name:name}))):Craft.cp.displayError(Craft.t("app",this.settings.deleteFailMessage,{name:name}))},onReorderItems:function onReorderItems(ids){this.settings.onReorderItems(ids)},onDeleteItem:function onDeleteItem(id){this.settings.onDeleteItem(id)},getItemId:function getItemId($row){return $row.attr(this.settings.idAttribute)},getItemName:function getItemName($row){return Craft.escapeHtml($row.attr(this.settings.nameAttribute))},updateUI:function updateUI(){if(0===this.totalItems?(this.$table.hide(),this.$noItems.removeClass("hidden")):(this.$table.show(),this.$noItems.addClass("hidden")),this.settings.sortable){var $moveButtons=this.$table.find(".move");1===this.totalItems?$moveButtons.addClass("disabled"):$moveButtons.removeClass("disabled")}this.settings.minItems&&this.totalItems<=this.settings.minItems?this.$deleteBtns.addClass("disabled"):this.$deleteBtns.removeClass("disabled"),this.settings.newItemBtnSelector&&(this.settings.maxItems&&this.totalItems>=this.settings.maxItems?$(this.settings.newItemBtnSelector).addClass("hidden"):$(this.settings.newItemBtnSelector).removeClass("hidden"))}},{defaults:{tableSelector:null,noItemsSelector:null,newItemBtnSelector:null,idAttribute:"data-id",nameAttribute:"data-name",sortable:!1,allowDeleteAll:!0,minItems:0,maxItems:null,reorderAction:null,deleteAction:null,reorderSuccessMessage:Craft.t("app","New order saved."),reorderFailMessage:Craft.t("app","Couldn’t save new order."),confirmDeleteMessage:Craft.t("app","Are you sure you want to delete “{name}”?"),deleteSuccessMessage:Craft.t("app","“{name}” deleted."),deleteFailMessage:Craft.t("app","Couldn’t delete “{name}”."),onReorderItems:$.noop,onDeleteItem:$.noop}})},function(module,exports){Craft.AssetEditor=Craft.BaseElementEditor.extend({$filenameInput:null,originalBasename:null,originalExtension:null,reloadIndex:!1,init:function init(element,settings){var _this=this;this.on("updateForm",(function(){_this.addListener(_this.$sidebar.find(".preview-thumb-container .edit-btn"),"click","showImageEditor"),_this.addListener(_this.$sidebar.find(".preview-thumb-container .preview-btn"),"click","showImagePreview"),_this.$filenameInput=_this.$sidebar.find(".filename"),_this.addListener(_this.$filenameInput,"focus","selectFilename")})),this.on("closeSlideout",(function(){_this.reloadIndex&&(_this.settings.elementIndex?_this.settings.elementIndex.updateElements():_this.settings.input&&_this.settings.input.refreshThumbnail(_this.$element.data("id")))})),this.base(element,settings),this.settings.validators.push((function(){return _this.validateExtension()}))},showImageEditor:function showImageEditor(){var _this2=this;new Craft.AssetImageEditor(this.$element.data("id"),{onSave:function onSave(){_this2.reloadIndex=!0,_this2.load()}})},showImagePreview:function showImagePreview(){var settings={};this.$element.data("image-width")&&(settings.startingWidth=this.$element.data("image-width"),settings.startingHeight=this.$element.data("image-height")),new Craft.PreviewFileModal(this.$element.data("id"),null,settings)},selectFilename:function selectFilename(){var _this3=this;if(void 0!==this.$filenameInput[0].selectionStart){var _this$_parseFilename=this._parseFilename(),basename=_this$_parseFilename.basename,extension=_this$_parseFilename.extension;null===this.originalBasename&&(this.originalBasename=basename,this.originalExtension=extension),this.$filenameInput[0].selectionStart=0,this.$filenameInput[0].selectionEnd=basename.length,this.$filenameInput.one("mouseup.keepselection",(function(ev){ev.preventDefault()})),setTimeout((function(){_this3.$filenameInput.off("mouseup.keepselection")}),500)}},validateExtension:function validateExtension(){if(null===this.originalBasename)return!0;var _this$_parseFilename2=this._parseFilename(),basename=_this$_parseFilename2.basename,extension=_this$_parseFilename2.extension;return extension===this.originalExtension||(extension?confirm(Craft.t("app","Are you sure you want to change the extension from “.{oldExt}” to “.{newExt}”?",{oldExt:this.originalExtension,newExt:extension})):this.originalFilename!==basename?(this.$filenameInput.val("".concat(Craft.rtrim(basename,"."),".").concat(this.originalExtension)),!0):confirm(Craft.t("app","Are you sure you want to remove the extension “.{ext}”?",{ext:this.originalExtension})))},_parseFilename:function _parseFilename(){var parts=this.$filenameInput.val().split("."),extension=parts.length>1?parts.pop():null,basename;return{basename:parts.join("."),extension:extension}}}),Craft.registerElementEditorClass("craft\\elements\\Asset",Craft.AssetEditor)},function(module,exports){Craft.AssetImageEditor=Garnish.Modal.extend({$body:null,$footer:null,$imageTools:null,$buttons:null,$cancelBtn:null,$replaceBtn:null,$saveBtn:null,$editorContainer:null,$straighten:null,$croppingCanvas:null,$spinnerCanvas:null,canvas:null,image:null,viewport:null,focalPoint:null,grid:null,croppingCanvas:null,clipper:null,croppingRectangle:null,cropperHandles:null,cropperGrid:null,croppingShade:null,croppingAreaText:null,imageStraightenAngle:0,viewportRotation:0,originalWidth:0,originalHeight:0,imageVerticeCoords:null,zoomRatio:1,animationInProgress:!1,currentView:"",assetId:null,cacheBust:null,draggingCropper:!1,scalingCropper:!1,draggingFocal:!1,previousMouseX:0,previousMouseY:0,shiftKeyHeld:!1,editorHeight:0,editorWidth:0,cropperState:!1,scaleFactor:1,flipData:{},focalPointState:!1,spinnerInterval:null,maxImageSize:null,lastLoadedDimensions:null,imageIsLoading:!1,mouseMoveEvent:null,croppingConstraint:!1,constraintOrientation:"landscape",showingCustomConstraint:!1,renderImage:null,renderCropper:null,init:function init(assetId,settings){this.cacheBust=Date.now(),this.setSettings(settings,Craft.AssetImageEditor.defaults),null===this.settings.allowDegreeFractions&&(this.settings.allowDegreeFractions=Craft.isImagick),this.assetId=assetId,this.flipData={x:0,y:0},this.$container=$('<form class="modal fitted imageeditor"></form>').appendTo(Garnish.$bod),this.$body=$('<div class="body"></div>').appendTo(this.$container),this.$footer=$('<div class="footer"/>').appendTo(this.$container),this.base(this.$container,this.settings),this.$buttons=$('<div class="buttons right"/>').appendTo(this.$footer),this.$cancelBtn=$("<button/>",{type:"button",class:"btn cancel",text:Craft.t("app","Cancel")}).appendTo(this.$buttons),this.$replaceBtn=$("<button/>",{type:"button",class:"btn submit save replace",text:Craft.t("app","Save")}).appendTo(this.$buttons),this.settings.allowSavingAsNew&&(this.$saveBtn=$("<button/>",{type:"button",class:"btn submit save copy",text:Craft.t("app","Save as a new asset")}).appendTo(this.$buttons),this.addListener(this.$saveBtn,"activate",this.saveImage)),this.addListener(this.$replaceBtn,"activate",this.saveImage),this.addListener(this.$cancelBtn,"activate",this.hide),this.removeListener(this.$shade,"click"),this.maxImageSize=this.getMaxImageSize(),Craft.postActionRequest("assets/image-editor",{assetId:assetId},this.loadEditor.bind(this))},getMaxImageSize:function getMaxImageSize(){var browserViewportWidth=Garnish.$doc.get(0).documentElement.clientWidth,browserViewportHeight=Garnish.$doc.get(0).documentElement.clientHeight;return Math.max(browserViewportHeight,browserViewportWidth)*(window.devicePixelRatio>1?2:1)},loadEditor:function loadEditor(data){var _this=this;data.html||alert(Craft.t("app","Could not load the image editor.")),this.$body.html(data.html),this.$tabs=$(".tabs li",this.$body),this.$viewsContainer=$(".views",this.$body),this.$views=$("> div",this.$viewsContainer),this.$imageTools=$(".image-container .image-tools",this.$body),this.$editorContainer=$(".image-container .image",this.$body),this.editorHeight=this.$editorContainer.innerHeight(),this.editorWidth=this.$editorContainer.innerWidth(),this._showSpinner(),this.updateSizeAndPosition(),this.canvas=new fabric.StaticCanvas("image-canvas"),this.$croppingCanvas=$("#cropping-canvas",this.$editorContainer),this.$croppingCanvas.width(this.editorWidth),this.$croppingCanvas.height(this.editorHeight),this.canvas.enableRetinaScaling=!0,this.renderImage=function(){Garnish.requestAnimationFrame(_this.canvas.renderAll.bind(_this.canvas))};var imageUrl=Craft.getActionUrl("assets/edit-image",{assetId:this.assetId,size:this.maxImageSize,cacheBust:this.cacheBust});fabric.Image.fromURL(imageUrl,(function(imageObject){_this.image=imageObject,_this.image.set({originX:"center",originY:"center",left:_this.editorWidth/2,top:_this.editorHeight/2}),_this.canvas.add(_this.image),_this.originalHeight=_this.image.getHeight(),_this.originalWidth=_this.image.getWidth(),_this.zoomRatio=1,_this.lastLoadedDimensions=_this.getScaledImageDimensions(),_this._setFittedImageVerticeCoordinates(),_this._repositionEditorElements();var focalState={imageDimensions:_this.getScaledImageDimensions(),offsetX:0,offsetY:0},focal=!1;if(data.focalPoint){var focalData=data.focalPoint,adjustedX=focalState.imageDimensions.width*focalData.x,adjustedY=focalState.imageDimensions.height*focalData.y;focalState.offsetX=adjustedX-focalState.imageDimensions.width/2,focalState.offsetY=adjustedY-focalState.imageDimensions.height/2,focal=!0}_this.storeFocalPointState(focalState),focal&&_this._createFocalPoint(),_this._createViewport(),_this.storeCropperState(),_this._addControlListeners(),_this.addListener(_this.$croppingCanvas,"mousemove,touchmove",_this._handleMouseMove),_this.addListener(_this.$croppingCanvas,"mousedown,touchstart",_this._handleMouseDown),_this.addListener(_this.$croppingCanvas,"mouseup,touchend",_this._handleMouseUp),_this.addListener(_this.$croppingCanvas,"mouseout,touchcancel",_this._handleMouseOut),_this._hideSpinner(),_this.renderImage(),_this.$tabs.first().trigger("click")}))},_reloadImage:function _reloadImage(){var _this2=this;if(!this.imageIsLoading){this.imageIsLoading=!0,this.maxImageSize=this.getMaxImageSize();var imageUrl=Craft.getActionUrl("assets/edit-image",{assetId:this.assetId,size:this.maxImageSize,cacheBust:this.cacheBust});this.image.setSrc(imageUrl,(function(imageObject){_this2.originalHeight=imageObject.getHeight(),_this2.originalWidth=imageObject.getWidth(),_this2.lastLoadedDimensions={width:_this2.originalHeight,height:_this2.originalWidth},_this2.updateSizeAndPosition(),_this2.renderImage(),_this2.imageIsLoading=!1}))}},updateSizeAndPosition:function updateSizeAndPosition(){if(this.$container){var innerWidth=window.innerWidth,innerHeight=window.innerHeight;this.$container.css({width:innerWidth,"min-width":innerWidth,left:0,height:innerHeight,"min-height":innerHeight,top:0}),this.$body.css({height:innerHeight-62}),innerWidth<innerHeight?this.$container.addClass("vertical"):this.$container.removeClass("vertical"),this.$spinnerCanvas&&this.$spinnerCanvas.css({left:this.$spinnerCanvas.parent().width()/2-this.$spinnerCanvas.width()/2+"px",top:this.$spinnerCanvas.parent().height()/2-this.$spinnerCanvas.height()/2+"px"}),this.$editorContainer&&this.image&&this._repositionEditorElements()}},_repositionEditorElements:function _repositionEditorElements(){var previousEditorDimensions={width:this.editorWidth,height:this.editorHeight};this.editorHeight=this.$editorContainer.innerHeight(),this.editorWidth=this.$editorContainer.innerWidth(),this.canvas.setDimensions({width:this.editorWidth,height:this.editorHeight});var currentScaledDimensions=this.getScaledImageDimensions();if("crop"===this.currentView){this.zoomRatio=this.getZoomToFitRatio(this.getScaledImageDimensions());var previouslyOccupiedArea=this._getBoundingRectangle(this.imageVerticeCoords);this._setFittedImageVerticeCoordinates(),this._repositionCropper(previouslyOccupiedArea)}else this.zoomRatio=this.getZoomToCoverRatio(this.getScaledImageDimensions())*this.scaleFactor;this._repositionImage(previousEditorDimensions),this._repositionViewport(),this._repositionFocalPoint(previousEditorDimensions),this._zoomImage(),this.renderImage(),(currentScaledDimensions.width/this.lastLoadedDimensions.width>1.5||currentScaledDimensions.height/this.lastLoadedDimensions.height>1.5)&&this._reloadImage()},_repositionImage:function _repositionImage(previousEditorDimensions){this.image.set({left:this.image.left-(previousEditorDimensions.width-this.editorWidth)/2,top:this.image.top-(previousEditorDimensions.height-this.editorHeight)/2})},_createViewport:function _createViewport(){this.viewport=new fabric.Rect({width:this.image.width,height:this.image.height,fill:"rgba(127,0,0,1)",originX:"center",originY:"center",globalCompositeOperation:"destination-in",left:this.image.left,top:this.image.top}),this.canvas.add(this.viewport),this.renderImage()},_createFocalPoint:function _createFocalPoint(){var focalPointState=this.focalPointState,sizeFactor=this.getScaledImageDimensions().width/focalPointState.imageDimensions.width,focalX=focalPointState.offsetX*sizeFactor*this.zoomRatio*this.scaleFactor,focalY=focalPointState.offsetY*sizeFactor*this.zoomRatio*this.scaleFactor;focalX+=this.image.left,focalY+=this.image.top;var deltaX=0,deltaY=0;this.viewport&&0===focalPointState.offsetX&&0===focalPointState.offsetY&&("crop"!==this.currentView?(deltaX=this.viewport.left-this.image.left,deltaY=this.viewport.top-this.image.top):(deltaX=this.clipper.left-this.image.left,deltaY=this.clipper.top-this.image.top),focalX+=deltaX,focalY+=deltaY,focalPointState.offsetX+=deltaX/(sizeFactor*this.zoomRatio*this.scaleFactor),focalPointState.offsetY+=deltaY/(sizeFactor*this.zoomRatio*this.scaleFactor)),this.focalPoint=new fabric.Group([new fabric.Circle({radius:8,fill:"rgba(0,0,0,0.5)",strokeWidth:2,stroke:"rgba(255,255,255,0.8)",left:0,top:0,originX:"center",originY:"center"}),new fabric.Circle({radius:1,fill:"rgba(255,255,255,0)",strokeWidth:2,stroke:"rgba(255,255,255,0.8)",left:0,top:0,originX:"center",originY:"center"})],{originX:"center",originY:"center",left:focalX,top:focalY}),this.storeFocalPointState(focalPointState),this.canvas.add(this.focalPoint)},toggleFocalPoint:function toggleFocalPoint(){this.focalPoint?(this.canvas.remove(this.focalPoint),this.focalPoint=null):this._createFocalPoint(),this.renderImage()},_repositionViewport:function _repositionViewport(){if(this.viewport){var dimensions={left:this.editorWidth/2,top:this.editorHeight/2};if("crop"===this.currentView)dimensions.width=this.editorWidth,dimensions.height=this.editorHeight;else if(this.cropperState){var state=this.cropperState,scaledImageDimensions,sizeFactor=this.getScaledImageDimensions().width/state.imageDimensions.width;dimensions.width=state.width*sizeFactor*this.zoomRatio,dimensions.height=state.height*sizeFactor*this.zoomRatio,this.image.set({left:this.editorWidth/2-state.offsetX*sizeFactor,top:this.editorHeight/2-state.offsetY*sizeFactor})}else $.extend(dimensions,this.getScaledImageDimensions());this.viewport.set(dimensions)}},_repositionFocalPoint:function _repositionFocalPoint(previousEditorDimensions){if(this.focalPoint){var offsetX=this.focalPoint.left-this.editorWidth/2,offsetY=this.focalPoint.top-this.editorHeight/2,currentWidth=this.image.width,newWidth,ratio=this.getScaledImageDimensions().width*this.zoomRatio/currentWidth/this.scaleFactor;offsetX-=(previousEditorDimensions.width-this.editorWidth)/2,offsetY-=(previousEditorDimensions.height-this.editorHeight)/2,offsetX*=ratio,offsetY*=ratio,this.focalPoint.set({left:this.editorWidth/2+offsetX,top:this.editorHeight/2+offsetY})}},hasOrientationChanged:function hasOrientationChanged(){return this.viewportRotation%180!=0},getScaledImageDimensions:function getScaledImageDimensions(){return void 0===this.getScaledImageDimensions._&&(this.getScaledImageDimensions._={}),this.getScaledImageDimensions._.imageRatio=this.originalHeight/this.originalWidth,this.getScaledImageDimensions._.editorRatio=this.editorHeight/this.editorWidth,this.getScaledImageDimensions._.dimensions={},this.getScaledImageDimensions._.imageRatio>this.getScaledImageDimensions._.editorRatio?(this.getScaledImageDimensions._.dimensions.height=Math.min(this.editorHeight,this.originalHeight),this.getScaledImageDimensions._.dimensions.width=Math.round(this.originalWidth/(this.originalHeight/this.getScaledImageDimensions._.dimensions.height))):(this.getScaledImageDimensions._.dimensions.width=Math.min(this.editorWidth,this.originalWidth),this.getScaledImageDimensions._.dimensions.height=Math.round(this.originalHeight*(this.getScaledImageDimensions._.dimensions.width/this.originalWidth))),this.getScaledImageDimensions._.dimensions},_zoomImage:function _zoomImage(){void 0===this._zoomImage._&&(this._zoomImage._={}),this._zoomImage._.imageDimensions=this.getScaledImageDimensions(),this.image.set({width:this._zoomImage._.imageDimensions.width*this.zoomRatio,height:this._zoomImage._.imageDimensions.height*this.zoomRatio})},_addControlListeners:function _addControlListeners(){var _this3=this;this.addListener(this.$tabs,"click",this._handleTabClick),this.addListener($(".focal-point"),"click",this.toggleFocalPoint),this.addListener($(".rotate-left"),"click",(function(){this.rotateImage(-90)})),this.addListener($(".rotate-right"),"click",(function(){this.rotateImage(90)})),this.addListener($(".flip-vertical"),"click",(function(){this.flipImage("y")})),this.addListener($(".flip-horizontal"),"click",(function(){this.flipImage("x")})),this.straighteningInput=new Craft.SlideRuleInput("slide-rule",{onStart:function onStart(){_this3._showGrid()},onChange:function onChange(slider){_this3.straighten(slider)},onEnd:function onEnd(){_this3._hideGrid(),_this3._cleanupFocalPointAfterStraighten()}}),this.addListener(Garnish.$doc,"keydown",(function(ev){ev.keyCode===Garnish.SHIFT_KEY&&(this.shiftKeyHeld=!0)})),this.addListener(Garnish.$doc,"keyup",(function(ev){ev.keyCode===Garnish.SHIFT_KEY&&(this.shiftKeyHeld=!1)})),this.addListener($(".constraint-buttons .constraint",this.$container),"click",this._handleConstraintClick),this.addListener($(".orientation input",this.$container),"click",this._handleOrientationClick),this.addListener($(".constraint-buttons .custom-input input",this.$container),"keyup",this._applyCustomConstraint)},_handleConstraintClick:function _handleConstraintClick(ev){var constraint=$(ev.currentTarget).data("constraint"),$target=$(ev.currentTarget);if($target.siblings().removeClass("active"),$target.addClass("active"),"custom"==constraint)return this._showCustomConstraint(),void this._applyCustomConstraint();this._hideCustomConstraint(),this.setCroppingConstraint(constraint),this.enforceCroppingConstraint()},_handleOrientationClick:function _handleOrientationClick(ev){if(ev.currentTarget.value!==this.constraintOrientation){this.constraintOrientation=ev.currentTarget.value;for(var $constraints=$(".constraint.flip",this.$container),i=0;i<$constraints.length;i++){var $constraint=$($constraints[i]);$constraint.data("constraint",1/$constraint.data("constraint")),$constraint.html($constraint.html().split(":").reverse().join(":"))}$constraints.filter(".active").click()}},_applyCustomConstraint:function _applyCustomConstraint(){var constraint=this._getCustomConstraint();constraint.w>0&&constraint.h>0&&(this.setCroppingConstraint(constraint.w/constraint.h),this.enforceCroppingConstraint())},_getCustomConstraint:function _getCustomConstraint(){var w=parseFloat($(".custom-constraint-w").val()),h=parseFloat($(".custom-constraint-h").val());return{w:isNaN(w)?0:w,h:isNaN(h)?0:h}},_setCustomConstraint:function _setCustomConstraint(w,h){$(".custom-constraint-w").val(parseFloat(w)),$(".custom-constraint-h").val(parseFloat(h))},_hideCustomConstraint:function _hideCustomConstraint(){this.showingCustomConstraint=!1,$(".constraint.custom .custom-input",this.$container).addClass("hidden"),$(".constraint.custom .custom-label",this.$container).removeClass("hidden"),$(".orientation",this.$container).removeClass("hidden")},_showCustomConstraint:function _showCustomConstraint(){this.showingCustomConstraint||(this.showingCustomConstraint=!0,$(".constraint.custom .custom-input",this.$container).removeClass("hidden"),$(".constraint.custom .custom-label",this.$container).addClass("hidden"),$(".orientation",this.$container).addClass("hidden"))},_handleTabClick:function _handleTabClick(ev){if(!this.animationInProgress){var $tab=$(ev.currentTarget),view=$tab.data("view");this.$tabs.removeClass("selected"),$tab.addClass("selected"),this.showView(view)}},showView:function showView(view){var $view;this.currentView!==view&&(this.$views.addClass("hidden"),this.$views.filter('[data-view="'+view+'"]').removeClass("hidden"),"rotate"===view?this.enableSlider():this.disableSlider(),this.updateSizeAndPosition(),"crop"===this.currentView&&"crop"!==view?this.disableCropMode():"crop"!==this.currentView&&"crop"===view&&this.enableCropMode(),this.currentView=view)},storeCropperState:function storeCropperState(state){void 0===this.storeCropperState._&&(this.storeCropperState._={}),state?this.cropperState=state:this.clipper?(this.storeCropperState._.zoomFactor=1/this.zoomRatio,this.cropperState={offsetX:(this.clipper.left-this.image.left)*this.storeCropperState._.zoomFactor,offsetY:(this.clipper.top-this.image.top)*this.storeCropperState._.zoomFactor,height:this.clipper.height*this.storeCropperState._.zoomFactor,width:this.clipper.width*this.storeCropperState._.zoomFactor,imageDimensions:this.getScaledImageDimensions()}):(this.storeCropperState._.dimensions=this.getScaledImageDimensions(),this.cropperState={offsetX:0,offsetY:0,height:this.storeCropperState._.dimensions.height,width:this.storeCropperState._.dimensions.width,imageDimensions:this.storeCropperState._.dimensions})},storeFocalPointState:function storeFocalPointState(state){void 0===this.storeFocalPointState._&&(this.storeFocalPointState._={}),state?this.focalPointState=state:this.focalPoint&&(this.storeFocalPointState._.zoomFactor=1/this.zoomRatio,this.focalPointState={offsetX:(this.focalPoint.left-this.image.left)*this.storeFocalPointState._.zoomFactor/this.scaleFactor,offsetY:(this.focalPoint.top-this.image.top)*this.storeFocalPointState._.zoomFactor/this.scaleFactor,imageDimensions:this.getScaledImageDimensions()})},rotateImage:function rotateImage(degrees){var _this4=this;if(!this.animationInProgress){if(90!==degrees&&-90!==degrees)return!1;this.animationInProgress=!0,this.viewportRotation+=degrees,this.viewportRotation=parseInt((this.viewportRotation+360)%360,10);var newAngle=this.image.angle+degrees,scaledImageDimensions=this.getScaledImageDimensions(),imageZoomRatio;imageZoomRatio=this.hasOrientationChanged()?this.getZoomToCoverRatio({height:scaledImageDimensions.width,width:scaledImageDimensions.height}):this.getZoomToCoverRatio(scaledImageDimensions),this.zoomRatio>imageZoomRatio&&(imageZoomRatio=this.zoomRatio);var viewportProperties={angle:90===degrees?"+=90":"-=90"},imageProperties={angle:newAngle,width:scaledImageDimensions.width*imageZoomRatio,height:scaledImageDimensions.height*imageZoomRatio},scaleFactor=1;this.scaleFactor<1?(scaleFactor=1/this.scaleFactor,this.scaleFactor=1):(this.viewport.width>this.editorHeight?scaleFactor=this.editorHeight/this.viewport.width:this.viewport.height>this.editorWidth&&(scaleFactor=this.editorWidth/this.viewport.height),this.scaleFactor=scaleFactor),scaleFactor<1&&(imageProperties.width*=scaleFactor,imageProperties.height*=scaleFactor);var state=this.cropperState,deltaX=state.offsetX,deltaY=state.offsetY,angleInRadians=degrees*(Math.PI/180),newDeltaX=deltaX*Math.cos(angleInRadians)-deltaY*Math.sin(angleInRadians),newDeltaY=deltaX*Math.sin(angleInRadians)+deltaY*Math.cos(angleInRadians),sizeFactor=scaledImageDimensions.width/state.imageDimensions.width,modifiedDeltaX=newDeltaX*sizeFactor*this.zoomRatio*this.scaleFactor,modifiedDeltaY=newDeltaY*sizeFactor*this.zoomRatio*this.scaleFactor;imageProperties.left=this.editorWidth/2-modifiedDeltaX,imageProperties.top=this.editorHeight/2-modifiedDeltaY,state.offsetX=newDeltaX,state.offsetY=newDeltaY;var temp=state.width;state.width=state.height,state.height=temp,this.storeCropperState(state),this.focalPoint&&this.canvas.remove(this.focalPoint),this.viewport.animate(viewportProperties,{duration:this.settings.animationDuration,onComplete:function onComplete(){var temp=_this4.viewport.height*scaleFactor;_this4.viewport.height=_this4.viewport.width*scaleFactor,_this4.viewport.width=temp,_this4.viewport.set({angle:0})}}),this.image.animate(imageProperties,{onChange:this.canvas.renderAll.bind(this.canvas),duration:this.settings.animationDuration,onComplete:function onComplete(){var cleanAngle=parseFloat((_this4.image.angle+360)%360);_this4.image.set({angle:cleanAngle}),_this4.animationInProgress=!1,_this4.focalPoint?(_this4._adjustFocalPointByAngle(degrees),_this4.straighten(_this4.straighteningInput),_this4.canvas.add(_this4.focalPoint)):_this4._resetFocalPointPosition()}})}},flipImage:function flipImage(axis){var _this5=this;if(!this.animationInProgress){this.animationInProgress=!0,this.hasOrientationChanged()&&(axis="y"===axis?"x":"y"),this.focalPoint?this.canvas.remove(this.focalPoint):this._resetFocalPointPosition();var editorCenter={x:this.editorWidth/2,y:this.editorHeight/2};this.straighteningInput.setValue(-this.imageStraightenAngle),this.imageStraightenAngle=-this.imageStraightenAngle;var properties={angle:this.viewportRotation+this.imageStraightenAngle},deltaY,deltaX,cropperState=this.cropperState,focalPointState=this.focalPointState;"y"===axis&&this.hasOrientationChanged()||"y"!==axis&&!this.hasOrientationChanged()?(cropperState.offsetX=-cropperState.offsetX,focalPointState.offsetX=-focalPointState.offsetX,deltaX=this.image.left-editorCenter.x,properties.left=editorCenter.x-deltaX):(cropperState.offsetY=-cropperState.offsetY,focalPointState.offsetY=-focalPointState.offsetY,deltaY=this.image.top-editorCenter.y,properties.top=editorCenter.y-deltaY),"y"===axis?(properties.scaleY=-1*this.image.scaleY,this.flipData.y=1-this.flipData.y):(properties.scaleX=-1*this.image.scaleX,this.flipData.x=1-this.flipData.x),this.storeCropperState(cropperState),this.storeFocalPointState(focalPointState),this.image.animate(properties,{onChange:this.canvas.renderAll.bind(this.canvas),duration:this.settings.animationDuration,onComplete:function onComplete(){_this5.animationInProgress=!1,_this5.focalPoint&&(_this5._adjustFocalPointByAngle(0),_this5.canvas.add(_this5.focalPoint))}})}},straighten:function straighten(slider){if(!this.animationInProgress){this.animationInProgress=!0;var previousAngle=this.image.angle;this.imageStraightenAngle=(this.settings.allowDegreeFractions?parseFloat(slider.value):Math.round(parseFloat(slider.value)))%360,this.image.set({angle:this.viewportRotation+this.imageStraightenAngle}),this.zoomRatio=this.getZoomToCoverRatio(this.getScaledImageDimensions())*this.scaleFactor,this._zoomImage(),this.cropperState&&this._adjustEditorElementsOnStraighten(previousAngle),this.renderImage(),this.animationInProgress=!1}},_adjustEditorElementsOnStraighten:function _adjustEditorElementsOnStraighten(previousAngle){var scaledImageDimensions=this.getScaledImageDimensions(),angleDelta=this.image.angle-previousAngle,state=this.cropperState,currentZoomRatio=this.zoomRatio,adjustmentRatio=1,deltaX,deltaY,newCenterX,newCenterY,sizeFactor;do{var cropperCenterX=state.offsetX,cropperCenterY=state.offsetY,angleInRadians=angleDelta*(Math.PI/180);newCenterX=cropperCenterX*Math.cos(angleInRadians)-cropperCenterY*Math.sin(angleInRadians),newCenterY=cropperCenterX*Math.sin(angleInRadians)+cropperCenterY*Math.cos(angleInRadians),deltaX=newCenterX*currentZoomRatio*(sizeFactor=scaledImageDimensions.width/state.imageDimensions.width),deltaY=newCenterY*currentZoomRatio*sizeFactor;var imageVertices=this.getImageVerticeCoords(currentZoomRatio),rectangle={width:this.viewport.width,height:this.viewport.height,left:this.editorWidth/2-this.viewport.width/2+deltaX,top:this.editorHeight/2-this.viewport.height/2+deltaY};currentZoomRatio*=adjustmentRatio=this._getZoomRatioToFitRectangle(rectangle,imageVertices)}while(1!==adjustmentRatio);this.image.set({left:this.editorWidth/2-deltaX,top:this.editorHeight/2-deltaY}),state.offsetX=newCenterX,state.offsetY=newCenterY,state.width=this.viewport.width/currentZoomRatio/sizeFactor,state.height=this.viewport.height/currentZoomRatio/sizeFactor,this.storeCropperState(state),this.zoomRatio=currentZoomRatio,this.focalPoint?(this._adjustFocalPointByAngle(angleDelta),this._isCenterInside(this.focalPoint,this.viewport)?this.focalPoint.set({opacity:1}):this.focalPoint.set({opacity:0})):0!==angleDelta&&this._resetFocalPointPosition(),this._zoomImage()},_cleanupFocalPointAfterStraighten:function _cleanupFocalPointAfterStraighten(){if(this.focalPoint&&!this._isCenterInside(this.focalPoint,this.viewport)){this.focalPoint.set({opacity:1});var state=this.focalPointState;state.offsetX=0,state.offsetY=0,this.storeFocalPointState(state),this.toggleFocalPoint()}},_resetFocalPointPosition:function _resetFocalPointPosition(){var state=this.focalPointState;state.offsetX=0,state.offsetY=0,this.storeFocalPointState(state)},_isCenterInside:function _isCenterInside(object,containingObject){return object.left>containingObject.left-containingObject.width/2&&object.top>containingObject.top-containingObject.height/2&&object.left<containingObject.left+containingObject.width/2&&object.top<containingObject.top+containingObject.height/2},_adjustFocalPointByAngle:function _adjustFocalPointByAngle(angle){var angleInRadians=angle*(Math.PI/180),state=this.focalPointState,focalX=state.offsetX,focalY=state.offsetY,newFocalX=focalX*Math.cos(angleInRadians)-focalY*Math.sin(angleInRadians),newFocalY=focalX*Math.sin(angleInRadians)+focalY*Math.cos(angleInRadians),sizeFactor=this.getScaledImageDimensions().width/state.imageDimensions.width,adjustedFocalX=newFocalX*sizeFactor*this.zoomRatio,adjustedFocalY=newFocalY*sizeFactor*this.zoomRatio;this.focalPoint.left=this.image.left+adjustedFocalX,this.focalPoint.top=this.image.top+adjustedFocalY,state.offsetX=newFocalX,state.offsetY=newFocalY,this.storeFocalPointState(state)},_getZoomRatioToFitRectangle:function _getZoomRatioToFitRectangle(rectangle,containingVertices){for(var rectangleVertices=this._getRectangleVertices(rectangle),vertex,verticeIndex=0,adjustmentRatio;verticeIndex<rectangleVertices.length&&(vertex=rectangleVertices[verticeIndex],this.arePointsInsideRectangle([vertex],containingVertices));verticeIndex++)vertex=!1;if(vertex){var edge=this._getEdgeCrossed(containingVertices,vertex),rectangleCenter={x:rectangle.left+rectangle.width/2,y:rectangle.top+rectangle.height/2},distanceFromVertexToEdge=Math.abs((edge[1].y-edge[0].y)*vertex.x-(edge[1].x-edge[0].x)*vertex.y+edge[1].x*edge[0].y-edge[1].y*edge[0].x)/Math.sqrt(Math.pow(edge[1].y-edge[0].y,2)+Math.pow(edge[1].x-edge[0].x,2)),distanceFromCenterToEdge=Math.abs((edge[1].y-edge[0].y)*rectangleCenter.x-(edge[1].x-edge[0].x)*rectangleCenter.y+edge[1].x*edge[0].y-edge[1].y*edge[0].x)/Math.sqrt(Math.pow(edge[1].y-edge[0].y,2)+Math.pow(edge[1].x-edge[0].x,2));adjustmentRatio=(distanceFromVertexToEdge+distanceFromCenterToEdge)/distanceFromCenterToEdge}else adjustmentRatio=1;return adjustmentRatio},saveImage:function saveImage(ev){var _this6=this,$button=$(ev.currentTarget);if($button.hasClass("disabled"))return!1;$(".btn",this.$buttons).addClass("disabled"),this.$buttons.append('<div class="spinner"></div>');var postData={assetId:this.assetId,viewportRotation:this.viewportRotation,imageRotation:this.imageStraightenAngle,replace:$button.hasClass("replace")?1:0};if(this.cropperState){var cropData={};cropData.height=this.cropperState.height,cropData.width=this.cropperState.width,cropData.offsetX=this.cropperState.offsetX,cropData.offsetY=this.cropperState.offsetY,postData.imageDimensions=this.cropperState.imageDimensions,postData.cropData=cropData}else postData.imageDimensions=this.getScaledImageDimensions();this.focalPoint&&(postData.focalPoint=this.focalPointState),postData.flipData=this.flipData,postData.zoom=this.zoomRatio,Craft.postActionRequest("assets/save-image",postData,(function(data){_this6.$buttons.find(".btn").removeClass("disabled").end().find(".spinner").remove(),data.error?alert(data.error):(_this6.onSave(),_this6.hide(),Craft.cp.runQueue())}))},getZoomToCoverRatio:function getZoomToCoverRatio(dimensions){var angleInRadians=Math.abs(this.imageStraightenAngle)*(Math.PI/180),scaledWidth=Math.sin(angleInRadians)*dimensions.height+Math.cos(angleInRadians)*dimensions.width,scaledHeight=Math.sin(angleInRadians)*dimensions.width+Math.cos(angleInRadians)*dimensions.height;return Math.max(scaledWidth/dimensions.width,scaledHeight/dimensions.height)},getZoomToFitRatio:function getZoomToFitRatio(dimensions){var boundingBox=this._getImageBoundingBox(dimensions),scale=1;if(boundingBox.height>this.editorHeight||boundingBox.width>this.editorWidth){var vertScale=this.editorHeight/boundingBox.height,horiScale=this.editorWidth/boundingBox.width;scale=Math.min(horiScale,vertScale)}return scale},getCombinedZoomRatio:function getCombinedZoomRatio(dimensions){return this.getZoomToCoverRatio(dimensions)/this.getZoomToFitRatio(dimensions)},_showGrid:function _showGrid(){if(!this.grid){var strokeOptions={strokeWidth:1,stroke:"rgba(255,255,255,0.5)"},lineCount=8,gridWidth=this.viewport.width,gridHeight=this.viewport.height,xStep=gridWidth/9,yStep=gridHeight/9,grid=[new fabric.Rect({strokeWidth:2,stroke:"rgba(255,255,255,1)",originX:"center",originY:"center",width:gridWidth,height:gridHeight,left:gridWidth/2,top:gridHeight/2,fill:"rgba(255,255,255,0)"})],i;for(i=1;i<=8;i++)grid.push(new fabric.Line([i*xStep,0,i*xStep,gridHeight],strokeOptions));for(i=1;i<=8;i++)grid.push(new fabric.Line([0,i*yStep,gridWidth,i*yStep],strokeOptions));this.grid=new fabric.Group(grid,{left:this.editorWidth/2,top:this.editorHeight/2,originX:"center",originY:"center",angle:this.viewport.angle}),this.canvas.add(this.grid),this.renderImage()}},_hideGrid:function _hideGrid(){this.canvas.remove(this.grid),this.grid=null,this.renderImage()},onFadeOut:function onFadeOut(){this.destroy()},show:function show(){this.base(),Garnish.$bod.addClass("no-scroll")},hide:function hide(){this.removeAllListeners(),this.straighteningInput.removeAllListeners(),Garnish.$bod.removeClass("no-scroll"),this.base()},onSave:function onSave(){this.settings.onSave(),this.trigger("save")},enableSlider:function enableSlider(){this.$imageTools.removeClass("hidden")},disableSlider:function disableSlider(){this.$imageTools.addClass("hidden")},enableCropMode:function enableCropMode(){var _this7=this,imageDimensions=this.getScaledImageDimensions();this.zoomRatio=this.getZoomToFitRatio(imageDimensions);var viewportProperties={width:this.editorWidth,height:this.editorHeight},imageProperties={width:imageDimensions.width*this.zoomRatio,height:imageDimensions.height*this.zoomRatio,left:this.editorWidth/2,top:this.editorHeight/2},callback=function callback(){_this7._setFittedImageVerticeCoordinates();var state=_this7.cropperState,scaledImageDimensions=_this7.getScaledImageDimensions(),sizeFactor=scaledImageDimensions.width/state.imageDimensions.width,cropperData={left:_this7.image.left+state.offsetX*sizeFactor*_this7.zoomRatio,top:_this7.image.top+state.offsetY*sizeFactor*_this7.zoomRatio,width:state.width*sizeFactor*_this7.zoomRatio,height:state.height*sizeFactor*_this7.zoomRatio};_this7._showCropper(cropperData),_this7.focalPoint&&(sizeFactor=scaledImageDimensions.width/_this7.focalPointState.imageDimensions.width,_this7.focalPoint.left=_this7.image.left+_this7.focalPointState.offsetX*sizeFactor*_this7.zoomRatio,_this7.focalPoint.top=_this7.image.top+_this7.focalPointState.offsetY*sizeFactor*_this7.zoomRatio,_this7.canvas.add(_this7.focalPoint))};this._editorModeTransition(callback,imageProperties,viewportProperties)},disableCropMode:function disableCropMode(){var _this8=this,viewportProperties={};this._hideCropper();var imageDimensions=this.getScaledImageDimensions(),targetZoom=this.getZoomToCoverRatio(imageDimensions)*this.scaleFactor,inverseZoomFactor=targetZoom/this.zoomRatio;this.zoomRatio=targetZoom;var imageProperties={width:imageDimensions.width*this.zoomRatio,height:imageDimensions.height*this.zoomRatio,left:this.editorWidth/2,top:this.editorHeight/2},offsetX,offsetY,imageOffsetX=(this.clipper.left-this.image.left)*inverseZoomFactor,imageOffsetY=(this.clipper.top-this.image.top)*inverseZoomFactor;imageProperties.left=this.editorWidth/2-imageOffsetX,imageProperties.top=this.editorHeight/2-imageOffsetY,viewportProperties.height=this.clipper.height*inverseZoomFactor,viewportProperties.width=this.clipper.width*inverseZoomFactor,(!this.focalPoint||this.focalPoint&&!this._isCenterInside(this.focalPoint,this.clipper))&&(this.focalPoint&&this.toggleFocalPoint(),this._resetFocalPointPosition());var callback=function callback(){if(_this8.focalPoint){var sizeFactor=_this8.getScaledImageDimensions().width/_this8.focalPointState.imageDimensions.width;_this8.focalPoint.left=_this8.image.left+_this8.focalPointState.offsetX*sizeFactor*_this8.zoomRatio,_this8.focalPoint.top=_this8.image.top+_this8.focalPointState.offsetY*sizeFactor*_this8.zoomRatio,_this8.canvas.add(_this8.focalPoint)}};this._editorModeTransition(callback,imageProperties,viewportProperties)},_editorModeTransition:function _editorModeTransition(callback,imageProperties,viewportProperties){var _this9=this;this.animationInProgress||(this.animationInProgress=!0,this.focalPoint&&(this.canvas.remove(this.focalPoint),this.renderImage()),this.image.animate(imageProperties,{onChange:this.canvas.renderAll.bind(this.canvas),duration:this.settings.animationDuration,onComplete:function onComplete(){callback(),_this9.animationInProgress=!1,_this9.renderImage()}}),this.viewport.animate(viewportProperties,{duration:this.settings.animationDuration}))},_showSpinner:function _showSpinner(){this.$spinnerCanvas=$('<canvas id="spinner-canvas"></canvas>').appendTo($(".image",this.$container));var canvas,context=document.getElementById("spinner-canvas").getContext("2d"),start=new Date,lines=16,cW=context.canvas.width,cH=context.canvas.height,draw=function draw(){var rotation=parseInt((new Date-start)/1e3*16)/16;context.save(),context.clearRect(0,0,cW,cH),context.translate(cW/2,cH/2),context.rotate(2*Math.PI*rotation);for(var i=0;i<16;i++)context.beginPath(),context.rotate(2*Math.PI/16),context.moveTo(cW/10,0),context.lineTo(cW/4,0),context.lineWidth=cW/30,context.strokeStyle="rgba(255,255,255,"+i/16+")",context.stroke();context.restore()};this.spinnerInterval=window.setInterval(draw,1e3/30)},_hideSpinner:function _hideSpinner(){window.clearInterval(this.spinnerInterval),this.$spinnerCanvas.remove(),this.$spinnerCanvas=null},_showCropper:function _showCropper(clipperData){this._setupCropperLayer(clipperData),this._redrawCropperElements(),this.renderCropper()},_hideCropper:function _hideCropper(){this.clipper&&(this.croppingCanvas.remove(this.clipper),this.croppingCanvas.remove(this.croppingShade),this.croppingCanvas.remove(this.cropperHandles),this.croppingCanvas.remove(this.cropperGrid),this.croppingCanvas.remove(this.croppingRectangle),this.croppingCanvas.remove(this.croppingAreaText),this.croppingCanvas=null,this.renderCropper=null)},_setupCropperLayer:function _setupCropperLayer(clipperData){var _this10=this;this.croppingCanvas=new fabric.StaticCanvas("cropping-canvas",{backgroundColor:"rgba(0,0,0,0)",hoverCursor:"default",selection:!1}),this.croppingCanvas.setDimensions({width:this.editorWidth,height:this.editorHeight}),this.renderCropper=function(){return Garnish.requestAnimationFrame(_this10.croppingCanvas.renderAll.bind(_this10.croppingCanvas))},$("#cropping-canvas",this.$editorContainer).css({position:"absolute",top:0,left:0}),this.croppingShade=new fabric.Rect({left:this.editorWidth/2,top:this.editorHeight/2,originX:"center",originY:"center",width:this.editorWidth,height:this.editorHeight,fill:"rgba(0,0,0,0.7)"});var imageDimensions=this.getScaledImageDimensions(),rectangleRatio=0===this.imageStraightenAngle?1:1.2*this.getCombinedZoomRatio(imageDimensions),rectWidth=imageDimensions.width/rectangleRatio,rectHeight=imageDimensions.height/rectangleRatio;if(this.hasOrientationChanged()){var temp=rectHeight;rectHeight=rectWidth,rectWidth=temp}this.clipper=new fabric.Rect({left:this.editorWidth/2,top:this.editorHeight/2,originX:"center",originY:"center",width:rectWidth,height:rectHeight,stroke:"black",fill:"rgba(128,0,0,1)",strokeWidth:0}),clipperData&&this.clipper.set(clipperData),this.clipper.globalCompositeOperation="destination-out",this.croppingCanvas.add(this.croppingShade),this.croppingCanvas.add(this.clipper)},_redrawCropperElements:function _redrawCropperElements(){void 0===this._redrawCropperElements._&&(this._redrawCropperElements._={}),this.cropperHandles&&(this.croppingCanvas.remove(this.cropperHandles),this.croppingCanvas.remove(this.cropperGrid),this.croppingCanvas.remove(this.croppingRectangle),this.croppingCanvas.remove(this.croppingAreaText)),this._redrawCropperElements._.lineOptions={strokeWidth:4,stroke:"rgb(255,255,255)",fill:!1},this._redrawCropperElements._.gridOptions={strokeWidth:2,stroke:"rgba(255,255,255,0.5)"},this._redrawCropperElements._.pathGroup=[new fabric.Path("M 0,10 L 0,0 L 10,0",this._redrawCropperElements._.lineOptions),new fabric.Path("M "+(this.clipper.width-8)+",0 L "+(this.clipper.width+4)+",0 L "+(this.clipper.width+4)+",10",this._redrawCropperElements._.lineOptions),new fabric.Path("M "+(this.clipper.width+4)+","+(this.clipper.height-8)+" L"+(this.clipper.width+4)+","+(this.clipper.height+4)+" L "+(this.clipper.width-8)+","+(this.clipper.height+4),this._redrawCropperElements._.lineOptions),new fabric.Path("M 10,"+(this.clipper.height+4)+" L 0,"+(this.clipper.height+4)+" L 0,"+(this.clipper.height-8),this._redrawCropperElements._.lineOptions)],this.cropperHandles=new fabric.Group(this._redrawCropperElements._.pathGroup,{left:this.clipper.left,top:this.clipper.top,originX:"center",originY:"center"}),this.croppingRectangle=new fabric.Rect({left:this.clipper.left,top:this.clipper.top,width:this.clipper.width,height:this.clipper.height,fill:"rgba(0,0,0,0)",stroke:"rgba(255,255,255,0.8)",strokeWidth:2,originX:"center",originY:"center"}),this.cropperGrid=new fabric.Group([new fabric.Line([.33*this.clipper.width,0,.33*this.clipper.width,this.clipper.height],this._redrawCropperElements._.gridOptions),new fabric.Line([.66*this.clipper.width,0,.66*this.clipper.width,this.clipper.height],this._redrawCropperElements._.gridOptions),new fabric.Line([0,.33*this.clipper.height,this.clipper.width,.33*this.clipper.height],this._redrawCropperElements._.gridOptions),new fabric.Line([0,.66*this.clipper.height,this.clipper.width,.66*this.clipper.height],this._redrawCropperElements._.gridOptions)],{left:this.clipper.left,top:this.clipper.top,originX:"center",originY:"center"}),this._redrawCropperElements._.cropTextTop=this.croppingRectangle.top+this.clipper.height/2+12,this._redrawCropperElements._.cropTextBackgroundColor="rgba(0,0,0,0)",this._redrawCropperElements._.cropTextTop+12>this.editorHeight-2&&(this._redrawCropperElements._.cropTextTop-=24,this._redrawCropperElements._.cropTextBackgroundColor="rgba(0,0,0,0.5)"),this.croppingAreaText=new fabric.Textbox(Math.round(this.clipper.width)+" x "+Math.round(this.clipper.height),{left:this.croppingRectangle.left,top:this._redrawCropperElements._.cropTextTop,fontSize:13,fill:"rgb(200,200,200)",backgroundColor:this._redrawCropperElements._.cropTextBackgroundColor,font:"Craft",width:70,height:15,originX:"center",originY:"center",textAlign:"center"}),this.croppingCanvas.add(this.cropperHandles),this.croppingCanvas.add(this.cropperGrid),this.croppingCanvas.add(this.croppingRectangle),this.croppingCanvas.add(this.croppingAreaText)},_repositionCropper:function _repositionCropper(previousImageArea){if(this.croppingCanvas){var currentOffset_x=this.clipper.left-this.croppingCanvas.width/2,currentOffset_y=this.clipper.top-this.croppingCanvas.height/2;this.croppingCanvas.setDimensions({width:this.editorWidth,height:this.editorHeight});var currentArea,areaFactor=this._getBoundingRectangle(this.imageVerticeCoords).width/previousImageArea.width;this.clipper.width=Math.round(this.clipper.width*areaFactor),this.clipper.height=Math.round(this.clipper.height*areaFactor),this.clipper.left=this.editorWidth/2+currentOffset_x*areaFactor,this.clipper.top=this.editorHeight/2+currentOffset_y*areaFactor,this.croppingShade.set({width:this.editorWidth,height:this.editorHeight,left:this.editorWidth/2,top:this.editorHeight/2}),this._redrawCropperElements(),this.renderCropper()}},_getBoundingRectangle:function _getBoundingRectangle(coordinateSet){return{width:Math.max(coordinateSet.a.x,coordinateSet.b.x,coordinateSet.c.x,coordinateSet.d.x)-Math.min(coordinateSet.a.x,coordinateSet.b.x,coordinateSet.c.x,coordinateSet.d.x),height:Math.max(coordinateSet.a.y,coordinateSet.b.y,coordinateSet.c.y,coordinateSet.d.y)-Math.min(coordinateSet.a.y,coordinateSet.b.y,coordinateSet.c.y,coordinateSet.d.y)}},_handleMouseDown:function _handleMouseDown(ev){var focal=this.focalPoint&&this._isMouseOver(ev,this.focalPoint),move=this.croppingCanvas&&this._isMouseOver(ev,this.clipper),handle=this.croppingCanvas&&this._cropperHandleHitTest(ev);(handle||move||focal)&&(this.previousMouseX=ev.pageX,this.previousMouseY=ev.pageY,focal?this.draggingFocal=!0:handle?this.scalingCropper=handle:move&&(this.draggingCropper=!0))},_handleMouseMove:function _handleMouseMove(ev){null!==this.mouseMoveEvent&&Garnish.requestAnimationFrame(this._handleMouseMoveInternal.bind(this)),this.mouseMoveEvent=ev},_handleMouseMoveInternal:function _handleMouseMoveInternal(){null!==this.mouseMoveEvent&&(this.focalPoint&&this.draggingFocal?(this._handleFocalDrag(this.mouseMoveEvent),this.storeFocalPointState(),this.renderImage()):this.draggingCropper||this.scalingCropper?(this.draggingCropper?this._handleCropperDrag(this.mouseMoveEvent):this._handleCropperResize(this.mouseMoveEvent),this._redrawCropperElements(),this.storeCropperState(),this.renderCropper()):this._setMouseCursor(this.mouseMoveEvent),this.previousMouseX=this.mouseMoveEvent.pageX,this.previousMouseY=this.mouseMoveEvent.pageY,this.mouseMoveEvent=null)},_handleMouseUp:function _handleMouseUp(ev){this.draggingCropper=!1,this.scalingCropper=!1,this.draggingFocal=!1},_handleMouseOut:function _handleMouseOut(ev){this._handleMouseUp(ev),this.mouseMoveEvent=ev,this._handleMouseMoveInternal()},_handleCropperDrag:function _handleCropperDrag(ev){if(void 0===this._handleCropperDrag._&&(this._handleCropperDrag._={}),this._handleCropperDrag._.deltaX=ev.pageX-this.previousMouseX,this._handleCropperDrag._.deltaY=ev.pageY-this.previousMouseY,0===this._handleCropperDrag._.deltaX&&0===this._handleCropperDrag._.deltaY)return!1;if(this._handleCropperDrag._.rectangle={left:this.clipper.left-this.clipper.width/2,top:this.clipper.top-this.clipper.height/2,width:this.clipper.width,height:this.clipper.height},this._handleCropperDrag._.vertices=this._getRectangleVertices(this._handleCropperDrag._.rectangle,this._handleCropperDrag._.deltaX,this._handleCropperDrag._.deltaY),!this.arePointsInsideRectangle(this._handleCropperDrag._.vertices,this.imageVerticeCoords)){for(this._handleCropperDrag._.dxi=0,this._handleCropperDrag._.dyi=0,this._handleCropperDrag._.xStep=this._handleCropperDrag._.deltaX>0?-1:1,this._handleCropperDrag._.yStep=this._handleCropperDrag._.deltaY>0?-1:1,this._handleCropperDrag._.furthest=0,this._handleCropperDrag._.furthestDeltas={},this._handleCropperDrag._.dxi=Math.min(Math.abs(this._handleCropperDrag._.deltaX),10);this._handleCropperDrag._.dxi>=0;this._handleCropperDrag._.dxi--)for(this._handleCropperDrag._.dyi=Math.min(Math.abs(this._handleCropperDrag._.deltaY),10);this._handleCropperDrag._.dyi>=0;this._handleCropperDrag._.dyi--)this._handleCropperDrag._.vertices=this._getRectangleVertices(this._handleCropperDrag._.rectangle,this._handleCropperDrag._.dxi*(this._handleCropperDrag._.deltaX>0?1:-1),this._handleCropperDrag._.dyi*(this._handleCropperDrag._.deltaY>0?1:-1)),this.arePointsInsideRectangle(this._handleCropperDrag._.vertices,this.imageVerticeCoords)&&this._handleCropperDrag._.dxi+this._handleCropperDrag._.dyi>this._handleCropperDrag._.furthest&&(this._handleCropperDrag._.furthest=this._handleCropperDrag._.dxi+this._handleCropperDrag._.dyi,this._handleCropperDrag._.furthestDeltas={x:this._handleCropperDrag._.dxi*(this._handleCropperDrag._.deltaX>0?1:-1),y:this._handleCropperDrag._.dyi*(this._handleCropperDrag._.deltaY>0?1:-1)});if(0==this._handleCropperDrag._.furthest)return;this._handleCropperDrag._.deltaX=this._handleCropperDrag._.furthestDeltas.x,this._handleCropperDrag._.deltaY=this._handleCropperDrag._.furthestDeltas.y}this.clipper.set({left:this.clipper.left+this._handleCropperDrag._.deltaX,top:this.clipper.top+this._handleCropperDrag._.deltaY})},_handleFocalDrag:function _handleFocalDrag(ev){if(void 0===this._handleFocalDrag._&&(this._handleFocalDrag._={}),this.focalPoint){if(this._handleFocalDrag._.deltaX=ev.pageX-this.previousMouseX,this._handleFocalDrag._.deltaY=ev.pageY-this.previousMouseY,0===this._handleFocalDrag._.deltaX&&0===this._handleFocalDrag._.deltaY)return;if(this._handleFocalDrag._.newX=this.focalPoint.left+this._handleFocalDrag._.deltaX,this._handleFocalDrag._.newY=this.focalPoint.top+this._handleFocalDrag._.deltaY,"crop"===this.currentView){if(!this.arePointsInsideRectangle([{x:this._handleFocalDrag._.newX,y:this._handleFocalDrag._.newY}],this.imageVerticeCoords))return}else if(!(this.viewport.left-this.viewport.width/2-this._handleFocalDrag._.newX<0&&this.viewport.left+this.viewport.width/2-this._handleFocalDrag._.newX>0&&this.viewport.top-this.viewport.height/2-this._handleFocalDrag._.newY<0&&this.viewport.top+this.viewport.height/2-this._handleFocalDrag._.newY>0))return;this.focalPoint.set({left:this.focalPoint.left+this._handleFocalDrag._.deltaX,top:this.focalPoint.top+this._handleFocalDrag._.deltaY})}},setCroppingConstraint:function setCroppingConstraint(constraint){switch(this.updateSizeAndPosition(),constraint){case"none":this.croppingConstraint=!1;break;case"original":this.croppingConstraint=this.originalWidth/this.originalHeight;break;case"current":this.croppingConstraint=this.clipper.width/this.clipper.height;break;case"custom":break;default:this.croppingConstraint=parseFloat(constraint)}},enforceCroppingConstraint:function enforceCroppingConstraint(){var _this11=this;void 0===this.enforceCroppingConstraint._&&(this.enforceCroppingConstraint._={}),!this.animationInProgress&&this.croppingConstraint&&(this.animationInProgress=!0,this.enforceCroppingConstraint._.rectangle={left:this.clipper.left-this.clipper.width/2,top:this.clipper.top-this.clipper.height/2,width:this.clipper.width,height:this.clipper.height},this.clipper.width>this.clipper.height*this.croppingConstraint?(this.enforceCroppingConstraint._.previousHeight=this.enforceCroppingConstraint._.rectangle.height,this.enforceCroppingConstraint._.rectangle.height=this.clipper.width/this.croppingConstraint,this.enforceCroppingConstraint._.rectangle.top-=(this.enforceCroppingConstraint._.rectangle.height-this.enforceCroppingConstraint._.previousHeight)/2,this.arePointsInsideRectangle(this._getRectangleVertices(this.enforceCroppingConstraint._.rectangle),this.imageVerticeCoords)||(this.enforceCroppingConstraint._.rectangle.width=this.clipper.height*this.croppingConstraint,this.enforceCroppingConstraint._.rectangle.height=this.enforceCroppingConstraint._.rectangle.width/this.croppingConstraint)):(this.enforceCroppingConstraint._.previousWidth=this.enforceCroppingConstraint._.rectangle.width,this.enforceCroppingConstraint._.rectangle.width=this.clipper.height*this.croppingConstraint,this.enforceCroppingConstraint._.rectangle.left-=(this.enforceCroppingConstraint._.rectangle.width-this.enforceCroppingConstraint._.previousWidth)/2,this.arePointsInsideRectangle(this._getRectangleVertices(this.enforceCroppingConstraint._.rectangle),this.imageVerticeCoords)||(this.enforceCroppingConstraint._.rectangle.height=this.clipper.width/this.croppingConstraint,this.enforceCroppingConstraint._.rectangle.width=this.enforceCroppingConstraint._.rectangle.height*this.croppingConstraint)),this.enforceCroppingConstraint._.properties={height:this.enforceCroppingConstraint._.rectangle.height,width:this.enforceCroppingConstraint._.rectangle.width},this.clipper.animate(this.enforceCroppingConstraint._.properties,{onChange:function onChange(){_this11._redrawCropperElements(),_this11.croppingCanvas.renderAll()},duration:this.settings.animationDuration,onComplete:function onComplete(){_this11._redrawCropperElements(),_this11.animationInProgress=!1,_this11.renderCropper(),_this11.storeCropperState()}}))},_handleCropperResize:function _handleCropperResize(ev){void 0===this._handleCropperResize._&&(this._handleCropperResize._={}),this._handleCropperResize._.deltaX=ev.pageX-this.previousMouseX,this._handleCropperResize._.deltaY=ev.pageY-this.previousMouseY,"b"!==this.scalingCropper&&"t"!==this.scalingCropper||(this._handleCropperResize._.deltaX=0),"l"!==this.scalingCropper&&"r"!==this.scalingCropper||(this._handleCropperResize._.deltaY=0),0===this._handleCropperResize._.deltaX&&0===this._handleCropperResize._.deltaY||(this._handleCropperResize._.startingRectangle={left:this.clipper.left-this.clipper.width/2,top:this.clipper.top-this.clipper.height/2,width:this.clipper.width,height:this.clipper.height},this._handleCropperResize._.rectangle=this._calculateNewCropperSizeByDeltas(this._handleCropperResize._.startingRectangle,this._handleCropperResize._.deltaX,this._handleCropperResize._.deltaY,this.scalingCropper),this._handleCropperResize._.rectangle.height<30||this._handleCropperResize._.rectangle.width<30||this.arePointsInsideRectangle(this._getRectangleVertices(this._handleCropperResize._.rectangle),this.imageVerticeCoords)&&(this.clipper.set({top:this._handleCropperResize._.rectangle.top+this._handleCropperResize._.rectangle.height/2,left:this._handleCropperResize._.rectangle.left+this._handleCropperResize._.rectangle.width/2,width:this._handleCropperResize._.rectangle.width,height:this._handleCropperResize._.rectangle.height}),this._redrawCropperElements()))},_calculateNewCropperSizeByDeltas:function _calculateNewCropperSizeByDeltas(startingRectangle,deltaX,deltaY,cropperDirection){if(void 0===this._calculateNewCropperSizeByDeltas._&&(this._calculateNewCropperSizeByDeltas._={}),this._calculateNewCropperSizeByDeltas._.topDelta=0,this._calculateNewCropperSizeByDeltas._.leftDelta=0,this._calculateNewCropperSizeByDeltas._.rectangle=startingRectangle,this._calculateNewCropperSizeByDeltas._.deltaX=deltaX,this._calculateNewCropperSizeByDeltas._.deltaY=deltaY,this.croppingConstraint){switch(this._calculateNewCropperSizeByDeltas._.change=0,cropperDirection){case"t":this._calculateNewCropperSizeByDeltas._.change=-this._calculateNewCropperSizeByDeltas._.deltaY;break;case"b":this._calculateNewCropperSizeByDeltas._.change=this._calculateNewCropperSizeByDeltas._.deltaY;break;case"r":this._calculateNewCropperSizeByDeltas._.change=this._calculateNewCropperSizeByDeltas._.deltaX;break;case"l":this._calculateNewCropperSizeByDeltas._.change=-this._calculateNewCropperSizeByDeltas._.deltaX;break;case"tr":this._calculateNewCropperSizeByDeltas._.change=Math.abs(this._calculateNewCropperSizeByDeltas._.deltaY)>Math.abs(this._calculateNewCropperSizeByDeltas._.deltaX)?-this._calculateNewCropperSizeByDeltas._.deltaY:this._calculateNewCropperSizeByDeltas._.deltaX;break;case"tl":this._calculateNewCropperSizeByDeltas._.change=Math.abs(this._calculateNewCropperSizeByDeltas._.deltaY)>Math.abs(this._calculateNewCropperSizeByDeltas._.deltaX)?-this._calculateNewCropperSizeByDeltas._.deltaY:-this._calculateNewCropperSizeByDeltas._.deltaX;break;case"br":this._calculateNewCropperSizeByDeltas._.change=Math.abs(this._calculateNewCropperSizeByDeltas._.deltaY)>Math.abs(this._calculateNewCropperSizeByDeltas._.deltaX)?this._calculateNewCropperSizeByDeltas._.deltaY:this._calculateNewCropperSizeByDeltas._.deltaX;break;case"bl":this._calculateNewCropperSizeByDeltas._.change=Math.abs(this._calculateNewCropperSizeByDeltas._.deltaY)>Math.abs(this._calculateNewCropperSizeByDeltas._.deltaX)?this._calculateNewCropperSizeByDeltas._.deltaY:-this._calculateNewCropperSizeByDeltas._.deltaX}switch(this.croppingConstraint>1?(this._calculateNewCropperSizeByDeltas._.deltaX=this._calculateNewCropperSizeByDeltas._.change,this._calculateNewCropperSizeByDeltas._.deltaY=this._calculateNewCropperSizeByDeltas._.deltaX/this.croppingConstraint):(this._calculateNewCropperSizeByDeltas._.deltaY=this._calculateNewCropperSizeByDeltas._.change,this._calculateNewCropperSizeByDeltas._.deltaX=this._calculateNewCropperSizeByDeltas._.deltaY*this.croppingConstraint),this._calculateNewCropperSizeByDeltas._.rectangle.height+=this._calculateNewCropperSizeByDeltas._.deltaY,this._calculateNewCropperSizeByDeltas._.rectangle.width+=this._calculateNewCropperSizeByDeltas._.deltaX,cropperDirection){case"t":this._calculateNewCropperSizeByDeltas._.rectangle.top-=this._calculateNewCropperSizeByDeltas._.deltaY,this._calculateNewCropperSizeByDeltas._.rectangle.left-=this._calculateNewCropperSizeByDeltas._.deltaX/2;break;case"b":this._calculateNewCropperSizeByDeltas._.rectangle.left+=-this._calculateNewCropperSizeByDeltas._.deltaX/2;break;case"r":this._calculateNewCropperSizeByDeltas._.rectangle.top+=-this._calculateNewCropperSizeByDeltas._.deltaY/2;break;case"l":this._calculateNewCropperSizeByDeltas._.rectangle.top-=this._calculateNewCropperSizeByDeltas._.deltaY/2,this._calculateNewCropperSizeByDeltas._.rectangle.left-=this._calculateNewCropperSizeByDeltas._.deltaX;break;case"tr":this._calculateNewCropperSizeByDeltas._.rectangle.top-=this._calculateNewCropperSizeByDeltas._.deltaY;break;case"tl":this._calculateNewCropperSizeByDeltas._.rectangle.top-=this._calculateNewCropperSizeByDeltas._.deltaY,this._calculateNewCropperSizeByDeltas._.rectangle.left-=this._calculateNewCropperSizeByDeltas._.deltaX;break;case"bl":this._calculateNewCropperSizeByDeltas._.rectangle.left-=this._calculateNewCropperSizeByDeltas._.deltaX}}else!this.shiftKeyHeld||"tl"!==cropperDirection&&"tr"!==cropperDirection&&"bl"!==cropperDirection&&"br"!==cropperDirection||(this._calculateNewCropperSizeByDeltas._.ratio,Math.abs(deltaX)>Math.abs(deltaY)?(this._calculateNewCropperSizeByDeltas._.ratio=startingRectangle.width/startingRectangle.height,this._calculateNewCropperSizeByDeltas._.deltaY=this._calculateNewCropperSizeByDeltas._.deltaX/this._calculateNewCropperSizeByDeltas._.ratio,this._calculateNewCropperSizeByDeltas._.deltaY*="tr"===cropperDirection||"bl"===cropperDirection?-1:1):(this._calculateNewCropperSizeByDeltas._.ratio=startingRectangle.width/startingRectangle.height,this._calculateNewCropperSizeByDeltas._.deltaX=this._calculateNewCropperSizeByDeltas._.deltaY*this._calculateNewCropperSizeByDeltas._.ratio,this._calculateNewCropperSizeByDeltas._.deltaX*="tr"===cropperDirection||"bl"===cropperDirection?-1:1)),cropperDirection.match(/t/)&&(this._calculateNewCropperSizeByDeltas._.rectangle.top+=this._calculateNewCropperSizeByDeltas._.deltaY,this._calculateNewCropperSizeByDeltas._.rectangle.height-=this._calculateNewCropperSizeByDeltas._.deltaY),cropperDirection.match(/b/)&&(this._calculateNewCropperSizeByDeltas._.rectangle.height+=this._calculateNewCropperSizeByDeltas._.deltaY),cropperDirection.match(/r/)&&(this._calculateNewCropperSizeByDeltas._.rectangle.width+=this._calculateNewCropperSizeByDeltas._.deltaX),cropperDirection.match(/l/)&&(this._calculateNewCropperSizeByDeltas._.rectangle.left+=this._calculateNewCropperSizeByDeltas._.deltaX,this._calculateNewCropperSizeByDeltas._.rectangle.width-=this._calculateNewCropperSizeByDeltas._.deltaX);return this._calculateNewCropperSizeByDeltas._.rectangle.top=this._calculateNewCropperSizeByDeltas._.rectangle.top,this._calculateNewCropperSizeByDeltas._.rectangle.left=this._calculateNewCropperSizeByDeltas._.rectangle.left,this._calculateNewCropperSizeByDeltas._.rectangle.width=this._calculateNewCropperSizeByDeltas._.rectangle.width,this._calculateNewCropperSizeByDeltas._.rectangle.height=this._calculateNewCropperSizeByDeltas._.rectangle.height,this._calculateNewCropperSizeByDeltas._.rectangle},_setMouseCursor:function _setMouseCursor(ev){void 0===this._setMouseCursor._&&(this._setMouseCursor._={}),Garnish.isMobileBrowser(!0)||(this._setMouseCursor._.cursor="default",this._setMouseCursor._.handle=this.croppingCanvas&&this._cropperHandleHitTest(ev),this.focalPoint&&this._isMouseOver(ev,this.focalPoint)?this._setMouseCursor._.cursor="pointer":this._setMouseCursor._.handle?"t"===this._setMouseCursor._.handle||"b"===this._setMouseCursor._.handle?this._setMouseCursor._.cursor="ns-resize":"l"===this._setMouseCursor._.handle||"r"===this._setMouseCursor._.handle?this._setMouseCursor._.cursor="ew-resize":"tl"===this._setMouseCursor._.handle||"br"===this._setMouseCursor._.handle?this._setMouseCursor._.cursor="nwse-resize":"bl"!==this._setMouseCursor._.handle&&"tr"!==this._setMouseCursor._.handle||(this._setMouseCursor._.cursor="nesw-resize"):this.croppingCanvas&&this._isMouseOver(ev,this.clipper)&&(this._setMouseCursor._.cursor="move"),$(".body").css("cursor",this._setMouseCursor._.cursor))},_cropperHandleHitTest:function _cropperHandleHitTest(ev){if(void 0===this._cropperHandleHitTest._&&(this._cropperHandleHitTest._={}),this._cropperHandleHitTest._.parentOffset=this.$croppingCanvas.offset(),this._cropperHandleHitTest._.mouseX=ev.pageX-this._cropperHandleHitTest._.parentOffset.left,this._cropperHandleHitTest._.mouseY=ev.pageY-this._cropperHandleHitTest._.parentOffset.top,this._cropperHandleHitTest._.lb=this.clipper.left-this.clipper.width/2,this._cropperHandleHitTest._.rb=this._cropperHandleHitTest._.lb+this.clipper.width,this._cropperHandleHitTest._.tb=this.clipper.top-this.clipper.height/2,this._cropperHandleHitTest._.bb=this._cropperHandleHitTest._.tb+this.clipper.height,this._cropperHandleHitTest._.mouseX<this._cropperHandleHitTest._.lb+10&&this._cropperHandleHitTest._.mouseX>this._cropperHandleHitTest._.lb-3){if(this._cropperHandleHitTest._.mouseY<this._cropperHandleHitTest._.tb+10&&this._cropperHandleHitTest._.mouseY>this._cropperHandleHitTest._.tb-3)return"tl";if(this._cropperHandleHitTest._.mouseY<this._cropperHandleHitTest._.bb+3&&this._cropperHandleHitTest._.mouseY>this._cropperHandleHitTest._.bb-10)return"bl"}if(this._cropperHandleHitTest._.mouseX>this._cropperHandleHitTest._.rb-13&&this._cropperHandleHitTest._.mouseX<this._cropperHandleHitTest._.rb+3){if(this._cropperHandleHitTest._.mouseY<this._cropperHandleHitTest._.tb+10&&this._cropperHandleHitTest._.mouseY>this._cropperHandleHitTest._.tb-3)return"tr";if(this._cropperHandleHitTest._.mouseY<this._cropperHandleHitTest._.bb+2&&this._cropperHandleHitTest._.mouseY>this._cropperHandleHitTest._.bb-10)return"br"}return this._cropperHandleHitTest._.mouseX<this._cropperHandleHitTest._.lb+3&&this._cropperHandleHitTest._.mouseX>this._cropperHandleHitTest._.lb-3&&this._cropperHandleHitTest._.mouseY<this._cropperHandleHitTest._.bb-10&&this._cropperHandleHitTest._.mouseY>this._cropperHandleHitTest._.tb+10?"l":this._cropperHandleHitTest._.mouseX<this._cropperHandleHitTest._.rb+1&&this._cropperHandleHitTest._.mouseX>this._cropperHandleHitTest._.rb-5&&this._cropperHandleHitTest._.mouseY<this._cropperHandleHitTest._.bb-10&&this._cropperHandleHitTest._.mouseY>this._cropperHandleHitTest._.tb+10?"r":this._cropperHandleHitTest._.mouseY<this._cropperHandleHitTest._.tb+4&&this._cropperHandleHitTest._.mouseY>this._cropperHandleHitTest._.tb-2&&this._cropperHandleHitTest._.mouseX>this._cropperHandleHitTest._.lb+10&&this._cropperHandleHitTest._.mouseX<this._cropperHandleHitTest._.rb-10?"t":this._cropperHandleHitTest._.mouseY<this._cropperHandleHitTest._.bb+2&&this._cropperHandleHitTest._.mouseY>this._cropperHandleHitTest._.bb-4&&this._cropperHandleHitTest._.mouseX>this._cropperHandleHitTest._.lb+10&&this._cropperHandleHitTest._.mouseX<this._cropperHandleHitTest._.rb-10&&"b"},_isMouseOver:function _isMouseOver(event,object){return void 0===this._isMouseOver._&&(this._isMouseOver._={}),this._isMouseOver._.parentOffset=this.$croppingCanvas.offset(),this._isMouseOver._.mouseX=event.pageX-this._isMouseOver._.parentOffset.left,this._isMouseOver._.mouseY=event.pageY-this._isMouseOver._.parentOffset.top,this._isMouseOver._.lb=object.left-object.width/2,this._isMouseOver._.rb=this._isMouseOver._.lb+object.width,this._isMouseOver._.tb=object.top-object.height/2,this._isMouseOver._.bb=this._isMouseOver._.tb+object.height,this._isMouseOver._.mouseX>=this._isMouseOver._.lb&&this._isMouseOver._.mouseX<=this._isMouseOver._.rb&&this._isMouseOver._.mouseY>=this._isMouseOver._.tb&&this._isMouseOver._.mouseY<=this._isMouseOver._.bb},_getRectangleVertices:function _getRectangleVertices(rectangle,offsetX,offsetY){return void 0===this._getRectangleVertices._&&(this._getRectangleVertices._={}),void 0===offsetX&&(offsetX=0),void 0===offsetY&&(offsetY=0),this._getRectangleVertices._.topLeft={x:rectangle.left+offsetX,y:rectangle.top+offsetY},this._getRectangleVertices._.topRight={x:this._getRectangleVertices._.topLeft.x+rectangle.width,y:this._getRectangleVertices._.topLeft.y},this._getRectangleVertices._.bottomRight={x:this._getRectangleVertices._.topRight.x,y:this._getRectangleVertices._.topRight.y+rectangle.height},this._getRectangleVertices._.bottomLeft={x:this._getRectangleVertices._.topLeft.x,y:this._getRectangleVertices._.bottomRight.y},[this._getRectangleVertices._.topLeft,this._getRectangleVertices._.topRight,this._getRectangleVertices._.bottomRight,this._getRectangleVertices._.bottomLeft]},_setFittedImageVerticeCoordinates:function _setFittedImageVerticeCoordinates(){this.imageVerticeCoords=this.getImageVerticeCoords("fit")},getImageVerticeCoords:function getImageVerticeCoords(zoomMode){var angleInRadians=-1*((this.hasOrientationChanged()?90:0)+this.imageStraightenAngle)*(Math.PI/180),imageDimensions=this.getScaledImageDimensions(),ratio;ratio="number"==typeof zoomMode?zoomMode:"cover"===zoomMode?this.getZoomToCoverRatio(imageDimensions):this.getZoomToFitRatio(imageDimensions);var scaledHeight=imageDimensions.height*ratio,scaledWidth=imageDimensions.width*ratio,topVerticalSegment=Math.cos(angleInRadians)*scaledHeight,bottomVerticalSegment=Math.sin(angleInRadians)*scaledWidth,rightHorizontalSegment=Math.cos(angleInRadians)*scaledWidth,leftHorizontalSegment=Math.sin(angleInRadians)*scaledHeight,verticalOffset=(this.editorHeight-(topVerticalSegment+bottomVerticalSegment))/2,horizontalOffset=(this.editorWidth-(leftHorizontalSegment+rightHorizontalSegment))/2;return{a:{x:horizontalOffset+rightHorizontalSegment,y:verticalOffset},b:{x:this.editorWidth-horizontalOffset,y:verticalOffset+topVerticalSegment},c:{x:horizontalOffset+leftHorizontalSegment,y:this.editorHeight-verticalOffset},d:{x:horizontalOffset,y:verticalOffset+bottomVerticalSegment}}},_debug:function _debug(fabricObj){this.canvas.remove(this.debugger),this.debugger=fabricObj,this.canvas.add(this.debugger)},arePointsInsideRectangle:function arePointsInsideRectangle(points,rectangle){for(void 0===this.arePointsInsideRectangle._&&(this.arePointsInsideRectangle._={}),this.arePointsInsideRectangle._.ab=this._getVector(rectangle.a,rectangle.b),this.arePointsInsideRectangle._.bc=this._getVector(rectangle.b,rectangle.c),this.arePointsInsideRectangle._.scalarAbAb=this._getScalarProduct(this.arePointsInsideRectangle._.ab,this.arePointsInsideRectangle._.ab),this.arePointsInsideRectangle._.scalarBcBc=this._getScalarProduct(this.arePointsInsideRectangle._.bc,this.arePointsInsideRectangle._.bc),this.arePointsInsideRectangle._.i=0;this.arePointsInsideRectangle._.i<points.length;this.arePointsInsideRectangle._.i++)if(this.arePointsInsideRectangle._.point=points[this.arePointsInsideRectangle._.i],this.arePointsInsideRectangle._.ap=this._getVector(rectangle.a,this.arePointsInsideRectangle._.point),this.arePointsInsideRectangle._.bp=this._getVector(rectangle.b,this.arePointsInsideRectangle._.point),this.arePointsInsideRectangle._.scalarAbAp=this._getScalarProduct(this.arePointsInsideRectangle._.ab,this.arePointsInsideRectangle._.ap),this.arePointsInsideRectangle._.scalarBcBp=this._getScalarProduct(this.arePointsInsideRectangle._.bc,this.arePointsInsideRectangle._.bp),this.arePointsInsideRectangle._.projectsOnAB=0<=this.arePointsInsideRectangle._.scalarAbAp&&this.arePointsInsideRectangle._.scalarAbAp<=this.arePointsInsideRectangle._.scalarAbAb,this.arePointsInsideRectangle._.projectsOnBC=0<=this.arePointsInsideRectangle._.scalarBcBp&&this.arePointsInsideRectangle._.scalarBcBp<=this.arePointsInsideRectangle._.scalarBcBc,!this.arePointsInsideRectangle._.projectsOnAB||!this.arePointsInsideRectangle._.projectsOnBC)return!1;return!0},_getVector:function _getVector(a,b){return{x:b.x-a.x,y:b.y-a.y}},_getScalarProduct:function _getScalarProduct(a,b){return a.x*b.x+a.y*b.y},_getVectorMagnitude:function _getVectorMagnitude(vector){return Math.sqrt(vector.x*vector.x+vector.y*vector.y)},_getAngleBetweenVectors:function _getAngleBetweenVectors(a,b){return Math.round(180*Math.acos(Math.min(1,this._getScalarProduct(a,b)/(this._getVectorMagnitude(a)*this._getVectorMagnitude(b))))/Math.PI*100)/100},_getEdgeCrossed:function _getEdgeCrossed(rectangle,vertex){for(var edgePoints=[[rectangle.a,rectangle.b],[rectangle.b,rectangle.c],[rectangle.c,rectangle.d],[rectangle.d,rectangle.a]],centerPoint={x:this.editorWidth/2,y:this.editorHeight/2},smallestDiff=180,edgeCrossed=null,edgeIndex=0;edgeIndex<edgePoints.length;edgeIndex++){var edge=edgePoints[edgeIndex],toCenter=this._getVector(edge[0],centerPoint),edgeVector=this._getVector(edge[0],edge[1]),toVertex=this._getVector(edge[0],vertex),diff=Math.abs(this._getAngleBetweenVectors(toCenter,toVertex)-(this._getAngleBetweenVectors(toCenter,edgeVector)+this._getAngleBetweenVectors(edgeVector,toVertex)));diff<smallestDiff&&(smallestDiff=diff,edgeCrossed=edge)}return edgeCrossed},_getImageBoundingBox:function _getImageBoundingBox(dimensions){var box={},angleInRadians=Math.abs(this.imageStraightenAngle)*(Math.PI/180),proportion=dimensions.height/dimensions.width;if(box.height=dimensions.width*(Math.sin(angleInRadians)+Math.cos(angleInRadians)*proportion),box.width=dimensions.width*(Math.cos(angleInRadians)+Math.sin(angleInRadians)*proportion),this.hasOrientationChanged()){var temp=box.width;box.width=box.height,box.height=temp}return box}},{defaults:{animationDuration:100,allowSavingAsNew:!0,onSave:$.noop,allowDegreeFractions:null}})},function(module,exports){function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}Craft.AssetIndex=Craft.BaseElementIndex.extend({$includeSubfoldersContainer:null,$includeSubfoldersCheckbox:null,showingIncludeSubfoldersCheckbox:!1,$uploadButton:null,$uploadInput:null,$progressBar:null,$folders:null,uploader:null,promptHandler:null,progressBar:null,_uploadTotalFiles:0,_uploadFileProgress:{},_uploadedAssetIds:[],_currentUploaderSettings:{},_assetDrag:null,_folderDrag:null,_expandDropTargetFolderTimeout:null,_tempExpandedFolders:[],_fileConflictTemplate:{choices:[{value:"keepBoth",title:Craft.t("app","Keep both")},{value:"replace",title:Craft.t("app","Replace it")}]},_folderConflictTemplate:{choices:[{value:"replace",title:Craft.t("app","Replace the folder (all existing files will be deleted)")},{value:"merge",title:Craft.t("app","Merge the folder (any conflicting files will be replaced)")}]},init:function init(elementType,$container,settings){this.base(elementType,$container,settings),"index"===this.settings.context?(this._folderDrag||this._initIndexPageMode(),this.addListener(Garnish.$win,"resize,scroll","_positionProgressBar")):(this.addListener(this.$main,"scroll","_positionProgressBar"),this.settings.modal&&this.settings.modal.on("updateSizeAndPosition",this._positionProgressBar.bind(this)))},initSources:function initSources(){return"index"!==this.settings.context||this._folderDrag||this._initIndexPageMode(),this.base()},initSource:function initSource($source){this.base($source),this._createFolderContextMenu($source),"index"===this.settings.context&&(this._folderDrag&&this._getSourceLevel($source)>1&&$source.data("folder-id")&&this._folderDrag.addItems($source.parent()),this._assetDrag&&this._assetDrag.updateDropTargets())},deinitSource:function deinitSource($source){this.base($source);var contextMenu=$source.data("contextmenu");contextMenu&&contextMenu.destroy(),"index"===this.settings.context&&(this._folderDrag&&this._getSourceLevel($source)>1&&this._folderDrag.removeItems($source.parent()),this._assetDrag&&this._assetDrag.updateDropTargets())},_getSourceLevel:function _getSourceLevel($source){return $source.parentsUntil("nav","ul").length},_initIndexPageMode:function _initIndexPageMode(){var _this=this;this._folderDrag||(this.settings.selectable=!0,this.settings.multiSelect=!0,this._assetDrag=new Garnish.DragDrop({activeDropTargetClass:"sel",helperOpacity:.75,filter:function filter(){return _this.view.getSelectedElements().has("div.element[data-movable]")},helper:function helper($file){return _this._getFileDragHelper($file)},dropTargets:function dropTargets(){var attr;attr=_this._assetDrag.$draggee&&_this._assetDrag.$draggee.has(".element[data-peer-file]").length?"data-can-move-peer-files-to":"data-can-move-to";for(var targets=[],i=0;i<_this.$sources.length;i++){var $source=_this.$sources.eq(i);Garnish.hasAttr($source,attr)&&targets.push($source)}return targets},onDragStart:this._onDragStart.bind(this),onDropTargetChange:this._onDropTargetChange.bind(this),onDragStop:this._onFileDragStop.bind(this),helperBaseZindex:800}),this._folderDrag=new Garnish.DragDrop({activeDropTargetClass:"sel",helperOpacity:.75,filter:function filter(){for(var $selected=_this.sourceSelect.getSelectedItems(),draggees=[],i=0;i<$selected.length;i++){var $source=$selected.eq(i);_this._getFolderUidFromSourceKey($source.data("key"))&&($source.hasClass("sel")&&_this._getSourceLevel($source)>1&&draggees.push($source.parent()[0]))}return $(draggees)},helper:function helper($draggeeHelper){var $helperSidebar=$('<div class="sidebar" style="padding-top: 0; padding-bottom: 0;"/>'),$helperNav=$("<nav/>").appendTo($helperSidebar),$helperUl=$("<ul/>").appendTo($helperNav);return $draggeeHelper.appendTo($helperUl).removeClass("expanded"),$draggeeHelper.children("a").addClass("sel"),$draggeeHelper.css({"padding-top":_this._folderDrag.$draggee.css("padding-top"),"padding-right":_this._folderDrag.$draggee.css("padding-right"),"padding-bottom":_this._folderDrag.$draggee.css("padding-bottom"),"padding-left":_this._folderDrag.$draggee.css("padding-left")}),$helperSidebar},dropTargets:function dropTargets(){var targets=[],draggedSourceIds=[];_this._folderDrag.$draggee.find("a[data-key]").each((function(){draggedSourceIds.push($(this).data("key"))}));for(var i=0;i<_this.$sources.length;i++){var $source=_this.$sources.eq(i),key=$source.data("key");_this._getFolderUidFromSourceKey(key)&&(Craft.inArray(key,draggedSourceIds)||targets.push($source))}return targets},onDragStart:this._onDragStart.bind(this),onDropTargetChange:this._onDropTargetChange.bind(this),onDragStop:this._onFolderDragStop.bind(this)}))},_onFileDragStop:function _onFileDragStop(){var _this2=this;if(this._assetDrag.$activeDropTarget&&this._assetDrag.$activeDropTarget[0]!==this.$source[0]){for(var originatingSource=this.$source,targetFolderId=this._assetDrag.$activeDropTarget.data("folder-id"),originalAssetIds=[],i=0;i<this._assetDrag.$draggee.length;i++){var originalAssetId=Craft.getElementInfo(this._assetDrag.$draggee[i]).id;originalAssetIds.push(originalAssetId)}if(originalAssetIds.length){this.setIndexBusy(),this._positionProgressBar(),this.progressBar.resetProgressBar(),this.progressBar.setItemCount(originalAssetIds.length),this.progressBar.showProgressBar();var parameterArray=[];for(i=0;i<originalAssetIds.length;i++)parameterArray.push({action:"assets/move-asset",params:{assetId:originalAssetIds[i],folderId:targetFolderId}});var onMoveFinish=function onMoveFinish(responseArray){_this2.promptHandler.resetPrompts();for(var i=0;i<responseArray.length;i++){var response=responseArray[i];response.conflict&&_this2.promptHandler.addPrompt({assetId:response.assetId,suggestedFilename:response.suggestedFilename,prompt:{message:response.conflict,choices:_this2._fileConflictTemplate.choices}}),response.error&&alert(response.error)}_this2.setIndexAvailable(),_this2.progressBar.hideProgressBar();var reloadIndex=!1,performAfterMoveActions=function performAfterMoveActions(){this.sourceSelect.selectItem(originatingSource),this._totalVisible-=this._assetDrag.$draggee.length;for(var i=0;i<originalAssetIds.length;i++)$("[data-id="+originalAssetIds[i]+"]").remove();this.view.deselectAllElements(),this._collapseExtraExpandedFolders(targetFolderId),reloadIndex&&this.updateElements()};if(_this2.promptHandler.getPromptCount()){var promptCallback=function promptCallback(returnData){for(var newParameterArray=[],i=0;i<returnData.length;i++)"cancel"!==returnData[i].choice?("keepBoth"===returnData[i].choice&&newParameterArray.push({action:"assets/move-asset",params:{folderId:targetFolderId,assetId:returnData[i].assetId,filename:returnData[i].suggestedFilename}}),"replace"===returnData[i].choice&&newParameterArray.push({action:"assets/move-asset",params:{folderId:targetFolderId,assetId:returnData[i].assetId,force:!0}})):reloadIndex=!0;0===newParameterArray.length?performAfterMoveActions.apply(_this2):(_this2.setIndexBusy(),_this2.progressBar.resetProgressBar(),_this2.progressBar.setItemCount(_this2.promptHandler.getPromptCount()),_this2.progressBar.showProgressBar(),_this2._performBatchRequests(newParameterArray,onMoveFinish))};_this2._assetDrag.fadeOutHelpers(),_this2.promptHandler.showBatchPrompts(promptCallback)}else performAfterMoveActions.apply(_this2),_this2._assetDrag.fadeOutHelpers()};return void this._performBatchRequests(parameterArray,onMoveFinish)}}else this.$source.addClass("sel"),this._collapseExtraExpandedFolders();this._assetDrag.returnHelpersToDraggees()},_onFolderDragStop:function _onFolderDragStop(){var _this3=this;if(this._folderDrag.$activeDropTarget&&0===this._folderDrag.$activeDropTarget.siblings("ul").children("li").filter(this._folderDrag.$draggee).length){var targetFolderId=this._folderDrag.$activeDropTarget.data("folder-id");this._collapseExtraExpandedFolders(targetFolderId);for(var folderIds=[],i=0;i<this._folderDrag.$draggee.length;i++){var $a,folderId=this._folderDrag.$draggee.eq(i).children("a").data("folder-id");if(folderId!=targetFolderId){folderIds.push(folderId);break}}if(folderIds.length){folderIds.sort(),folderIds.reverse(),this.setIndexBusy(),this._positionProgressBar(),this.progressBar.resetProgressBar(),this.progressBar.setItemCount(folderIds.length),this.progressBar.showProgressBar();var parameterArray=[];for(i=0;i<folderIds.length;i++)parameterArray.push({action:"assets/move-folder",params:{folderId:folderIds[i],parentId:targetFolderId}});this.requestId++;var fileMoveList=[],newSourceKey="",onMoveFinish=function onMoveFinish(responseArray){_this3.promptHandler.resetPrompts();for(var i=0;i<responseArray.length;i++){var data=responseArray[i];data.success&&(data.transferList&&(fileMoveList=data.transferList),data.newFolderId&&(newSourceKey=_this3._folderDrag.$activeDropTarget.data("key")+"/folder:"+data.newFolderUid)),data.conflict&&(data.prompt={message:data.conflict,choices:_this3._folderConflictTemplate.choices},_this3.promptHandler.addPrompt(data)),data.error&&alert(data.error)}if(_this3.promptHandler.getPromptCount()){var promptCallback=function promptCallback(returnData){_this3.promptHandler.resetPrompts();for(var newParameterArray=[],params={},i=0;i<returnData.length;i++)"cancel"!==returnData[i].choice&&("replace"===returnData[i].choice&&(params.force=!0),"merge"===returnData[i].choice&&(params.merge=!0),params.folderId=data.folderId,params.parentId=data.parentId,newParameterArray.push({action:"assets/move-folder",params:params}));0===newParameterArray.length?_this3._performActualFolderMove(fileMoveList,folderIds,newSourceKey):(_this3.setIndexBusy(),_this3.progressBar.resetProgressBar(),_this3.progressBar.setItemCount(_this3.promptHandler.getPromptCount()),_this3.progressBar.showProgressBar(),_this3._performBatchRequests(newParameterArray,onMoveFinish))};_this3.promptHandler.showBatchPrompts(promptCallback),_this3.setIndexAvailable(),_this3.progressBar.hideProgressBar()}else _this3._performActualFolderMove(fileMoveList,folderIds,newSourceKey)};return void this._performBatchRequests(parameterArray,onMoveFinish)}}else this.$source.addClass("sel"),this._collapseExtraExpandedFolders();this._folderDrag.returnHelpersToDraggees()},_performActualFolderMove:function _performActualFolderMove(fileMoveList,folderDeleteList,newSourceKey){var _this4=this;this.setIndexBusy(),this.progressBar.resetProgressBar(),this.progressBar.setItemCount(1),this.progressBar.showProgressBar();var moveCallback=function moveCallback(folderDeleteList){for(var counter=0,limit=folderDeleteList.length,i=0;i<folderDeleteList.length;i++)Craft.postActionRequest("assets/delete-folder",{folderId:folderDeleteList[i]},(function(){++counter===limit&&(_this4.setIndexAvailable(),_this4.progressBar.hideProgressBar(),_this4._folderDrag.returnHelpersToDraggees(),_this4.setInstanceState("selectedSource",newSourceKey),_this4.refreshSources())}))};if(fileMoveList.length>0){for(var parameterArray=[],i=0;i<fileMoveList.length;i++)parameterArray.push({action:"assets/move-asset",params:fileMoveList[i]});this._performBatchRequests(parameterArray,(function(){moveCallback(folderDeleteList)}))}else moveCallback(folderDeleteList)},_getRootSource:function _getRootSource($source){for(var $parent;($parent=this._getParentSource($source))&&$parent.length;)$source=$parent;return $source},_getParentSource:function _getParentSource($source){if(this._getSourceLevel($source)>1)return $source.parent().parent().siblings("a")},_selectSourceByFolderId:function _selectSourceByFolderId(targetFolderId){for(var $targetSource=this._getSourceByKey(targetFolderId),$parentSources=$targetSource.parent().parents("li"),i=0;i<$parentSources.length;i++){var $parentSource=$($parentSources[i]);$parentSource.hasClass("expanded")||$parentSource.children(".toggle").trigger("click")}this.selectSource($targetSource),this.updateElements()},afterInit:function afterInit(){var _this5=this;this.$uploadButton||(this.$uploadButton=$("<button/>",{type:"button",class:"btn submit","data-icon":"upload",style:"position: relative; overflow: hidden;",text:Craft.t("app","Upload files")}),this.addButton(this.$uploadButton),this.$uploadInput=$('<input type="file" multiple="multiple" name="assets-upload" />').hide().insertBefore(this.$uploadButton)),this.promptHandler=new Craft.PromptHandler,this.progressBar=new Craft.ProgressBar(this.$main,!0);var options={url:Craft.getActionUrl("assets/upload"),fileInput:this.$uploadInput,dropZone:this.$container};options.events={fileuploadstart:this._onUploadStart.bind(this),fileuploadprogressall:this._onUploadProgress.bind(this),fileuploaddone:this._onUploadComplete.bind(this)},this.settings.criteria&&void 0!==this.settings.criteria.kind&&(options.allowedKinds=this.settings.criteria.kind),this._currentUploaderSettings=options,this.uploader=new Craft.Uploader(this.$uploadButton,options),this.$uploadButton.on("click",(function(){_this5.$uploadButton.hasClass("disabled")||_this5.isIndexBusy||_this5.$uploadButton.parent().find("input[name=assets-upload]").trigger("click")})),this.base()},getDefaultSourceKey:function getDefaultSourceKey(){var _this6=this;if("index"===this.settings.context&&void 0!==window.defaultSource){var _ret=function(){var defaultSourceParts=window.defaultSource.split("/"),volumeSource=_this6.$sources.toArray().find((function(s){return $(s).data("volume-handle")===defaultSourceParts[0]}));if(volumeSource){for(var $source=$(volumeSource),_loop=function _loop(i){var subfolderSource=_this6._getChildSources($source).toArray().find((function(s){return $("> .label",s).text()===defaultSourceParts[i]}));if(!subfolderSource)return"break";_this6._expandSource($source),$source=$(subfolderSource)},i=1;i<defaultSourceParts.length;i++){var _ret2;if("break"===_loop(i))break}return{v:$source.data("key")}}}();if("object"===_typeof(_ret))return _ret.v}return this.base()},onSelectSource:function onSelectSource(){var $source=this._getSourceByKey(this.sourceKey),folderId;$source.data("folder-id")&&Garnish.hasAttr(this.$source,"data-can-upload")?(this.uploader.setParams({folderId:this.$source.attr("data-folder-id")}),this.$uploadButton.removeClass("disabled")):this.$uploadButton.addClass("disabled"),$source.length&&"index"===this.settings.context&&this._updateUrl($source),this.base()},_updateUrl:function _updateUrl($source){if("undefined"!=typeof history){for(var nestedSources=[],$thisSource=$source,$parent;($parent=this._getParentSource($thisSource))&&$parent.length;)nestedSources.unshift($thisSource),$thisSource=$parent;var uri="assets";$thisSource.data("volume-handle")&&(uri+="/"+$thisSource.data("volume-handle"),nestedSources.forEach((function($s){uri+="/"+$s.children(".label").text()}))),history.replaceState({},"",Craft.getUrl(uri))}},_getFolderUidFromSourceKey:function _getFolderUidFromSourceKey(sourceKey){var m=sourceKey.match(/\bfolder:([0-9a-f\-]+)$/);return m?m[1]:null},startSearching:function startSearching(){if(!this.settings.hideSidebar&&this.$source.siblings("ul").length){if(null===this.$includeSubfoldersContainer){var id="includeSubfolders-"+Math.floor(1e9*Math.random());this.$includeSubfoldersContainer=$('<div style="margin-bottom: -25px; opacity: 0;"/>').insertAfter(this.$search);var $subContainer=$('<div style="padding-top: 5px;"/>').appendTo(this.$includeSubfoldersContainer);this.$includeSubfoldersCheckbox=$('<input type="checkbox" id="'+id+'" class="checkbox"/>').appendTo($subContainer),$('<label class="light smalltext" for="'+id+'"/>').text(" "+Craft.t("app","Search in subfolders")).appendTo($subContainer),this.addListener(this.$includeSubfoldersCheckbox,"change",(function(){this.setSelecetedSourceState("includeSubfolders",this.$includeSubfoldersCheckbox.prop("checked")),this.updateElements()}))}else this.$includeSubfoldersContainer.velocity("stop");var checked=this.getSelectedSourceState("includeSubfolders",!1);this.$includeSubfoldersCheckbox.prop("checked",checked),this.$includeSubfoldersContainer.velocity({marginBottom:0,opacity:1},"fast"),this.showingIncludeSubfoldersCheckbox=!0}this.base()},stopSearching:function stopSearching(){this.showingIncludeSubfoldersCheckbox&&(this.$includeSubfoldersContainer.velocity("stop"),this.$includeSubfoldersContainer.velocity({marginBottom:-25,opacity:0},"fast"),this.showingIncludeSubfoldersCheckbox=!1),this.base()},getViewParams:function getViewParams(){var data=this.base();return this.showingIncludeSubfoldersCheckbox&&this.$includeSubfoldersCheckbox.prop("checked")&&(data.criteria.includeSubfolders=!0),data},_onUploadStart:function _onUploadStart(){this.setIndexBusy(),this._positionProgressBar(),this.progressBar.resetProgressBar(),this.progressBar.showProgressBar(),this.promptHandler.resetPrompts()},_onUploadProgress:function _onUploadProgress(event,data){var progress=parseInt(data.loaded/data.total*100,10);this.progressBar.setProgressPercentage(progress)},_onUploadComplete:function _onUploadComplete(event,data){var response=data.result,filename=data.files[0].name,doReload=!0;response.success||response.conflict?(this._uploadedAssetIds.push(response.assetId),response.conflict&&(response.prompt={message:Craft.t("app",response.conflict,{file:response.filename}),choices:this._fileConflictTemplate.choices},this.promptHandler.addPrompt(response)),Craft.cp.runQueue()):(response.error?alert(Craft.t("app","Upload failed. The error message was: “{error}”",{error:response.error})):alert(Craft.t("app","Upload failed for {filename}.",{filename:filename})),doReload=!1),this.uploader.isLastUpload()&&(this.setIndexAvailable(),this.progressBar.hideProgressBar(),this.promptHandler.getPromptCount()?this.promptHandler.showBatchPrompts(this._uploadFollowup.bind(this)):doReload&&this._updateAfterUpload())},_updateAfterUpload:function _updateAfterUpload(){"index"!==this.settings.context&&(this.setSortAttribute("dateModified"),this.setSortDirection("desc")),this.updateElements()},_uploadFollowup:function _uploadFollowup(returnData){var _this7=this;this.setIndexBusy(),this.progressBar.resetProgressBar(),this.promptHandler.resetPrompts();var finalCallback=function finalCallback(){_this7.setIndexAvailable(),_this7.progressBar.hideProgressBar(),_this7._updateAfterUpload()};this.progressBar.setItemCount(returnData.length);var doFollowup=function doFollowup(parameterArray,parameterIndex,callback){var postData={},action=null,followupCallback=function followupCallback(data,textStatus){"success"===textStatus&&data.assetId?_this7._uploadedAssetIds.push(data.assetId):data.error&&alert(data.error),parameterIndex++,_this7.progressBar.incrementProcessedItemCount(1),_this7.progressBar.updateProgressBar(),parameterIndex===parameterArray.length?callback():doFollowup(parameterArray,parameterIndex,callback)};"replace"===parameterArray[parameterIndex].choice?(action="assets/replace-file",postData.sourceAssetId=parameterArray[parameterIndex].assetId,parameterArray[parameterIndex].conflictingAssetId?postData.assetId=parameterArray[parameterIndex].conflictingAssetId:postData.targetFilename=parameterArray[parameterIndex].filename):"cancel"===parameterArray[parameterIndex].choice&&(action="assets/delete-asset",postData.assetId=parameterArray[parameterIndex].assetId),action?Craft.postActionRequest(action,postData,followupCallback):followupCallback({assetId:parameterArray[parameterIndex].assetId},"success")};this.progressBar.showProgressBar(),doFollowup(returnData,0,finalCallback)},onUpdateElements:function onUpdateElements(){var _this8=this;this._onUpdateElements(!1,this.view.getAllElements()),this.view.on("appendElements",(function(ev){_this8._onUpdateElements(!0,ev.newElements)})),this.base()},_onUpdateElements:function _onUpdateElements(append,$newElements){if("index"===this.settings.context&&(append||this._assetDrag.removeAllItems(),this._assetDrag.addItems($newElements.has("div.element[data-movable]"))),this._uploadedAssetIds.length){if(this.view.settings.selectable)for(var i=0;i<this._uploadedAssetIds.length;i++)this.view.selectElementById(this._uploadedAssetIds[i]);this._uploadedAssetIds=[]}this.base(append,$newElements),this.removeListener(this.$elements,"keydown"),this.addListener(this.$elements,"keydown",this._onKeyDown.bind(this)),this.view.elementSelect.on("focusItem",this._onElementFocus.bind(this))},_onKeyDown:function _onKeyDown(ev){if(ev.keyCode===Garnish.SPACE_KEY&&ev.shiftKey){if(Craft.PreviewFileModal.openInstance)Craft.PreviewFileModal.openInstance.selfDestruct();else{var $element=this.view.elementSelect.$focusedItem.find(".element");$element.length&&this._loadPreview($element)}return ev.stopPropagation(),!1}},_onElementFocus:function _onElementFocus(ev){var $element=$(ev.item).find(".element");Craft.PreviewFileModal.openInstance&&$element.length&&this._loadPreview($element)},_loadPreview:function _loadPreview($element){var settings={};$element.data("image-width")&&(settings.startingWidth=$element.data("image-width"),settings.startingHeight=$element.data("image-height")),new Craft.PreviewFileModal($element.data("id"),this.view.elementSelect,settings)},_onDragStart:function _onDragStart(){this._tempExpandedFolders=[]},_getFileDragHelper:function _getFileDragHelper($element){var currentView,$outerContainer,$innerContainer;switch(this.getSelectedSourceState("mode")){case"table":$outerContainer=$('<div class="elements datatablesorthelper"/>').appendTo(Garnish.$bod),$innerContainer=$('<div class="tableview"/>').appendTo($outerContainer);var $table=$('<table class="data"/>').appendTo($innerContainer),$tbody=$("<tbody/>").appendTo($table);$element.appendTo($tbody),this._$firstRowCells=this.view.$table.children("tbody").children("tr:first").children();for(var $helperCells=$element.children(),i=0;i<$helperCells.length;i++){var $helperCell=$($helperCells[i]);if($helperCell.hasClass("checkbox-cell"))$helperCell.remove(),$outerContainer.css("margin-"+Craft.left,19);else{var $firstRowCell=$(this._$firstRowCells[i]),width=$firstRowCell.width();$firstRowCell.width(width),$helperCell.width(width)}}return $outerContainer;case"thumbs":return $outerContainer=$('<div class="elements thumbviewhelper"/>').appendTo(Garnish.$bod),$innerContainer=$('<ul class="thumbsview"/>').appendTo($outerContainer),$element.appendTo($innerContainer),$outerContainer}return $()},_onDropTargetChange:function _onDropTargetChange($dropTarget){if(clearTimeout(this._expandDropTargetFolderTimeout),$dropTarget){var folderId=$dropTarget.data("folder-id");folderId?(this.dropTargetFolder=this._getSourceByKey(folderId),this._hasSubfolders(this.dropTargetFolder)&&!this._isExpanded(this.dropTargetFolder)&&(this._expandDropTargetFolderTimeout=setTimeout(this._expandFolder.bind(this),500))):this.dropTargetFolder=null}$dropTarget&&$dropTarget[0]!==this.$source[0]?this.$source.removeClass("sel"):this.$source.addClass("sel")},_collapseExtraExpandedFolders:function _collapseExtraExpandedFolders(dropTargetFolderId){var $excludedSources;clearTimeout(this._expandDropTargetFolderTimeout),dropTargetFolderId&&($excludedSources=this._getSourceByKey(dropTargetFolderId).parents("li").children("a"));for(var i=this._tempExpandedFolders.length-1;i>=0;i--){var $source=this._tempExpandedFolders[i];void 0!==$excludedSources&&0!==$excludedSources.filter('[data-key="'+$source.data("key")+'"]').length||(this._collapseFolder($source),this._tempExpandedFolders.splice(i,1))}},_getSourceByKey:function _getSourceByKey(key){return this.$sources.filter('[data-key$="'+key+'"]')},_hasSubfolders:function _hasSubfolders($source){return $source.siblings("ul").find("li").length},_isExpanded:function _isExpanded($source){return $source.parent("li").hasClass("expanded")},_expandFolder:function _expandFolder(){this._collapseExtraExpandedFolders(this.dropTargetFolder.data("folder-id")),this.dropTargetFolder.siblings(".toggle").trigger("click"),this._tempExpandedFolders.push(this.dropTargetFolder)},_collapseFolder:function _collapseFolder($source){$source.parent().hasClass("expanded")&&$source.siblings(".toggle").trigger("click")},_createFolderContextMenu:function _createFolderContextMenu($source){var _this9=this;if(this._getFolderUidFromSourceKey($source.data("key"))){var menuOptions=[{label:Craft.t("app","New subfolder"),onClick:function onClick(){_this9._createSubfolder($source)}}];"index"===this.settings.context&&this._getSourceLevel($source)>1&&(menuOptions.push({label:Craft.t("app","Rename folder"),onClick:function onClick(){_this9._renameFolder($source)}}),menuOptions.push({label:Craft.t("app","Delete folder"),onClick:function onClick(){_this9._deleteFolder($source)}})),new Garnish.ContextMenu($source,menuOptions,{menuClass:"menu"})}},_createSubfolder:function _createSubfolder($parentFolder){var _this10=this,subfolderName=prompt(Craft.t("app","Enter the name of the folder"));if(subfolderName){var params={parentId:$parentFolder.data("folder-id"),folderName:subfolderName};this.setIndexBusy(),Craft.postActionRequest("assets/create-folder",params,(function(data,textStatus){if(_this10.setIndexAvailable(),"success"===textStatus&&data.success){_this10._prepareParentForChildren($parentFolder);var $subfolder=$('<li><a data-key="'+$parentFolder.data("key")+"/folder:"+data.folderUid+'"'+(Garnish.hasAttr($parentFolder,"data-has-thumbs")?" data-has-thumbs":"")+' data-folder-id="'+data.folderId+'"'+(Garnish.hasAttr($parentFolder,"data-can-upload")?" data-can-upload":"")+(Garnish.hasAttr($parentFolder,"data-can-move-to")?" data-can-move-to":"")+(Garnish.hasAttr($parentFolder,"data-can-move-peer-files-to")?" data-can-move-peer-files-to":"")+">"+data.folderName+"</a></li>"),$a=$subfolder.children("a:first");_this10._appendSubfolder($parentFolder,$subfolder),_this10.initSource($a)}"success"===textStatus&&data.error&&alert(data.error)}))}},_deleteFolder:function _deleteFolder($targetFolder){var _this11=this;if(confirm(Craft.t("app","Really delete folder “{folder}”?",{folder:$.trim($targetFolder.text())}))){var params={folderId:$targetFolder.data("folder-id")};this.setIndexBusy(),Craft.postActionRequest("assets/delete-folder",params,(function(data,textStatus){if(_this11.setIndexAvailable(),"success"===textStatus&&data.success){var $parentFolder=_this11._getParentSource($targetFolder);_this11.deinitSource($targetFolder),$targetFolder.parent().remove(),_this11._cleanUpTree($parentFolder)}"success"===textStatus&&data.error&&alert(data.error)}))}},_renameFolder:function _renameFolder($source){var _this12=this,$label=$source.children(".label"),oldName=Craft.trim($label.text()),newName=prompt(Craft.t("app","Rename folder"),oldName);newName&&newName!==oldName&&(this.setIndexBusy(),Craft.sendActionRequest("POST","assets/rename-folder",{data:{folderId:$source.data("folder-id"),newName:newName}}).then((function(response){response.data.success?($label.text(response.data.newName),$source.data("key")===_this12.$source.data("key")&&(_this12.updateElements(),"index"===_this12.settings.context&&_this12._updateUrl($source))):response.data.error&&alert(response.data.error)})).finally((function(){_this12.setIndexAvailable()})))},_prepareParentForChildren:function _prepareParentForChildren($parentFolder){this._hasSubfolders($parentFolder)||($parentFolder.parent().addClass("expanded").append('<div class="toggle"></div><ul></ul>'),this.initSourceToggle($parentFolder))},_appendSubfolder:function _appendSubfolder($parentFolder,$subfolder){for(var $subfolderList,$existingChildren=$parentFolder.siblings("ul").children("li"),subfolderLabel=$.trim($subfolder.children("a:first").text()),folderInserted=!1,i=0;i<$existingChildren.length;i++){var $existingChild=$($existingChildren[i]);if($.trim($existingChild.children("a:first").text())>subfolderLabel){$existingChild.before($subfolder),folderInserted=!0;break}}folderInserted||$parentFolder.siblings("ul").append($subfolder)},_cleanUpTree:function _cleanUpTree($parentFolder){null!==$parentFolder&&0===$parentFolder.siblings("ul").children("li").length&&(this.deinitSourceToggle($parentFolder),$parentFolder.siblings("ul").remove(),$parentFolder.siblings(".toggle").remove(),$parentFolder.parent().removeClass("expanded"))},_positionProgressBar:function _positionProgressBar(){this.progressBar||(this.progressBar=new Craft.ProgressBar(this.$main,!0));var $container=$(),scrollTop=0,offset=0;"index"===this.settings.context?($container=this.progressBar.$progressBar.closest("#content"),scrollTop=Garnish.$win.scrollTop()):($container=this.progressBar.$progressBar.closest(".main"),scrollTop=this.$main.scrollTop());var containerTop,diff=scrollTop-$container.offset().top,windowHeight=Garnish.$win.height();offset=$container.height()>windowHeight?windowHeight/2-6+diff:$container.height()/2-6,"index"!==this.settings.context&&(offset=scrollTop+($container.height()/2-6)),this.progressBar.$progressBar.css({top:offset})},_performBatchRequests:function _performBatchRequests(parameterArray,finalCallback){for(var _this13=this,responseArray=[],doRequest=function doRequest(parameters){Craft.postActionRequest(parameters.action,parameters.params,(function(data,textStatus){_this13.progressBar.incrementProcessedItemCount(1),_this13.progressBar.updateProgressBar(),"success"===textStatus&&(responseArray.push(data),Craft.cp.runQueue()),responseArray.length>=parameterArray.length&&finalCallback(responseArray)}))},i=0;i<parameterArray.length;i++)doRequest(parameterArray[i])}}),Craft.registerElementIndexClass("craft\\elements\\Asset",Craft.AssetIndex)},function(module,exports){Craft.AssetSelectInput=Craft.BaseElementSelectInput.extend({requestId:0,hud:null,$uploadBtn:null,uploader:null,progressBar:null,init:function init(){this.base.apply(this,arguments),this.settings.canUpload&&this._attachUploader(),this.addListener(this.$elementsContainer,"keydown",this._onKeyDown.bind(this)),this.elementSelect.on("focusItem",this._onElementFocus.bind(this))},_onKeyDown:function _onKeyDown(ev){if(ev.keyCode===Garnish.SPACE_KEY&&ev.shiftKey){if(Craft.PreviewFileModal.openInstance)Craft.PreviewFileModal.openInstance.selfDestruct();else{var $element=this.elementSelect.$focusedItem;$element.length&&this._loadPreview($element)}return ev.stopPropagation(),!1}},_onElementFocus:function _onElementFocus(ev){var $element=$(ev.item);Craft.PreviewFileModal.openInstance&&$element.length&&this._loadPreview($element)},_loadPreview:function _loadPreview($element){var settings={};$element.data("image-width")&&(settings.startingWidth=$element.data("image-width"),settings.startingHeight=$element.data("image-height")),new Craft.PreviewFileModal($element.data("id"),this.elementSelect,settings)},createElementEditor:function createElementEditor($element){return this.base($element,{params:{defaultFieldLayoutId:this.settings.defaultFieldLayoutId},input:this})},_attachUploader:function _attachUploader(){var _this=this;this.progressBar=new Craft.ProgressBar($('<div class="progress-shade"></div>').appendTo(this.$container));var options={url:Craft.getActionUrl("assets/upload"),dropZone:this.$container,formData:{fieldId:this.settings.fieldId}};this.settings.sourceElementId&&(options.formData.elementId=this.settings.sourceElementId),this.settings.criteria.siteId&&(options.formData.siteId=this.settings.criteria.siteId),this.$addElementBtn&&(this.$uploadBtn=$("<button/>",{type:"button",class:"btn dashed","data-icon":"upload",text:1==this.settings.limit?Craft.t("app","Upload a file"):Craft.t("app","Upload files")}).insertAfter(this.$addElementBtn),options.fileInput=$("<input/>",{type:"file",class:"hidden",multiple:1!=this.settings.limit}).insertAfter(this.$uploadBtn),Garnish.$win.trigger("resize")),void 0!==Craft.csrfTokenName&&void 0!==Craft.csrfTokenValue&&(options.formData[Craft.csrfTokenName]=Craft.csrfTokenValue),void 0!==this.settings.criteria.kind&&(options.allowedKinds=this.settings.criteria.kind),options.canAddMoreFiles=this.canAddMoreFiles.bind(this),options.events={},options.events.fileuploadstart=this._onUploadStart.bind(this),options.events.fileuploadprogressall=this._onUploadProgress.bind(this),options.events.fileuploaddone=this._onUploadComplete.bind(this),this.uploader=new Craft.Uploader(this.$container,options),this.$uploadBtn&&this.$uploadBtn.on("click",(function(ev){_this.$uploadBtn.next("input[type=file]").trigger("click")}))},refreshThumbnail:function refreshThumbnail(elementId){var _this2=this,parameters={elementId:elementId,siteId:this.settings.criteria.siteId,size:this.settings.viewMode};Craft.postActionRequest("elements/get-element-html",parameters,(function(data){if(data.error)alert(data.error);else{var $existing=_this2.$elements.filter('[data-id="'+elementId+'"]');$existing.find(".elementthumb").replaceWith($(data.html).find(".elementthumb")),_this2.thumbLoader.load($existing)}}))},selectUploadedFile:function selectUploadedFile(element){if(this.canAddMoreElements()){var $newElement=element.$element;$newElement.addClass("removable"),$newElement.prepend('<input type="hidden" name="'+this.settings.name+'[]" value="'+element.id+'"><a class="delete icon" title="'+Craft.t("app","Remove")+'"></a>'),$newElement.appendTo(this.$elementsContainer);var margin=-($newElement.outerWidth()+10);this.$addElementBtn.css("margin-"+Craft.left,margin+"px");var animateCss={};animateCss["margin-"+Craft.left]=0,this.$addElementBtn.velocity(animateCss,"fast"),this.addElements($newElement),delete this.modal}},_onUploadStart:function _onUploadStart(){this.progressBar.$progressBar.css({top:Math.round(this.$container.outerHeight()/2)-6}),this.$container.addClass("uploading"),this.progressBar.resetProgressBar(),this.progressBar.showProgressBar()},_onUploadProgress:function _onUploadProgress(event,data){var progress=parseInt(data.loaded/data.total*100,10);this.progressBar.setProgressPercentage(progress)},_onUploadComplete:function _onUploadComplete(event,data){var _this3=this;if(data.result.error)alert(data.result.error);else{var parameters={elementId:data.result.assetId,siteId:this.settings.criteria.siteId,size:this.settings.viewMode};Craft.postActionRequest("elements/get-element-html",parameters,(function(data){if(data.error)alert(data.error);else{var html=$(data.html);Craft.appendHeadHtml(data.headHtml),_this3.selectUploadedFile(Craft.getElementInfo(html))}_this3.uploader.isLastUpload()&&(_this3.progressBar.hideProgressBar(),_this3.$container.removeClass("uploading"),window.draftEditor&&window.draftEditor.checkForm())})),Craft.cp.runQueue()}},canAddMoreFiles:function canAddMoreFiles(slotsTaken){return!this.settings.limit||this.$elements.length+slotsTaken<this.settings.limit}})},function(module,exports){Craft.AssetSelectorModal=Craft.BaseElementSelectorModal.extend({$selectTransformBtn:null,_selectedTransform:null,init:function init(elementType,settings){settings=$.extend({},Craft.AssetSelectorModal.defaults,settings),this.base(elementType,settings),settings.transforms.length&&this.createSelectTransformButton(settings.transforms)},createSelectTransformButton:function createSelectTransformButton(transforms){if(transforms&&transforms.length){var $btnGroup=$('<div class="btngroup"/>').appendTo(this.$primaryButtons);this.$selectBtn.appendTo($btnGroup),this.$selectTransformBtn=$("<button/>",{type:"button",class:"btn menubtn disabled",text:Craft.t("app","Select transform")}).appendTo($btnGroup);for(var $menu=$('<div class="menu" data-align="right"></div>').insertAfter(this.$selectTransformBtn),$menuList=$("<ul></ul>").appendTo($menu),i=0;i<transforms.length;i++)$('<li><a data-transform="'+transforms[i].handle+'">'+transforms[i].name+"</a></li>").appendTo($menuList);var MenuButton=new Garnish.MenuBtn(this.$selectTransformBtn,{onOptionSelect:this.onSelectTransform.bind(this)});MenuButton.disable(),this.$selectTransformBtn.data("menuButton",MenuButton)}},onSelectionChange:function onSelectionChange(ev){var $selectedElements=this.elementIndex.getSelectedElements(),allowTransforms=!1;if($selectedElements.length&&this.settings.transforms.length){allowTransforms=!0;for(var i=0;i<$selectedElements.length&&$(".element.hasthumb:first",$selectedElements[i]).length;i++);}var MenuBtn=null;this.$selectTransformBtn&&(MenuBtn=this.$selectTransformBtn.data("menuButton")),allowTransforms?(MenuBtn&&MenuBtn.enable(),this.$selectTransformBtn.removeClass("disabled")):this.$selectTransformBtn&&(MenuBtn&&MenuBtn.disable(),this.$selectTransformBtn.addClass("disabled")),this.base()},onSelectTransform:function onSelectTransform(option){var transform=$(option).data("transform");this.selectImagesWithTransform(transform)},selectImagesWithTransform:function selectImagesWithTransform(transform){var _this=this;void 0===Craft.AssetSelectorModal.transformUrls[transform]&&(Craft.AssetSelectorModal.transformUrls[transform]={});for(var $selectedElements=this.elementIndex.getSelectedElements(),imageIdsWithMissingUrls=[],i=0;i<$selectedElements.length;i++){var $item=$($selectedElements[i]),elementId=Craft.getElementInfo($item).id;void 0===Craft.AssetSelectorModal.transformUrls[transform][elementId]&&imageIdsWithMissingUrls.push(elementId)}imageIdsWithMissingUrls.length?(this.showFooterSpinner(),this.fetchMissingTransformUrls(imageIdsWithMissingUrls,transform,(function(){_this.hideFooterSpinner(),_this.selectImagesWithTransform(transform)}))):(this._selectedTransform=transform,this.selectElements(),this._selectedTransform=null)},fetchMissingTransformUrls:function fetchMissingTransformUrls(imageIdsWithMissingUrls,transform,callback){var _this2=this,elementId=imageIdsWithMissingUrls.pop(),data={assetId:elementId,handle:transform};Craft.postActionRequest("assets/generate-transform",data,(function(response,textStatus){Craft.AssetSelectorModal.transformUrls[transform][elementId]=!1,"success"===textStatus&&response.url&&(Craft.AssetSelectorModal.transformUrls[transform][elementId]=response.url),imageIdsWithMissingUrls.length?_this2.fetchMissingTransformUrls(imageIdsWithMissingUrls,transform,callback):callback()}))},getElementInfo:function getElementInfo($selectedElements){var info=this.base($selectedElements);if(this._selectedTransform)for(var i=0;i<info.length;i++){var elementId=info[i].id;void 0!==Craft.AssetSelectorModal.transformUrls[this._selectedTransform][elementId]&&!1!==Craft.AssetSelectorModal.transformUrls[this._selectedTransform][elementId]&&(info[i].url=Craft.AssetSelectorModal.transformUrls[this._selectedTransform][elementId])}return info},onSelect:function onSelect(elementInfo){this.settings.onSelect(elementInfo,this._selectedTransform)}},{defaults:{canSelectImageTransforms:!1,transforms:[]},transformUrls:{}}),Craft.registerElementSelectorModalClass("craft\\elements\\Asset",Craft.AssetSelectorModal)},function(module,exports){Craft.AuthManager=Garnish.Base.extend({remainingSessionTime:null,checkRemainingSessionTimer:null,showLoginModalTimer:null,decrementLogoutWarningInterval:null,showingLogoutWarningModal:!1,showingLoginModal:!1,logoutWarningModal:null,loginModal:null,$logoutWarningPara:null,$passwordInput:null,$passwordSpinner:null,$loginBtn:null,$loginErrorPara:null,submitLoginIfLoggedOut:!1,init:function init(){this.updateRemainingSessionTime(Craft.remainingSessionTime)},setCheckRemainingSessionTimer:function setCheckRemainingSessionTimer(seconds){this.checkRemainingSessionTimer&&clearTimeout(this.checkRemainingSessionTimer),this.checkRemainingSessionTimer=setTimeout(this.checkRemainingSessionTime.bind(this),1e3*seconds)},checkRemainingSessionTime:function checkRemainingSessionTime(extendSession){var _this=this;$.ajax({url:Craft.getActionUrl("users/session-info",extendSession?null:"dontExtendSession=1"),type:"GET",dataType:"json",complete:function complete(jqXHR,textStatus){"success"===textStatus?(void 0!==jqXHR.responseJSON.csrfTokenValue&&void 0!==Craft.csrfTokenValue&&(Craft.csrfTokenValue=jqXHR.responseJSON.csrfTokenValue),_this.updateRemainingSessionTime(jqXHR.responseJSON.timeout),_this.submitLoginIfLoggedOut=!1):_this.updateRemainingSessionTime(-1)}})},updateRemainingSessionTime:function updateRemainingSessionTime(remainingSessionTime){this.remainingSessionTime=parseInt(remainingSessionTime),-1!==this.remainingSessionTime&&this.remainingSessionTime<Craft.AuthManager.minSafeSessionTime?(this.remainingSessionTime?(this.showingLogoutWarningModal||this.showLogoutWarningModal(),this.remainingSessionTime<Craft.AuthManager.checkInterval&&(this.showLoginModalTimer&&clearTimeout(this.showLoginModalTimer),this.showLoginModalTimer=setTimeout(this.showLoginModal.bind(this),1e3*this.remainingSessionTime))):this.showingLoginModal?this.submitLoginIfLoggedOut&&this.submitLogin():this.showLoginModal(),this.setCheckRemainingSessionTimer(Craft.AuthManager.checkInterval)):(this.hideLogoutWarningModal(),this.hideLoginModal(),-1!==this.remainingSessionTime&&this.remainingSessionTime<Craft.AuthManager.minSafeSessionTime+Craft.AuthManager.checkInterval?this.setCheckRemainingSessionTimer(this.remainingSessionTime-Craft.AuthManager.minSafeSessionTime+1):this.setCheckRemainingSessionTimer(Craft.AuthManager.checkInterval))},showLogoutWarningModal:function showLogoutWarningModal(){var quickShow;if(this.showingLoginModal?(this.hideLoginModal(!0),quickShow=!0):quickShow=!1,this.showingLogoutWarningModal=!0,!this.logoutWarningModal){var $form=$('<form id="logoutwarningmodal" class="modal alert fitted"/>'),$body=$('<div class="body"/>').appendTo($form),$buttons=$('<div class="buttons right"/>').appendTo($body),$logoutBtn=$("<button/>",{type:"button",class:"btn",text:Craft.t("app","Log out now")}).appendTo($buttons),$renewSessionBtn=$("<button/>",{type:"submit",class:"btn submit",text:Craft.t("app","Keep me logged in")}).appendTo($buttons);this.$logoutWarningPara=$("<p/>").prependTo($body),this.logoutWarningModal=new Garnish.Modal($form,{autoShow:!1,closeOtherModals:!1,hideOnEsc:!1,hideOnShadeClick:!1,shadeClass:"modal-shade dark logoutwarningmodalshade",onFadeIn:function onFadeIn(){Garnish.isMobileBrowser(!0)||setTimeout((function(){$renewSessionBtn.trigger("focus")}),100)}}),this.addListener($logoutBtn,"activate","logout"),this.addListener($form,"submit","renewSession")}quickShow?this.logoutWarningModal.quickShow():this.logoutWarningModal.show(),this.updateLogoutWarningMessage(),this.decrementLogoutWarningInterval=setInterval(this.decrementLogoutWarning.bind(this),1e3)},updateLogoutWarningMessage:function updateLogoutWarningMessage(){this.$logoutWarningPara.text(Craft.t("app","Your session will expire in {time}.",{time:Craft.secondsToHumanTimeDuration(this.remainingSessionTime)})),this.logoutWarningModal.updateSizeAndPosition()},decrementLogoutWarning:function decrementLogoutWarning(){this.remainingSessionTime>0&&(this.remainingSessionTime--,this.updateLogoutWarningMessage()),0===this.remainingSessionTime&&clearInterval(this.decrementLogoutWarningInterval)},hideLogoutWarningModal:function hideLogoutWarningModal(quick){this.showingLogoutWarningModal=!1,this.logoutWarningModal&&(quick?this.logoutWarningModal.quickHide():this.logoutWarningModal.hide(),this.decrementLogoutWarningInterval&&clearInterval(this.decrementLogoutWarningInterval))},showLoginModal:function showLoginModal(){var _this2=this,quickShow;if(this.showingLogoutWarningModal?(this.hideLogoutWarningModal(!0),quickShow=!0):quickShow=!1,this.showingLoginModal=!0,!this.loginModal){var $form=$('<form id="loginmodal" class="modal alert fitted"/>'),$body=$('<div class="body"><h2>'+Craft.t("app","Your session has ended.")+"</h2><p>"+Craft.t("app","Enter your password to log back in.")+"</p></div>").appendTo($form),$inputContainer=$('<div class="inputcontainer">').appendTo($body),$inputsFlexContainer=$('<div class="flex"/>').appendTo($inputContainer),$passwordContainer=$('<div class="flex-grow"/>').appendTo($inputsFlexContainer),$buttonContainer=$("<div/>").appendTo($inputsFlexContainer),$passwordWrapper=$('<div class="passwordwrapper"/>').appendTo($passwordContainer);this.$passwordInput=$('<input type="password" class="text password fullwidth" placeholder="'+Craft.t("app","Password")+'"/>').appendTo($passwordWrapper),this.$passwordSpinner=$('<div class="spinner hidden"/>').appendTo($inputContainer),this.$loginBtn=$("<button/>",{type:"submit",class:"btn submit disabled",text:Craft.t("app","Login")}).appendTo($buttonContainer),this.$loginErrorPara=$('<p class="error"/>').appendTo($body),this.loginModal=new Garnish.Modal($form,{autoShow:!1,closeOtherModals:!1,hideOnEsc:!1,hideOnShadeClick:!1,shadeClass:"modal-shade dark loginmodalshade",onFadeIn:function onFadeIn(){Garnish.isMobileBrowser(!0)||setTimeout((function(){_this2.$passwordInput.trigger("focus")}),100)},onFadeOut:function onFadeOut(){_this2.$passwordInput.val("")}}),new Craft.PasswordInput(this.$passwordInput,{onToggleInput:function onToggleInput($newPasswordInput){_this2.$passwordInput=$newPasswordInput}}),this.addListener(this.$passwordInput,"input","validatePassword"),this.addListener($form,"submit","login")}quickShow?this.loginModal.quickShow():this.loginModal.show()},hideLoginModal:function hideLoginModal(quick){this.showingLoginModal=!1,this.loginModal&&(quick?this.loginModal.quickHide():this.loginModal.hide())},logout:function logout(){$.get({url:Craft.getActionUrl("users/logout"),dataType:"json",success:function success(){Craft.redirectTo("")}})},renewSession:function renewSession(ev){ev&&ev.preventDefault(),this.hideLogoutWarningModal(),this.checkRemainingSessionTime(!0)},validatePassword:function validatePassword(){return this.$passwordInput.val().length>=6?(this.$loginBtn.removeClass("disabled"),!0):(this.$loginBtn.addClass("disabled"),!1)},login:function login(ev){ev&&ev.preventDefault(),this.validatePassword()&&(this.$passwordSpinner.removeClass("hidden"),this.clearLoginError(),void 0!==Craft.csrfTokenValue?(this.submitLoginIfLoggedOut=!0,this.checkRemainingSessionTime()):this.submitLogin())},submitLogin:function submitLogin(){var _this3=this,data={loginName:Craft.username,password:this.$passwordInput.val()};Craft.postActionRequest("users/login",data,(function(response,textStatus){_this3.$passwordSpinner.addClass("hidden"),"success"===textStatus?response.success?(_this3.hideLoginModal(),_this3.checkRemainingSessionTime()):(_this3.showLoginError(response.error),Garnish.shake(_this3.loginModal.$container),Garnish.isMobileBrowser(!0)||_this3.$passwordInput.trigger("focus")):_this3.showLoginError()}))},showLoginError:function showLoginError(error){null==error&&(error=Craft.t("app","A server error occurred.")),this.$loginErrorPara.text(error),this.loginModal.updateSizeAndPosition()},clearLoginError:function clearLoginError(){this.showLoginError("")}},{checkInterval:60,minSafeSessionTime:120})},function(module,exports){function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}Craft.CP=Garnish.Base.extend({authManager:null,$nav:null,$mainContainer:null,$alerts:null,$crumbs:null,$notificationContainer:null,$main:null,$primaryForm:null,$headerContainer:null,$header:null,$mainContent:null,$details:null,$sidebarContainer:null,$sidebar:null,$contentContainer:null,$edition:null,$confirmUnloadForms:null,$deltaForms:null,$collapsibleTables:null,fixedHeader:!1,tabManager:null,enableQueue:!0,totalJobs:0,jobInfo:null,displayedJobInfo:null,displayedJobInfoUnchanged:1,trackJobProgressTimeout:null,jobProgressIcon:null,checkingForUpdates:!1,forcingRefreshOnUpdatesCheck:!1,includingDetailsOnUpdatesCheck:!1,checkForUpdatesCallbacks:null,init:function init(){var _this=this;0!==Craft.remainingSessionTime&&(this.authManager=new Craft.AuthManager),this.$nav=$("#nav"),this.$mainContainer=$("#main-container"),this.$alerts=$("#alerts"),this.$crumbs=$("#crumbs"),this.$notificationContainer=$("#notifications"),this.$main=$("#main"),this.$primaryForm=$("#main-form"),this.$headerContainer=$("#header-container"),this.$header=$("#header"),this.$mainContent=$("#main-content"),this.$details=$("#details"),this.$sidebarContainer=$("#sidebar-container"),this.$sidebar=$("#sidebar"),this.$contentContainer=$("#content-container"),this.$collapsibleTables=$("table.collapsible"),this.updateSidebarMenuLabel();for(var $allInstructions=this.$details.find(".meta > .field > .instructions"),i=0;i<$allInstructions.length;i++){var $instructions=$allInstructions.eq(i),$label=$instructions.siblings(".heading").children("label");$("<span/>",{class:"info",html:$instructions.children().html()}).appendTo($label),$instructions.remove()}this.$header.length&&(this.addListener(Garnish.$win,"scroll","updateFixedHeader"),this.updateFixedHeader()),Garnish.$doc.ready((function(){_this.addListener(Garnish.$win,"resize",(function(ev){ev.target===window&&_this.handleWindowResize()})),_this.handleWindowResize();var $errorNotifications=_this.$notificationContainer.children(".error"),$otherNotifications=_this.$notificationContainer.children(":not(.error)");$errorNotifications.delay(2*Craft.CP.notificationDuration).velocity("fadeOut"),$otherNotifications.delay(Craft.CP.notificationDuration).velocity("fadeOut"),Garnish.requestAnimationFrame(_this.initSpecialForms.bind(_this))})),this.$alerts.length&&this.initAlerts(),this.addListener($("#nav-toggle"),"click","toggleNav"),this.addListener($("#sidebar-toggle"),"click","toggleSidebar"),this.$primaryForm.length||(this.$primaryForm=$("form[data-saveshortcut]:first")),this.$primaryForm.length&&Garnish.hasAttr(this.$primaryForm,"data-saveshortcut")&&function(){var shortcuts=[],actions=_this.$primaryForm.data("actions");if(void 0===actions)shortcuts.push([{keyCode:Garnish.S_KEY,ctrl:!0},{redirect:_this.$primaryForm.data("saveshortcut-redirect"),retainScroll:Garnish.hasAttr(_this.$primaryForm,"saveshortcut-scroll")}]);else for(var _i=0;_i<actions.length;_i++){var action=actions[_i];action.shortcut&&shortcuts.push([{keyCode:Garnish.S_KEY,ctrl:!0,shift:!!action.shift},{action:action.action,redirect:action.redirect,confirm:action.confirm,params:action.params,data:action.data,retainScroll:action.retainScroll}])}for(var _loop=function _loop(_i2){Garnish.shortcutManager.registerShortcut(shortcuts[_i2][0],(function(){_this.submitPrimaryForm(shortcuts[_i2][1])}))},_i2=0;_i2<shortcuts.length;_i2++)_loop(_i2)}(),this.initTabs();var scrollY=Craft.getLocalStorage("scrollY");if(void 0!==scrollY&&(Craft.removeLocalStorage("scrollY"),Garnish.$doc.ready((function(){Garnish.requestAnimationFrame((function(){window.scrollTo(0,scrollY)}))}))),$.isTouchCapable()&&(this.$mainContainer.on("focus","input, textarea, .focusable-input",this._handleInputFocus.bind(this)),this.$mainContainer.on("blur","input, textarea, .focusable-input",this._handleInputBlur.bind(this))),Craft.announcements.length){var $btn=$("#announcements-btn").removeClass("hidden"),hasUnreads=Craft.announcements.some((function(a){return a.unread})),hud;hasUnreads&&$btn.addClass("unread"),this.addListener($btn,"click",(function(){if(hud)hud.show();else{var contents="";Craft.announcements.forEach((function(a){contents+='<div class="announcement '.concat(a.unread?"unread":"",'">')+'<div class="announcement-label-container">'+'<div class="announcement-icon">'.concat(a.icon,"</div>")+'<div class="announcement-label">'.concat(a.label,"</div>")+"</div>"+"<h2>".concat(a.heading,"</h2>")+"<p>".concat(a.body,"</p>")+"</div>"})),hud=new Garnish.HUD($btn,'<div id="announcements">'.concat(contents,"</div>"),{onShow:function onShow(){$btn.addClass("active")},onHide:function onHide(){$btn.removeClass("active")}}),$("a",hud.$main).each((function(){this.hostname.length&&this.hostname!==location.hostname&&void 0===$(this).attr("target")&&$(this).attr("rel","noopener").attr("target","_blank")})),hasUnreads&&($btn.removeClass("unread"),Craft.sendActionRequest("POST","users/mark-announcements-as-read",{data:{ids:Craft.announcements.map((function(a){return a.id}))}}))}}))}},initSpecialForms:function initSpecialForms(){if(this.$confirmUnloadForms=$("form[data-confirm-unload]"),this.$deltaForms=$("form[data-delta]"),this.$confirmUnloadForms.length){for(var $forms=this.$confirmUnloadForms.add(this.$deltaForms),$form,serialized,i=0;i<$forms.length;i++)($form=$forms.eq(i)).data("initialSerializedValue")||(serialized="function"==typeof $form.data("serializer")?$form.data("serializer")():$form.serialize(),$form.data("initialSerializedValue",serialized)),this.addListener($form,"submit",(function(ev){if(Garnish.hasAttr($form,"data-confirm-unload")&&this.removeListener(Garnish.$win,"beforeunload"),Garnish.hasAttr($form,"data-delta")){var serialized;ev.preventDefault(),serialized="function"==typeof $form.data("serializer")?$form.data("serializer")():$form.serialize();var data=Craft.findDeltaData($form.data("initialSerializedValue"),serialized,Craft.deltaNames);Craft.createForm(data).appendTo(Garnish.$bod).submit()}}));this.addListener(Garnish.$win,"beforeunload",(function(ev){var confirmUnload=!1,$form,serialized;if(void 0!==Craft.livePreview&&Craft.livePreview.inPreviewMode)confirmUnload=!0;else for(var i=0;i<this.$confirmUnloadForms.length;i++)if(serialized="function"==typeof($form=this.$confirmUnloadForms.eq(i)).data("serializer")?$form.data("serializer")():$form.serialize(),$form.data("initialSerializedValue")!==serialized){confirmUnload=!0;break}if(confirmUnload){var message=Craft.t("app","Any changes will be lost if you leave this page.");return ev?ev.originalEvent.returnValue=message:window.event.returnValue=message,message}}))}},_handleInputFocus:function _handleInputFocus(){this.updateFixedHeader()},_handleInputBlur:function _handleInputBlur(){this.updateFixedHeader()},submitPrimaryForm:function submitPrimaryForm(options){this.trigger("beforeSaveShortcut"),"object"===_typeof(options)&&$.isPlainObject(options)||(options={}),options.redirect||(options.redirect=this.$primaryForm.data("saveshortcut-redirect")),options.data||(options.data={}),options.data.saveShortcut=!0,Craft.submitForm(this.$primaryForm,options)},updateSidebarMenuLabel:function updateSidebarMenuLabel(){var $item=this.$sidebar.find("a.sel:first"),$label=$item.children(".label");$("#selected-sidebar-item-label").text($label.length?$label.text():$item.text()),Garnish.$bod.removeClass("showing-sidebar")},toggleNav:function toggleNav(){Garnish.$bod.toggleClass("showing-nav")},toggleSidebar:function toggleSidebar(){Garnish.$bod.toggleClass("showing-sidebar")},initTabs:function initTabs(){this.tabManager&&(this.tabManager.destroy(),this.tabManager=null);var $tabs=$("#tabs");if($tabs.length&&(this.tabManager=new Craft.Tabs($tabs),this.tabManager.on("selectTab",(function(ev){var href=ev.$tab.attr("href");if("#"===href.charAt(0)&&$(href).removeClass("hidden"),Garnish.$win.trigger("resize"),Garnish.$doc.trigger("scroll"),href&&"#"===href.charAt(0)){var menuBtn=$("#context-btn").menubtn().data("menubtn");if(menuBtn)for(var i=0;i<menuBtn.menu.$options.length;i++){var a=menuBtn.menu.$options[i];a.href&&(a.href=a.href.match(/^[^#]*/)[0]+href)}}"undefined"!=typeof history&&Garnish.requestAnimationFrame((function(){history.replaceState(void 0,void 0,href)}))})),this.tabManager.on("deselectTab",(function(ev){"#"===ev.$tab.attr("href").charAt(0)&&$(ev.$tab.attr("href")).addClass("hidden")})),window.LOCATION_HASH)){var $tab=this.tabManager.$tabs.filter('[href="#'.concat(window.LOCATION_HASH,'"]'));$tab.length&&this.tabManager.selectTab($tab)}},get $tabsContainer(){return this.tabManager?this.tabManager.$container:void 0},get $tabsList(){return this.tabManager?this.tabManager.$ul:void 0},get $tabs(){return this.tabManager?this.tabManager.$ul.find("> li"):void 0},get $selectedTab(){return this.tabManager?this.tabManager.$selectedTab:void 0},get selectedTabIndex(){return this.tabManager?this.tabManager.$tabs.index(this.tabManager.$selectedTab):void 0},get $focusableTab(){return this.tabManager?this.tabManager.$focusableTab:void 0},selectTab:function selectTab(tab){this.tabManager&&this.tabManager.selectTab(tab)},deselectTab:function deselectTab(){this.tabManager&&this.tabManager.deselectTab()},handleWindowResize:function handleWindowResize(){this.updateResponsiveTables()},updateResponsiveTables:function updateResponsiveTables(){for(this.updateResponsiveTables._i=0;this.updateResponsiveTables._i<this.$collapsibleTables.length;this.updateResponsiveTables._i++)this.updateResponsiveTables._$table=this.$collapsibleTables.eq(this.updateResponsiveTables._i),this.updateResponsiveTables._containerWidth=this.updateResponsiveTables._$table.parent().width(),this.updateResponsiveTables._check=!1,this.updateResponsiveTables._containerWidth>0&&(void 0===this.updateResponsiveTables._$table.data("lastContainerWidth")?this.updateResponsiveTables._check=!0:(this.updateResponsiveTables._isCollapsed=this.updateResponsiveTables._$table.hasClass("collapsed"),this.updateResponsiveTables._containerWidth>this.updateResponsiveTables._$table.data("lastContainerWidth")?this.updateResponsiveTables._isCollapsed&&(this.updateResponsiveTables._$table.removeClass("collapsed"),this.updateResponsiveTables._check=!0):this.updateResponsiveTables._isCollapsed||(this.updateResponsiveTables._check=!0)),this.updateResponsiveTables._check&&this.updateResponsiveTables._$table.width()-30>this.updateResponsiveTables._containerWidth&&this.updateResponsiveTables._$table.addClass("collapsed"),this.updateResponsiveTables._$table.data("lastContainerWidth",this.updateResponsiveTables._containerWidth))},updateFixedHeader:function updateFixedHeader(){if(this.$main.length&&this.$headerContainer[0].getBoundingClientRect().top<0){if(!this.fixedHeader){var headerHeight=this.$headerContainer.height();this.$contentContainer.css("min-height","calc(100vh - "+(headerHeight+14+48-1)+"px)"),this.$headerContainer.height(headerHeight),Garnish.$bod.addClass("fixed-header");var contentHeight=this.$contentContainer.outerHeight(),$detailsHeight=this.$details.outerHeight(),css={top:headerHeight+"px","max-height":"calc(100vh - "+headerHeight+"px)"};this.$sidebar.addClass("fixed").css(css),this.$details.addClass("fixed").css(css),this.fixedHeader=!0}}else this.fixedHeader&&(this.$headerContainer.height("auto"),Garnish.$bod.removeClass("fixed-header"),this.$contentContainer.css("min-height",""),this.$sidebar.removeClass("fixed").css({top:"","max-height":""}),this.$details.removeClass("fixed").css({top:"","max-height":""}),this.fixedHeader=!1)},displayNotification:function displayNotification(type,message){var notificationDuration=Craft.CP.notificationDuration;["cp-error","error"].includes(type)?(notificationDuration*=2,icon="alert",label=Craft.t("app","Error")):(icon="info",label=Craft.t("app","Notice"));var $notification=$('\n            <div class="notification '.concat(type.replace("cp-",""),'">\n                <span data-icon="').concat(icon,'" aria-label="').concat(label,'"></span>\n                ').concat(message,"\n            </div>\n            ")).appendTo(this.$notificationContainer),fadedMargin=-$notification.outerWidth()/2+"px";$notification.hide().css({opacity:0,"margin-left":fadedMargin,"margin-right":fadedMargin}).velocity({opacity:1,"margin-left":"2px","margin-right":"2px"},{display:"inline-block",duration:"fast"}).delay(notificationDuration).velocity({opacity:0,"margin-left":fadedMargin,"margin-right":fadedMargin},{complete:function complete(){$notification.remove()}}),this.trigger("displayNotification",{notificationType:type,message:message})},displayNotice:function displayNotice(message){this.displayNotification("notice",message)},displayError:function displayError(message){message||(message=Craft.t("app","A server error occurred.")),this.displayNotification("error",message)},fetchAlerts:function fetchAlerts(){var data={path:Craft.path};Craft.queueActionRequest("app/get-cp-alerts",data,this.displayAlerts.bind(this))},displayAlerts:function displayAlerts(alerts){if(this.$alerts.remove(),Garnish.isArray(alerts)&&alerts.length){this.$alerts=$('<ul id="alerts"/>').prependTo($("#page-container"));for(var i=0;i<alerts.length;i++)$('<li><span data-icon="alert" aria-label="'.concat(Craft.t("app","Error"),'"></span> ').concat(alerts[i],"</li>")).appendTo(this.$alerts);var height=this.$alerts.outerHeight();this.$alerts.css("margin-top",-height).velocity({"margin-top":0},"fast"),this.initAlerts()}},initAlerts:function initAlerts(){for(var _this2=this,$shunnableAlerts=this.$alerts.find('a[class^="shun:"]'),i=0;i<$shunnableAlerts.length;i++)this.addListener($shunnableAlerts[i],"click",(function(ev){ev.preventDefault();var $link=$(ev.currentTarget),data={message:$link.prop("className").substr(5)};Craft.queueActionRequest("app/shun-cp-alert",data,(function(response,textStatus){"success"===textStatus&&(response.success?$link.parent().remove():_this2.displayError(response.error))}))}))},checkForUpdates:function checkForUpdates(forceRefresh,includeDetails,callback){var _this3=this;if("function"==typeof includeDetails&&(callback=includeDetails,includeDetails=!1),this.checkingForUpdates&&(!0===forceRefresh&&!this.forcingRefreshOnUpdatesCheck||!0===includeDetails&&!this.includingDetailsOnUpdatesCheck)){var realCallback=callback;callback=function callback(){_this3.checkForUpdates(forceRefresh,includeDetails,realCallback)}}"function"==typeof callback&&(Garnish.isArray(this.checkForUpdatesCallbacks)||(this.checkForUpdatesCallbacks=[]),this.checkForUpdatesCallbacks.push(callback)),this.checkingForUpdates||(this.checkingForUpdates=!0,this.forcingRefreshOnUpdatesCheck=!0===forceRefresh,this.includingDetailsOnUpdatesCheck=!0===includeDetails,this._checkForUpdates(forceRefresh,includeDetails).then((function(info){if(_this3.updateUtilitiesBadge(),_this3.checkingForUpdates=!1,Garnish.isArray(_this3.checkForUpdatesCallbacks)){var callbacks=_this3.checkForUpdatesCallbacks;_this3.checkForUpdatesCallbacks=null;for(var i=0;i<callbacks.length;i++)callbacks[i](info)}_this3.trigger("checkForUpdates",{updateInfo:info})})))},_checkForUpdates:function _checkForUpdates(forceRefresh,includeDetails){var _this4=this;return new Promise((function(resolve,reject){forceRefresh?_this4._getUpdates(includeDetails).then((function(info){resolve(info)})):_this4._checkForCachedUpdates(includeDetails).then((function(info){!1!==info.cached&&resolve(info),_this4._getUpdates(includeDetails).then((function(info){resolve(info)}))}))}))},_checkForCachedUpdates:function _checkForCachedUpdates(includeDetails){return new Promise((function(resolve,reject){var data={onlyIfCached:!0,includeDetails:includeDetails};Craft.postActionRequest("app/check-for-updates",data,(function(info,textStatus){resolve("success"===textStatus?info:{cached:!1})}))}))},_getUpdates:function _getUpdates(includeDetails){var _this5=this;return new Promise((function(resolve,reject){Craft.sendApiRequest("GET","updates").then((function(updates){_this5._cacheUpdates(updates,includeDetails).then(resolve)})).catch((function(e){_this5._cacheUpdates({}).then(resolve)}))}))},_cacheUpdates:function _cacheUpdates(updates,includeDetails){return new Promise((function(resolve,reject){Craft.postActionRequest("app/cache-updates",{updates:updates,includeDetails:includeDetails},(function(info,textStatus){"success"===textStatus?resolve(info):reject()}),{contentType:"json"})}))},updateUtilitiesBadge:function updateUtilitiesBadge(){var $utilitiesLink=$("#nav-utilities").find("> a:not(.sel)");$utilitiesLink.length&&Craft.queueActionRequest("app/get-utilities-badge-count",(function(response){var $badge=$utilitiesLink.children(".badge");response.badgeCount?($badge.length||($badge=$('<span class="badge"/>').appendTo($utilitiesLink)),$badge.text(response.badgeCount)):$badge.length&&$badge.remove()}))},runQueue:function runQueue(){var _this6=this;this.enableQueue&&(Craft.runQueueAutomatically?Craft.queueActionRequest("queue/run",(function(response,textStatus){"success"===textStatus&&_this6.trackJobProgress(!1,!0)})):this.trackJobProgress(!1,!0))},trackJobProgress:function trackJobProgress(delay,force){if(force&&this.trackJobProgressTimeout&&(clearTimeout(this.trackJobProgressTimeout),this.trackJobProgressTimeout=null),!this.trackJobProgressTimeout&&this.enableQueue)if(!0===delay){var timeout=Math.min(6e4,500*this.displayedJobInfoUnchanged);this.trackJobProgressTimeout=setTimeout(this._trackJobProgressInternal.bind(this),timeout)}else this._trackJobProgressInternal()},_trackJobProgressInternal:function _trackJobProgressInternal(){var _this7=this;Craft.queueActionRequest("queue/get-job-info?limit=50&dontExtendSession=1",(function(response,textStatus){"success"===textStatus&&(_this7.trackJobProgressTimeout=null,_this7.totalJobs=response.total,_this7.setJobInfo(response.jobs),_this7.jobInfo.length&&_this7.trackJobProgress(!0))}))},setJobInfo:function setJobInfo(jobInfo){if(this.enableQueue){this.jobInfo=jobInfo;var oldInfo=this.displayedJobInfo;this.displayedJobInfo=this.getDisplayedJobInfo(),oldInfo&&this.displayedJobInfo&&oldInfo.id===this.displayedJobInfo.id&&oldInfo.progress===this.displayedJobInfo.progress&&oldInfo.progressLabel===this.displayedJobInfo.progressLabel&&oldInfo.status===this.displayedJobInfo.status?this.displayedJobInfoUnchanged++:this.displayedJobInfoUnchanged=1,this.updateJobIcon(),this.trigger("setJobInfo")}},getDisplayedJobInfo:function getDisplayedJobInfo(){if(!this.enableQueue)return null;for(var statuses=[Craft.CP.JOB_STATUS_RESERVED,Craft.CP.JOB_STATUS_FAILED,Craft.CP.JOB_STATUS_WAITING],i=0;i<statuses.length;i++)for(var j=0;j<this.jobInfo.length;j++)if(this.jobInfo[j].status===statuses[i]&&(statuses[i]!==Craft.CP.JOB_STATUS_WAITING||!this.jobInfo[j].delay))return this.jobInfo[j];return null},updateJobIcon:function updateJobIcon(){this.enableQueue&&this.$nav.length&&(this.displayedJobInfo?(this.jobProgressIcon||(this.jobProgressIcon=new JobProgressIcon),this.displayedJobInfo.status===Craft.CP.JOB_STATUS_RESERVED||this.displayedJobInfo.status===Craft.CP.JOB_STATUS_WAITING?(this.jobProgressIcon.hideFailMode(),this.jobProgressIcon.setDescription(this.displayedJobInfo.description,this.displayedJobInfo.progressLabel),this.jobProgressIcon.setProgress(this.displayedJobInfo.progress)):this.displayedJobInfo.status===Craft.CP.JOB_STATUS_FAILED&&this.jobProgressIcon.showFailMode(Craft.t("app","Failed"))):this.jobProgressIcon&&(this.jobProgressIcon.hideFailMode(),this.jobProgressIcon.complete(),delete this.jobProgressIcon))},getSiteId:function getSiteId(){var siteId=Craft.getLocalStorage("BaseElementIndex.siteId");return void 0!==siteId?(Craft.removeLocalStorage("BaseElementIndex.siteId"),this.setSiteId(siteId),siteId):Craft.getCookie("siteId")},setSiteId:function setSiteId(siteId){Craft.setCookie("siteId",siteId,{maxAge:31536e3})}},{notificationDuration:2e3,JOB_STATUS_WAITING:1,JOB_STATUS_RESERVED:2,JOB_STATUS_DONE:3,JOB_STATUS_FAILED:4}),Garnish.$scrollContainer=Garnish.$win,Craft.cp=new Craft.CP;var JobProgressIcon=Garnish.Base.extend({$li:null,$a:null,$label:null,$progressLabel:null,progress:null,failMode:!1,_$bgCanvas:null,_$staticCanvas:null,_$hoverCanvas:null,_$failCanvas:null,_staticCtx:null,_hoverCtx:null,_canvasSize:null,_arcPos:null,_arcRadius:null,_lineWidth:null,_arcStartPos:0,_arcEndPos:0,_arcStartStepSize:null,_arcEndStepSize:null,_arcStep:null,_arcStepTimeout:null,_arcAnimateCallback:null,_progressBar:null,init:function init(){this.$li=$("<li/>").appendTo(Craft.cp.$nav.children("ul")),this.$a=$("<a/>",{id:"job-icon",href:Craft.canAccessQueueManager?Craft.getUrl("utilities/queue-manager"):null}).appendTo(this.$li),this.$canvasContainer=$('<span class="icon"/>').appendTo(this.$a);var $labelContainer=$('<span class="label"/>').appendTo(this.$a);this.$label=$("<span/>").appendTo($labelContainer),this.$progressLabel=$('<span class="progress-label"/>').appendTo($labelContainer).hide();var m=window.devicePixelRatio>1?2:1;this._canvasSize=18*m,this._arcPos=this._canvasSize/2,this._arcRadius=7*m,this._lineWidth=3*m,this._$bgCanvas=this._createCanvas("bg","#61666b"),this._$staticCanvas=this._createCanvas("static","#d7d9db"),this._$hoverCanvas=this._createCanvas("hover","#fff"),this._$failCanvas=this._createCanvas("fail","#da5a47").hide(),this._staticCtx=this._$staticCanvas[0].getContext("2d"),this._hoverCtx=this._$hoverCanvas[0].getContext("2d"),this._drawArc(this._$bgCanvas[0].getContext("2d"),0,1),this._drawArc(this._$failCanvas[0].getContext("2d"),0,1)},setDescription:function setDescription(description,progressLabel){this.$a.attr("title",description),this.$label.text(description),progressLabel?this.$progressLabel.text(progressLabel).show():this.$progressLabel.hide()},setProgress:function setProgress(progress){0==progress?(this._$staticCanvas.hide(),this._$hoverCanvas.hide()):(this._$staticCanvas.show(),this._$hoverCanvas.show(),this.progress&&progress>this.progress?this._animateArc(0,progress/100):this._setArc(0,progress/100)),this.progress=progress},complete:function complete(){var _this8=this;this._animateArc(0,1,(function(){_this8._$bgCanvas.velocity("fadeOut"),_this8._animateArc(1,1,(function(){_this8.$a.remove(),_this8.destroy()}))}))},showFailMode:function showFailMode(message){this.failMode||(this.failMode=!0,this.progress=null,this._$bgCanvas.hide(),this._$staticCanvas.hide(),this._$hoverCanvas.hide(),this._$failCanvas.show(),this.setDescription(message))},hideFailMode:function hideFailMode(){this.failMode&&(this.failMode=!1,this._$bgCanvas.show(),this._$staticCanvas.show(),this._$hoverCanvas.show(),this._$failCanvas.hide())},_createCanvas:function _createCanvas(id,color){var $canvas=$('<canvas id="job-icon-'+id+'" width="'+this._canvasSize+'" height="'+this._canvasSize+'"/>').appendTo(this.$canvasContainer),ctx=$canvas[0].getContext("2d");return ctx.strokeStyle=color,ctx.lineWidth=this._lineWidth,ctx.lineCap="round",$canvas},_setArc:function _setArc(startPos,endPos){this._arcStartPos=startPos,this._arcEndPos=endPos,this._drawArc(this._staticCtx,startPos,endPos),this._drawArc(this._hoverCtx,startPos,endPos)},_drawArc:function _drawArc(ctx,startPos,endPos){ctx.clearRect(0,0,this._canvasSize,this._canvasSize),ctx.beginPath(),ctx.arc(this._arcPos,this._arcPos,this._arcRadius,(1.5+2*startPos)*Math.PI,(1.5+2*endPos)*Math.PI),ctx.stroke(),ctx.closePath()},_animateArc:function _animateArc(targetStartPos,targetEndPos,callback){this._arcStepTimeout&&clearTimeout(this._arcStepTimeout),this._arcStep=0,this._arcStartStepSize=(targetStartPos-this._arcStartPos)/10,this._arcEndStepSize=(targetEndPos-this._arcEndPos)/10,this._arcAnimateCallback=callback,this._takeNextArcStep()},_takeNextArcStep:function _takeNextArcStep(){this._setArc(this._arcStartPos+this._arcStartStepSize,this._arcEndPos+this._arcEndStepSize),this._arcStep++,this._arcStep<10?this._arcStepTimeout=setTimeout(this._takeNextArcStep.bind(this),50):this._arcAnimateCallback&&this._arcAnimateCallback()}})},function(module,exports){Craft.CategoryIndex=Craft.BaseElementIndex.extend({editableGroups:null,$newCategoryBtnGroup:null,$newCategoryBtn:null,init:function init(elementType,$container,settings){this.on("selectSource",this.updateButton.bind(this)),this.on("selectSite",this.updateButton.bind(this)),this.base(elementType,$container,settings)},afterInit:function afterInit(){this.editableGroups=[];for(var i=0;i<Craft.editableCategoryGroups.length;i++){var group=Craft.editableCategoryGroups[i];this.getSourceByKey("group:"+group.uid)&&this.editableGroups.push(group)}this.base()},getDefaultSourceKey:function getDefaultSourceKey(){if("index"===this.settings.context&&"undefined"!=typeof defaultGroupHandle)for(var i=0;i<this.$sources.length;i++){var $source=$(this.$sources[i]);if($source.data("handle")===defaultGroupHandle)return $source.data("key")}return this.base()},updateButton:function updateButton(){var _this=this;if(this.$source){var selectedSourceHandle=this.$source.data("handle"),i,href,label;if(this.editableGroups.length){var selectedGroup,$menuBtn;if(this.$newCategoryBtnGroup&&this.$newCategoryBtnGroup.remove(),selectedSourceHandle)for(i=0;i<this.editableGroups.length;i++)if(this.editableGroups[i].handle===selectedSourceHandle){selectedGroup=this.editableGroups[i];break}if(this.$newCategoryBtnGroup=$('<div class="btngroup submit"/>'),selectedGroup?(href=this._getGroupTriggerHref(selectedGroup),label="index"===this.settings.context?Craft.t("app","New category"):Craft.t("app","New {group} category",{group:selectedGroup.name}),this.$newCategoryBtn=$('<a class="btn submit add icon" '+href+">"+Craft.escapeHtml(label)+"</a>").appendTo(this.$newCategoryBtnGroup),"index"!==this.settings.context&&this.addListener(this.$newCategoryBtn,"click",(function(ev){this._openCreateCategoryModal(ev.currentTarget.getAttribute("data-id"))})),this.editableGroups.length>1&&($menuBtn=$("<button/>",{type:"button",class:"btn submit menubtn"}).appendTo(this.$newCategoryBtnGroup))):this.$newCategoryBtn=$menuBtn=$("<button/>",{type:"button",class:"btn submit add icon menubtn",text:Craft.t("app","New category")}).appendTo(this.$newCategoryBtnGroup),$menuBtn){var menuHtml='<div class="menu"><ul>';for(i=0;i<this.editableGroups.length;i++){var group=this.editableGroups[i];"index"!==this.settings.context&&group===selectedGroup||(href=this._getGroupTriggerHref(group),label="index"===this.settings.context?group.name:Craft.t("app","New {group} category",{group:group.name}),menuHtml+="<li><a "+href+">"+Craft.escapeHtml(label)+"</a></li>")}menuHtml+="</ul></div>",$(menuHtml).appendTo(this.$newCategoryBtnGroup);var menuBtn=new Garnish.MenuBtn($menuBtn);"index"!==this.settings.context&&menuBtn.on("optionSelect",(function(ev){_this._openCreateCategoryModal(ev.option.getAttribute("data-id"))}))}this.addButton(this.$newCategoryBtnGroup)}if("index"===this.settings.context&&"undefined"!=typeof history){var uri="categories";selectedSourceHandle&&(uri+="/"+selectedSourceHandle),history.replaceState({},"",Craft.getUrl(uri))}}},_getGroupTriggerHref:function _getGroupTriggerHref(group){if("index"===this.settings.context){var uri="categories/".concat(group.handle,"/new"),site=this.getSite(),params=site?{site:site.handle}:void 0;return'href="'.concat(Craft.getUrl(uri,params),'"')}return'data-id="'.concat(group.id,'"')},_openCreateCategoryModal:function _openCreateCategoryModal(groupId){var _this2=this;if(!this.$newCategoryBtn.hasClass("loading")){for(var group,i=0;i<this.editableGroups.length;i++)if(this.editableGroups[i].id==groupId){group=this.editableGroups[i];break}if(group){this.$newCategoryBtn.addClass("inactive");var newCategoryBtnText=this.$newCategoryBtn.text();this.$newCategoryBtn.text(Craft.t("app","New {group} category",{group:group.name})),Craft.createElementEditor(this.elementType,{hudTrigger:this.$newCategoryBtnGroup,siteId:this.siteId,attributes:{groupId:groupId},onHideHud:function onHideHud(){_this2.$newCategoryBtn.removeClass("inactive").text(newCategoryBtnText)},onSaveElement:function onSaveElement(response){var groupSourceKey="group:"+group.uid;_this2.sourceKey!==groupSourceKey&&_this2.selectSourceByKey(groupSourceKey),_this2.selectElementAfterUpdate(response.id),_this2.updateElements()}})}}}}),Craft.registerElementIndexClass("craft\\elements\\Category",Craft.CategoryIndex)},function(module,exports){Craft.CategorySelectInput=Craft.BaseElementSelectInput.extend({setSettings:function setSettings(){this.base.apply(this,arguments),this.settings.sortable=!1},getModalSettings:function getModalSettings(){var settings=this.base();return settings.hideOnSelect=!1,settings},getElements:function getElements(){return this.$elementsContainer.find(".element")},onModalSelect:function onModalSelect(elements){var _this=this;this.modal.disable(),this.modal.disableCancelBtn(),this.modal.disableSelectBtn(),this.modal.showFooterSpinner();for(var selectedCategoryIds=this.getSelectedElementIds(),i=0;i<elements.length;i++)selectedCategoryIds.push(elements[i].id);var data={categoryIds:selectedCategoryIds,siteId:elements[0].siteId,id:this.settings.id,name:this.settings.name,branchLimit:this.settings.branchLimit,selectionLabel:this.settings.selectionLabel};Craft.postActionRequest("elements/get-categories-input-html",data,(function(response,textStatus){if(_this.modal.enable(),_this.modal.enableCancelBtn(),_this.modal.enableSelectBtn(),_this.modal.hideFooterSpinner(),"success"===textStatus){var $newInput,$newElementsContainer=$(response.html).children(".elements");_this.$elementsContainer.replaceWith($newElementsContainer),_this.$elementsContainer=$newElementsContainer,_this.resetElements();for(var filteredElements=[],i=0;i<elements.length;i++){var element=elements[i],$element=_this.getElementById(element.id);$element&&(_this.animateElementIntoPlace(element.$element,$element),filteredElements.push(element))}_this.updateDisabledElementsInModal(),_this.modal.hide(),_this.onSelectElements(filteredElements)}}))},removeElement:function removeElement($element){var $allCategories=$element.add($element.parent().siblings("ul").find(".element"));this.removeElements($allCategories);for(var i=0;i<$allCategories.length;i++)this._animateCategoryAway($allCategories,i)},_animateCategoryAway:function _animateCategoryAway($allCategories,i){var _this2=this,callback;i===$allCategories.length-1&&(callback=function callback(){var $li=$allCategories.first().parent().parent(),$ul=$li.parent();$ul[0]===_this2.$elementsContainer[0]||$li.siblings().length?$li.remove():$ul.remove()});var func=function func(){_this2.animateElementAway($allCategories.eq(i),callback)};0===i?func():setTimeout(func,100*i)}})},function(module,exports){Craft.charts={},Craft.charts.DataTable=Garnish.Base.extend({columns:null,rows:null,init:function init(data){var columns=data.columns,rows=data.rows;rows.forEach((function(d){$.each(d,(function(cellIndex){var column,parseTime;switch(columns[cellIndex].type){case"date":parseTime=d3.timeParse("%Y-%m-%d"),d[cellIndex]=parseTime(d[cellIndex]);break;case"datetime":parseTime=d3.timeParse("%Y-%m-%d %H:00:00"),d[cellIndex]=parseTime(d[cellIndex]);break;case"percent":d[cellIndex]=d[cellIndex]/100;break;case"number":d[cellIndex]=+d[cellIndex]}}))})),this.columns=columns,this.rows=rows}}),Craft.charts.Tip=Garnish.Base.extend({$container:null,$tip:null,init:function init($container){this.$container=$container,this.$tip=$('<div class="tooltip"></div>').appendTo(this.$container),this.hide()},setContent:function setContent(html){this.$tip.html(html)},setPosition:function setPosition(position){this.$tip.css("left","".concat(position.left,"px")),this.$tip.css("top","".concat(position.top,"px"))},show:function show(){this.$tip.css("display","block")},hide:function hide(){this.$tip.css("display","none")}}),Craft.charts.BaseChart=Garnish.Base.extend({$container:null,$chart:null,chartBaseClass:"cp-chart",dataTable:null,formatLocale:null,timeFormatLocale:null,orientation:null,svg:null,width:null,height:null,init:function init(container,settings){var _this=this;this.$container=container,this.setSettings(Craft.charts.BaseChart.defaults),this.setSettings(settings);var globalSettings={formats:window.d3Formats,formatLocaleDefinition:window.d3FormatLocaleDefinition,timeFormatLocaleDefinition:window.d3TimeFormatLocaleDefinition};this.setSettings(globalSettings),d3.select(window).on("resize",(function(){_this.resize()}))},setSettings:function setSettings(settings,defaults){var baseSettings=void 0===this.settings?{}:this.settings;this.settings=$.extend(!0,{},baseSettings,defaults,settings)},draw:function draw(dataTable,settings){this.setSettings(settings),this.dataTable=dataTable,this.formatLocale=d3.formatLocale(this.settings.formatLocaleDefinition),this.timeFormatLocale=d3.timeFormatLocale(this.settings.timeFormatLocaleDefinition),this.orientation=this.settings.orientation,this.$chart&&this.$chart.remove();var className=this.chartBaseClass;this.settings.chartClass&&(className+=" "+this.settings.chartClass),this.$chart=$('<div class="'.concat(className,'" />')).appendTo(this.$container)},resize:function resize(){this.draw(this.dataTable,this.settings)},onAfterDrawTicks:function onAfterDrawTicks(){$(".tick",this.$chart).each((function(tickKey,tick){var $tickText=$("text",tick),$clone;$tickText.clone().appendTo(tick),$tickText.attr("stroke","#ffffff"),$tickText.attr("stroke-width",3)}))}},{defaults:{formatLocaleDefinition:null,timeFormatLocaleDefinition:null,formats:{numberFormat:",.2f",percentFormat:",.2%",currencyFormat:"$,.2f",shortDateFormats:{day:"%-m/%-d",month:"%-m/%y",year:"%Y"}},margin:{top:0,right:0,bottom:0,left:0},chartClass:null,colors:["#0594D1","#DE3800","#FF9A00","#009802","#9B009B"]}}),Craft.charts.Area=Craft.charts.BaseChart.extend({tip:null,drawingArea:null,init:function init(container,settings){this.base(container,Craft.charts.Area.defaults),this.setSettings(settings)},draw:function draw(dataTable,settings){this.base(dataTable,settings),this.tip&&(this.tip=null);var margin=this.getChartMargin();this.width=this.$chart.width()-margin.left-margin.right,this.height=this.$chart.height()-margin.top-margin.bottom;var svg={width:this.width+(margin.left+margin.right),height:this.height+(margin.top+margin.bottom),translateX:"rtl"!==this.orientation?margin.left:margin.right,translateY:margin.top};this.svg=d3.select(this.$chart.get(0)).append("svg").attr("width",svg.width).attr("height",svg.height),this.drawingArea=this.svg.append("g").attr("transform","translate(".concat(svg.translateX,",").concat(svg.translateY,")")),this.drawTicks(),this.drawAxes(),this.drawChart(),this.drawTipTriggers()},drawTicks:function drawTicks(){var x=this.getX(!0),xTicks=3,xAxis=d3.axisBottom(x).tickFormat(this.getXFormatter()).ticks(3);this.drawingArea.append("g").attr("class","x ticks-axis").attr("transform","translate(0, ".concat(this.height,")")).call(xAxis);var y=this.getY(),yTicks=2,yAxis;"rtl"!==this.orientation?(yAxis=d3.axisLeft(y).tickFormat(this.getYFormatter()).tickValues(this.getYTickValues()).ticks(2),this.drawingArea.append("g").attr("class","y ticks-axis").call(yAxis)):(yAxis=d3.axisRight(y).tickFormat(this.getYFormatter()).tickValues(this.getYTickValues()).ticks(2),this.drawingArea.append("g").attr("class","y ticks-axis").attr("transform","translate(".concat(this.width,",0)")).call(yAxis)),this.onAfterDrawTicks()},drawAxes:function drawAxes(){if(this.settings.xAxis.showAxis){var x=this.getX(),xAxis=d3.axisBottom(x).ticks(0).tickSizeOuter(0);this.drawingArea.append("g").attr("class","x axis").attr("transform","translate(0, ".concat(this.height,")")).call(xAxis)}if(this.settings.yAxis.showAxis){var y=this.getY(),chartPadding=0,yAxis;"rtl"===this.orientation?(yAxis=d3.axisLeft(y).ticks(0),this.drawingArea.append("g").attr("class","y axis").attr("transform","translate(".concat(this.width-0,", 0)")).call(yAxis)):(yAxis=d3.axisRight(y).ticks(0),this.drawingArea.append("g").attr("class","y axis").attr("transform","translate(".concat(0,", 0)")).call(yAxis))}},drawChart:function drawChart(){var x=this.getX(!0),y=this.getY();if(this.settings.xAxis.gridlines){var xLineAxis=d3.axisBottom(x);this.drawingArea.append("g").attr("class","x grid-line").attr("transform","translate(0,".concat(this.height,")")).call(xLineAxis.tickSize(-this.height,0,0).tickFormat(""))}var yTicks=2;if(this.settings.yAxis.gridlines){var yLineAxis=d3.axisLeft(y);this.drawingArea.append("g").attr("class","y grid-line").attr("transform","translate(0 , 0)").call(yLineAxis.tickSize(-this.width,0).tickFormat("").tickValues(this.getYTickValues()).ticks(2))}var line=d3.line().x((function(d){return x(d[0])})).y((function(d){return y(d[1])}));this.drawingArea.append("g").attr("class","chart-line").append("path").datum(this.dataTable.rows).style("fill","none").style("stroke",this.settings.colors[0]).style("stroke-width","3px").attr("d",line);var area=d3.area().x((function(d){return x(d[0])})).y0(this.height).y1((function(d){return y(d[1])}));this.drawingArea.append("g").attr("class","chart-area").append("path").datum(this.dataTable.rows).style("fill",this.settings.colors[0]).style("fill-opacity","0.3").attr("d",area),this.settings.plots&&this.drawingArea.append("g").attr("class","plots").selectAll("circle").data(this.dataTable.rows).enter().append("circle").style("fill",this.settings.colors[0]).attr("class",(function(d,index){return"plot plot-".concat(index)})).attr("r",4).attr("cx",(function(d){return x(d[0])})).attr("cy",(function(d){return y(d[1])}))},drawTipTriggers:function drawTipTriggers(){var _this2=this;if(this.settings.tips){this.tip||(this.tip=new Craft.charts.Tip(this.$chart));var chartMargin=this.getChartMargin(),tickSizeOuter=6,length,xAxisTickInterval=(this.drawingArea.select(".x path.domain").node().getTotalLength()-chartMargin.left-chartMargin.right-12)/(this.dataTable.rows.length-1),tipTriggerWidth=Math.max(0,xAxisTickInterval),x=this.getX(!0),y=this.getY();this.drawingArea.append("g").attr("class","tip-triggers").selectAll("rect").data(this.dataTable.rows).enter().append("rect").attr("class","tip-trigger").style("fill","transparent").style("fill-opacity","1").attr("width",tipTriggerWidth).attr("height",this.height).attr("x",(function(d){return x(d[0])-tipTriggerWidth/2})).on("mouseover",(function(d,index){_this2.drawingArea.select(".plot-"+index).attr("r",5);var $content=$("<div />"),$xValue=$('<div class="x-value" />').appendTo($content),$yValue=$('<div class="y-value" />').appendTo($content);$xValue.html(_this2.getXFormatter()(d[0])),$yValue.html(_this2.getYFormatter()(d[1]));var content=$content.get(0);_this2.tip.setContent(content);var margin=_this2.getChartMargin(),offset=24,top=y(d[1])+24,left,calcLeft,maxLeft;"rtl"!==_this2.orientation?(left=x(d[0])+margin.left+24,_this2.$chart.offset().left+left+_this2.tip.$tip.width()>_this2.$chart.offset().left+_this2.$chart.width()-24&&(left=x(d[0])-(_this2.tip.$tip.width()+24))):left=x(d[0])-(_this2.tip.$tip.width()+margin.left+24);left<0&&(left=x(d[0])+margin.left+24);var position={top:top,left:left};_this2.tip.setPosition(position),_this2.tip.show()})).on("mouseout",(function(d,index){_this2.drawingArea.select(".plot-"+index).attr("r",4),_this2.tip.hide()}))}},getChartMargin:function getChartMargin(){var _this3=this,margin=this.settings.margin,values=this.getYTickValues(),yTicksMaxWidth=0;return $.each(values,(function(key,value){var characterWidth=8,formatter,formattedValue,computedTickWidth=8*_this3.getYFormatter()(value).length;computedTickWidth>yTicksMaxWidth&&(yTicksMaxWidth=computedTickWidth)})),yTicksMaxWidth+=10,margin.left=yTicksMaxWidth,margin},getX:function getX(padded){var xDomainMin=d3.min(this.dataTable.rows,(function(d){return d[0]})),xDomainMax=d3.max(this.dataTable.rows,(function(d){return d[0]})),xDomain=[xDomainMin,xDomainMax];"rtl"===this.orientation&&(xDomain=[xDomainMax,xDomainMin]);var left=0,right=0;padded&&(left=0,right=0);var x=d3.scaleTime().range([left,this.width-right]);return x.domain(xDomain),x},getY:function getY(){var yDomain=[0,this.getYMaxValue()],y=d3.scaleLinear().range([this.height,0]);return y.domain(yDomain),y},getXFormatter:function getXFormatter(){var formatter;return formatter=this.settings.xAxis.formatter!==$.noop?this.settings.xAxis.formatter(this):Craft.charts.utils.getTimeFormatter(this.timeFormatLocale,this.settings)},getYFormatter:function getYFormatter(){var formatter;return formatter=this.settings.yAxis.formatter!==$.noop?this.settings.yAxis.formatter(this):Craft.charts.utils.getNumberFormatter(this.formatLocale,this.dataTable.columns[1].type,this.settings)},getYMaxValue:function getYMaxValue(){return d3.max(this.dataTable.rows,(function(d){return d[1]}))},getYTickValues:function getYTickValues(){var maxValue=this.getYMaxValue();return maxValue>1?[maxValue/2,maxValue]:[0,maxValue]}},{defaults:{chartClass:"area",margin:{top:25,right:5,bottom:25,left:0},plots:!0,tips:!0,xAxis:{gridlines:!1,showAxis:!0,formatter:$.noop},yAxis:{gridlines:!0,showAxis:!1,formatter:$.noop}}}),Craft.charts.utils={getDuration:function getDuration(seconds){var secondsNum=parseInt(seconds,10),duration={hours:Math.floor(secondsNum/3600),minutes:Math.floor((secondsNum-3600*duration.hours)/60),seconds:secondsNum-3600*duration.hours-60*duration.minutes};return duration.hours<10&&(duration.hours="0".concat(duration.hours)),duration.minutes<10&&(duration.minutes="0".concat(duration.minutes)),duration.seconds<10&&(duration.seconds="0".concat(duration.seconds)),"".concat(duration.hours,":").concat(duration.minutes,":").concat(duration.seconds)},getTimeFormatter:function getTimeFormatter(timeFormatLocale,chartSettings){switch(chartSettings.dataScale){case"year":return timeFormatLocale.format("%Y");case"month":return timeFormatLocale.format(chartSettings.formats.shortDateFormats.month);case"hour":return timeFormatLocale.format("".concat(chartSettings.formats.shortDateFormats.day," %H:00:00"));default:return timeFormatLocale.format(chartSettings.formats.shortDateFormats.day)}},getNumberFormatter:function getNumberFormatter(formatLocale,type,chartSettings){switch(type){case"currency":return formatLocale.format(chartSettings.formats.currencyFormat);case"percent":return formatLocale.format(chartSettings.formats.percentFormat);case"time":return Craft.charts.utils.getDuration;case"number":return formatLocale.format(chartSettings.formats.numberFormat)}}}},function(module,exports){Craft.ColorInput=Garnish.Base.extend({$container:null,$input:null,$colorContainer:null,$colorPreview:null,$colorInput:null,init:function init(container){this.$container=$(container),this.$input=this.$container.find(".color-input"),this.$colorContainer=this.$container.children(".color"),this.$colorPreview=this.$colorContainer.children(".color-preview"),this.createColorInput(),this.handleTextChange(),this.addListener(this.$input,"input","handleTextChange")},createColorInput:function createColorInput(){var input=document.createElement("input");input.setAttribute("type","color"),"color"===input.type&&(this.$colorContainer.removeClass("static"),this.$colorInput=$(input).addClass("color-preview-input").attr({"aria-controls":this.$input.attr("id"),"aria-label":Craft.t("app","Color picker")}).appendTo(this.$colorPreview),this.addListener(this.$colorInput,"click",(function(ev){ev.stopPropagation()})),this.addListener(this.$colorContainer,"click",(function(){this.$colorInput.trigger("click")})),this.addListener(this.$colorInput,"input","updateColor"))},updateColor:function updateColor(){this.$input.val(this.$colorInput.val()),this.handleTextChange()},handleTextChange:function handleTextChange(){var val=this.$input.val();val!==(val=Craft.trim(val))&&this.$input.val(val),val.length&&"#"===val[0]&&(val=val.substr(1),this.$input.val(val)),val.length?(3===val.length&&(val=val[0].repeat(2)+val[1].repeat(2)+val[2].repeat(2)),val.match(/^[0-9a-f]{6}$/i)?(this.$colorPreview.css("background-color","#".concat(val)),this.$colorInput&&this.$colorInput.val("#".concat(val))):this.$colorPreview.css("background-color","")):this.$colorPreview.css("background-color","")}},{_browserSupportsColorInputs:null,doesBrowserSupportColorInputs:function doesBrowserSupportColorInputs(){return Craft.ColorInput._browserSupportsColorInputs,Craft.ColorInput._browserSupportsColorInputs}})},function(module,exports){function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null!=_i){var _arr=[],_n=!0,_d=!1,_s,_e;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}Craft.CustomizeSourcesModal=Garnish.Modal.extend({elementIndex:null,$elementIndexSourcesContainer:null,$sidebar:null,$sourcesContainer:null,$sourceSettingsContainer:null,$newHeadingBtn:null,$footer:null,$footerBtnContainer:null,$saveBtn:null,$cancelBtn:null,$saveSpinner:null,$loadingSpinner:null,sourceSort:null,sources:null,selectedSource:null,updateSourcesOnSave:!1,availableTableAttributes:null,init:function init(elementIndex,settings){var _this=this;this.base(),this.setSettings(settings,{resizable:!0}),this.elementIndex=elementIndex,this.$elementIndexSourcesContainer=this.elementIndex.$sidebar.children("nav").children("ul");var $container=$('<form class="modal customize-sources-modal"/>').appendTo(Garnish.$bod);this.$sidebar=$('<div class="cs-sidebar block-types"/>').appendTo($container),this.$sourcesContainer=$('<div class="sources">').appendTo(this.$sidebar),this.$sourceSettingsContainer=$('<div class="source-settings">').appendTo($container),this.$footer=$('<div class="footer"/>').appendTo($container),this.$footerBtnContainer=$('<div class="buttons right"/>').appendTo(this.$footer),this.$cancelBtn=$("<button/>",{type:"button",class:"btn",text:Craft.t("app","Cancel")}).appendTo(this.$footerBtnContainer),this.$saveBtn=$("<button/>",{type:"button",class:"btn submit disabled",text:Craft.t("app","Save")}).appendTo(this.$footerBtnContainer),this.$saveSpinner=$('<div class="spinner hidden"/>').appendTo(this.$footerBtnContainer),this.$newHeadingBtn=$("<button/>",{type:"button",class:"btn submit add icon",text:Craft.t("app","New heading")}).appendTo($('<div class="buttons left secondary-buttons"/>').appendTo(this.$footer)),this.$loadingSpinner=$('<div class="spinner"/>').appendTo($container),this.setContainer($container),this.show();var data={elementType:this.elementIndex.elementType};Craft.postActionRequest("element-index-settings/get-customize-sources-modal-data",data,(function(response,textStatus){_this.$loadingSpinner.remove(),"success"===textStatus&&(_this.$saveBtn.removeClass("disabled"),_this.buildModal(response))})),this.addListener(this.$newHeadingBtn,"click","handleNewHeadingBtnClick"),this.addListener(this.$cancelBtn,"click","hide"),this.addListener(this.$saveBtn,"click","save"),this.addListener(this.$container,"submit","save")},buildModal:function buildModal(response){var _this2=this;this.availableTableAttributes=response.availableTableAttributes,this.sourceSort=new Garnish.DragSort({handle:".move",axis:"y",onSortChange:function onSortChange(){_this2.updateSourcesOnSave=!0}}),this.sources=[];for(var i=0;i<response.sources.length;i++){var source=this.addSource(response.sources[i]);this.sources.push(source)}this.selectedSource||void 0===this.sources[0]||this.sources[0].select()},addSource:function addSource(sourceData){var $item=$('<div class="customize-sources-item"/>').appendTo(this.$sourcesContainer),$itemLabel=$('<div class="label"/>').appendTo($item),$itemInput=$('<input type="hidden"/>').appendTo($item),source;return $('<a class="move icon" title="'+Craft.t("app","Reorder")+'" role="button"></a>').appendTo($item),void 0!==sourceData.heading?($item.addClass("heading"),$itemInput.attr("name","sourceOrder[][heading]"),(source=new Craft.CustomizeSourcesModal.Heading(this,$item,$itemLabel,$itemInput,sourceData)).updateItemLabel(sourceData.heading)):($itemInput.attr("name","sourceOrder[][key]").val(sourceData.key),(source=new Craft.CustomizeSourcesModal.Source(this,$item,$itemLabel,$itemInput,sourceData)).updateItemLabel(sourceData.label),(this.elementIndex.sourceKey+"/").substr(0,sourceData.key.length+1)===sourceData.key+"/"&&source.select()),this.sourceSort.addItems($item),source},handleNewHeadingBtnClick:function handleNewHeadingBtnClick(){var source=this.addSource({heading:""});Garnish.scrollContainerToElement(this.$sidebar,source.$item),source.select(),this.updateSourcesOnSave=!0},save:function save(ev){var _this3=this;if(ev&&ev.preventDefault(),!this.$saveBtn.hasClass("disabled")&&this.$saveSpinner.hasClass("hidden")){this.$saveSpinner.removeClass("hidden");var data=this.$container.serialize()+"&elementType="+this.elementIndex.elementType;Craft.postActionRequest("element-index-settings/save-customize-sources-modal-settings",data,(function(response,textStatus){if(_this3.$saveSpinner.addClass("hidden"),"success"===textStatus&&response.success){if(_this3.updateSourcesOnSave&&_this3.$elementIndexSourcesContainer.length){for(var $lastSource=null,$pendingHeading,i=0;i<_this3.sourceSort.$items.length;i++){var $item,source=_this3.sourceSort.$items.eq(i).data("source"),$indexSource=source.getIndexSource();$indexSource&&(source.isHeading()?$pendingHeading=$indexSource:($pendingHeading&&(_this3.appendSource($pendingHeading,$lastSource),$lastSource=$pendingHeading,$pendingHeading=null),_this3.appendSource($indexSource,$lastSource),$lastSource=$indexSource))}if($lastSource){var $extraSources=$lastSource.nextAll();_this3.elementIndex.sourceSelect.removeItems($extraSources),$extraSources.remove()}}_this3.selectedSource&&_this3.selectedSource.sourceData.key&&(_this3.elementIndex.selectSourceByKey(_this3.selectedSource.sourceData.key),_this3.elementIndex.updateElements()),Craft.cp.displayNotice(Craft.t("app","Source settings saved")),_this3.hide()}else{var error="success"===textStatus&&response.error?response.error:Craft.t("app","A server error occurred.");Craft.cp.displayError(error)}}))}},appendSource:function appendSource($source,$lastSource){$lastSource?$source.insertAfter($lastSource):$source.prependTo(this.$elementIndexSourcesContainer)},destroy:function destroy(){for(var i=0;i<this.sources.length;i++)this.sources[i].destroy();delete this.sources,this.base()}}),Craft.CustomizeSourcesModal.BaseSource=Garnish.Base.extend({modal:null,$item:null,$itemLabel:null,$itemInput:null,$settingsContainer:null,sourceData:null,init:function init(modal,$item,$itemLabel,$itemInput,sourceData){this.modal=modal,this.$item=$item,this.$itemLabel=$itemLabel,this.$itemInput=$itemInput,this.sourceData=sourceData,this.$item.data("source",this),this.addListener(this.$item,"click","select")},isHeading:function isHeading(){return!1},isSelected:function isSelected(){return this.modal.selectedSource===this},select:function select(){this.isSelected()||(this.modal.selectedSource&&this.modal.selectedSource.deselect(),this.$item.addClass("sel"),this.modal.selectedSource=this,this.$settingsContainer?this.$settingsContainer.removeClass("hidden"):this.$settingsContainer=this.createSettings().appendTo(this.modal.$sourceSettingsContainer),this.modal.$sourceSettingsContainer.scrollTop(0))},createSettings:function createSettings(){return $("<div/>")},getIndexSource:function getIndexSource(){},deselect:function deselect(){this.$item.removeClass("sel"),this.modal.selectedSource=null,this.$settingsContainer.addClass("hidden")},updateItemLabel:function updateItemLabel(val){this.$itemLabel.text(val)},destroy:function destroy(){this.$item.data("source",null),this.base()}}),Craft.CustomizeSourcesModal.Source=Craft.CustomizeSourcesModal.BaseSource.extend({createSettings:function createSettings(){var $settings=$("<div/>");return this.sourceData.tableAttributes.length&&$settings.append(this.createTableColumnsField()),$settings},createTableColumnsField:function createTableColumnsField(){var $columnCheckboxes=$("<div/>"),selectedAttributes=[];$('<input type="hidden" name="sources['+this.sourceData.key+'][tableAttributes][]" value=""/>').appendTo($columnCheckboxes);for(var i=0;i<this.sourceData.tableAttributes.length;i++){var _this$sourceData$tabl=_slicedToArray(this.sourceData.tableAttributes[i],2),key=_this$sourceData$tabl[0],label=_this$sourceData$tabl[1];$columnCheckboxes.append(this.createTableColumnOption(key,label,!0)),selectedAttributes.push(key)}var availableTableAttributes=this.modal.availableTableAttributes.slice(0);availableTableAttributes.push.apply(availableTableAttributes,_toConsumableArray(this.sourceData.availableTableAttributes));for(var _i2=0;_i2<availableTableAttributes.length;_i2++){var _availableTableAttrib=_slicedToArray(availableTableAttributes[_i2],2),_key=_availableTableAttrib[0],_label=_availableTableAttrib[1];Craft.inArray(_key,selectedAttributes)||$columnCheckboxes.append(this.createTableColumnOption(_key,_label,!1))}return new Garnish.DragSort($columnCheckboxes.children(),{handle:".move",axis:"y"}),Craft.ui.createField($columnCheckboxes,{label:Craft.t("app","Table Columns"),instructions:Craft.t("app","Choose which table columns should be visible for this source, and in which order.")})},createTableColumnOption:function createTableColumnOption(key,label,checked){return $('<div class="customize-sources-table-column"/>').append('<div class="icon move"/>').append(Craft.ui.createCheckbox({label:Craft.escapeHtml(label),name:"sources["+this.sourceData.key+"][tableAttributes][]",value:key,checked:checked}))},getIndexSource:function getIndexSource(){var $source=this.modal.elementIndex.getSourceByKey(this.sourceData.key);if($source)return $source.closest("li")}}),Craft.CustomizeSourcesModal.Heading=Craft.CustomizeSourcesModal.BaseSource.extend({$labelField:null,$labelInput:null,$deleteBtn:null,isHeading:function isHeading(){return!0},select:function select(){this.base(),this.$labelInput.trigger("focus")},createSettings:function createSettings(){var $settings=$("<div/>");return this.$labelField=Craft.ui.createTextField({label:Craft.t("app","Heading"),instructions:Craft.t("app","This can be left blank if you just want an unlabeled separator."),value:this.sourceData.heading}).appendTo($settings),this.$labelInput=this.$labelField.find(".text"),$settings.append("<hr/>"),this.$deleteBtn=$('<a class="error delete"/>').text(Craft.t("app","Delete heading")).appendTo($settings),this.addListener(this.$labelInput,"input","handleLabelInputChange"),this.addListener(this.$deleteBtn,"click","deleteHeading"),$settings},handleLabelInputChange:function handleLabelInputChange(){this.updateItemLabel(this.$labelInput.val()),this.modal.updateSourcesOnSave=!0},updateItemLabel:function updateItemLabel(val){this.$itemLabel.html((val?Craft.escapeHtml(val):'<em class="light">'+Craft.t("app","(blank)")+"</em>")+"&nbsp;"),this.$itemInput.val(val)},deleteHeading:function deleteHeading(){this.modal.sourceSort.removeItems(this.$item),this.modal.sources.splice($.inArray(this,this.modal.sources),1),this.modal.updateSourcesOnSave=!0,this.isSelected()&&(this.deselect(),this.modal.sources.length&&this.modal.sources[0].select()),this.$item.remove(),this.$settingsContainer.remove(),this.destroy()},getIndexSource:function getIndexSource(){var label=this.$labelInput?this.$labelInput.val():this.sourceData.heading;return $('<li class="heading"/>').append($("<span/>").text(label))}})},function(module,exports){Craft.DataTableSorter=Garnish.DragSort.extend({$table:null,init:function init(table,settings){this.$table=$(table);var $rows=this.$table.children("tbody").children(":not(.filler)");(settings=$.extend({},Craft.DataTableSorter.defaults,settings)).container=this.$table.children("tbody"),settings.helper=this.getHelper.bind(this),settings.caboose="<tr/>",settings.axis=Garnish.Y_AXIS,settings.magnetStrength=4,settings.helperLagBase=1.5,this.base($rows,settings)},getHelper:function getHelper($helperRow){var $helper=$('<div class="'+this.settings.helperClass+'"/>').appendTo(Garnish.$bod),$table=$("<table/>").appendTo($helper),$tbody=$("<tbody/>").appendTo($table);$helperRow.appendTo($tbody),$table.width(this.$table.width()),$table.prop("className",this.$table.prop("className"));for(var $firstRow,$cells=this.$table.find("tr:first").children(),$helperCells=$helperRow.children(),i=0;i<$helperCells.length;i++)$($helperCells[i]).width($($cells[i]).width());return $helper}},{defaults:{handle:".move",helperClass:"datatablesorthelper"}})},function(module,exports){Craft.DeleteUserModal=Garnish.Modal.extend({id:null,userId:null,$deleteActionRadios:null,$deleteSpinner:null,userSelect:null,_deleting:!1,init:function init(userId,settings){var _this=this;this.id=Math.floor(1e9*Math.random()),this.userId=userId,settings=$.extend(Craft.DeleteUserModal.defaults,settings);var $form=$('<form class="modal fitted deleteusermodal" method="post" accept-charset="UTF-8">'+Craft.getCsrfInput()+'<input type="hidden" name="action" value="users/delete-user"/>'+(Garnish.isArray(this.userId)?"":'<input type="hidden" name="userId" value="'+this.userId+'"/>')+(settings.redirect?'<input type="hidden" name="redirect" value="'+settings.redirect+'"/>':"")+"</form>").appendTo(Garnish.$bod),$body=$('<div class="body"><div class="content-summary"><p>'+Craft.t("app","What do you want to do with their content?")+'</p><ul class="bullets"></ul></div><div class="options"><label><input type="radio" name="contentAction" value="transfer"/> '+Craft.t("app","Transfer it to:")+'</label><div id="transferselect'+this.id+'" class="elementselect"><div class="elements"></div><button type="button" class="btn add icon dashed">'+Craft.t("app","Choose a user")+'</button></div></div><div><label class="error"><input type="radio" name="contentAction" value="delete"/> '+Craft.t("app","Delete their content")+"</label></div></div>").appendTo($form),$buttons=$('<div class="buttons right"/>').appendTo($body),$cancelBtn=$("<button/>",{type:"button",class:"btn",text:Craft.t("app","Cancel")}).appendTo($buttons),idParam;if(settings.contentSummary.length)for(var i=0;i<settings.contentSummary.length;i++)$body.find("ul").append($("<li/>",{text:settings.contentSummary[i]}));else $body.find("ul").remove();if(this.$deleteActionRadios=$body.find("input[type=radio]"),this.$deleteSubmitBtn=$("<button/>",{type:"submit",class:"btn submit disabled",text:this._submitBtnLabel(!1)}).appendTo($buttons),this.$deleteSpinner=$('<div class="spinner hidden"/>').appendTo($buttons),Garnish.isArray(this.userId)){idParam=["and"];for(var _i=0;_i<this.userId.length;_i++)idParam.push("not "+this.userId[_i])}else idParam="not "+this.userId;this.userSelect=new Craft.BaseElementSelectInput({id:"transferselect"+this.id,name:"transferContentTo",elementType:"craft\\elements\\User",criteria:{id:idParam},limit:1,modalSettings:{closeOtherModals:!1},onSelectElements:function onSelectElements(){_this.updateSizeAndPosition(),_this.$deleteActionRadios.first().prop("checked")?_this.validateDeleteInputs():_this.$deleteActionRadios.first().trigger("click")},onRemoveElements:this.validateDeleteInputs.bind(this),selectable:!1,editable:!1}),this.addListener($cancelBtn,"click","hide"),this.addListener(this.$deleteActionRadios,"change","validateDeleteInputs"),this.addListener($form,"submit","handleSubmit"),this.base($form,settings)},_submitBtnLabel:function _submitBtnLabel(withContent){var message=withContent?"Delete {num, plural, =1{user} other{users}} and content":"Delete {num, plural, =1{user} other{users}}";return Craft.t("app",message,{num:Garnish.isArray(this.userId)?this.userId.length:1})},validateDeleteInputs:function validateDeleteInputs(){var validates=!1;return this.$deleteActionRadios.eq(1).prop("checked")?(validates=!0,this.$deleteSubmitBtn.text(this._submitBtnLabel(!0))):(this.$deleteSubmitBtn.text(this._submitBtnLabel(!1)),this.$deleteActionRadios.eq(0).prop("checked")&&(validates=!!this.userSelect.totalSelected)),this.updateSizeAndPosition(),validates?this.$deleteSubmitBtn.removeClass("disabled"):this.$deleteSubmitBtn.addClass("disabled"),validates},handleSubmit:function handleSubmit(ev){if(!this._deleting&&this.validateDeleteInputs()){this.$deleteSubmitBtn.addClass("active"),this.$deleteSpinner.removeClass("hidden"),this.disable(),this.userSelect.disable(),this._deleting=!0;try{!1===this.settings.onSubmit()&&ev.preventDefault()}catch(e){throw ev.preventDefault(),this.$deleteSpinner.addClass("hidden"),e}}else ev.preventDefault()},onFadeIn:function onFadeIn(){Garnish.isMobileBrowser(!0)||this.$deleteActionRadios.first().trigger("focus"),this.base()}},{defaults:{contentSummary:[],onSubmit:$.noop,redirect:null}})},function(module,exports){function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _iterableToArray(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}Craft.DraftEditor=Garnish.Base.extend({$revisionBtn:null,$revisionLabel:null,$spinner:null,$expandSiteStatusesBtn:null,$statusIcon:null,$editMetaBtn:null,metaHud:null,$nameTextInput:null,$saveMetaBtn:null,$siteStatusPane:null,$globalLightswitch:null,$siteLightswitches:null,$addlSiteField:null,siteIds:null,newSiteIds:null,enableAutosave:null,lastSerializedValue:null,listeningForChanges:!1,pauseLevel:0,timeout:null,saving:!1,cancelToken:null,ignoreFailedRequest:!1,queue:null,submittingForm:!1,duplicatedElements:null,errors:null,httpStatus:null,httpError:null,openingPreview:!1,preview:null,previewToken:null,scrollY:null,createdProvisionalDraft:!1,bc:null,init:function init(settings){var _this=this;if(this.setSettings(settings,Craft.DraftEditor.defaults),this.queue=[],this.duplicatedElements={},this.enableAutosave=Craft.autosaveDrafts,this.siteIds=Object.keys(this.settings.siteStatuses).map((function(siteId){return parseInt(siteId)})),this.$revisionBtn=$("#context-btn"),this.$revisionLabel=$("#revision-label"),this.$spinner=$("#revision-spinner"),this.$expandSiteStatusesBtn=$("#expand-status-btn"),this.$statusIcon=$("#revision-status"),this.settings.canEditMultipleSites&&this.addListener(this.$expandSiteStatusesBtn,"click","expandSiteStatuses"),this.settings.previewTargets.length){this.settings.enablePreview&&this.addListener($("#preview-btn"),"click","openPreview");var $shareBtn=$("#share-btn");1===this.settings.previewTargets.length?this.addListener($shareBtn,"click",(function(){this.openShareLink(this.settings.previewTargets[0].url)})):this.createShareMenu($shareBtn)}this.settings.revisionId||(Craft.cp.$primaryForm.data("serializer",(function(){return _this.serializeForm(!0)})),this.addListener(Craft.cp.$primaryForm,"submit","handleFormSubmit"),this.settings.isProvisionalDraft?this.initForProvisionalDraft():this.settings.draftId&&!this.settings.isUnpublishedDraft?this.initForDraft():this.settings.canUpdateSource||this.addListener(Craft.cp.$primaryForm,"submit.saveShortcut",(function(ev){ev.saveShortcut&&(ev.preventDefault(),_this.createDraft(),_this.removeListener(Craft.cp.$primaryForm,"submit.saveShortcut"))})),this.listenForChanges(),this.addListener(this.$statusIcon,"click",(function(){_this.showStatusHud(_this.$statusIcon)})),BroadcastChannel&&!this.settings.revisionId&&(this.bc=new BroadcastChannel("DraftEditor"),this.bc.onmessage=function(ev){"saveDraft"===ev.data.event&&ev.data.canonicalId===_this.settings.sourceId&&(ev.data.draftId===_this.settings.draftId||ev.data.isProvisionalDraft&&!_this.settings.draftId)&&window.location.reload()}))},listenForChanges:function listenForChanges(){this.listeningForChanges||this.pauseLevel>0||!this.enableAutosave||!this.settings.saveDraftAction||(this.listeningForChanges=!0,this.addListener(Garnish.$bod,"keypress,keyup,change,focus,blur,click,mousedown,mouseup",(function(ev){$(ev.target).is(this.statusIcons())||(clearTimeout(this.timeout),["keypress","keyup","change"].includes(ev.type)?this.timeout=setTimeout(this.checkForm.bind(this),500):this.checkForm())})))},stopListeningForChanges:function stopListeningForChanges(){this.listeningForChanges&&(this.removeListener(Garnish.$bod,"keypress,keyup,change,focus,blur,click,mousedown,mouseup"),clearTimeout(this.timeout),this.listeningForChanges=!1)},pause:function pause(){this.pauseLevel++,this.stopListeningForChanges()},resume:function resume(){if(0===this.pauseLevel)throw"Craft.DraftEditor::resume() should only be called after pause().";this.pauseLevel--,0===this.pauseLevel&&this.enableAutosave&&(this.checkForm(),this.listenForChanges())},initForProvisionalDraft:function initForProvisionalDraft(){var _this2=this,$button=$("#discard-changes");$button.length||($button=this.$revisionBtn.data("menubtn")?this.$revisionBtn.data("menubtn").menu.$container.find("#discard-changes"):null),$button&&$button.length&&this.addListener($button,"click",(function(){confirm(Craft.t("app","Are you sure you want to discard your changes?"))&&Craft.submitForm(Craft.cp.$primaryForm,{action:_this2.settings.deleteDraftAction,redirect:_this2.settings.hashedCpEditUrl,params:{draftId:_this2.settings.draftId,provisional:_this2.settings.isProvisionalDraft}})}))},initForDraft:function initForDraft(){var _this3=this;this.createEditMetaBtn(),this.settings.canUpdateSource&&Garnish.shortcutManager.registerShortcut({keyCode:Garnish.S_KEY,ctrl:!0,alt:!0},(function(){Craft.submitForm(Craft.cp.$primaryForm,{action:_this3.settings.publishDraftAction,redirect:_this3.settings.hashedCpEditUrl})}),0)},expandSiteStatuses:function expandSiteStatuses(){var _this4=this;this.removeListener(this.$expandSiteStatusesBtn,"click"),this.$expandSiteStatusesBtn.velocity({opacity:0},"fast",(function(){_this4.$expandSiteStatusesBtn.remove()}));var $enabledForSiteField=$("#enabledForSite-".concat(this.settings.siteId,"-field"));if(this.$siteStatusPane=$enabledForSiteField.parent(),this.settings.revisionId)this._getOtherSupportedSites().forEach((function(s){return _this4._createSiteStatusField(s)}));else{$enabledForSiteField.addClass("nested");var $globalField=Craft.ui.createLightswitchField({id:"enabled",label:Craft.t("app","Enabled"),name:"enabled"}).insertBefore($enabledForSiteField);$globalField.find("label").css("font-weight","bold"),this.$globalLightswitch=$globalField.find(".lightswitch"),this.settings.revisionId||this._showField($globalField);var siteStatusValues=Object.values(this.settings.siteStatuses),hasEnabled=siteStatusValues.includes(!0),hasDisabled=siteStatusValues.includes(!1),originalEnabledValue=hasEnabled&&hasDisabled?"-":hasEnabled?"1":"",originalSerializedStatus=encodeURIComponent("enabledForSite[".concat(this.settings.siteId,"]"))+"="+(this.settings.enabledForSite?"1":"");this.$siteLightswitches=$enabledForSiteField.find(".lightswitch").on("change",this._updateGlobalStatus.bind(this)),this._getOtherSupportedSites().forEach((function(s){return _this4._createSiteStatusField(s)}));for(var serializedStatuses="enabled=".concat(originalEnabledValue),i=0;i<this.$siteLightswitches.length;i++){var $input=this.$siteLightswitches.eq(i).data("lightswitch").$input;serializedStatuses+="&"+encodeURIComponent($input.attr("name"))+"="+$input.val()}Craft.cp.$primaryForm.data("initialSerializedValue",Craft.cp.$primaryForm.data("initialSerializedValue").replace(originalSerializedStatus,serializedStatuses)),this.lastSerializedValue&&(this.lastSerializedValue=this.lastSerializedValue.replace(originalSerializedStatus,serializedStatuses)),this.settings.addlSiteIds&&this.settings.addlSiteIds.length&&this._createAddlSiteField(),this.$globalLightswitch.on("change",this._updateSiteStatuses.bind(this)),this._updateGlobalStatus()}},_getOtherSupportedSites:function _getOtherSupportedSites(){var _this5=this;return Craft.sites.filter((function(s){return s.id!=_this5.settings.siteId&&_this5.siteIds.includes(s.id)}))},_showField:function _showField($field){var height=$field.height();$field.css("overflow","hidden").height(0).velocity({height:height},"fast",(function(){$field.css({overflow:"",height:""})}))},_removeField:function _removeField($field){var height=$field.height();$field.css("overflow","hidden").velocity({height:0},"fast",(function(){$field.remove()}))},_updateGlobalStatus:function _updateGlobalStatus(){var allEnabled=!0,allDisabled=!0;this.$siteLightswitches.each((function(){var enabled;if($(this).data("lightswitch").on?allDisabled=!1:allEnabled=!1,!allEnabled&&!allDisabled)return!1})),allEnabled?this.$globalLightswitch.data("lightswitch").turnOn(!0):allDisabled?this.$globalLightswitch.data("lightswitch").turnOff(!0):this.$globalLightswitch.data("lightswitch").turnIndeterminate(!0)},_updateSiteStatuses:function _updateSiteStatuses(){var enabled=this.$globalLightswitch.data("lightswitch").on;this.$siteLightswitches.each((function(){enabled?$(this).data("lightswitch").turnOn(!0):$(this).data("lightswitch").turnOff(!0)}))},_createSiteStatusField:function _createSiteStatusField(site){var $field=Craft.ui.createLightswitchField({id:"enabledForSite-".concat(site.id),label:Craft.t("app","Enabled for {site}",{site:site.name}),name:"enabledForSite[".concat(site.id,"]"),on:!this.settings.siteStatuses.hasOwnProperty(site.id)||this.settings.siteStatuses[site.id],disabled:!!this.settings.revisionId});if(this.$addlSiteField?$field.insertBefore(this.$addlSiteField):$field.appendTo(this.$siteStatusPane),!this.settings.revisionId){$field.addClass("nested");var $lightswitch=$field.find(".lightswitch").on("change",this._updateGlobalStatus.bind(this));this.$siteLightswitches=this.$siteLightswitches.add($lightswitch)}return this._showField($field),$field},_createAddlSiteField:function _createAddlSiteField(){var _this6=this,addlSites=Craft.sites.filter((function(s){return!_this6.siteIds.includes(s.id)&&_this6.settings.addlSiteIds.includes(s.id)}));if(addlSites.length){var $addlSiteSelectContainer=Craft.ui.createSelect({options:[{label:Craft.t("app","Add a site…")}].concat(_toConsumableArray(addlSites.map((function(s){return{label:s.name,value:s.id}}))))}).addClass("fullwidth");this.$addlSiteField=Craft.ui.createField($addlSiteSelectContainer,{}).addClass("nested add").appendTo(this.$siteStatusPane);var $addlSiteSelect=$addlSiteSelectContainer.find("select");$addlSiteSelect.on("change",(function(){var siteId=parseInt($addlSiteSelect.val()),site=Craft.sites.find((function(s){return s.id===siteId}));site&&(_this6._createSiteStatusField(site),$addlSiteSelect.val("").find('option[value="'.concat(siteId,'"]')).remove(),null===_this6.newSiteIds&&(_this6.newSiteIds=[]),_this6.siteIds.push(siteId),_this6.newSiteIds.push(siteId),1===$addlSiteSelect.find("option").length&&_this6._removeField(_this6.$addlSiteField))})),this._showField(this.$addlSiteField)}},showStatusHud:function showStatusHud(target){var bodyHtml;null===this.errors?bodyHtml="<p>".concat(this._saveSuccessMessage(),"</p>"):(bodyHtml='<p class="error"><strong>'.concat(this._saveFailMessage(),"</strong></p>"),this.errors.length&&(bodyHtml+='<ul class="errors">'+this.errors.map((function(e){return"<li>".concat(Craft.escapeHtml(e),"</li>")})).join("")+"</ul>"),this.httpError&&(bodyHtml+='<p class="http-error code">'.concat(Craft.escapeHtml(this.httpError),"</p>")),400===this.httpStatus&&(bodyHtml+='<button class="btn refresh-btn">'.concat(Craft.t("app","Refresh"),"</button>")));var hud=new Garnish.HUD(target,bodyHtml,{hudClass:"hud revision-status-hud",onHide:function onHide(){hud.destroy()}});hud.$mainContainer.find(".refresh-btn").on("click",(function(){window.location.reload()}))},_saveSuccessMessage:function _saveSuccessMessage(){return this.settings.isProvisionalDraft||this.settings.isUnpublishedDraft?Craft.t("app","Your changes have been stored."):Craft.t("app","The draft has been saved.")},_saveFailMessage:function _saveFailMessage(){return this.settings.isProvisionalDraft||this.settings.isUnpublishedDraft?Craft.t("app","Your changes could not be stored."):Craft.t("app","The draft could not be saved.")},spinners:function spinners(){return this.preview?this.$spinner.add(this.preview.$spinner):this.$spinner},statusIcons:function statusIcons(){return this.preview?this.$statusIcon.add(this.preview.$statusIcon):this.$statusIcon},createEditMetaBtn:function createEditMetaBtn(){this.$editMetaBtn=$("<button/>",{type:"button",class:"btn edit icon",title:Craft.t("app","Edit draft settings")}).appendTo($("#context-btngroup")),this.addListener(this.$editMetaBtn,"click","showMetaHud")},createShareMenu:function createShareMenu($shareBtn){var _this7=this;$shareBtn.addClass("menubtn");var $menu=$("<div/>",{class:"menu"}).insertAfter($shareBtn),$ul=$("<ul/>").appendTo($menu);this.settings.previewTargets.forEach((function(target){var $li=$("<li/>").appendTo($ul),$a=$("<a/>",{text:target.label}).appendTo($li);_this7.addListener($a,"click",(function(){_this7.openShareLink(target.url)}))}))},getPreviewToken:function getPreviewToken(){var _this8=this;return new Promise((function(resolve,reject){_this8.previewToken?resolve(_this8.previewToken):Craft.sendActionRequest("POST","preview/create-token",{data:{elementType:_this8.settings.elementType,sourceId:_this8.settings.sourceId,siteId:_this8.settings.siteId,draftId:_this8.settings.draftId,revisionId:_this8.settings.revisionId,provisional:_this8.settings.isProvisionalDraft}}).then((function(response){_this8.previewToken=response.data.token,resolve(_this8.previewToken)})).catch(reject)}))},getTokenizedPreviewUrl:function getTokenizedPreviewUrl(url,randoParam){var _this9=this;return new Promise((function(resolve,reject){var params={};!randoParam&&_this9.settings.isLive||(params[randoParam||"x-craft-preview"]=Craft.randomString(10)),_this9.settings.siteToken&&(params[Craft.siteToken]=_this9.settings.siteToken),_this9.settings.isLive?resolve(Craft.getUrl(url,params)):_this9.getPreviewToken().then((function(token){params[Craft.tokenParam]=token,resolve(Craft.getUrl(url,params))})).catch(reject)}))},openShareLink:function openShareLink(url){this.getTokenizedPreviewUrl(url).then((function(url){window.open(url)}))},getPreview:function getPreview(){var _this10=this;return this.preview||(this.preview=new Craft.Preview(this),this.enableAutosave||(this.preview.on("open",(function(){_this10.enableAutosave=!0,_this10.listenForChanges()})),this.preview.on("close",(function(){_this10.enableAutosave=!1,_this10.stopListeningForChanges();var $statusIcons=_this10.statusIcons();$statusIcons.hasClass("checkmark-icon")&&$statusIcons.addClass("hidden")}))),this.preview.on("close",(function(){_this10.scrollY&&(window.scrollTo(0,_this10.scrollY),_this10.scrollY=null)}))),this.preview},openPreview:function openPreview(){var _this11=this;return new Promise((function(resolve,reject){_this11.openingPreview=!0,_this11.ensureIsDraftOrRevision(!0).then((function(){_this11.scrollY=window.scrollY,_this11.getPreview().open(),_this11.openingPreview=!1,resolve()})).catch(reject)}))},ensureIsDraftOrRevision:function ensureIsDraftOrRevision(onlyIfChanged){var _this12=this;return new Promise((function(resolve,reject){if(_this12.settings.draftId||_this12.settings.revisionId)resolve();else{if(onlyIfChanged&&_this12.serializeForm(!0)===Craft.cp.$primaryForm.data("initialSerializedValue"))return void resolve();_this12.createDraft().then(resolve).catch(reject)}}))},serializeForm:function serializeForm(removeActionParams){var data=Craft.cp.$primaryForm.serialize();return this.isPreviewActive()&&(data=data.replace("__PREVIEW_FIELDS__=1",this.preview.$editor.serialize())),removeActionParams&&!this.settings.isUnpublishedDraft&&(data=(data=data.replace(/&action=[^&]*/,"")).replace(/&redirect=[^&]*/,"")),data},checkForm:function checkForm(force){if(!(this.settings.revisionId||this.pauseLevel>0)&&this.enableAutosave&&this.settings.saveDraftAction){clearTimeout(this.timeout),this.timeout=null;var data=this.serializeForm(!0);if(force||data!==(this.lastSerializedValue||Craft.cp.$primaryForm.data("initialSerializedValue"))){var provisional=(!this.settings.draftId||this.settings.isProvisionalDraft)&&!this.settings.revisionId;this.saveDraft(data,provisional).catch((function(e){console.warn("Couldn’t save draft:",e)}))}}},isPreviewActive:function isPreviewActive(){return this.preview&&this.preview.isActive},createDraft:function createDraft(){var _this13=this;return new Promise((function(resolve,reject){_this13.saveDraft(_this13.serializeForm(!0)).then(resolve).catch(reject)}))},saveDraft:function saveDraft(data){var _this14=this;return new Promise((function(resolve,reject){if(_this14.submittingForm)reject("Form already being submitted.");else if(_this14.saving)_this14.queue.push((function(){_this14.checkForm()}));else{_this14.lastSerializedValue=data,_this14.saving=!0,_this14.errors=null,_this14.httpStatus=null,_this14.httpError=null,_this14.cancelToken=axios.CancelToken.source(),_this14.spinners().removeClass("hidden"),_this14.statusIcons().velocity("stop").css("opacity","").removeClass("invisible checkmark-icon alert-icon fade-out").addClass("hidden"),_this14.$saveMetaBtn&&_this14.$saveMetaBtn.addClass("active");var modifiedFieldNames=[],preparedData=_this14.prepareData(data,_this14.settings.isUnpublishedDraft?void 0:function(deltaName,params){params.length&&modifiedFieldNames.push(decodeURIComponent(params[0].split("=")[0]))});!_this14.settings.isProvisionalDraft&&_this14.settings.draftId||(preparedData+="&provisional=1"),Craft.sendActionRequest("POST",_this14.settings.saveDraftAction,{cancelToken:_this14.cancelToken.token,headers:{"content-type":"application/x-www-form-urlencoded"},data:preparedData}).then((function(response){_this14._afterSaveRequest(),response.data.errors&&(_this14.errors=response.data.errors,_this14._showFailStatus(),reject(response.data.errors));var createdProvisionalDraft=!_this14.settings.draftId;createdProvisionalDraft&&(_this14.settings.isProvisionalDraft=!0,_this14.createdProvisionalDraft=!0),response.data.title&&$("#header h1").text(response.data.title),response.data.docTitle&&(document.title=response.data.docTitle),_this14.settings.isProvisionalDraft?createdProvisionalDraft&&_this14.$revisionLabel.append($("<span/>",{text:" — ".concat(Craft.t("app","Edited"))})):(_this14.$revisionLabel.text(response.data.draftName),_this14.settings.draftName=response.data.draftName);var revisionMenu=_this14.$revisionBtn.data("menubtn")?_this14.$revisionBtn.data("menubtn").menu:null;if(_this14.newSiteIds&&(revisionMenu||(_this14.$revisionBtn.removeClass("disabled").addClass("menubtn"),new Garnish.MenuBtn(_this14.$revisionBtn),(revisionMenu=_this14.$revisionBtn.data("menubtn").menu).$container.removeClass("hidden")),_this14.newSiteIds.forEach((function(siteId){var $option=revisionMenu.$options.filter("[data-site-id=".concat(siteId,"]")),$li;$option.find(".status").removeClass("disabled").addClass("enabled"),$option.parent().removeClass("hidden").closest(".site-group").removeClass("hidden")})),revisionMenu.$container.find(".revision-hr").removeClass("hidden"),_this14.newSiteIds=null),_this14.settings.isProvisionalDraft){if(createdProvisionalDraft){var $actionInput=$("#action").attr("value",_this14.settings.publishDraftAction);_this14.settings.draftId=response.data.draftId,_this14.settings.isLive=!1,_this14.previewToken=null,revisionMenu&&revisionMenu.$container.find("#current-revision").append($("<div/>",{class:"edited-desc"}).append($("<p/>",{text:Craft.t("app","Showing your unsaved changes.")})).append($("<button/>",{id:"discard-changes",class:"btn",text:Craft.t("app","Discard changes")}))),_this14.initForProvisionalDraft()}}else revisionMenu&&(revisionMenu.$options.filter(".sel").find(".draft-name").text(response.data.draftName),revisionMenu.$options.filter(".sel").find(".draft-meta").text(response.data.creator?Craft.t("app","Saved {timestamp} by {creator}",{timestamp:response.data.timestamp,creator:response.data.creator}):Craft.t("app","Saved {timestamp}",{timestamp:response.data.timestamp})));for(var oldId in response.data.previewTargets&&JSON.stringify(response.data.previewTargets)!==JSON.stringify(_this14.settings.previewTargets)&&_this14.updatePreviewTargets(response.data.previewTargets),createdProvisionalDraft&&_this14.trigger("createProvisionalDraft"),_this14.$nameTextInput&&_this14.checkMetaValues(),response.data.duplicatedElements)oldId!=_this14.settings.sourceId&&response.data.duplicatedElements.hasOwnProperty(oldId)&&(_this14.duplicatedElements[oldId]=response.data.duplicatedElements[oldId]);for(var selectors=response.data.modifiedAttributes.map((function(attr){return'[name="'.concat(attr,'"],[name^="').concat(attr,'["]')})).concat(modifiedFieldNames.map((function(name){return'[name="'.concat(name,'"]')}))),$fields=$(selectors.join(",")).parents().filter(".field:not(:has(> .status-badge))"),i=0;i<$fields.length;i++)$fields.eq(i).prepend($("<div/>",{class:"status-badge modified",title:Craft.t("app","This field has been modified."),"aria-label":Craft.t("app","This field has been modified.")}));_this14.afterUpdate(data),_this14.bc&&_this14.bc.postMessage({event:"saveDraft",canonicalId:_this14.settings.sourceId,draftId:_this14.settings.draftId,isProvisionalDraft:_this14.settings.isProvisionalDraft}),resolve()})).catch((function(e){_this14._afterSaveRequest(),_this14.ignoreFailedRequest||(_this14.errors=[],e&&e.response&&(_this14.httpStatus=e.response.status,_this14.httpError=e.response.data?e.response.data.error:null),_this14._showFailStatus(),reject(e)),_this14.ignoreFailedRequest=!1}))}}))},_afterSaveRequest:function _afterSaveRequest(){this.spinners().addClass("hidden"),this.$saveMetaBtn&&this.$saveMetaBtn.removeClass("active"),this.saving=!1},_showFailStatus:function _showFailStatus(){this.statusIcons().velocity("stop").css("opacity","").removeClass("hidden checkmark-icon").addClass("alert-icon").attr("title",this._saveFailMessage())},prepareData:function prepareData(data,deltaCallback){return data=Craft.findDeltaData(Craft.cp.$primaryForm.data("initialSerializedValue"),data,Craft.deltaNames,deltaCallback),data=this.swapDuplicatedElementIds(data),this.settings.draftId&&(data+="&draftId=".concat(this.settings.draftId),this.settings.isProvisionalDraft&&(data+="&provisional=1")),null!==this.settings.draftName&&(data+="&draftName=".concat(this.settings.draftName)),data},swapDuplicatedElementIds:function swapDuplicatedElementIds(data){var _this15=this,idsRE=Object.keys(this.duplicatedElements).join("|");if(""===idsRE)return data;for(var lb=encodeURIComponent("["),rb=encodeURIComponent("]");data!==(data=data.replace(new RegExp("(&fields".concat(lb,"[^=]+").concat(rb).concat(lb,")(").concat(idsRE,")(").concat(rb,")"),"g"),(function(m,pre,id,post){return pre+_this15.duplicatedElements[id]+post})).replace(new RegExp("(&fields".concat(lb,"[^=]+=)(").concat(idsRE,")\\b"),"g"),(function(m,pre,id){return pre+_this15.duplicatedElements[id]}))););return data},updatePreviewTargets:function updatePreviewTargets(previewTargets){var _this16=this;previewTargets.forEach((function(newTarget){var currentTarget=_this16.settings.previewTargets.find((function(t){return t.label===newTarget.label}));currentTarget&&(currentTarget.url=newTarget.url)}))},afterUpdate:function afterUpdate(data){Craft.cp.$primaryForm.data("initialSerializedValue",data),Craft.initialDeltaValues={};var $statusIcons=this.statusIcons().velocity("stop").css("opacity","").removeClass("hidden").addClass("checkmark-icon").attr("title",this._saveSuccessMessage());Craft.autosaveDrafts||$statusIcons.velocity("stop").velocity({opacity:0},{delay:2e3,complete:function complete(){$statusIcons.addClass("hidden")}}),this.trigger("update"),this.nextInQueue()},nextInQueue:function nextInQueue(){this.queue.length&&this.queue.shift()()},showMetaHud:function showMetaHud(){this.metaHud?this.metaHud.show():(this.createMetaHud(),this.onMetaHudShow()),Garnish.isMobileBrowser(!0)||this.$nameTextInput.trigger("focus")},createMetaHud:function createMetaHud(){var $hudBody=$("<div/>"),$nameField=$('<div class="field"><div class="heading"><label for="draft-name">'+Craft.t("app","Draft Name")+"</label></div></div>").appendTo($hudBody),$nameInputContainer=$('<div class="input"/>').appendTo($nameField);this.$nameTextInput=$('<input type="text" class="text fullwidth" id="draft-name"/>').appendTo($nameInputContainer).val(this.settings.draftName);var $footer=$('<div class="hud-footer flex flex-center"/>').appendTo($hudBody);$('<div class="flex-grow"></div>').appendTo($footer),this.$saveMetaBtn=$("<button/>",{type:"submit",class:"btn submit disabled",text:Craft.t("app","Save")}).appendTo($footer),this.metaHud=new Garnish.HUD(this.$editMetaBtn,$hudBody,{onSubmit:this.saveMeta.bind(this)}),this.addListener(this.$nameTextInput,"input","checkMetaValues"),this.metaHud.on("show",this.onMetaHudShow.bind(this)),this.metaHud.on("hide",this.onMetaHudHide.bind(this)),this.metaHud.on("escape",this.onMetaHudEscape.bind(this))},onMetaHudShow:function onMetaHudShow(){this.$editMetaBtn.addClass("active")},onMetaHudHide:function onMetaHudHide(){this.$editMetaBtn.removeClass("active")},onMetaHudEscape:function onMetaHudEscape(){this.$nameTextInput.val(this.settings.draftName)},checkMetaValues:function checkMetaValues(){return this.$nameTextInput.val()&&this.$nameTextInput.val()!==this.settings.draftName?(this.$saveMetaBtn.removeClass("disabled"),!0):(this.$saveMetaBtn.addClass("disabled"),!1)},shakeMetaHud:function shakeMetaHud(){Garnish.shake(this.metaHud.$hud)},saveMeta:function saveMeta(){this.checkMetaValues()?(this.settings.draftName=this.$nameTextInput.val(),this.metaHud.hide(),this.checkForm(!0)):this.shakeMetaHud()},handleFormSubmit:function handleFormSubmit(ev){if(ev.preventDefault(),!this.submittingForm)if(!this.settings.draftId||this.settings.isUnpublishedDraft||this.settings.isProvisionalDraft||void 0!==ev.autosave&&!ev.autosave||!(ev.saveShortcut||ev.customTrigger&&ev.customTrigger.data("action")===this.settings.saveDraftAction)){Craft.cp.$confirmUnloadForms=Craft.cp.$confirmUnloadForms.not(Craft.cp.$primaryForm),this.cancelToken&&(this.ignoreFailedRequest=!0,this.cancelToken.cancel());var data=this.prepareData(this.serializeForm(!1)),$form=Craft.createForm(data);$form.appendTo(Garnish.$bod),$form.submit(),this.submittingForm=!0}else this.checkForm(!0)}},{defaults:{elementType:null,sourceId:null,siteId:null,isUnpublishedDraft:!1,enabled:!1,enabledForSite:!1,isLive:!1,isProvisionalDraft:!1,siteStatuses:null,addlSiteIds:[],cpEditUrl:null,draftId:null,revisionId:null,draftName:null,canEditMultipleSites:!1,canUpdateSource:!1,saveDraftAction:null,deleteDraftAction:null,publishDraftAction:null,hashedCpEditUrl:null,hashedAddAnotherRedirectUrl:null,enablePreview:!1,previewTargets:[],siteToken:null}})},function(module,exports){Craft.DynamicGenerator=Craft.BaseInputGenerator.extend({callback:$.noop,init:function init(source,target,callback){this.callback=callback,this.base(source,target)},generateTargetValue:function generateTargetValue(sourceVal){return this.callback(sourceVal)}})},function(module,exports){Craft.EditableTable=Garnish.Base.extend({initialized:!1,id:null,baseName:null,columns:null,sorter:null,biggestId:-1,$table:null,$tbody:null,$addRowBtn:null,rowCount:0,hasMaxRows:!1,hasMinRows:!1,radioCheckboxes:null,init:function init(id,baseName,columns,settings){if(this.id=id,this.baseName=baseName,this.columns=columns,this.setSettings(settings,Craft.EditableTable.defaults),this.radioCheckboxes={},this.$table=$("#"+id),this.$tbody=this.$table.children("tbody"),this.rowCount=this.$tbody.find("tr").length,this.$table.data("editable-table")&&(Garnish.log("Double-instantiating an editable table on an element"),this.$table.data("editable-table").destroy()),this.$table.data("editable-table",this),this.sorter=new Craft.DataTableSorter(this.$table,{helperClass:"editabletablesorthelper",copyDraggeeInputValuesToHelper:!0}),this.isVisible()?this.initialize():setTimeout(this.initializeIfVisible.bind(this),500),this.settings.minRows&&this.rowCount<this.settings.minRows)for(var i=this.rowCount;i<this.settings.minRows;i++)this.addRow()},isVisible:function isVisible(){return this.$table.parent().height()>0},initialize:function initialize(){if(this.initialized)return!1;this.initialized=!0,this.removeListener(Garnish.$win,"resize");for(var $rows=this.$tbody.children(),i=0;i<$rows.length;i++)this.createRowObj($rows[i]);return this.$addRowBtn=this.$table.next(".add"),this.updateAddRowButton(),this.addListener(this.$addRowBtn,"activate","addRow"),!0},initializeIfVisible:function initializeIfVisible(){this.removeListener(Garnish.$win,"resize"),this.isVisible()?this.initialize():this.addListener(Garnish.$win,"resize","initializeIfVisible")},updateAddRowButton:function updateAddRowButton(){this.canAddRow()?(this.$addRowBtn.css("opacity","1"),this.$addRowBtn.css("pointer-events","auto")):(this.$addRowBtn.css("opacity","0.2"),this.$addRowBtn.css("pointer-events","none"))},canDeleteRow:function canDeleteRow(){return this.rowCount>this.settings.minRows},deleteRow:function deleteRow(row){this.canDeleteRow()&&(this.sorter.removeItems(row.$tr),row.$tr.remove(),this.rowCount--,this.updateAddRowButton(),0===this.rowCount&&this.$table.addClass("hidden"),this.settings.onDeleteRow(row.$tr),row.destroy())},canAddRow:function canAddRow(){return!this.settings.staticRows&&(!this.settings.maxRows||this.rowCount<this.settings.maxRows)},addRow:function addRow(focus,prepend){if(this.canAddRow()){var rowId=this.settings.rowIdPrefix+(this.biggestId+1),$tr=this.createRow(rowId,this.columns,this.baseName,$.extend({},this.settings.defaultValues));prepend?$tr.prependTo(this.$tbody):$tr.appendTo(this.$tbody);var row=this.createRowObj($tr);return this.sorter.addItems($tr),!1!==focus&&$tr.find("input:visible,textarea:visible,select:visible").first().trigger("focus"),this.rowCount++,this.updateAddRowButton(),this.$table.removeClass("hidden"),this.settings.onAddRow($tr),row}},createRow:function createRow(rowId,columns,baseName,values){return Craft.EditableTable.createRow(rowId,columns,baseName,values)},createRowObj:function createRowObj($tr){return new Craft.EditableTable.Row(this,$tr)},focusOnPrevRow:function focusOnPrevRow($tr,tdIndex,blurTd){var $prevTr=$tr.prev("tr"),prevRow;if((prevRow=$prevTr.length?$prevTr.data("editable-table-row"):this.addRow(!1,!0))&&prevRow.$tds[tdIndex])if($(prevRow.$tds[tdIndex]).hasClass("disabled"))$prevTr&&this.focusOnPrevRow($prevTr,tdIndex,blurTd);else{var $input=$("textarea,input.text",prevRow.$tds[tdIndex]);$input.length&&($(blurTd).trigger("blur"),$input.trigger("focus"))}},focusOnNextRow:function focusOnNextRow($tr,tdIndex,blurTd){var $nextTr=$tr.next("tr"),nextRow;if((nextRow=$nextTr.length?$nextTr.data("editable-table-row"):this.addRow(!1))&&nextRow.$tds[tdIndex])if($(nextRow.$tds[tdIndex]).hasClass("disabled"))$nextTr&&this.focusOnNextRow($nextTr,tdIndex,blurTd);else{var $input=$("textarea,input.text",nextRow.$tds[tdIndex]);$input.length&&($(blurTd).trigger("blur"),$input.trigger("focus"))}},importData:function importData(data,row,tdIndex){for(var lines=data.split(/\r?\n|\r/),i=0;i<lines.length;i++){for(var values=lines[i].split("\t"),j=0;j<values.length;j++){var value=values[j];row.$tds.eq(tdIndex+j).find("textarea,input[type!=hidden]").val(value).trigger("input")}var $nextTr=row.$tr.next("tr");row=$nextTr.length?$nextTr.data("editable-table-row"):this.addRow(!1)}}},{textualColTypes:["color","date","email","multiline","number","singleline","template","time","url"],defaults:{rowIdPrefix:"",defaultValues:{},staticRows:!1,minRows:null,maxRows:null,onAddRow:$.noop,onDeleteRow:$.noop},createRow:function createRow(rowId,columns,baseName,values){var $tr=$("<tr/>",{"data-id":rowId});for(var colId in columns)if(columns.hasOwnProperty(colId)){var col=columns[colId],value=void 0!==values[colId]?values[colId]:"",$cell;if("heading"===col.type)$cell=$("<th/>",{scope:"row",class:col.class,html:value});else{var name=baseName+"["+rowId+"]["+colId+"]";switch($cell=$("<td/>",{class:"".concat(col.class," ").concat(col.type,"-cell"),width:col.width}),Craft.inArray(col.type,Craft.EditableTable.textualColTypes)&&$cell.addClass("textual"),col.code&&$cell.addClass("code"),col.type){case"checkbox":$('<div class="checkbox-wrapper"/>').append(Craft.ui.createCheckbox({name:name,value:col.value||"1",checked:!!value})).appendTo($cell);break;case"color":Craft.ui.createColorInput({name:name,value:value,small:!0}).appendTo($cell);break;case"date":Craft.ui.createDateInput({name:name,value:value}).appendTo($cell);break;case"lightswitch":Craft.ui.createLightswitch({name:name,value:col.value||"1",on:!!value,small:!0}).appendTo($cell);break;case"select":Craft.ui.createSelect({name:name,options:col.options,value:value||function(){for(var key in col.options)if(col.options.hasOwnProperty(key)&&col.options[key].default)return void 0!==col.options[key].value?col.options[key].value:key;return null}(),class:"small"}).appendTo($cell);break;case"time":Craft.ui.createTimeInput({name:name,value:value}).appendTo($cell);break;case"email":case"url":Craft.ui.createTextInput({name:name,value:value,type:col.type,placeholder:col.placeholder||null}).appendTo($cell);break;default:$("<textarea/>",{name:name,rows:col.rows||1,val:value,placeholder:col.placeholder}).appendTo($cell)}}$cell.appendTo($tr)}return $("<td/>",{class:"thin action"}).append($("<a/>",{class:"move icon",title:Craft.t("app","Reorder")})).appendTo($tr),$("<td/>",{class:"thin action"}).append($("<a/>",{class:"delete icon",title:Craft.t("app","Delete")})).appendTo($tr),$tr}}),Craft.EditableTable.Row=Garnish.Base.extend({table:null,id:null,niceTexts:null,$tr:null,$tds:null,tds:null,$textareas:null,$deleteBtn:null,init:function init(table,tr){this.table=table,this.$tr=$(tr),this.$tds=this.$tr.children(),this.tds=[],this.id=this.$tr.attr("data-id"),this.$tr.data("editable-table-row",this);var id=parseInt(this.id.substr(this.table.settings.rowIdPrefix.length));id>this.table.biggestId&&(this.table.biggestId=id),this.$textareas=$(),this.niceTexts=[];var textareasByColId={},i=0,colId,col,td,$textarea,$checkbox;for(colId in this.table.columns)this.table.columns.hasOwnProperty(colId)&&(col=this.table.columns[colId],td=this.tds[colId]=this.$tds[i],Craft.inArray(col.type,Craft.EditableTable.textualColTypes)?($textarea=$("textarea",td),this.$textareas=this.$textareas.add($textarea),this.addListener($textarea,"focus","onTextareaFocus"),this.addListener($textarea,"mousedown","ignoreNextTextareaFocus"),this.niceTexts.push(new Garnish.NiceText($textarea,{onHeightChange:this.onTextareaHeightChange.bind(this)})),this.addListener($textarea,"keypress",{tdIndex:i,type:col.type},"handleKeypress"),this.addListener($textarea,"input",{type:col.type},"validateValue"),$textarea.trigger("input"),"multiline"!==col.type&&this.addListener($textarea,"paste",{tdIndex:i,type:col.type},"handlePaste"),textareasByColId[colId]=$textarea):"checkbox"===col.type&&($checkbox=$('input[type="checkbox"]',td),col.radioMode&&(void 0===this.table.radioCheckboxes[colId]&&(this.table.radioCheckboxes[colId]=[]),this.table.radioCheckboxes[colId].push($checkbox[0]),this.addListener($checkbox,"change",{colId:colId},"onRadioCheckboxChange")),col.toggle&&this.addListener($checkbox,"change",{colId:colId},(function(ev){this.applyToggleCheckbox(ev.data.colId)}))),$(td).hasClass("disabled")||this.addListener(td,"click",{td:td},(function(ev){ev.target===ev.data.td&&$(ev.data.td).find("textarea,input,select,.lightswitch").focus()})),i++);for(colId in this.onTextareaHeightChange(),this.table.columns)this.table.columns.hasOwnProperty(colId)&&"checkbox"===(col=this.table.columns[colId]).type&&col.toggle&&this.applyToggleCheckbox(colId);for(colId in this.table.columns)this.table.columns.hasOwnProperty(colId)&&(col=this.table.columns[colId]).autopopulate&&void 0!==textareasByColId[col.autopopulate]&&!textareasByColId[colId].val()&&new Craft.HandleGenerator(textareasByColId[colId],textareasByColId[col.autopopulate],{allowNonAlphaStart:!0});var $deleteBtn=this.$tr.children().last().find(".delete");this.addListener($deleteBtn,"click","deleteRow");var $inputs=this.$tr.find("input,textarea,select,.lightswitch");this.addListener($inputs,"focus",(function(ev){$(ev.currentTarget).closest("td:not(.disabled)").addClass("focus")})),this.addListener($inputs,"blur",(function(ev){$(ev.currentTarget).closest("td").removeClass("focus")}))},onTextareaFocus:function onTextareaFocus(ev){this.onTextareaHeightChange();var $textarea=$(ev.currentTarget);$textarea.data("ignoreNextFocus")?$textarea.data("ignoreNextFocus",!1):setTimeout((function(){Craft.selectFullValue($textarea)}),0)},onRadioCheckboxChange:function onRadioCheckboxChange(ev){if(ev.currentTarget.checked)for(var i=0;i<this.table.radioCheckboxes[ev.data.colId].length;i++){var checkbox=this.table.radioCheckboxes[ev.data.colId][i];checkbox.checked=checkbox===ev.currentTarget}},applyToggleCheckbox:function applyToggleCheckbox(checkboxColId){for(var checkboxCol=this.table.columns[checkboxColId],checked=$('input[type="checkbox"]',this.tds[checkboxColId]).prop("checked"),colId,colIndex,neg,i=0;i<checkboxCol.toggle.length;i++)colId=checkboxCol.toggle[i],colIndex=this.table.colum,(neg="!"===colId[0])&&(colId=colId.substr(1)),checked&&!neg||!checked&&neg?$(this.tds[colId]).removeClass("disabled").find("textarea, input").prop("disabled",!1):$(this.tds[colId]).addClass("disabled").find("textarea, input").prop("disabled",!0)},ignoreNextTextareaFocus:function ignoreNextTextareaFocus(ev){$.data(ev.currentTarget,"ignoreNextFocus",!0)},handleKeypress:function handleKeypress(ev){var keyCode=ev.keyCode?ev.keyCode:ev.charCode,ctrl=Garnish.isCtrlKeyPressed(ev);if(keyCode===Garnish.RETURN_KEY&&("multiline"!==ev.data.type||ctrl))return ev.preventDefault(),void(ev.shiftKey?this.table.focusOnPrevRow(this.$tr,ev.data.tdIndex,ev.currentTarget):this.table.focusOnNextRow(this.$tr,ev.data.tdIndex,ev.currentTarget));"number"!==ev.data.type||ctrl||Craft.inArray(keyCode,Craft.EditableTable.Row.numericKeyCodes)||ev.preventDefault()},handlePaste:function handlePaste(ev){var data=Craft.trim(ev.originalEvent.clipboardData.getData("Text")," \n\r");data.match(/[\t\r\n]/)&&(ev.preventDefault(),this.table.importData(data,this,ev.data.tdIndex))},validateValue:function validateValue(ev){if("multiline"!==ev.data.type){var safeValue;if("number"===ev.data.type){var match=ev.currentTarget.value.match(/^\s*(-?[\d\\.]*)/);safeValue=null!==match?match[1]:""}else safeValue=ev.currentTarget.value.replace(/[\r\n]/g,"");safeValue!==ev.currentTarget.value&&(ev.currentTarget.value=safeValue)}},onTextareaHeightChange:function onTextareaHeightChange(){for(var tallestTextareaHeight=-1,i=0;i<this.niceTexts.length;i++)this.niceTexts[i].height>tallestTextareaHeight&&(tallestTextareaHeight=this.niceTexts[i].height);this.$textareas.css("min-height",tallestTextareaHeight);var tdHeight=this.$textareas.filter(":visible").first().parent().height();tdHeight>tallestTextareaHeight&&this.$textareas.css("min-height",tdHeight)},deleteRow:function deleteRow(){this.table.deleteRow(this)}},{numericKeyCodes:[9,8,37,38,39,40,45,91,46,190,48,49,50,51,52,53,54,55,56,57]})},function(module,exports){Craft.ElementActionTrigger=Garnish.Base.extend({maxLevels:null,newChildUrl:null,$trigger:null,$selectedItems:null,triggerEnabled:!0,init:function init(settings){this.setSettings(settings,Craft.ElementActionTrigger.defaults),this.$trigger=$("#"+settings.type.replace(/[\[\]\\]+/g,"-")+"-actiontrigger"),this.settings.activate&&(this.$trigger.data("custom-handler",!0),"FORM"===this.$trigger.prop("nodeName")?this.addListener(this.$trigger,"submit","handleTriggerActivation"):this.addListener(this.$trigger,"click","handleTriggerActivation")),this.updateTrigger(),Craft.elementIndex.on("selectionChange",this.updateTrigger.bind(this))},updateTrigger:function updateTrigger(){0!==Craft.elementIndex.getSelectedElements().length&&(this.validateSelection()?this.enableTrigger():this.disableTrigger())},validateSelection:function validateSelection(){var valid=!0;return this.$selectedItems=Craft.elementIndex.getSelectedElements(),!this.settings.batch&&this.$selectedItems.length>1?valid=!1:"function"==typeof this.settings.validateSelection&&(valid=this.settings.validateSelection(this.$selectedItems)),valid},enableTrigger:function enableTrigger(){this.triggerEnabled||(this.$trigger.removeClass("disabled"),this.triggerEnabled=!0)},disableTrigger:function disableTrigger(){this.triggerEnabled&&(this.$trigger.addClass("disabled"),this.triggerEnabled=!1)},handleTriggerActivation:function handleTriggerActivation(ev){ev.preventDefault(),ev.stopPropagation(),this.triggerEnabled&&this.settings.activate(this.$selectedItems)}},{defaults:{type:null,batch:!0,validateSelection:null,activate:null}})},function(module,exports){function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null!=_i){var _arr=[],_n=!0,_d=!1,_s,_e;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}Craft.ElementThumbLoader=Garnish.Base.extend({queue:null,workers:[],init:function init(){this.queue=[];for(var i=0;i<3;i++)this.workers.push(new Craft.ElementThumbLoader.Worker(this))},load:function load($elements){for(var _this=this,$thumbs=$elements.find(".elementthumb"),_loop=function _loop(i){var $thumb=$thumbs.eq(i),$scrollParent=$thumb.scrollParent();if($scrollParent[0]===document.body&&($scrollParent=Garnish.$doc),_this.isVisible($thumb,$scrollParent))_this.addToQueue($thumb[0]);else{var key="thumb"+Math.floor(1e6*Math.random());Craft.ElementThumbLoader.invisibleThumbs[key]=[_this,$thumb,$scrollParent],$scrollParent.on("scroll.".concat(key),{$thumb:$thumb,$scrollParent:$scrollParent,key:key},(function(ev){_this.isVisible(ev.data.$thumb,ev.data.$scrollParent)&&(delete Craft.ElementThumbLoader.invisibleThumbs[ev.data.key],$scrollParent.off("scroll.".concat(ev.data.key)),_this.addToQueue(ev.data.$thumb[0]))}))}},i=0;i<$thumbs.length;i++)_loop(i)},addToQueue:function addToQueue(thumb){this.queue.push(thumb);for(var i=0;i<this.workers.length;i++)this.workers[i].active||this.workers[i].loadNext()},isVisible:function isVisible($thumb,$scrollParent){var thumbOffset=$thumb.offset().top,scrollParentOffset,scrollParentHeight;return $scrollParent[0]===document?(scrollParentOffset=$scrollParent.scrollTop(),scrollParentHeight=Garnish.$win.height()):(scrollParentOffset=$scrollParent.offset().top,scrollParentHeight=$scrollParent.height()),thumbOffset>scrollParentOffset&&thumbOffset<scrollParentOffset+scrollParentHeight+1e3},destroy:function destroy(){for(var i=0;i<this.workers.length;i++)this.workers[i].destroy();this.base()}},{invisibleThumbs:{},retryAll:function retryAll(){for(var key in Craft.ElementThumbLoader.invisibleThumbs){var _Craft$ElementThumbLo=_slicedToArray(Craft.ElementThumbLoader.invisibleThumbs[key],3),queue=_Craft$ElementThumbLo[0],$thumb=_Craft$ElementThumbLo[1],$scrollParent=_Craft$ElementThumbLo[2];delete Craft.ElementThumbLoader.invisibleThumbs[key],$scrollParent.off("scroll.".concat(key)),queue.load($thumb.parent())}}}),Craft.ElementThumbLoader.Worker=Garnish.Base.extend({loader:null,active:!1,init:function init(loader){this.loader=loader},loadNext:function loadNext(){var container=this.loader.queue.shift();if(void 0!==container){this.active=!0;var $container=$(container);if($container.find("img").length)this.loadNext();else{var $img=$("<img/>",{sizes:$container.attr("data-sizes"),srcset:$container.attr("data-srcset"),alt:""});this.addListener($img,"load,error","loadNext"),$img.appendTo($container),picturefill({elements:[$img[0]]})}}else this.active=!1}})},function(module,exports){Craft.ElevatedSessionForm=Garnish.Base.extend({$form:null,inputs:null,init:function init(form,inputs){if(this.$form=$(form),void 0!==inputs){this.inputs=[],inputs=$.makeArray(inputs);for(var i=0;i<inputs.length;i++)for(var $inputs=$(inputs[i]),j=0;j<$inputs.length;j++){var $input=$inputs.eq(j);this.inputs.push({input:$input,val:Garnish.getInputPostVal($input)})}}this.addListener(this.$form,"submit","handleFormSubmit")},handleFormSubmit:function handleFormSubmit(ev){if(Craft.elevatedSessionManager.fetchingTimeout)return ev.preventDefault(),void ev.stopImmediatePropagation();if(this.inputs){for(var inputsChanged=!1,$input,i=0;i<this.inputs.length;i++)if(($input=this.inputs[i].input).data("passwordInput")&&($input=$input.data("passwordInput").$currentInput),Garnish.getInputPostVal($input)!==this.inputs[i].val){inputsChanged=!0;break}if(!inputsChanged)return}ev.preventDefault(),ev.stopImmediatePropagation(),Craft.elevatedSessionManager.requireElevatedSession(this.submitForm.bind(this))},submitForm:function submitForm(){this.disable(),this.$form.trigger("submit"),this.enable()}})},function(module,exports){Craft.ElevatedSessionManager=Garnish.Base.extend({fetchingTimeout:!1,passwordModal:null,$passwordInput:null,$passwordSpinner:null,$submitBtn:null,$errorPara:null,callback:null,requireElevatedSession:function requireElevatedSession(callback){var _this=this;this.callback=callback,this.fetchingTimeout=!0,Craft.postActionRequest("users/get-elevated-session-timeout",(function(response,textStatus){_this.fetchingTimeout=!1,"success"===textStatus&&(!1===response.timeout||response.timeout>=Craft.ElevatedSessionManager.minSafeElevatedSessionTimeout?_this.callback():_this.showPasswordModal())}))},showPasswordModal:function showPasswordModal(){var _this2=this;if(this.passwordModal)this.passwordModal.show();else{var $passwordModal=$('<form id="elevatedsessionmodal" class="modal secure fitted"/>'),$body=$('<div class="body"><p>'+Craft.t("app","Enter your password to continue.")+"</p></div>").appendTo($passwordModal),$inputContainer=$('<div class="inputcontainer">').appendTo($body),$inputsFlexContainer=$('<div class="flex"/>').appendTo($inputContainer),$passwordContainer=$('<div class="flex-grow"/>').appendTo($inputsFlexContainer),$buttonContainer=$("<td/>").appendTo($inputsFlexContainer),$passwordWrapper=$('<div class="passwordwrapper"/>').appendTo($passwordContainer);this.$passwordInput=$('<input type="password" class="text password fullwidth" placeholder="'+Craft.t("app","Password")+'" autocomplete="current-password"/>').appendTo($passwordWrapper),this.$passwordSpinner=$('<div class="spinner hidden"/>').appendTo($inputContainer),this.$submitBtn=$("<button/>",{type:"submit",class:"btn submit disabled",text:Craft.t("app","Submit")}).appendTo($buttonContainer),this.$errorPara=$('<p class="error"/>').appendTo($body),this.passwordModal=new Garnish.Modal($passwordModal,{closeOtherModals:!1,onFadeIn:function onFadeIn(){setTimeout(_this2.focusPasswordInput.bind(_this2),100)},onFadeOut:function onFadeOut(){_this2.$passwordInput.val("")}}),new Craft.PasswordInput(this.$passwordInput,{onToggleInput:function onToggleInput($newPasswordInput){_this2.$passwordInput=$newPasswordInput}}),this.addListener(this.$passwordInput,"input","validatePassword"),this.addListener($passwordModal,"submit","submitPassword")}},focusPasswordInput:function focusPasswordInput(){Garnish.isMobileBrowser(!0)||this.$passwordInput.trigger("focus")},validatePassword:function validatePassword(){return this.$passwordInput.val().length>=6?(this.$submitBtn.removeClass("disabled"),!0):(this.$submitBtn.addClass("disabled"),!1)},submitPassword:function submitPassword(ev){var _this3=this;if(ev&&ev.preventDefault(),this.validatePassword()){this.$passwordSpinner.removeClass("hidden"),this.clearLoginError();var data={currentPassword:this.$passwordInput.val()};Craft.postActionRequest("users/start-elevated-session",data,(function(response,textStatus){_this3.$passwordSpinner.addClass("hidden"),"success"===textStatus?response.success?(_this3.passwordModal.hide(),_this3.callback()):(_this3.showPasswordError(response.message||Craft.t("app","Incorrect password.")),Garnish.shake(_this3.passwordModal.$container),_this3.focusPasswordInput()):_this3.showPasswordError()}))}},showPasswordError:function showPasswordError(error){null==error&&(error=Craft.t("app","A server error occurred.")),this.$errorPara.text(error),this.passwordModal.updateSizeAndPosition()},clearLoginError:function clearLoginError(){this.showPasswordError("")}},{minSafeElevatedSessionTimeout:5}),Craft.elevatedSessionManager=new Craft.ElevatedSessionManager},function(module,exports){Craft.EntryIndex=Craft.BaseElementIndex.extend({publishableSections:null,$newEntryBtnGroup:null,$newEntryBtn:null,init:function init(elementType,$container,settings){this.on("selectSource",this.updateButton.bind(this)),this.on("selectSite",this.updateButton.bind(this)),this.base(elementType,$container,settings)},afterInit:function afterInit(){this.publishableSections=[];for(var i=0;i<Craft.publishableSections.length;i++){var section=Craft.publishableSections[i];this.getSourceByKey("section:"+section.uid)&&this.publishableSections.push(section)}this.base()},getDefaultSourceKey:function getDefaultSourceKey(){if("index"===this.settings.context&&"undefined"!=typeof defaultSectionHandle){if("singles"===defaultSectionHandle)return"singles";for(var i=0;i<this.$sources.length;i++){var $source=$(this.$sources[i]);if($source.data("handle")===defaultSectionHandle)return $source.data("key")}}return this.base()},updateButton:function updateButton(){var _this=this;if(this.$source){var handle,i,href,label;if(handle="singles"===this.$source.data("key")?"singles":this.$source.data("handle"),this.publishableSections.length){var selectedSection,$menuBtn;if(this.$newEntryBtnGroup&&this.$newEntryBtnGroup.remove(),handle)for(i=0;i<this.publishableSections.length;i++)if(this.publishableSections[i].handle===handle){selectedSection=this.publishableSections[i];break}if(this.$newEntryBtnGroup=$('<div class="btngroup submit"/>'),selectedSection?(href=this._getSectionTriggerHref(selectedSection),label="index"===this.settings.context?Craft.t("app","New entry"):Craft.t("app","New {section} entry",{section:selectedSection.name}),this.$newEntryBtn=$('<a class="btn submit add icon" '+href+' role="button" tabindex="0">'+Craft.escapeHtml(label)+"</a>").appendTo(this.$newEntryBtnGroup),"index"!==this.settings.context&&this.addListener(this.$newEntryBtn,"click",(function(ev){this._openCreateEntryModal(ev.currentTarget.getAttribute("data-id"))})),this.publishableSections.length>1&&($menuBtn=$("<button/>",{type:"button",class:"btn submit menubtn"}).appendTo(this.$newEntryBtnGroup))):this.$newEntryBtn=$menuBtn=$("<button/>",{type:"button",class:"btn submit add icon menubtn",text:Craft.t("app","New entry")}).appendTo(this.$newEntryBtnGroup),$menuBtn){var menuHtml='<div class="menu"><ul>';for(i=0;i<this.publishableSections.length;i++){var section=this.publishableSections[i];("index"===this.settings.context&&-1!==$.inArray(this.siteId,section.sites)||"index"!==this.settings.context&&section!==selectedSection)&&(href=this._getSectionTriggerHref(section),label="index"===this.settings.context?section.name:Craft.t("app","New {section} entry",{section:section.name}),menuHtml+="<li><a "+href+">"+Craft.escapeHtml(label)+"</a></li>")}menuHtml+="</ul></div>",$(menuHtml).appendTo(this.$newEntryBtnGroup);var menuBtn=new Garnish.MenuBtn($menuBtn);"index"!==this.settings.context&&menuBtn.on("optionSelect",(function(ev){_this._openCreateEntryModal(ev.option.getAttribute("data-id"))}))}this.addButton(this.$newEntryBtnGroup)}if("index"===this.settings.context&&"undefined"!=typeof history){var uri="entries";handle&&(uri+="/"+handle),history.replaceState({},"",Craft.getUrl(uri))}}},_getSectionTriggerHref:function _getSectionTriggerHref(section){if("index"===this.settings.context){var uri="entries/".concat(section.handle,"/new"),site=this.getSite(),params=site?{site:site.handle}:void 0;return'href="'.concat(Craft.getUrl(uri,params),'"')}return'data-id="'.concat(section.id,'"')},_openCreateEntryModal:function _openCreateEntryModal(sectionId){var _this2=this;if(!this.$newEntryBtn.hasClass("loading")){for(var section,i=0;i<this.publishableSections.length;i++)if(this.publishableSections[i].id==sectionId){section=this.publishableSections[i];break}if(section){this.$newEntryBtn.addClass("inactive");var newEntryBtnText=this.$newEntryBtn.text();this.$newEntryBtn.text(Craft.t("app","New {section} entry",{section:section.name})),Craft.createElementEditor(this.elementType,{hudTrigger:this.$newEntryBtnGroup,siteId:this.siteId,attributes:{sectionId:sectionId,typeId:section.entryTypes[0].id,enabled:section.canPublish?1:0},onHideHud:function onHideHud(){_this2.$newEntryBtn.removeClass("inactive").text(newEntryBtnText)},onSaveElement:function onSaveElement(response){var sectionSourceKey="section:"+section.uid;_this2.sourceKey!==sectionSourceKey&&_this2.selectSourceByKey(sectionSourceKey),_this2.selectElementAfterUpdate(response.id),_this2.updateElements()}})}}}}),Craft.registerElementIndexClass("craft\\elements\\Entry",Craft.EntryIndex)},function(module,exports){Craft.FieldLayoutDesigner=Garnish.Base.extend({$container:null,$tabContainer:null,$newTabBtn:null,$sidebar:null,$libraryToggle:null,$selectedLibrary:null,$fieldLibrary:null,$uiLibrary:null,$uiLibraryElements:null,$fieldSearch:null,$clearFieldSearchBtn:null,$fieldGroups:null,$fields:null,tabGrid:null,elementDrag:null,init:function init(container,settings){var _this=this;this.$container=$(container),this.setSettings(settings,Craft.FieldLayoutDesigner.defaults);var $workspace=this.$container.children(".fld-workspace");this.$tabContainer=$workspace.children(".fld-tabs"),this.$newTabBtn=$workspace.children(".fld-new-tab-btn"),this.$sidebar=this.$container.children(".fld-sidebar"),this.$fieldLibrary=this.$selectedLibrary=this.$sidebar.children(".fld-field-library");var $fieldSearchContainer=this.$fieldLibrary.children(".search");this.$fieldSearch=$fieldSearchContainer.children("input"),this.$clearFieldSearchBtn=$fieldSearchContainer.children(".clear"),this.$fieldGroups=this.$sidebar.find(".fld-field-group"),this.$fields=this.$fieldGroups.children(".fld-element"),this.$uiLibrary=this.$sidebar.children(".fld-ui-library"),this.$uiLibraryElements=this.$uiLibrary.children(),this.tabGrid=new Craft.Grid(this.$tabContainer,{itemSelector:".fld-tab",minColWidth:264,fillMode:"grid",snapToGrid:24});for(var $tabs=this.$tabContainer.children(),i=0;i<$tabs.length;i++)this.initTab($($tabs[i]));if($("<input/>",{type:"hidden",name:this.settings.elementPlacementInputName.replace("[__TAB_NAME__][]",""),value:""}).insertBefore(this.$container),this.elementDrag=new Craft.FieldLayoutDesigner.ElementDrag(this),this.settings.customizableTabs&&(this.tabDrag=new Craft.FieldLayoutDesigner.TabDrag(this),this.addListener(this.$newTabBtn,"activate","addTab")),this.settings.customizableUi){var $libraryPicker=this.$sidebar.children(".btngroup");new Craft.Listbox($libraryPicker,{onChange:function onChange($selectedOption){_this.$selectedLibrary.addClass("hidden"),_this.$selectedLibrary=_this["$".concat($selectedOption.data("library"),"Library")].removeClass("hidden")}})}this.addListener(this.$fieldSearch,"input",(function(){var val=_this.$fieldSearch.val().toLowerCase().replace(/['"]/g,"");if(!val)return _this.$fieldLibrary.find(".filtered").removeClass("filtered"),void _this.$clearFieldSearchBtn.addClass("hidden");_this.$clearFieldSearchBtn.removeClass("hidden");var $matches=_this.$fields.filter('[data-keywords*="'.concat(val,'"]')).add(_this.$fieldGroups.filter('[data-name*="'.concat(val,'"]')).children(".fld-element")).removeClass("filtered");_this.$fields.not($matches).addClass("filtered");for(var _i=0;_i<_this.$fieldGroups.length;_i++){var $group=_this.$fieldGroups.eq(_i);$group.find(".fld-element:not(.hidden):not(.filtered)").length?$group.removeClass("filtered"):$group.addClass("filtered")}})),this.addListener(this.$fieldSearch,"keydown",(function(ev){ev.keyCode===Garnish.ESC_KEY&&_this.$fieldSearch.val("").trigger("input")})),this.addListener(this.$clearFieldSearchBtn,"click",(function(){_this.$fieldSearch.val("").trigger("input")}))},initTab:function initTab($tab){if(this.settings.customizableTabs){var $editBtn=$tab.find(".tabs .settings");$('<div class="menu" data-align="center"/>').insertAfter($editBtn).append($("<ul/>").append($("<li/>").append($("<a/>",{"data-action":"rename",text:Craft.t("app","Rename")}))).append($("<li/>").append($("<a/>",{"data-action":"remove",text:Craft.t("app","Remove")})))).append($("<hr/>")).append($("<ul/>").append($("<li/>").append($("<a/>",{"data-action":"moveLeft",text:Craft.t("app","Move to the left")}))).append($("<li/>").append($("<a/>",{"data-action":"moveRight",text:Craft.t("app","Move to the right")}))));var menuBtn=new Garnish.MenuBtn($editBtn,{onOptionSelect:this.onTabOptionSelect.bind(this)});menuBtn.menu.on("show",(function(){$tab.prev(".fld-tab").length?menuBtn.menu.$container.find("[data-action=moveLeft]").removeClass("disabled"):menuBtn.menu.$container.find("[data-action=moveLeft]").addClass("disabled"),$tab.next(".fld-tab").length?menuBtn.menu.$container.find("[data-action=moveRight]").removeClass("disabled"):menuBtn.menu.$container.find("[data-action=moveRight]").addClass("disabled")}))}for(var $elements=$tab.children(".fld-tabcontent").children(),i=0;i<$elements.length;i++)this.initElement($($elements[i]))},initElement:function initElement($element){new Craft.FieldLayoutDesigner.Element(this,$element)},onTabOptionSelect:function onTabOptionSelect(option){if(this.settings.customizableTabs){var $option=$(option),$tab=$option.data("menu").$anchor.parent().parent().parent(),action;switch($option.data("action")){case"rename":this.renameTab($tab);break;case"remove":this.removeTab($tab);break;case"moveLeft":var $prev=$tab.prev(".fld-tab");$prev.length&&$tab.insertBefore($prev);break;case"moveRight":var $next=$tab.next(".fld-tab");$next.length&&$tab.insertAfter($next)}}},renameTab:function renameTab($tab){if(this.settings.customizableTabs){var $labelSpan=$tab.find(".tabs .tab span"),oldName=$labelSpan.text(),newName=this.promptForTabName(oldName);newName&&newName!==oldName&&($labelSpan.text(newName),$tab.find(".placement-input").attr("name",this.getElementPlacementInputName(newName)))}},promptForTabName:function promptForTabName(oldName){return Craft.escapeHtml(prompt(Craft.t("app","Give your tab a name."),oldName))},removeTab:function removeTab($tab){if(this.settings.customizableTabs){for(var $fields=$tab.find(".fld-element"),i=0;i<$fields.length;i++){var attribute=$($fields[i]).attr("data-attribute");this.removeFieldByHandle(attribute)}this.tabGrid.removeItems($tab),this.tabDrag.removeItems($tab),$tab.remove()}},removeField:function removeField($field){var attribute=$field.attr("data-attribute");$field.remove(),this.removeFieldByHandle(attribute),this.tabGrid.refreshCols(!0)},removeFieldByHandle:function removeFieldByHandle(attribute){this.$fields.filter('[data-attribute="'.concat(attribute,'"]:first')).removeClass("hidden").closest(".fld-field-group").removeClass("hidden")},addTab:function addTab(){if(this.settings.customizableTabs){var name=this.promptForTabName();if(name){var $tab=$('\n<div class="fld-tab">\n  <div class="tabs">\n    <div class="tab sel draggable">\n      <span>'.concat(name,'</span>\n      <a class="settings icon" title="').concat(Craft.t("app","Rename"),'"></a>\n    </div>\n  </div>\n  <div class="fld-tabcontent"></div>\n</div>\n')).appendTo(this.$tabContainer);this.tabGrid.addItems($tab),this.tabDrag.addItems($tab),this.initTab($tab)}}},getElementPlacementInputName:function getElementPlacementInputName(tabName){return this.settings.elementPlacementInputName.replace(/__TAB_NAME__/g,Craft.encodeUriComponent(tabName))}},{defaults:{customizableTabs:!0,customizableUi:!0,elementPlacementInputName:"elementPlacements[__TAB_NAME__][]",elementConfigInputName:"elementConfigs[__ELEMENT_KEY__]"}}),Craft.FieldLayoutDesigner.Element=Garnish.Base.extend({designer:null,$container:null,$placementInput:null,$configInput:null,$settingsContainer:null,$editBtn:null,config:null,isField:!1,attribute:null,requirable:!1,key:null,hasCustomWidth:!1,hasSettings:!1,hud:null,init:function init(designer,$container){var _this2=this;this.designer=designer,this.$container=$container,this.$container.data("fld-element",this),this.config=this.$container.data("config"),$.isPlainObject(this.config)||(this.config={}),this.config.type=this.$container.data("type"),this.isField=this.$container.hasClass("fld-field"),this.requirable=this.isField&&Garnish.hasAttr(this.$container,"data-requirable"),this.key=Craft.randomString(10),this.isField&&(this.attribute=this.$container.data("attribute"));var settingsHtml=this.$container.data("settings-html"),isRequired=this.requirable&&this.$container.hasClass("fld-required");this.hasCustomWidth=this.designer.settings.customizableUi&&Garnish.hasAttr(this.$container,"data-has-custom-width"),this.hasSettings=settingsHtml||this.requirable,this.hasSettings&&(settingsHtml=settingsHtml?settingsHtml.replace(/\b__ELEMENT_KEY__\b/g,this.key):"",this.$settingsContainer=$("<div/>",{class:"hidden"}),this.$editBtn=$("<a/>",{role:"button",tabindex:0,class:"settings icon",title:Craft.t("app","Edit")}),this.$editBtn.on("click",(function(){_this2.hud?(_this2.hud.show(),_this2.hud.updateSizeAndPosition(!0)):_this2.createSettingsHud(settingsHtml,isRequired)}))),this.initUi(),this.$container.attr("data-config",null),this.$container.attr("data-keywords",null),this.$container.attr("data-settings-html",null)},initUi:function initUi(){var _this3=this,widthSlider;(this.$placementInput=$("<input/>",{class:"placement-input",type:"hidden",name:"",value:this.key}).appendTo(this.$container),this.updatePlacementInput(),this.$configInput=$("<input/>",{type:"hidden",name:this.designer.settings.elementConfigInputName.replace(/\b__ELEMENT_KEY__\b/g,this.key)}).appendTo(this.$container),this.updateConfigInput(),this.hasCustomWidth)&&new Craft.SlidePicker(this.config.width||100,{min:25,max:100,step:25,valueLabel:function valueLabel(width){return Craft.t("app","{pct} width",{pct:"".concat(width,"%")})},onChange:function onChange(width){_this3.config.width=width,_this3.updateConfigInput()}}).$container.appendTo(this.$container);this.hasSettings&&this.$editBtn.appendTo(this.$container)},createSettingsHud:function createSettingsHud(settingsHtml,isRequired){var _this4=this,bodyHtml='\n<div class="fld-element-settings">\n  '.concat(settingsHtml,'\n  <div class="hud-footer">\n    <div class="buttons right">\n      <button class="btn submit" type="submit">').concat(Craft.t("app","Apply"),'</button>\n      <div class="spinner hidden"></div>\n    </div>\n  </div>\n</div>\n');if(this.hud=new Garnish.HUD(this.$container,bodyHtml,{onShow:function onShow(e){Garnish.requestAnimationFrame((function(){_this4.hud.$main.find(".text:first").trigger("focus")}))},onSubmit:function onSubmit(){_this4.applyHudSettings()}}),Craft.initUiElements(this.hud.$main),this.requirable)var $lightswitchField=Craft.ui.createLightswitchField({label:Craft.t("app","Required"),id:"".concat(this.key,"-required"),name:"required",on:isRequired}).prependTo(this.hud.$main);this.trigger("createSettingsHud")},applyHudSettings:function applyHudSettings(){var _this5=this;this.hud.$body.serializeArray().forEach((function(_ref){var name=_ref.name,value=_ref.value;_this5.config[name]=value})),this.updateConfigInput();var $spinner=this.hud.$body.find(".spinner").removeClass("hidden");Craft.sendActionRequest("POST","fields/render-layout-element-selector",{data:{config:this.config}}).then((function(response){$spinner.addClass("hidden"),_this5.$editBtn.detach(),_this5.$container.html($(response.data.html).html()),_this5.initUi(),_this5.updateRequiredClass(),_this5.hud.hide()})).catch((function(e){console.error(e),$spinner.addClass("hidden"),_this5.updateRequiredClass(),_this5.hud.hide()}))},updatePlacementInput:function updatePlacementInput(){var $tab=this.$container.closest(".fld-tab").find(".tab span");if($tab.length){var inputName=this.designer.getElementPlacementInputName($tab.text());this.$placementInput.attr("name",inputName)}},updateConfigInput:function updateConfigInput(){this.$configInput.val(JSON.stringify(this.config))},updateRequiredClass:function updateRequiredClass(){this.requirable&&(this.config.required?this.$container.addClass("fld-required"):this.$container.removeClass("fld-required"))}}),Craft.FieldLayoutDesigner.BaseDrag=Garnish.Drag.extend({designer:null,$insertion:null,showingInsertion:!1,$caboose:null,init:function init(designer,settings){this.designer=designer,this.base(this.findItems(),settings)},onDragStart:function onDragStart(){this.base(),this.$insertion=this.createInsertion(),this.$caboose=this.createCaboose(),this.$items=$().add(this.$items.add(this.$caboose)),Garnish.$bod.addClass("dragging")},removeCaboose:function removeCaboose(){this.$items=this.$items.not(this.$caboose),this.$caboose.remove()},swapDraggeeWithInsertion:function swapDraggeeWithInsertion(){this.$insertion.insertBefore(this.$draggee),this.$draggee.detach(),this.$items=$().add(this.$items.not(this.$draggee).add(this.$insertion)),this.showingInsertion=!0},swapInsertionWithDraggee:function swapInsertionWithDraggee(){this.$insertion.replaceWith(this.$draggee),this.$items=$().add(this.$items.not(this.$insertion).add(this.$draggee)),this.showingInsertion=!1},setMidpoints:function setMidpoints(){for(var i=0;i<this.$items.length;i++){var $item=$(this.$items[i]),offset=$item.offset();$item.hasClass("unused")||$item.data("midpoint",{left:offset.left+$item.outerWidth()/2,top:offset.top+$item.outerHeight()/2})}},getClosestItem:function getClosestItem(){for(this.getClosestItem._closestItem=null,this.getClosestItem._closestItemMouseDiff=null,this.getClosestItem._i=0;this.getClosestItem._i<this.$items.length;this.getClosestItem._i++)this.getClosestItem._$item=$(this.$items[this.getClosestItem._i]),this.getClosestItem._midpoint=this.getClosestItem._$item.data("midpoint"),this.getClosestItem._midpoint&&(this.getClosestItem._mouseDiff=Garnish.getDist(this.getClosestItem._midpoint.left,this.getClosestItem._midpoint.top,this.mouseX,this.mouseY),(null===this.getClosestItem._closestItem||this.getClosestItem._mouseDiff<this.getClosestItem._closestItemMouseDiff)&&(this.getClosestItem._closestItem=this.getClosestItem._$item[0],this.getClosestItem._closestItemMouseDiff=this.getClosestItem._mouseDiff));return this.getClosestItem._closestItem},checkForNewClosestItem:function checkForNewClosestItem(){this.checkForNewClosestItem._closestItem=this.getClosestItem(),this.checkForNewClosestItem._closestItem!==this.$insertion[0]&&(this.showingInsertion&&$.inArray(this.$insertion[0],this.$items)<$.inArray(this.checkForNewClosestItem._closestItem,this.$items)&&-1===$.inArray(this.checkForNewClosestItem._closestItem,this.$caboose)?this.$insertion.insertAfter(this.checkForNewClosestItem._closestItem):this.$insertion.insertBefore(this.checkForNewClosestItem._closestItem),this.$items=$().add(this.$items.add(this.$insertion)),this.showingInsertion=!0,this.designer.tabGrid.refreshCols(!0),this.setMidpoints())},onDragStop:function onDragStop(){var _this6=this;this.showingInsertion&&this.swapInsertionWithDraggee(),this.removeCaboose(),this.designer.tabGrid.refreshCols(!0);var offset=this.$draggee.offset();!offset||0===offset.top&&0===offset.left?(this.$draggee.css({display:this.draggeeDisplay,visibility:"visible",opacity:0}).velocity({opacity:1},Garnish.FX_DURATION),this.helpers[0].velocity({opacity:0},Garnish.FX_DURATION,(function(){_this6._showDraggee()}))):this.returnHelpersToDraggees(),this.base(),Garnish.$bod.removeClass("dragging")}}),Craft.FieldLayoutDesigner.TabDrag=Craft.FieldLayoutDesigner.BaseDrag.extend({init:function init(designer){var settings={handle:".tab"};this.base(designer,settings)},findItems:function findItems(){return this.designer.$tabContainer.find("> div.fld-tab")},onDragStart:function onDragStart(){this.base(),this.swapDraggeeWithInsertion(),this.setMidpoints()},swapDraggeeWithInsertion:function swapDraggeeWithInsertion(){this.base(),this.designer.tabGrid.removeItems(this.$draggee),this.designer.tabGrid.addItems(this.$insertion)},swapInsertionWithDraggee:function swapInsertionWithDraggee(){this.base(),this.designer.tabGrid.removeItems(this.$insertion),this.designer.tabGrid.addItems(this.$draggee)},onDrag:function onDrag(){this.checkForNewClosestItem(),this.base()},onDragStop:function onDragStop(){this.base(),this.$draggee.css({display:this.draggeeDisplay,visibility:"hidden"})},createCaboose:function createCaboose(){var $caboose=$('<div class="fld-tab fld-tab-caboose"/>').appendTo(this.designer.$tabContainer);return this.designer.tabGrid.addItems($caboose),$caboose},removeCaboose:function removeCaboose(){this.base(),this.designer.tabGrid.removeItems(this.$caboose)},createInsertion:function createInsertion(){var $tab=this.$draggee.find(".tab");return $('\n<div class="fld-tab fld-insertion" style="height: '.concat(this.$draggee.height(),'px;">\n  <div class="tabs"><div class="tab sel draggable" style="width: ').concat($tab.width(),"px; height: ").concat($tab.height(),'px;"></div></div>\n  <div class="fld-tabcontent" style="height: ').concat(this.$draggee.find(".fld-tabcontent").height(),'px;"></div>\n</div>\n'))}}),Craft.FieldLayoutDesigner.ElementDrag=Craft.FieldLayoutDesigner.BaseDrag.extend({draggingLibraryElement:!1,draggingField:!1,onDragStart:function onDragStart(){this.base(),this.draggingLibraryElement=this.$draggee.hasClass("unused"),this.draggingField=this.$draggee.hasClass("fld-field"),this.draggingLibraryElement&&!this.draggingField&&this.$draggee.css({display:this.draggeeDisplay,visibility:"visible"}),this.draggingLibraryElement||this.swapDraggeeWithInsertion(),this.setMidpoints()},onDrag:function onDrag(){this.isDraggeeMandatory()||this.isHoveringOverTab()?this.checkForNewClosestItem():this.showingInsertion&&(this.$insertion.remove(),this.$items=$().add(this.$items.not(this.$insertion)),this.showingInsertion=!1,this.designer.tabGrid.refreshCols(!0),this.setMidpoints()),this.base()},isDraggeeMandatory:function isDraggeeMandatory(){return Garnish.hasAttr(this.$draggee,"data-mandatory")},isHoveringOverTab:function isHoveringOverTab(){for(var i=0;i<this.designer.tabGrid.$items.length;i++)if(Garnish.hitTest(this.mouseX,this.mouseY,this.designer.tabGrid.$items.eq(i)))return!0;return!1},findItems:function findItems(){return this.designer.$tabContainer.find(".fld-element").add(this.designer.$sidebar.find(".fld-element"))},createCaboose:function createCaboose(){for(var $caboose=$(),$fieldContainers=this.designer.$tabContainer.find("> .fld-tab > .fld-tabcontent"),i=0;i<$fieldContainers.length;i++)$caboose=$caboose.add($("<div/>").appendTo($fieldContainers[i]));return $caboose},createInsertion:function createInsertion(){return $('<div class="fld-element fld-insertion" style="height: '.concat(this.$draggee.outerHeight(),'px;"/>'))},onDragStop:function onDragStop(){var showingInsertion=this.showingInsertion;if(showingInsertion){if(this.draggingLibraryElement){var $element=this.$draggee.clone().removeClass("unused");this.designer.initElement($element),this.draggingField&&(this.$draggee.css({visibility:"inherit",display:"field"}).addClass("hidden"),0===this.$draggee.siblings(".fld-field:not(.hidden)").length&&this.$draggee.closest(".fld-field-group").addClass("hidden")),this.$draggee=$element,this.addItems($element)}}else if(!this.draggingLibraryElement){var $libraryElement=this.draggingField?this.designer.$fields.filter('[data-attribute="'.concat(this.$draggee.data("attribute"),'"]:first')):this.designer.$uiLibraryElements.filter('[data-type="'.concat(this.$draggee.data("type").replace(/\\/g,"\\\\"),'"]:first'));this.draggingField&&($libraryElement.removeClass("hidden"),$libraryElement.closest(".fld-field-group").removeClass("hidden")),this.removeItems(this.$draggee),this.$draggee=$libraryElement}this.base(),this.$draggee.css({display:this.draggeeDisplay,visibility:this.draggingField||showingInsertion?"hidden":"visible"}),showingInsertion&&this.$draggee.data("fld-element").updatePlacementInput()}})},function(module,exports){Craft.FieldToggle=Garnish.Base.extend({$toggle:null,targetPrefix:null,targetSelector:null,reverseTargetSelector:null,_$target:null,_$reverseTarget:null,type:null,init:function init(toggle){switch(this.$toggle=$(toggle),this.$toggle.data("fieldtoggle")&&(Garnish.log("Double-instantiating a field toggle on an element"),this.$toggle.data("fieldtoggle").destroy()),this.$toggle.data("fieldtoggle",this),this.type=this.getType(),"select"===this.type||"fieldset"===this.type?this.targetPrefix=this.$toggle.attr("data-target-prefix")||"":(this.targetSelector=this.normalizeTargetSelector(this.$toggle.data("target")),this.reverseTargetSelector=this.normalizeTargetSelector(this.$toggle.data("reverse-target"))),this.findTargets(),this.type){case"link":this.addListener(this.$toggle,"click","onToggleChange");break;case"fieldset":this.addListener(this.$toggle.find("input"),"change","onToggleChange");break;default:this.addListener(this.$toggle,"change","onToggleChange"),this.onToggleChange()}},normalizeTargetSelector:function normalizeTargetSelector(selector){return selector&&!selector.match(/^[#\.]/)&&(selector="#"+selector),selector},getType:function getType(){var nodeName=this.$toggle.prop("nodeName");if("INPUT"===nodeName&&"checkbox"===this.$toggle.attr("type")||"checkbox"===this.$toggle.attr("role")||"switch"===this.$toggle.attr("role"))return"checkbox";switch(nodeName){case"SELECT":return"select";case"A":return"link";case"FIELDSET":return"fieldset"}console.warn("Unexpected field toggle:",this.$toggle[0])},findTargets:function findTargets(){if("select"===this.type||"fieldset"===this.type){var toggleVal=this.getToggleVal();this._$target=$(this.normalizeTargetSelector(this.targetPrefix+this.getToggleVal()))}else this.targetSelector&&(this._$target=$(this.targetSelector)),this.reverseTargetSelector&&(this._$reverseTarget=$(this.reverseTargetSelector))},getToggleVal:function getToggleVal(){return"checkbox"===this.type?void 0!==this.$toggle.prop("checked")?this.$toggle.prop("checked"):"true"===this.$toggle.attr("aria-checked"):null==(postVal="fieldset"===this.type?this.$toggle.find("input:checked:first").val():Garnish.getInputPostVal(this.$toggle))?null:postVal.replace(/[^\w]+/g,"-");var postVal},onToggleChange:function onToggleChange(){"select"===this.type||"fieldset"===this.type?(this.hideTarget(this._$target),this.findTargets(),this.showTarget(this._$target)):(this.findTargets(),"link"===this.type?this.onToggleChange._show=this.$toggle.hasClass("collapsed")||!this.$toggle.hasClass("expanded"):this.onToggleChange._show=!!this.getToggleVal(),this.onToggleChange._show?(this.showTarget(this._$target),this.hideTarget(this._$reverseTarget)):(this.hideTarget(this._$target),this.showTarget(this._$reverseTarget)),delete this.onToggleChange._show)},showTarget:function showTarget($target){var _this=this;if($target&&$target.length){if(this.showTarget._currentHeight=$target.height(),$target.removeClass("hidden"),"select"!==this.type&&"fieldset"!==this.type){"link"===this.type&&(this.$toggle.removeClass("collapsed"),this.$toggle.addClass("expanded"));for(var i=0;i<$target.length;i++)!function($t){"SPAN"!==$t.prop("nodeName")&&($t.height("auto"),_this.showTarget._targetHeight=$t.height(),$t.css({height:_this.showTarget._currentHeight,overflow:"hidden"}),$t.velocity("stop"),$t.velocity({height:_this.showTarget._targetHeight},"fast",(function(){$t.css({height:"",overflow:""})})))}($target.eq(i));delete this.showTarget._targetHeight}delete this.showTarget._currentHeight,Garnish.$win.trigger("resize")}},hideTarget:function hideTarget($target){if($target&&$target.length)if("select"===this.type||"fieldset"===this.type)$target.addClass("hidden");else{"link"===this.type&&(this.$toggle.removeClass("expanded"),this.$toggle.addClass("collapsed"));for(var i=0;i<$target.length;i++)!function($t){$t.hasClass("hidden")||("SPAN"===$t.prop("nodeName")?$t.addClass("hidden"):($t.css("overflow","hidden"),$t.velocity("stop"),$t.velocity({height:0},"fast",(function(){$t.addClass("hidden")}))))}($target.eq(i))}}})},function(module,exports){Craft.Grid=Garnish.Base.extend({$container:null,$items:null,items:null,totalCols:null,colGutterDrop:null,colPctWidth:null,possibleItemColspans:null,possibleItemPositionsByColspan:null,itemPositions:null,itemColspansByPosition:null,layouts:null,layout:null,itemHeights:null,leftPadding:null,_refreshingCols:!1,_refreshColsAfterRefresh:!1,_forceRefreshColsAfterRefresh:!1,init:function init(container,settings){var _this=this;this.$container=$(container),this.$container.data("grid")&&(Garnish.log("Double-instantiating a grid on an element"),this.$container.data("grid").destroy()),this.$container.data("grid",this),this.setSettings(settings,Craft.Grid.defaults),this.handleContainerHeightProxy=function(){_this.refreshCols(!1,!0)},this.$items=this.$container.children(this.settings.itemSelector),this.setItems(),this.refreshCols(!0,!1),Garnish.$doc.ready((function(){_this.refreshCols(!1,!1)}))},addItems:function addItems(items){this.$items=$().add(this.$items.add(items)),this.setItems(),this.refreshCols(!0,!0)},removeItems:function removeItems(items){this.$items=$().add(this.$items.not(items)),this.setItems(),this.refreshCols(!0,!0)},resetItemOrder:function resetItemOrder(){this.$items=$().add(this.$items),this.setItems(),this.refreshCols(!0,!0)},setItems:function setItems(){for(this.setItems._={},this.items=[],this.setItems._.i=0;this.setItems._.i<this.$items.length;this.setItems._.i++)this.items.push($(this.$items[this.setItems._.i]));delete this.setItems._},refreshCols:function refreshCols(force){if(this._refreshingCols)return this._refreshColsAfterRefresh=!0,void(force&&(this._forceRefreshColsAfterRefresh=!0));if(this._refreshingCols=!0,this.items.length)if(this.refreshCols._={},this.refreshCols._.oldHeight=this.$container[0].style.height,this.$container[0].style.height=1,this.refreshCols._.scrollHeight=this.$container[0].scrollHeight,this.$container[0].style.height=this.refreshCols._.oldHeight,0!==this.refreshCols._.scrollHeight)if(this.settings.cols?this.refreshCols._.totalCols=this.settings.cols:(this.refreshCols._.totalCols=Math.floor(this.$container.width()/this.settings.minColWidth),null!==this.totalCols&&this.refreshCols._.totalCols>this.totalCols&&(this.refreshCols._.totalCols=Math.floor((this.$container.width()-20)/this.settings.minColWidth)),this.settings.maxCols&&this.refreshCols._.totalCols>this.settings.maxCols&&(this.refreshCols._.totalCols=this.settings.maxCols)),0===this.refreshCols._.totalCols&&(this.refreshCols._.totalCols=1),!0===force||this.totalCols!==this.refreshCols._.totalCols){if(this.totalCols=this.refreshCols._.totalCols,this.colGutterDrop=this.settings.gutter*(this.totalCols-1)/this.totalCols,this.removeListener(this.$container,"resize"),"grid"===this.settings.fillMode)for(this.refreshCols._.itemIndex=0;this.refreshCols._.itemIndex<this.items.length;){for(this.refreshCols._.tallestItemHeight=-1,this.refreshCols._.colIndex=0,this.refreshCols._.i=this.refreshCols._.itemIndex;this.refreshCols._.i<this.refreshCols._.itemIndex+this.totalCols&&this.refreshCols._.i<this.items.length;this.refreshCols._.i++)this.refreshCols._.itemHeight=this.items[this.refreshCols._.i].height("auto").height(),this.refreshCols._.itemHeight>this.refreshCols._.tallestItemHeight&&(this.refreshCols._.tallestItemHeight=this.refreshCols._.itemHeight),this.refreshCols._.colIndex++;for(this.settings.snapToGrid&&(this.refreshCols._.remainder=this.refreshCols._.tallestItemHeight%this.settings.snapToGrid,this.refreshCols._.remainder&&(this.refreshCols._.tallestItemHeight+=this.settings.snapToGrid-this.refreshCols._.remainder)),this.refreshCols._.i=this.refreshCols._.itemIndex;this.refreshCols._.i<this.refreshCols._.itemIndex+this.totalCols&&this.refreshCols._.i<this.items.length;this.refreshCols._.i++)this.items[this.refreshCols._.i].height(this.refreshCols._.tallestItemHeight);this.refreshCols._.itemIndex+=this.totalCols}else if(this.removeListener(this.$items,"resize"),1===this.totalCols)this.$container.height("auto"),this.$items.show().css({position:"relative",width:"auto",top:0}).css(Craft.left,0);else{for(this.$items.css("position","absolute"),this.colPctWidth=100/this.totalCols,this.layouts=[],this.itemPositions=[],this.itemColspansByPosition=[],this.possibleItemColspans=[],this.possibleItemPositionsByColspan=[],this.itemHeightsByColspan=[],this.refreshCols._.item=0;this.refreshCols._.item<this.items.length;this.refreshCols._.item++)for(this.possibleItemColspans[this.refreshCols._.item]=[],this.possibleItemPositionsByColspan[this.refreshCols._.item]={},this.itemHeightsByColspan[this.refreshCols._.item]={},this.refreshCols._.$item=this.items[this.refreshCols._.item].show(),this.refreshCols._.positionRight="right"===this.refreshCols._.$item.data("position"),this.refreshCols._.positionLeft="left"===this.refreshCols._.$item.data("position"),this.refreshCols._.minColspan=this.refreshCols._.$item.data("colspan")?this.refreshCols._.$item.data("colspan"):this.refreshCols._.$item.data("min-colspan")?this.refreshCols._.$item.data("min-colspan"):1,this.refreshCols._.maxColspan=this.refreshCols._.$item.data("colspan")?this.refreshCols._.$item.data("colspan"):this.refreshCols._.$item.data("max-colspan")?this.refreshCols._.$item.data("max-colspan"):this.totalCols,this.refreshCols._.minColspan>this.totalCols&&(this.refreshCols._.minColspan=this.totalCols),this.refreshCols._.maxColspan>this.totalCols&&(this.refreshCols._.maxColspan=this.totalCols),this.refreshCols._.colspan=this.refreshCols._.minColspan;this.refreshCols._.colspan<=this.refreshCols._.maxColspan;this.refreshCols._.colspan++)for(this.refreshCols._.$item.css("width",this.getItemWidthCss(this.refreshCols._.colspan)),this.itemHeightsByColspan[this.refreshCols._.item][this.refreshCols._.colspan]=this.refreshCols._.$item.outerHeight(),this.possibleItemColspans[this.refreshCols._.item].push(this.refreshCols._.colspan),this.possibleItemPositionsByColspan[this.refreshCols._.item][this.refreshCols._.colspan]=[],this.refreshCols._.positionLeft?(this.refreshCols._.minPosition=0,this.refreshCols._.maxPosition=0):this.refreshCols._.positionRight?(this.refreshCols._.minPosition=this.totalCols-this.refreshCols._.colspan,this.refreshCols._.maxPosition=this.refreshCols._.minPosition):(this.refreshCols._.minPosition=0,this.refreshCols._.maxPosition=this.totalCols-this.refreshCols._.colspan),this.refreshCols._.position=this.refreshCols._.minPosition;this.refreshCols._.position<=this.refreshCols._.maxPosition;this.refreshCols._.position++)this.possibleItemPositionsByColspan[this.refreshCols._.item][this.refreshCols._.colspan].push(this.refreshCols._.position);for(this.refreshCols._.colHeights=[],this.refreshCols._.i=0;this.refreshCols._.i<this.totalCols;this.refreshCols._.i++)this.refreshCols._.colHeights.push(0);for(this.createLayouts(0,[],[],this.refreshCols._.colHeights,0),this.refreshCols._.layoutTotalCols=[],this.refreshCols._.i=0;this.refreshCols._.i<this.layouts.length;this.refreshCols._.i++)for(this.refreshCols._.layoutTotalCols[this.refreshCols._.i]=0,this.refreshCols._.j=0;this.refreshCols._.j<this.totalCols;this.refreshCols._.j++)this.layouts[this.refreshCols._.i].colHeights[this.refreshCols._.j]&&this.refreshCols._.layoutTotalCols[this.refreshCols._.i]++;for(this.refreshCols._.highestTotalCols=Math.max.apply(null,this.refreshCols._.layoutTotalCols),this.refreshCols._.i=this.layouts.length-1;this.refreshCols._.i>=0;this.refreshCols._.i--)this.refreshCols._.layoutTotalCols[this.refreshCols._.i]!==this.refreshCols._.highestTotalCols&&this.layouts.splice(this.refreshCols._.i,1);for(this.refreshCols._.layoutHeights=[],this.refreshCols._.i=0;this.refreshCols._.i<this.layouts.length;this.refreshCols._.i++)this.refreshCols._.layoutHeights.push(Math.max.apply(null,this.layouts[this.refreshCols._.i].colHeights));for(this.refreshCols._.shortestHeight=Math.min.apply(null,this.refreshCols._.layoutHeights),this.refreshCols._.shortestLayouts=[],this.refreshCols._.emptySpaces=[],this.refreshCols._.i=0;this.refreshCols._.i<this.refreshCols._.layoutHeights.length;this.refreshCols._.i++)if(this.refreshCols._.layoutHeights[this.refreshCols._.i]===this.refreshCols._.shortestHeight){for(this.refreshCols._.shortestLayouts.push(this.layouts[this.refreshCols._.i]),this.refreshCols._.emptySpace=this.layouts[this.refreshCols._.i].emptySpace,this.refreshCols._.j=0;this.refreshCols._.j<this.totalCols;this.refreshCols._.j++)this.refreshCols._.emptySpace+=this.refreshCols._.shortestHeight-this.layouts[this.refreshCols._.i].colHeights[this.refreshCols._.j];this.refreshCols._.emptySpaces.push(this.refreshCols._.emptySpace)}for(this.layout=this.refreshCols._.shortestLayouts[$.inArray(Math.min.apply(null,this.refreshCols._.emptySpaces),this.refreshCols._.emptySpaces)],this.refreshCols._.i=0;this.refreshCols._.i<this.items.length;this.refreshCols._.i++)this.refreshCols._.css={width:this.getItemWidthCss(this.layout.colspans[this.refreshCols._.i])},this.refreshCols._.css[Craft.left]=this.getItemLeftPosCss(this.layout.positions[this.refreshCols._.i]),this.items[this.refreshCols._.i].css(this.refreshCols._.css);this.isSimpleLayout()?(this.$container.height("auto"),this.$items.css({position:"relative",top:0,"margin-bottom":this.settings.gutter+"px"})):(this.$items.css("position","absolute"),this.positionItems(),this.addListener(this.$items,"resize","onItemResize"))}this.completeRefreshCols(),this.addListener(this.$container,"resize",this.handleContainerHeightProxy),this.onRefreshCols()}else this.completeRefreshCols();else this.completeRefreshCols();else this.completeRefreshCols()},completeRefreshCols:function completeRefreshCols(){var _this2=this;if(void 0!==this.refreshCols._&&delete this.refreshCols._,this._refreshingCols=!1,this._refreshColsAfterRefresh){var force=this._forceRefreshColsAfterRefresh;this._refreshColsAfterRefresh=!1,this._forceRefreshColsAfterRefresh=!1,Garnish.requestAnimationFrame((function(){_this2.refreshCols(force)}))}},getItemWidth:function getItemWidth(colspan){return this.colPctWidth*colspan},getItemWidthCss:function getItemWidthCss(colspan){return"calc("+this.getItemWidth(colspan)+"% - "+this.colGutterDrop+"px)"},getItemWidthInPx:function getItemWidthInPx(colspan){return this.getItemWidth(colspan)/100*this.$container.width()-this.colGutterDrop},getItemLeftPosCss:function getItemLeftPosCss(position){return"calc(("+this.getItemWidth(1)+"% + "+(this.settings.gutter-this.colGutterDrop)+"px) * "+position+")"},getItemLeftPosInPx:function getItemLeftPosInPx(position){return(this.getItemWidth(1)/100*this.$container.width()+(this.settings.gutter-this.colGutterDrop))*position},createLayouts:function createLayouts(item,prevPositions,prevColspans,prevColHeights,prevEmptySpace){new Craft.Grid.LayoutGenerator(this).createLayouts(item,prevPositions,prevColspans,prevColHeights,prevEmptySpace)},isSimpleLayout:function isSimpleLayout(){for(this.isSimpleLayout._={},this.isSimpleLayout._.i=0;this.isSimpleLayout._.i<this.layout.positions.length;this.isSimpleLayout._.i++)if(0!==this.layout.positions[this.isSimpleLayout._.i])return delete this.isSimpleLayout._,!1;return delete this.isSimpleLayout._,!0},positionItems:function positionItems(){for(this.positionItems._={},this.positionItems._.colHeights=[],this.positionItems._.i=0;this.positionItems._.i<this.totalCols;this.positionItems._.i++)this.positionItems._.colHeights.push(0);for(this.positionItems._.i=0;this.positionItems._.i<this.items.length;this.positionItems._.i++){for(this.positionItems._.endingCol=this.layout.positions[this.positionItems._.i]+this.layout.colspans[this.positionItems._.i]-1,this.positionItems._.affectedColHeights=[],this.positionItems._.col=this.layout.positions[this.positionItems._.i];this.positionItems._.col<=this.positionItems._.endingCol;this.positionItems._.col++)this.positionItems._.affectedColHeights.push(this.positionItems._.colHeights[this.positionItems._.col]);for(this.positionItems._.top=Math.max.apply(null,this.positionItems._.affectedColHeights),this.positionItems._.top>0&&(this.positionItems._.top+=this.settings.gutter),this.items[this.positionItems._.i].css("top",this.positionItems._.top),this.positionItems._.col=this.layout.positions[this.positionItems._.i];this.positionItems._.col<=this.positionItems._.endingCol;this.positionItems._.col++)this.positionItems._.colHeights[this.positionItems._.col]=this.positionItems._.top+this.itemHeightsByColspan[this.positionItems._.i][this.layout.colspans[this.positionItems._.i]]}this.$container.height(Math.max.apply(null,this.positionItems._.colHeights)),delete this.positionItems._},onItemResize:function onItemResize(ev){this.onItemResize._={},ev.stopPropagation(),this.onItemResize._.item=$.inArray(ev.currentTarget,this.$items),-1!==this.onItemResize._.item&&(this.onItemResize._.newHeight=this.items[this.onItemResize._.item].outerHeight(),this.onItemResize._.newHeight!==this.itemHeightsByColspan[this.onItemResize._.item][this.layout.colspans[this.onItemResize._.item]]&&(this.itemHeightsByColspan[this.onItemResize._.item][this.layout.colspans[this.onItemResize._.item]]=this.onItemResize._.newHeight,this.positionItems(!1))),delete this.onItemResize._},onRefreshCols:function onRefreshCols(){this.trigger("refreshCols"),this.settings.onRefreshCols()}},{defaults:{itemSelector:".item",cols:null,maxCols:null,minColWidth:320,gutter:14,fillMode:"top",colClass:"col",snapToGrid:null,onRefreshCols:$.noop}}),Craft.Grid.LayoutGenerator=Garnish.Base.extend({grid:null,_:null,init:function init(grid){this.grid=grid},createLayouts:function createLayouts(item,prevPositions,prevColspans,prevColHeights,prevEmptySpace){for(this._={},this._.c=0;this._.c<this.grid.possibleItemColspans[item].length;this._.c++){for(this._.colspan=this.grid.possibleItemColspans[item][this._.c],this._.tallestColHeightsByPosition=[],this._.p=0;this._.p<this.grid.possibleItemPositionsByColspan[item][this._.colspan].length;this._.p++){for(this._.position=this.grid.possibleItemPositionsByColspan[item][this._.colspan][this._.p],this._.colHeightsForPosition=[],this._.endingCol=this._.position+this._.colspan-1,this._.col=this._.position;this._.col<=this._.endingCol;this._.col++)this._.colHeightsForPosition.push(prevColHeights[this._.col]);this._.tallestColHeightsByPosition[this._.p]=Math.max.apply(null,this._.colHeightsForPosition)}for(this._.p=$.inArray(Math.min.apply(null,this._.tallestColHeightsByPosition),this._.tallestColHeightsByPosition),this._.position=this.grid.possibleItemPositionsByColspan[item][this._.colspan][this._.p],this._.positions=prevPositions.slice(0),this._.colspans=prevColspans.slice(0),this._.colHeights=prevColHeights.slice(0),this._.emptySpace=prevEmptySpace,this._.positions.push(this._.position),this._.colspans.push(this._.colspan),this._.tallestColHeight=this._.tallestColHeightsByPosition[this._.p],this._.endingCol=this._.position+this._.colspan-1,this._.col=this._.position;this._.col<=this._.endingCol;this._.col++)this._.emptySpace+=this._.tallestColHeight-this._.colHeights[this._.col],this._.colHeights[this._.col]=this._.tallestColHeight+this.grid.itemHeightsByColspan[item][this._.colspan];item===this.grid.items.length-1?this.grid.layouts.push({positions:this._.positions,colspans:this._.colspans,colHeights:this._.colHeights,emptySpace:this._.emptySpace}):this.grid.createLayouts(item+1,this._.positions,this._.colspans,this._.colHeights,this._.emptySpace)}delete this._}})},function(module,exports){Craft.HandleGenerator=Craft.BaseInputGenerator.extend({generateTargetValue:function generateTargetValue(sourceVal){var handle=sourceVal.replace("/<(.*?)>/g","");handle=(handle=handle.replace(/['"‘’“”\[\]\(\)\{\}:]/g,"")).toLowerCase(),handle=Craft.asciiString(handle),this.settings.allowNonAlphaStart||(handle=handle.replace(/^[^a-z]+/,""));var words=Craft.filterArray(handle.split(/[^a-z0-9]+/));if(handle="","snake"===Craft.handleCasing)return words.join("_");for(var i=0;i<words.length;i++)"pascal"!==Craft.handleCasing&&0===i?handle+=words[i]:handle+=words[i].charAt(0).toUpperCase()+words[i].substr(1);return handle}})},function(module,exports){Craft.ImageUpload=Garnish.Base.extend({$container:null,progressBar:null,uploader:null,init:function init(settings){this.setSettings(settings,Craft.ImageUpload.defaults),this.initImageUpload()},initImageUpload:function initImageUpload(){this.$container=$(this.settings.containerSelector),this.progressBar=new Craft.ProgressBar($('<div class="progress-shade"></div>').appendTo(this.$container));var options={url:Craft.getActionUrl(this.settings.uploadAction),formData:this.settings.postParameters,fileInput:this.$container.find(this.settings.fileInputSelector),paramName:this.settings.uploadParamName};void 0!==Craft.csrfTokenName&&void 0!==Craft.csrfTokenValue&&(options.formData[Craft.csrfTokenName]=Craft.csrfTokenValue),options.events={},options.events.fileuploadstart=this._onUploadStart.bind(this),options.events.fileuploadprogressall=this._onUploadProgress.bind(this),options.events.fileuploaddone=this._onUploadComplete.bind(this),options.events.fileuploadfail=this._onUploadError.bind(this),this.uploader=new Craft.Uploader(this.$container,options),this.initButtons()},initButtons:function initButtons(){var _this=this;this.$container.find(this.settings.uploadButtonSelector).on("click",(function(ev){_this.$container.find(_this.settings.fileInputSelector).trigger("click")})),this.$container.find(this.settings.deleteButtonSelector).on("click",(function(ev){confirm(Craft.t("app","Are you sure you want to delete this image?"))&&($(ev.currentTarget).parent().append('<div class="blocking-modal"></div>'),Craft.postActionRequest(_this.settings.deleteAction,_this.settings.postParameters,(function(response,textStatus){"success"===textStatus&&_this.refreshImage(response)})))}))},refreshImage:function refreshImage(response){$(this.settings.containerSelector).replaceWith(response.html),this.settings.onAfterRefreshImage(response),this.initImageUpload()},_onUploadStart:function _onUploadStart(event){this.progressBar.$progressBar.css({top:Math.round(this.$container.outerHeight()/2)-6}),this.$container.addClass("uploading"),this.progressBar.resetProgressBar(),this.progressBar.showProgressBar()},_onUploadProgress:function _onUploadProgress(event,data){var progress=parseInt(data.loaded/data.total*100,10);this.progressBar.setProgressPercentage(progress)},_onUploadComplete:function _onUploadComplete(event,data){if(data.result.error)alert(data.result.error);else{var html=$(data.result.html);this.refreshImage(data.result)}this.uploader.isLastUpload()&&(this.progressBar.hideProgressBar(),this.$container.removeClass("uploading"))},_onUploadError:function _onUploadError(event,data){data.jqXHR.responseJSON.error&&(alert(data.jqXHR.responseJSON.error),this.$container.removeClass("uploading"),this.progressBar.hideProgressBar(),this.progressBar.resetProgressBar())}},{defaults:{postParameters:{},uploadAction:"",deleteAction:"",fileInputSelector:"",onAfterRefreshImage:$.noop,containerSelector:null,uploadButtonSelector:null,deleteButtonSelector:null,uploadParamName:"files"}})},function(module,exports){Craft.InfoIcon=Garnish.Base.extend({$icon:null,content:null,hud:null,init:function init(icon){var _this=this,$parent;if((this.$icon=$(icon),this.$icon.data("infoicon")?(Garnish.log("Double-instantiating an info icon on an element"),this.content=this.$icon.data("infoicon").content,this.$icon.data("infoicon").destroy()):(this.content=this.$icon.html(),this.$icon.html("").attr({tabindex:0,role:"button","aria-label":Craft.t("app","Information")})),this.$icon.data("infoicon",this),this.$icon[0].previousSibling&&this.$icon[0].previousSibling.nodeType===Node.TEXT_NODE)&&!this.$icon.parent().hasClass("nowrap")){var m=this.$icon[0].previousSibling.nodeValue.match(/[^\s\-]+\s*$/);m&&(this.$icon[0].previousSibling.nodeValue=this.$icon[0].previousSibling.nodeValue.substr(0,m.index),$("<span/>",{class:"nowrap",html:m[0].replace(/\s+$/,"")+" "}).insertAfter(this.$icon[0].previousSibling).append(this.$icon))}this.addListener(this.$icon,"click",(function(ev){ev.preventDefault(),ev.stopPropagation(),_this.showHud()})),this.addListener(this.$icon,"keydown",(function(ev){_this.hud&&_this.hud.showing||![Garnish.SPACE_KEY,Garnish.RETURN_KEY].includes(ev.keyCode)||(ev.preventDefault(),ev.stopPropagation(),_this.showHud())}))},showHud:function showHud(ev){var _this2=this;this.hud?this.hud.show():(this.hud=new Garnish.HUD(this.$icon,this.content,{hudClass:"hud info-hud",closeOtherHUDs:!1,onShow:function onShow(){Garnish.shortcutManager.registerShortcut(Garnish.SPACE_KEY,(function(){_this2.hud.hide()}))}}),Craft.initUiElements(this.hud.$body))}})},function(module,exports){Craft.LightSwitch=Garnish.Base.extend({settings:null,$outerContainer:null,$innerContainer:null,$input:null,small:!1,on:!1,indeterminate:!1,dragger:null,dragStartMargin:null,init:function init(outerContainer,settings){if(this.$outerContainer=$(outerContainer),this.$outerContainer.data("lightswitch")&&(Garnish.log("Double-instantiating a lightswitch on an element"),this.$outerContainer.data("lightswitch").destroy()),this.$outerContainer.data("lightswitch",this),this.small=this.$outerContainer.hasClass("small"),this.setSettings(settings,Craft.LightSwitch.defaults),this.$innerContainer=this.$outerContainer.find(".lightswitch-container:first"),this.$input=this.$outerContainer.find("input:first"),!this.$input.prop("disabled")){this.on=this.$outerContainer.hasClass("on"),this.indeterminate=this.$outerContainer.hasClass("indeterminate"),this.addListener(this.$outerContainer,"mousedown","_onMouseDown"),this.addListener(this.$outerContainer,"keydown","_onKeyDown"),this.dragger=new Garnish.BaseDrag(this.$outerContainer,{axis:Garnish.X_AXIS,ignoreHandleSelector:null,onDragStart:this._onDragStart.bind(this),onDrag:this._onDrag.bind(this),onDragStop:this._onDragStop.bind(this)});var $wrapper=this.$outerContainer.parent(".lightswitch-inner-container");$wrapper.length&&(this.addListener($wrapper.children('span[data-toggle="off"]'),"click",this.turnOff),this.addListener($wrapper.children('span[data-toggle="on"]'),"click",this.turnOn))}},turnOn:function turnOn(muteEvent){var changed=!this.on;this.on=!0,this.indeterminate=!1,this.$outerContainer.addClass("dragging");var animateCss={};animateCss["margin-"+Craft.left]=0,this.$innerContainer.velocity("stop").velocity(animateCss,Craft.LightSwitch.animationDuration,this._onSettle.bind(this)),this.$input.val(this.settings.value),this.$outerContainer.addClass("on"),this.$outerContainer.removeClass("indeterminate"),this.$outerContainer.attr("aria-checked","true"),changed&&!0!==muteEvent&&this.onChange()},turnOff:function turnOff(muteEvent){var changed=this.on||this.indeterminate;this.on=!1,this.indeterminate=!1,this.$outerContainer.addClass("dragging");var animateCss={};animateCss["margin-"+Craft.left]=this._getOffMargin(),this.$innerContainer.velocity("stop").velocity(animateCss,Craft.LightSwitch.animationDuration,this._onSettle.bind(this)),this.$input.val(""),this.$outerContainer.removeClass("on"),this.$outerContainer.removeClass("indeterminate"),this.$outerContainer.attr("aria-checked","false"),changed&&!0!==muteEvent&&this.onChange()},turnIndeterminate:function turnIndeterminate(muteEvent){var changed=!this.indeterminate;this.on=!1,this.indeterminate=!0,this.$outerContainer.addClass("dragging");var animateCss={};animateCss["margin-"+Craft.left]=this._getOffMargin()/2,this.$innerContainer.velocity("stop").velocity(animateCss,Craft.LightSwitch.animationDuration,this._onSettle.bind(this)),this.$input.val(this.settings.indeterminateValue),this.$outerContainer.removeClass("on"),this.$outerContainer.addClass("indeterminate"),this.$outerContainer.attr("aria-checked","mixed"),changed&&!0!==muteEvent&&this.onChange()},toggle:function toggle(){this.indeterminate||!this.on?this.turnOn():this.turnOff()},onChange:function onChange(){this.trigger("change"),this.settings.onChange(this.on),this.$outerContainer.trigger("change")},_onMouseDown:function _onMouseDown(){this.addListener(Garnish.$doc,"mouseup","_onMouseUp")},_onMouseUp:function _onMouseUp(){this.removeListener(Garnish.$doc,"mouseup"),this.dragger.dragging||this.toggle()},_onKeyDown:function _onKeyDown(event){switch(event.keyCode){case Garnish.SPACE_KEY:this.toggle(),event.preventDefault();break;case Garnish.RIGHT_KEY:"ltr"===Craft.orientation?this.turnOn():this.turnOff(),event.preventDefault();break;case Garnish.LEFT_KEY:"ltr"===Craft.orientation?this.turnOff():this.turnOn(),event.preventDefault()}},_getMargin:function _getMargin(){return parseInt(this.$innerContainer.css("margin-"+Craft.left))},_onDragStart:function _onDragStart(){this.$outerContainer.addClass("dragging"),this.dragStartMargin=this._getMargin()},_onDrag:function _onDrag(){var margin;(margin="ltr"===Craft.orientation?this.dragStartMargin+this.dragger.mouseDistX:this.dragStartMargin-this.dragger.mouseDistX)<this._getOffMargin()?margin=this._getOffMargin():margin>0&&(margin=0),this.$innerContainer.css("margin-"+Craft.left,margin)},_onDragStop:function _onDragStop(){var margin=this._getMargin();console.log(margin),margin>this._getOffMargin()/2?this.turnOn():this.turnOff()},_onSettle:function _onSettle(){this.$outerContainer.removeClass("dragging")},destroy:function destroy(){this.base(),this.dragger.destroy()},_getOffMargin:function _getOffMargin(){return this.small?-10:-12}},{animationDuration:100,defaults:{value:"1",indeterminateValue:"-",onChange:$.noop}})},function(module,exports){Craft.Listbox=Garnish.Base.extend({$container:null,$options:null,$selectedOption:null,selectedOptionIndex:null,init:function init(container,settings){var _this=this;this.$container=$(container),this.setSettings(settings,Craft.Listbox.defaults),this.$container.data("listbox")&&(Garnish.log("Double-instantiating a listbox on an element"),this.$container.data("listbox").destroy()),this.$container.data("listbox",this),this.$options=this.$container.find("[role=option]"),this.$selectedOption=this.$options.filter("[aria-selected=true]"),this.$selectedOption.length?this.selectedOptionIndex=this.$options.index(this.$selectedOption):this.$selectedOption=null,this.addListener(this.$container,"keydown",(function(ev){switch(ev.keyCode){case Garnish.UP_KEY:_this.selectPrev(),ev.preventDefault();break;case Garnish.DOWN_KEY:_this.selectNext(),ev.preventDefault();break;case Garnish.LEFT_KEY:"ltr"===Craft.orientation?_this.selectPrev():_this.selectNext(),ev.preventDefault();break;case Garnish.RIGHT_KEY:"ltr"===Craft.orientation?_this.selectNext():_this.selectPrev(),ev.preventDefault()}})),this.addListener(this.$options,"click",(function(ev){_this.select(_this.$options.index($(ev.currentTarget))),ev.preventDefault()}))},select:function select(index){index<0||index>=this.$options.length||index===this.selectedOptionIndex||(this.$selectedOption.removeClass(this.settings.selectedClass).attr("aria-selected","false"),this.$selectedOption=this.$options.eq(index).addClass(this.settings.selectedClass).attr("aria-selected","true"),this.selectedOptionIndex=index,this.settings.onChange(this.$selectedOption,index),this.trigger("change",{$selectedOption:this.$selectedOption,selectedOptionIndex:index}))},selectPrev:function selectPrev(){null===this.selectedOptionIndex?this.select(0):this.select(this.selectedOptionIndex-1)},selectNext:function selectNext(){null===this.selectedOptionIndex?this.select(0):this.select(this.selectedOptionIndex+1)}},{defaults:{selectedClass:"active",focusClass:"focus",onChange:$.noop}})},function(module,exports){Craft.LivePreview=Garnish.Base.extend({$extraFields:null,$trigger:null,$shade:null,$editorContainer:null,$editor:null,$dragHandle:null,$previewContainer:null,$iframeContainer:null,$iframe:null,$fieldPlaceholder:null,previewUrl:null,token:null,basePostData:null,inPreviewMode:!1,fields:null,lastPostData:null,updateIframeInterval:null,loading:!1,checkAgain:!1,dragger:null,dragStartEditorWidth:null,_slideInOnIframeLoad:!1,_forceUpdateIframeProxy:null,_scrollX:null,_scrollY:null,_editorWidth:null,_editorWidthInPx:null,init:function init(settings){var _this=this;this.setSettings(settings,Craft.LivePreview.defaults),this.settings.previewUrl?this.previewUrl=this.settings.previewUrl:this.previewUrl=Craft.baseSiteUrl.replace(/\/+$/,"")+"/","https:"===document.location.protocol&&(this.previewUrl=this.previewUrl.replace(/^http:/,"https:")),this.basePostData=$.extend({},this.settings.previewParams),this._forceUpdateIframeProxy=this.forceUpdateIframe.bind(this),this.$extraFields=$(this.settings.extraFields),this.$trigger=$(this.settings.trigger),this.$fieldPlaceholder=$("<div/>"),this.editorWidth=Craft.getLocalStorage("LivePreview.editorWidth",Craft.LivePreview.defaultEditorWidth),this.addListener(this.$trigger,"activate","toggle"),Craft.cp.on("beforeSaveShortcut",(function(){_this.inPreviewMode&&_this.moveFieldsBack()}))},get editorWidth(){return this._editorWidth},get editorWidthInPx(){return this._editorWidthInPx},set editorWidth(width){var inPx;width>=1?(inPx=width,width/=Garnish.$win.width()):inPx=Math.round(width*Garnish.$win.width()),inPx<Craft.LivePreview.minEditorWidthInPx&&(width=(inPx=Craft.LivePreview.minEditorWidthInPx)/Garnish.$win.width()),this._editorWidth=width,this._editorWidthInPx=inPx},toggle:function toggle(){this.inPreviewMode?this.exit():this.enter()},enter:function enter(){if(!this.inPreviewMode)if(this.token){if(this.trigger("beforeEnter"),$(document.activeElement).trigger("blur"),!this.$editor){this.$shade=$("<div/>",{class:"modal-shade dark"}).appendTo(Garnish.$bod),this.$previewContainer=$("<div/>",{class:"lp-preview-container"}).appendTo(Garnish.$bod),this.$iframeContainer=$("<div/>",{class:"lp-iframe-container"}).appendTo(this.$previewContainer),this.$editorContainer=$("<div/>",{class:"lp-editor-container"}).appendTo(Garnish.$bod);var $editorHeader=$("<header/>",{class:"flex"}).appendTo(this.$editorContainer);this.$editor=$("<form/>",{class:"lp-editor"}).appendTo(this.$editorContainer),this.$dragHandle=$("<div/>",{class:"lp-draghandle"}).appendTo(this.$editorContainer);var $closeBtn=$("<button/>",{type:"button",class:"btn",text:Craft.t("app","Close Preview")}).appendTo($editorHeader);$("<div/>",{class:"flex-grow"}).appendTo($editorHeader);var $saveBtn=$("<button/>",{type:"button",class:"btn submit",text:Craft.t("app","Save")}).appendTo($editorHeader);this.dragger=new Garnish.BaseDrag(this.$dragHandle,{axis:Garnish.X_AXIS,onDragStart:this._onDragStart.bind(this),onDrag:this._onDrag.bind(this),onDragStop:this._onDragStop.bind(this)}),this.addListener($closeBtn,"click","exit"),this.addListener($saveBtn,"click","save")}this.handleWindowResize(),this.addListener(Garnish.$win,"resize","handleWindowResize"),this.$editorContainer.css(Craft.left,-this.editorWidthInPx+"px"),this.$previewContainer.css(Craft.right,-this.getIframeWidth()),this.fields=[];for(var $fields=$(this.settings.fields),i=0;i<$fields.length;i++){var $field=$($fields[i]),$clone=this._getClone($field);this.$fieldPlaceholder.insertAfter($field),$field.detach(),this.$fieldPlaceholder.replaceWith($clone),$field.appendTo(this.$editor),this.fields.push({$field:$field,$clone:$clone})}this.updateIframe()?this._slideInOnIframeLoad=!0:this.slideIn(),Garnish.on(Craft.BaseElementEditor,"saveElement",this._forceUpdateIframeProxy),Garnish.on(Craft.AssetImageEditor,"save",this._forceUpdateIframeProxy),Craft.ElementThumbLoader.retryAll(),this.inPreviewMode=!0,this.trigger("enter")}else this.createToken()},createToken:function createToken(){var _this2=this;Craft.postActionRequest("live-preview/create-token",{previewAction:this.settings.previewAction},(function(response,textStatus){"success"===textStatus&&(_this2.token=response.token,_this2.enter())}))},save:function save(){Craft.cp.submitPrimaryForm()},handleWindowResize:function handleWindowResize(){this.editorWidth=this.editorWidth,this.updateWidths()},slideIn:function slideIn(){var _this3=this;$("html").addClass("noscroll"),this.$shade.velocity("fadeIn"),this.$editorContainer.show().velocity("stop").animateLeft(0,"slow",(function(){_this3.trigger("slideIn"),Garnish.$win.trigger("resize")})),this.$previewContainer.show().velocity("stop").animateRight(0,"slow",(function(){_this3.updateIframeInterval=setInterval(_this3.updateIframe.bind(_this3),1e3),_this3.addListener(Garnish.$bod,"keyup",(function(ev){ev.keyCode===Garnish.ESC_KEY&&this.exit()}))}))},exit:function exit(){var _this4=this;this.inPreviewMode&&(this.trigger("beforeExit"),$("html").removeClass("noscroll"),this.removeListener(Garnish.$win,"resize"),this.removeListener(Garnish.$bod,"keyup"),this.updateIframeInterval&&clearInterval(this.updateIframeInterval),this.moveFieldsBack(),this.$shade.delay(200).velocity("fadeOut"),this.$editorContainer.velocity("stop").animateLeft(-this.editorWidthInPx,"slow",(function(){for(var i=0;i<_this4.fields.length;i++)_this4.fields[i].$newClone.remove();_this4.$editorContainer.hide(),_this4.trigger("slideOut")})),this.$previewContainer.velocity("stop").animateRight(-this.getIframeWidth(),"slow",(function(){_this4.$previewContainer.hide()})),Garnish.off(Craft.BaseElementEditor,"saveElement",this._forceUpdateIframeProxy),Craft.ElementThumbLoader.retryAll(),this.inPreviewMode=!1,this.trigger("exit"))},moveFieldsBack:function moveFieldsBack(){for(var i=0;i<this.fields.length;i++){var field=this.fields[i];field.$newClone=this._getClone(field.$field),this.$fieldPlaceholder.insertAfter(field.$field),field.$field.detach(),this.$fieldPlaceholder.replaceWith(field.$newClone),field.$clone.replaceWith(field.$field)}Garnish.$win.trigger("resize")},getIframeWidth:function getIframeWidth(){return Garnish.$win.width()-this.editorWidthInPx},updateWidths:function updateWidths(){this.$editorContainer.css("width",this.editorWidthInPx+"px"),this.$previewContainer.width(this.getIframeWidth())},updateIframe:function updateIframe(force){if(force&&(this.lastPostData=null),!this.inPreviewMode)return!1;if(this.loading)return this.checkAgain=!0,!1;var postData=$.extend(Garnish.getPostData(this.$editor),Garnish.getPostData(this.$extraFields));if(this.lastPostData&&Craft.compare(postData,this.lastPostData,!1))return!1;this.lastPostData=postData,this.loading=!0;var $doc=this.$iframe?$(this.$iframe[0].contentWindow.document):null;return this._scrollX=$doc?$doc.scrollLeft():0,this._scrollY=$doc?$doc.scrollTop():0,$.ajax({url:this.previewUrl+(-1!==this.previewUrl.indexOf("?")?"&":"?")+Craft.tokenParam+"="+this.token,method:"POST",data:$.extend({},postData,this.basePostData),headers:{"X-Craft-Token":this.token},xhrFields:{withCredentials:!0},crossDomain:!0,success:this.handleSuccess.bind(this),error:this.handleError.bind(this)}),!0},forceUpdateIframe:function forceUpdateIframe(){return this.updateIframe(!0)},handleSuccess:function handleSuccess(data){var _this5=this,html=data+'<script type="text/javascript">window.scrollTo('+this._scrollX+", "+this._scrollY+");<\/script>",$iframe=$('<iframe class="lp-preview" frameborder="0"/>');this.$iframe?$iframe.insertBefore(this.$iframe):$iframe.appendTo(this.$iframeContainer),this.addListener($iframe,"load",(function(){this.$iframe&&this.$iframe.remove(),this.$iframe=$iframe,this._slideInOnIframeLoad&&(this.slideIn(),this._slideInOnIframeLoad=!1),this.removeListener($iframe,"load")})),Garnish.requestAnimationFrame((function(){$iframe[0].contentWindow.document.open(),$iframe[0].contentWindow.document.write(html),$iframe[0].contentWindow.document.close(),_this5.onResponse()}))},handleError:function handleError(){this.onResponse()},onResponse:function onResponse(){this.loading=!1,this.checkAgain&&(this.checkAgain=!1,this.updateIframe())},_getClone:function _getClone($field){var $clone=$field.clone();return Garnish.copyInputValues($field,$clone),$clone.attr("id",""),$clone.find("[id]").attr("id",""),$clone},_onDragStart:function _onDragStart(){this.dragStartEditorWidth=this.editorWidthInPx,this.$previewContainer.addClass("dragging")},_onDrag:function _onDrag(){"ltr"===Craft.orientation?this.editorWidth=this.dragStartEditorWidth+this.dragger.mouseDistX:this.editorWidth=this.dragStartEditorWidth-this.dragger.mouseDistX,this.updateWidths()},_onDragStop:function _onDragStop(){this.$previewContainer.removeClass("dragging"),Craft.setLocalStorage("LivePreview.editorWidth",this.editorWidth)}},{defaultEditorWidth:.33,minEditorWidthInPx:320,defaults:{trigger:".livepreviewbtn",fields:null,extraFields:null,previewUrl:null,previewAction:null,previewParams:{}}}),Craft.LivePreview.init=function(settings){Craft.livePreview=new Craft.LivePreview(settings)}},function(module,exports){Craft.PasswordInput=Garnish.Base.extend({$passwordWrapper:null,$passwordInput:null,$textInput:null,$currentInput:null,$showPasswordToggle:null,showingPassword:null,init:function init(passwordInput,settings){this.$passwordInput=$(passwordInput),this.$passwordWrapper=this.$passwordInput.parent(".passwordwrapper"),this.settings=$.extend({},Craft.PasswordInput.defaults,settings),this.$passwordInput.data("passwordInput")&&(Garnish.log("Double-instantiating a password input on an element"),this.$passwordInput.data("passwordInput").destroy()),this.$passwordInput.data("passwordInput",this),this.$showPasswordToggle=$('<button type="button" class="invisible" />'),this.$showPasswordToggle.addClass("password-toggle"),this.$showPasswordToggle.insertAfter(this.$passwordInput),this.initInputFocusEvents(this.$passwordInput),this.addListener(this.$showPasswordToggle,"click","onClick"),this.hidePassword()},setCurrentInput:function setCurrentInput($input){this.$currentInput&&($input.insertAfter(this.$currentInput),this.$currentInput.detach(),$input.trigger("focus"),$input.val(this.$currentInput.val())),this.$currentInput=$input,this.addListener(this.$currentInput,"keypress,keyup,change,blur","onInputChange")},updateToggleLabel:function updateToggleLabel(label){this.$showPasswordToggle.text(label)},initInputFocusEvents:function initInputFocusEvents($input){this.addListener($input,"focus",(function(){this.$passwordWrapper.addClass("focus")})),this.addListener($input,"blur",(function(){this.$passwordWrapper.removeClass("focus")}))},showPassword:function showPassword(){this.showingPassword||(this.$textInput||(this.$textInput=this.$passwordInput.clone(!0),this.$textInput.attr({type:"text",autocapitalize:"off"}),this.initInputFocusEvents(this.$textInput)),this.setCurrentInput(this.$textInput),this.updateToggleLabel(Craft.t("app","Hide")),this.showingPassword=!0)},hidePassword:function hidePassword(){!1!==this.showingPassword&&(this.setCurrentInput(this.$passwordInput),this.updateToggleLabel(Craft.t("app","Show")),this.showingPassword=!1,this.addListener(this.$passwordInput,"keydown","onKeyDown"))},togglePassword:function togglePassword(){this.showingPassword?this.hidePassword():this.showPassword(),this.settings.onToggleInput(this.$currentInput)},onKeyDown:function onKeyDown(ev){ev.keyCode===Garnish.ALT_KEY&&this.$currentInput.val()&&(this.showPassword(),this.$showPasswordToggle.addClass("invisible"),this.addListener(this.$textInput,"keyup","onKeyUp"))},onKeyUp:function onKeyUp(ev){ev.preventDefault(),ev.keyCode===Garnish.ALT_KEY&&(this.hidePassword(),this.$showPasswordToggle.removeClass("invisible"))},onInputChange:function onInputChange(){this.$currentInput.val()?this.$showPasswordToggle.removeClass("invisible"):this.$showPasswordToggle.addClass("invisible")},onClick:function onClick(ev){if(this.$currentInput[0].setSelectionRange){var selectionStart=this.$currentInput[0].selectionStart,selectionEnd=this.$currentInput[0].selectionEnd;this.togglePassword(),this.$currentInput[0].setSelectionRange(selectionStart,selectionEnd)}else this.togglePassword()}},{defaults:{onToggleInput:$.noop}})},function(module,exports){Craft.Preview=Garnish.Base.extend({draftEditor:null,$shade:null,$editorContainer:null,$editor:null,$spinner:null,$statusIcon:null,$dragHandle:null,$previewContainer:null,$iframeContainer:null,$previewHeader:null,$targetBtn:null,$targetMenu:null,$deviceTypeContainer:null,$orientationBtn:null,$refreshBtn:null,$deviceMask:null,$devicePreviewContainer:null,$iframe:null,iframeLoaded:!1,$tempInput:null,$fieldPlaceholder:null,isActive:!1,isVisible:!1,activeTarget:0,isDeviceUpdating:!1,deviceAnimationTimeout:null,currentDeviceType:"desktop",deviceOrientation:null,deviceWidth:"",deviceHeight:"",deviceMaskDimensions:{phone:{width:375,height:753},tablet:{width:768,height:1110}},draftId:null,url:null,fields:null,iframeHeight:null,scrollTop:null,dragger:null,dragStartEditorWidth:null,_updateIframeProxy:null,_editorWidth:null,_editorWidthInPx:null,init:function init(draftEditor){this.draftEditor=draftEditor,this._updateIframeProxy=this.updateIframe.bind(this),this.$tempInput=$("<input/>",{type:"hidden",name:"__PREVIEW_FIELDS__",value:"1"}),this.$fieldPlaceholder=$("<div/>"),this.editorWidth=Craft.getLocalStorage("LivePreview.editorWidth",Craft.Preview.defaultEditorWidth)},get editorWidth(){return this._editorWidth},get editorWidthInPx(){return this._editorWidthInPx},set editorWidth(width){var inPx;width>=1?(inPx=width,width/=Garnish.$win.width()):inPx=Math.round(width*Garnish.$win.width()),inPx<Craft.Preview.minEditorWidthInPx&&(width=(inPx=Craft.Preview.minEditorWidthInPx)/Garnish.$win.width()),this._editorWidth=width,this._editorWidthInPx=inPx},open:function open(){var _this=this;if(!this.isActive){if(this.isActive=!0,this.trigger("beforeOpen"),$(document.activeElement).trigger("blur"),!this.$editor){this.$shade=$("<div/>",{class:"modal-shade dark"}).appendTo(Garnish.$bod),this.$previewContainer=$("<div/>",{class:"lp-preview-container"}).appendTo(Garnish.$bod),this.$editorContainer=$("<div/>",{class:"lp-editor-container"}).appendTo(Garnish.$bod);var $editorHeader=$("<header/>",{class:"flex"}).appendTo(this.$editorContainer);this.$editor=$("<form/>",{class:"lp-editor"}).appendTo(this.$editorContainer),this.$dragHandle=$("<div/>",{class:"lp-draghandle"}).appendTo(this.$editorContainer);var $closeBtn=$("<button/>",{type:"button",class:"btn",text:Craft.t("app","Close Preview")}).appendTo($editorHeader);if($("<div/>",{class:"flex-grow"}).appendTo($editorHeader),this.$spinner=$("<div/>",{class:"spinner hidden",title:Craft.t("app","Saving")}).appendTo($editorHeader),this.$statusIcon=$("<div/>",{class:"invisible"}).appendTo($editorHeader),Craft.Pro){if(this.$previewHeader=$("<header/>",{class:"lp-preview-header"}).appendTo(this.$previewContainer),this.draftEditor.settings.previewTargets.length>1){this.$targetBtn=$("<button/>",{type:"button",class:"btn menubtn",text:this.draftEditor.settings.previewTargets[0].label}).appendTo(this.$previewHeader),this.$targetMenu=$("<div/>",{class:"menu lp-target-menu"}).insertAfter(this.$targetBtn);for(var $ul=$("<ul/>",{class:"padded"}).appendTo(this.$targetMenu),$li,$a,i=0;i<this.draftEditor.settings.previewTargets.length;i++)$li=$("<li/>").appendTo($ul),$a=$("<a/>",{data:{target:i},text:this.draftEditor.settings.previewTargets[i].label,class:0===i?"sel":null}).appendTo($li);new Garnish.MenuBtn(this.$targetBtn,{onOptionSelect:function onOptionSelect(option){_this.switchTarget($(option).data("target"))}}),$('<div class="flex-grow"/>').appendTo(this.$previewHeader)}this.$deviceTypeContainer=$("<div/>",{class:"btngroup lp-device-type",role:"listbox","aria-label":Craft.t("app","Device type"),tabindex:"0"}).appendTo(this.$previewHeader),$("<button/>",{type:"button",role:"option",class:"btn lp-device-type-btn--desktop active",title:Craft.t("app","Desktop"),"aria-label":Craft.t("app","Desktop"),"aria-selected":"true",tabindex:"-1",data:{width:"",height:"",deviceType:"desktop"}}).appendTo(this.$deviceTypeContainer),$("<button/>",{type:"button",role:"option",class:"btn lp-device-type-btn--tablet",title:Craft.t("app","Tablet"),"aria-label":Craft.t("app","Tablet"),"aria-selected":"false",tabindex:"-1",data:{width:768,height:1024,deviceType:"tablet"}}).appendTo(this.$deviceTypeContainer),$("<button/>",{type:"button",role:"option",class:"btn lp-device-type-btn--phone",title:Craft.t("app","Mobile"),"aria-label":Craft.t("app","Mobile"),"aria-selected":"false",tabindex:"-1",data:{width:375,height:667,deviceType:"phone"}}).appendTo(this.$deviceTypeContainer),$('<div class="flex-grow"/>').appendTo(this.$previewHeader);var $buttonContainer=$('<div class="buttons"/>').appendTo(this.$previewHeader);this.$orientationBtn=$("<button/>",{type:"button",class:"btn disabled","data-icon":"rotate",disabled:"","aria-hidden":"",text:Craft.t("app","Rotate")}).appendTo($buttonContainer),this.addListener(this.$orientationBtn,"click","switchOrientation"),this.$refreshBtn=$("<button/>",{type:"button",class:"btn hidden",text:Craft.t("app","Refresh"),"data-icon":"refresh"}).appendTo($buttonContainer),this._updateRefreshBtn(),this.addListener(this.$refreshBtn,"click",(function(){_this.updateIframe(!1,!0)})),this.deviceOrientation=Craft.getLocalStorage("LivePreview.orientation"),this.addListener($(".btn",this.$deviceTypeContainer),"click","switchDeviceType"),this.$deviceMask=$("<div/>",{class:"lp-device-mask"})}this.$iframeContainer=$("<div/>",{class:"lp-iframe-container"}).appendTo(this.$previewContainer),this.$deviceMask&&this.$iframeContainer.append(this.$deviceMask),this.dragger=new Garnish.BaseDrag(this.$dragHandle,{axis:Garnish.X_AXIS,onDragStart:this._onDragStart.bind(this),onDrag:this._onDrag.bind(this),onDragStop:this._onDragStop.bind(this)}),this.addListener($closeBtn,"click","close"),this.addListener(this.$statusIcon,"click",(function(){_this.draftEditor.showStatusHud(_this.$statusIcon)}))}this.handleWindowResize(),this.addListener(Garnish.$win,"resize","handleWindowResize"),this.$editorContainer.css(Craft.left,-this.editorWidthInPx+"px"),this.$previewContainer.css(Craft.right,-this.getIframeWidth()),this.fields=[];var $fields=$("#content .field").not($("#content .field .field"));if($fields.length){this.$tempInput.insertBefore($fields.get(0));for(var _i=0;_i<$fields.length;_i++){var $field=$($fields[_i]),$clone=this._getClone($field);this.$fieldPlaceholder.insertAfter($field),$field.detach(),this.$fieldPlaceholder.replaceWith($clone),$field.appendTo(this.$editor),this.fields.push({$field:$field,$clone:$clone})}}this.updateIframe(),this.draftEditor.on("update",this._updateIframeProxy),Garnish.on(Craft.BaseElementEditor,"saveElement",this._updateIframeProxy),Garnish.on(Craft.AssetImageEditor,"save",this._updateIframeProxy),Craft.ElementThumbLoader.retryAll(),this.trigger("open")}},_activeTarget:function _activeTarget(){return this.draftEditor.settings.previewTargets[this.activeTarget]},_updateRefreshBtn:function _updateRefreshBtn(){var target=this._activeTarget();"undefined"===target.refresh||target.refresh?this.$refreshBtn.addClass("hidden"):this.$refreshBtn.removeClass("hidden")},switchTarget:function switchTarget(i){this.activeTarget=i,this.$targetBtn.text(this.draftEditor.settings.previewTargets[i].label),this.$targetMenu.find("a.sel").removeClass("sel"),this.$targetMenu.find("a").eq(i).addClass("sel"),this.updateIframe(!0),this._updateRefreshBtn(),this.trigger("switchTarget",{previewTarget:this.draftEditor.settings.previewTargets[i]})},handleWindowResize:function handleWindowResize(){this.editorWidth=this.editorWidth,this.updateWidths()},slideIn:function slideIn(){var _this2=this;this.isActive&&!this.isVisible&&($("html").addClass("noscroll"),this.$shade.velocity("fadeIn"),this.$editorContainer.show().velocity("stop").animateLeft(0,"slow",(function(){_this2.trigger("slideIn"),Garnish.$win.trigger("resize")})),this.$previewContainer.show().velocity("stop").animateRight(0,"slow",(function(){_this2.addListener(Garnish.$bod,"keyup",(function(ev){ev.keyCode===Garnish.ESC_KEY&&this.close()}))})),this.isVisible=!0)},close:function close(){var _this3=this;this.isActive&&this.isVisible&&(this.trigger("beforeClose"),$("html").removeClass("noscroll"),this.removeListener(Garnish.$win,"resize"),this.removeListener(Garnish.$bod,"keyup"),this.$tempInput.detach(),this.moveFieldsBack(),this.$shade.delay(200).velocity("fadeOut"),this.$editorContainer.velocity("stop").animateLeft(-this.editorWidthInPx,"slow",(function(){for(var i=0;i<_this3.fields.length;i++)_this3.fields[i].$newClone.remove();_this3.$editorContainer.hide(),_this3.trigger("slideOut")})),this.$previewContainer.velocity("stop").animateRight(-this.getIframeWidth(),"slow",(function(){_this3.$previewContainer.hide(),_this3.resetDevicePreview()})),this.draftEditor.off("update",this._updateIframeProxy),Garnish.off(Craft.BaseElementEditor,"saveElement",this._updateIframeProxy),Garnish.off(Craft.AssetImageEditor,"save",this._updateIframeProxy),Craft.ElementThumbLoader.retryAll(),this.isActive=!1,this.isVisible=!1,this.trigger("close"))},moveFieldsBack:function moveFieldsBack(){for(var i=0;i<this.fields.length;i++){var field=this.fields[i];field.$newClone=this._getClone(field.$field),this.$fieldPlaceholder.insertAfter(field.$field),field.$field.detach(),this.$fieldPlaceholder.replaceWith(field.$newClone),field.$clone.replaceWith(field.$field)}Garnish.$win.trigger("resize"),Garnish.$doc.trigger("scroll")},getIframeWidth:function getIframeWidth(){return Garnish.$win.width()-this.editorWidthInPx},updateWidths:function updateWidths(){this.$editorContainer.css("width",this.editorWidthInPx+"px"),this.$previewContainer.width(this.getIframeWidth()),this._devicePreviewIsActive()&&this.updateDevicePreview()},_useIframeResizer:function _useIframeResizer(){return!1!==Craft.previewIframeResizerOptions},updateIframe:function updateIframe(resetScroll,forceRefresh){var _this4=this;if(!this.isActive)return!1;resetScroll=!0===resetScroll;var target=this._activeTarget(),refresh=!(!forceRefresh&&this.draftId===(this.draftId=this.draftEditor.settings.draftId)&&this.$iframe&&!resetScroll&&void 0!==target.refresh&&!target.refresh);this.trigger("beforeUpdateIframe",{previewTarget:target,resetScroll:resetScroll,refresh:refresh}),refresh?this.draftEditor.getTokenizedPreviewUrl(target.url,"x-craft-live-preview").then((function(url){var sameHost;resetScroll?_this4.scrollTop=null:_this4.iframeLoaded&&_this4.$iframe&&(_this4._useIframeResizer()?(_this4.iframeHeight=_this4.$iframe.height(),_this4.scrollTop=_this4.$iframeContainer.scrollTop()):(sameHost=Craft.isSameHost(url))&&_this4.$iframe[0].contentWindow&&(_this4.scrollTop=$(_this4.$iframe[0].contentWindow.document).scrollTop())),_this4.iframeLoaded=!1;var $iframe=$("<iframe/>",{class:"lp-preview",frameborder:0,src:url});_this4.$iframe?_this4.$iframe.replaceWith($iframe):$iframe.appendTo(_this4.$iframeContainer),_this4._devicePreviewIsActive()&&(_this4.$devicePreviewContainer||(_this4.$devicePreviewContainer=$("<div/>",{class:"lp-device-preview-container"}),$iframe.wrap('<div class="lp-device-preview-container"></div>'),_this4.$devicePreviewContainer=_this4.$iframeContainer.find(".lp-device-preview-container"))),_this4._useIframeResizer()?(resetScroll||null===_this4.iframeHeight||($iframe.height(_this4.iframeHeight),_this4.$iframeContainer.scrollTop(_this4.scrollTop)),iFrameResize($.extend({checkOrigin:!1,scrolling:!0,onInit:function onInit(iframe){_this4.iframeLoaded=!0,_this4.iframeHeight=null,_this4.scrollTop=null,iframe.scrolling="no"}},Craft.previewIframeResizerOptions||{}),$iframe[0])):$iframe.on("load",(function(){_this4.iframeLoaded=!0,!resetScroll&&sameHost&&null!==_this4.scrollTop&&$($iframe[0].contentWindow.document).scrollTop(_this4.scrollTop)})),_this4.url=url,_this4.$iframe=$iframe,_this4._devicePreviewIsActive()&&_this4.updateDevicePreview(),_this4.trigger("afterUpdateIframe",{previewTarget:_this4.draftEditor.settings.previewTargets[_this4.activeTarget],$iframe:_this4.$iframe}),_this4.slideIn()})):this.slideIn()},_devicePreviewIsActive:function _devicePreviewIsActive(){return"desktop"!==this.currentDeviceType},switchDeviceType:function switchDeviceType(ev){if(this.isDeviceUpdating)return!1;this.$iframeContainer.removeClass("lp-iframe-container--animating");var $btn=$(ev.target),newDeviceType=$btn.data("deviceType");if(newDeviceType===this.currentDeviceType)return!1;this.currentDeviceType=newDeviceType,this.deviceWidth=$btn.data("width"),this.deviceHeight=$btn.data("height"),this.$deviceTypeContainer.find(".btn").removeClass("active").attr("aria-selected","false"),$btn.addClass("active").attr("aria-selected","true"),"desktop"===this.currentDeviceType?this.resetDevicePreview():(this.$iframeContainer.addClass("lp-iframe-container--updating"),this.updateIframe(!0,!0),this.updateDevicePreview())},switchOrientation:function switchOrientation(){if(this.isDeviceUpdating||!this._devicePreviewIsActive())return!1;this.deviceOrientation&&"portrait"!==this.deviceOrientation?this.deviceOrientation="portrait":this.deviceOrientation="landscape",Craft.setLocalStorage("LivePreview.orientation",this.deviceOrientation),this.$iframeContainer.addClass("lp-iframe-container--animating"),this.updateDevicePreview()},updateDevicePreview:function updateDevicePreview(){var _this5=this;if(this.isDeviceUpdating)return!1;this.isDeviceUpdating=!0,this.$orientationBtn.removeClass("disabled").removeAttr("disabled").removeAttr("aria-hidden"),this.$iframeContainer.addClass("lp-iframe-container--has-device-preview"),"tablet"===this.currentDeviceType?this.$iframeContainer.addClass("lp-iframe-container--tablet"):this.$iframeContainer.removeClass("lp-iframe-container--tablet");var hZoom=1,wZoom=1,zoom=1,previewHeight=this.$previewContainer.height()-50-48,previewWidth=this.$previewContainer.width()-48,maskHeight=this.deviceMaskDimensions[this.currentDeviceType].height,maskWidth=this.deviceMaskDimensions[this.currentDeviceType].width;"landscape"===this.deviceOrientation?(previewWidth<maskHeight&&(hZoom=previewWidth/maskHeight),previewHeight<maskWidth&&(wZoom=previewHeight/maskWidth)):(previewHeight<maskHeight&&(hZoom=previewHeight/maskHeight),previewWidth<maskWidth&&(wZoom=previewWidth/maskWidth)),zoom=hZoom,wZoom<hZoom&&(zoom=wZoom);var translate=-100/zoom/2,rotationDeg="landscape"===this.deviceOrientation?"-90deg":"0deg";this.$deviceMask.css({width:this.deviceMaskDimensions[this.currentDeviceType].width+"px",height:this.deviceMaskDimensions[this.currentDeviceType].height+"px",transform:"scale("+zoom+") translate("+translate+"%, "+translate+"%) rotate("+rotationDeg+")"}),this.deviceAnimationTimeout&&clearTimeout(this.deviceAnimationTimeout),this.deviceAnimationTimeout=setTimeout((function(){"landscape"===_this5.deviceOrientation?_this5.$devicePreviewContainer.css({width:_this5.deviceHeight+"px",height:_this5.deviceWidth+"px",transform:"scale("+zoom+") translate("+translate+"%, "+translate+"%)",marginTop:0,marginLeft:"-"+12*zoom+"px"}):_this5.$devicePreviewContainer.css({width:_this5.deviceWidth+"px",height:_this5.deviceHeight+"px",transform:"scale("+zoom+") translate("+translate+"%, "+translate+"%)",marginTop:"-"+12*zoom+"px",marginLeft:0}),_this5.$iframeContainer.removeClass("lp-iframe-container--animating"),_this5.$iframeContainer.removeClass("lp-iframe-container--updating"),_this5.isDeviceUpdating=!1}),300)},resetDevicePreview:function resetDevicePreview(){this.deviceAnimationTimeout&&clearTimeout(this.deviceAnimationTimeout),this.currentDeviceType="desktop",this.$deviceTypeContainer.find(".btn").removeClass("active").attr("aria-selected","false"),this.$deviceTypeContainer.find(".lp-device-type-btn--desktop").addClass("active").attr("aria-selected","true"),this.$orientationBtn.addClass("disabled").attr("disabled","").attr("aria-hidden",""),this.$iframeContainer.removeClass("lp-iframe-container--animating"),this.$iframeContainer.removeClass("lp-iframe-container--has-device-preview"),this.$iframeContainer.removeClass("lp-iframe-container--tablet"),this.$devicePreviewContainer&&(this._useIframeResizer()&&this.$iframe[0].iFrameResizer.removeListeners(),this.$devicePreviewContainer.detach(),this.$devicePreviewContainer=null,this.$iframe=null,this.updateIframe(!0,!0)),this.isDeviceUpdating=!1},_getClone:function _getClone($field){var $clone=$field.clone();return Garnish.copyInputValues($field,$clone),$clone.attr("id",""),$clone.find("[id]").attr("id",""),$clone.find("[name]").prop("disabled",!0),$clone},_onDragStart:function _onDragStart(){this.dragStartEditorWidth=this.editorWidthInPx,this.$previewContainer.addClass("dragging")},_onDrag:function _onDrag(){"ltr"===Craft.orientation?this.editorWidth=this.dragStartEditorWidth+this.dragger.mouseDistX:this.editorWidth=this.dragStartEditorWidth-this.dragger.mouseDistX,this.updateWidths()},_onDragStop:function _onDragStop(){this.$previewContainer.removeClass("dragging"),Craft.setLocalStorage("LivePreview.editorWidth",this.editorWidth)}},{defaultEditorWidth:.33,minEditorWidthInPx:320})},function(module,exports){Craft.PreviewFileModal=Garnish.Modal.extend({assetId:null,$spinner:null,elementSelect:null,type:null,loaded:null,requestId:0,init:function init(assetId,elementSelect,settings){if((settings=$.extend(this.defaultSettings,settings)).onHide=this._onHide.bind(this),Craft.PreviewFileModal.openInstance){var instance=Craft.PreviewFileModal.openInstance;return instance.assetId!==assetId&&(instance.loadAsset(assetId,settings.startingWidth,settings.startingHeight),instance.elementSelect=elementSelect),this.destroy()}Craft.PreviewFileModal.openInstance=this,this.elementSelect=elementSelect,this.$container=$('<div class="modal previewmodal loading"/>').appendTo(Garnish.$bod),this.base(this.$container,$.extend({resizable:!0},settings)),this.$container&&(this.$container.velocity("stop"),this.$container.show().css("opacity",1),this.$shade.velocity("stop"),this.$shade.show().css("opacity",1)),this.loadAsset(assetId,settings.startingWidth,settings.startingHeight)},_onHide:function _onHide(){return Craft.PreviewFileModal.openInstance=null,this.elementSelect&&this.elementSelect.focusItem(this.elementSelect.$focusedItem),this.$shade.remove(),this.destroy()},selfDestruct:function selfDestruct(){var instance=Craft.PreviewFileModal.openInstance;return instance.hide(),instance.$shade.remove(),instance.destroy(),Craft.PreviewFileModal.openInstance=null,!0},loadAsset:function loadAsset(assetId,startingWidth,startingHeight){var _this=this;this.assetId=assetId,this.$container.empty(),this.loaded=!1,this.desiredHeight=null,this.desiredWidth=null;var containerHeight=.66*Garnish.$win.height(),containerWidth=Math.min(containerHeight/3*4,Garnish.$win.width()-2*this.settings.minGutter);if(containerHeight=containerWidth/4*3,startingWidth&&startingHeight){var ratio=startingWidth/startingHeight;containerWidth=Math.min(startingWidth,Garnish.$win.width()-2*this.settings.minGutter),(containerWidth=(containerHeight=Math.min(containerWidth/ratio,Garnish.$win.height()-2*this.settings.minGutter))*ratio)>Math.min(startingWidth,Garnish.$win.width()-2*this.settings.minGutter)&&(containerHeight=(containerWidth=Math.min(startingWidth,Garnish.$win.width()-2*this.settings.minGutter))/ratio)}this._resizeContainer(containerWidth,containerHeight),this.$spinner=$('<div class="spinner centeralign"></div>').appendTo(this.$container);var top=this.$container.height()/2-this.$spinner.height()/2+"px",left=this.$container.width()/2-this.$spinner.width()/2+"px";this.$spinner.css({left:left,top:top,position:"absolute"}),this.requestId++,Craft.postActionRequest("assets/preview-file",{assetId:assetId,requestId:this.requestId},(function(response,textStatus){if(_this.$container.removeClass("loading"),_this.$spinner.remove(),_this.loaded=!0,"success"===textStatus)if(response.success){if(response.requestId!=_this.requestId)return;if(!response.previewHtml)return _this.$container.addClass("zilch"),void _this.$container.append($("<p/>",{text:Craft.t("app","No preview available.")}));_this.$container.removeClass("zilch"),_this.$container.append(response.previewHtml),Craft.appendHeadHtml(response.headHtml),Craft.appendFootHtml(response.footHtml)}else alert(response.error),_this.hide()}))},_resizeContainer:function _resizeContainer(containerWidth,containerHeight){this.$container.css({width:containerWidth,"min-width":containerWidth,"max-width":containerWidth,height:containerHeight,"min-height":containerHeight,"max-height":containerHeight,top:(Garnish.$win.height()-containerHeight)/2,left:(Garnish.$win.width()-containerWidth)/2})}},{defaultSettings:{startingWidth:null,startingHeight:null}})},function(module,exports){Craft.ProgressBar=Garnish.Base.extend({$progressBar:null,$innerProgressBar:null,$progressBarStatus:null,_itemCount:0,_processedItemCount:0,_displaySteps:!1,init:function init($element,displaySteps){displaySteps&&(this._displaySteps=!0),this.$progressBar=$('<div class="progressbar pending hidden"/>').appendTo($element),this.$innerProgressBar=$('<div class="progressbar-inner"/>').appendTo(this.$progressBar),this.$progressBarStatus=$('<div class="progressbar-status hidden" />').insertAfter(this.$progressBar),this.resetProgressBar()},resetProgressBar:function resetProgressBar(){this.setProgressPercentage(100),this.$progressBar.addClass("pending"),this.setItemCount(1),this.setProcessedItemCount(0),this.$progressBarStatus.html(""),this._displaySteps&&this.$progressBar.addClass("has-status")},hideProgressBar:function hideProgressBar(){var _this=this;this.$progressBar.fadeTo("fast",.01,(function(){_this.$progressBar.addClass("hidden").fadeTo(1,1,$.noop)})),this.$progressBarStatus.fadeTo("fast",.01,(function(){_this.$progressBarStatus.addClass("hidden").fadeTo(1,1,$.noop)}))},showProgressBar:function showProgressBar(){this.$progressBar.removeClass("hidden"),this.$progressBarStatus.removeClass("hidden")},setItemCount:function setItemCount(count){this._itemCount=count},incrementItemCount:function incrementItemCount(count){this._itemCount+=count},setProcessedItemCount:function setProcessedItemCount(count){this._processedItemCount=count},incrementProcessedItemCount:function incrementProcessedItemCount(count){this._processedItemCount+=count},updateProgressBar:function updateProgressBar(){this._itemCount=Math.max(this._itemCount,1);var width=Math.min(100,Math.round(100*this._processedItemCount/this._itemCount));this.setProgressPercentage(width),this._displaySteps&&this.$progressBarStatus.html(this._processedItemCount+" / "+this._itemCount)},setProgressPercentage:function setProgressPercentage(percentage,animate){0===percentage?this.$progressBar.addClass("pending"):(this.$progressBar.removeClass("pending"),animate?this.$innerProgressBar.velocity("stop").velocity({width:percentage+"%"},"fast"):this.$innerProgressBar.velocity("stop").width(percentage+"%"))}})},function(module,exports){Craft.PromptHandler=Garnish.Base.extend({modal:null,$modalContainerDiv:null,$prompt:null,$promptApplyToRemainingContainer:null,$promptApplyToRemainingCheckbox:null,$promptApplyToRemainingLabel:null,$pomptChoices:null,_prompts:[],_promptBatchCallback:$.noop,_promptBatchReturnData:[],_promptBatchNum:0,resetPrompts:function resetPrompts(){this._prompts=[],this._promptBatchCallback=$.noop,this._promptBatchReturnData=[],this._promptBatchNum=0},addPrompt:function addPrompt(prompt){this._prompts.push(prompt)},getPromptCount:function getPromptCount(){return this._prompts.length},showBatchPrompts:function showBatchPrompts(callback){this._promptBatchCallback=callback,this._promptBatchReturnData=[],this._promptBatchNum=0,this._showNextPromptInBatch()},_showNextPromptInBatch:function _showNextPromptInBatch(){var prompt=this._prompts[this._promptBatchNum].prompt,remainingInBatch=this._prompts.length-(this._promptBatchNum+1);this._showPrompt(prompt.message,prompt.choices,this._handleBatchPromptSelection.bind(this),remainingInBatch)},_handleBatchPromptSelection:function _handleBatchPromptSelection(choice,applyToRemaining){var prompt=this._prompts[this._promptBatchNum],remainingInBatch=this._prompts.length-(this._promptBatchNum+1),choiceData=$.extend(prompt,{choice:choice});this._promptBatchReturnData.push(choiceData),remainingInBatch?(this._promptBatchNum++,applyToRemaining?this._handleBatchPromptSelection(choice,!0):this._showNextPromptInBatch()):"function"==typeof this._promptBatchCallback&&this._promptBatchCallback(this._promptBatchReturnData)},_showPrompt:function _showPrompt(message,choices,callback,itemsToGo){this._promptCallback=callback,null===this.modal&&(this.modal=new Garnish.Modal({closeOtherModals:!1})),null===this.$modalContainerDiv&&(this.$modalContainerDiv=$('<div class="modal fitted prompt-modal"></div>').addClass().appendTo(Garnish.$bod)),this.$prompt=$('<div class="body"></div>').appendTo(this.$modalContainerDiv.empty()),this.$promptMessage=$('<p class="prompt-msg"/>').appendTo(this.$prompt),this.$promptChoices=$('<div class="options"></div>').appendTo(this.$prompt),this.$promptApplyToRemainingContainer=$('<label class="assets-applytoremaining"/>').appendTo(this.$prompt).hide(),this.$promptApplyToRemainingCheckbox=$('<input type="checkbox"/>').appendTo(this.$promptApplyToRemainingContainer),this.$promptApplyToRemainingLabel=$("<span/>").appendTo(this.$promptApplyToRemainingContainer),this.$promptButtons=$('<div class="buttons right"/>').appendTo(this.$prompt),this.modal.setContainer(this.$modalContainerDiv),this.$promptMessage.html(message);for(var $cancelBtn=$("<button/>",{type:"button",class:"btn",text:Craft.t("app","Cancel")}).appendTo(this.$promptButtons),$submitBtn=$("<button/>",{type:"submit",class:"btn submit disabled",text:Craft.t("app","OK")}).appendTo(this.$promptButtons),i=0;i<choices.length;i++){var $radioButtonHtml,$radioButton=$('<div><label><input type="radio" name="promptAction" value="'+choices[i].value+'"/> '+choices[i].title+"</label></div>").appendTo(this.$promptChoices).find("input");this.addListener($radioButton,"click",(function(){$submitBtn.removeClass("disabled")}))}this.addListener($submitBtn,"activate",(function(ev){var choice=$(ev.currentTarget).parents(".modal").find("input[name=promptAction]:checked").val(),applyToRemaining=this.$promptApplyToRemainingCheckbox.prop("checked");this._selectPromptChoice(choice,applyToRemaining)})),this.addListener($cancelBtn,"activate",(function(){var choice="cancel",applyToRemaining=this.$promptApplyToRemainingCheckbox.prop("checked");this._selectPromptChoice(choice,applyToRemaining)})),itemsToGo&&(this.$promptApplyToRemainingContainer.show(),this.$promptApplyToRemainingLabel.html(" "+Craft.t("app","Apply this to the {number} remaining conflicts?",{number:itemsToGo}))),this.modal.show(),this.modal.removeListener(Garnish.Modal.$shade,"click"),this.addListener(Garnish.Modal.$shade,"click","_cancelPrompt")},_selectPromptChoice:function _selectPromptChoice(choice,applyToRemaining){var _this=this;this.$prompt.fadeOut("fast",(function(){_this.modal.hide(),_this._promptCallback(choice,applyToRemaining)}))},_cancelPrompt:function _cancelPrompt(){this._selectPromptChoice("cancel",!0)}})},function(module,exports){!function($){Craft.SlidePicker=Garnish.Base.extend({min:null,max:null,totalSteps:null,value:null,$container:null,$buttons:null,init:function init(value,settings){var _this=this;this.setSettings(settings,Craft.SlidePicker.defaults),this.$container=$("<div/>",{class:"slide-picker",role:"slider",tabindex:0}),this.refresh(),this.setValue(value,!1),this.addListener(this.$container,"keydown",(function(ev){switch(ev.keyCode){case Garnish.UP_KEY:_this.setValue(_this.value+_this.settings.step),ev.preventDefault();break;case Garnish.DOWN_KEY:_this.setValue(_this.value-_this.settings.step),ev.preventDefault();break;case Garnish.RIGHT_KEY:"ltr"===Craft.orientation?_this.setValue(_this.value+_this.settings.step):_this.setValue(_this.value-_this.settings.step),ev.preventDefault();break;case Garnish.LEFT_KEY:"ltr"===Craft.orientation?_this.setValue(_this.value-_this.settings.step):_this.setValue(_this.value+_this.settings.step),ev.preventDefault()}}))},refresh:function refresh(){var _this2=this;if(this.min=this._min(),this.max=this._max(),this.totalSteps=(this.max-this.min)/this.settings.step,!Number.isInteger(this.totalSteps))throw"Invalid SlidePicker config";this.$buttons&&this.$buttons.remove(),this.$container.attr("aria-valuemin",this.min),this.$container.attr("aria-valuemax",this.max),this.$buttons=$();for(var value=this.min;value<=this.max;value+=this.settings.step)this.$buttons=this.$buttons.add($("<a/>",{title:this.settings.valueLabel(value),data:{value:value}}));if(this.$buttons.appendTo(this.$container),null!==this.value){var _value=this.value;this.value=null,this.setValue(_value,!1)}this.addListener(this.$buttons,"mouseover",(function(ev){_this2.$buttons.removeClass("active-hover last-active-hover"),$(ev.currentTarget).addClass("active-hover last-active-hover").prevAll().addClass("active-hover")})),this.addListener(this.$buttons,"mouseout",(function(){_this2.$buttons.removeClass("active-hover")})),this.addListener(this.$buttons,"click",(function(ev){_this2.setValue($.data(ev.currentTarget,"value")),ev.stopPropagation(),_this2.$container.focus()}))},setValue:function setValue(value,triggerEvent){if(value=Math.max(Math.min(value,this.max),this.min),this.value!==(this.value=value)){this.$container.attr({"aria-valuenow":this.value,"aria-valuetext":this.settings.valueLabel(this.value)}),this.$buttons.removeClass("last-active active");var $activeButton=this.$buttons.eq((this.value-this.min)/this.settings.step);$activeButton.add($activeButton.prevAll()).addClass("active"),$activeButton.addClass("last-active"),!1!==triggerEvent&&this.settings.onChange(value)}},_min:function _min(){return"function"==typeof this.settings.min?this.settings.min():this.settings.min},_max:function _max(){return"function"==typeof this.settings.max?this.settings.max():this.settings.max}},{defaults:{min:0,max:100,step:10,valueLabel:null,onChange:$.noop}})}(jQuery)},function(module,exports){Craft.SlideRuleInput=Garnish.Base.extend({$container:null,$options:null,$selectedOption:null,$input:null,value:null,startPositionX:null,init:function init(id,settings){var _this=this;this.setSettings(settings,Craft.SlideRuleInput.defaultSettings),this.value=0,this.graduationsMin=-70,this.graduationsMax=70,this.slideMin=-45,this.slideMax=45,this.$container=$("#"+id),this.$overlay=$('<div class="overlay"></div>').appendTo(this.$container),this.$cursor=$('<div class="cursor"></div>').appendTo(this.$container),this.$graduations=$('<div class="graduations"></div>').appendTo(this.$container),this.$graduationsUl=$("<ul></ul>").appendTo(this.$graduations);for(var i=this.graduationsMin;i<=this.graduationsMax;i++){var $li=$('<li class="graduation" data-graduation="'+i+'"><div class="label">'+i+"</div></li>").appendTo(this.$graduationsUl);i%5==0&&$li.addClass("main-graduation"),0===i&&$li.addClass("selected")}this.$options=this.$container.find(".graduation"),this.addListener(this.$container,"resize",this._handleResize.bind(this)),this.addListener(this.$container,"tapstart",this._handleTapStart.bind(this)),this.addListener(Garnish.$bod,"tapmove",this._handleTapMove.bind(this)),this.addListener(Garnish.$bod,"tapend",this._handleTapEnd.bind(this)),setTimeout((function(){_this.graduationsCalculatedWidth=10*(_this.$options.length-1),_this.$graduationsUl.css("left",-_this.graduationsCalculatedWidth/2+_this.$container.width()/2)}),50)},_handleResize:function _handleResize(){var left=this.valueToPosition(this.value);this.$graduationsUl.css("left",left)},_handleTapStart:function _handleTapStart(ev,touch){ev.preventDefault(),this.startPositionX=touch.position.x,this.startLeft=this.$graduationsUl.position().left,this.dragging=!0,this.onStart()},_handleTapMove:function _handleTapMove(ev,touch){if(this.dragging){ev.preventDefault();var curX=this.startPositionX-touch.position.x,left=this.startLeft-curX,value=this.positionToValue(left);this.setValue(value),this.onChange()}},setValue:function setValue(value){var left=this.valueToPosition(value);value<this.slideMin?(value=this.slideMin,left=this.valueToPosition(value)):value>this.slideMax&&(value=this.slideMax,left=this.valueToPosition(value)),this.$graduationsUl.css("left",left),value>=this.slideMin&&value<=this.slideMax&&(this.$options.removeClass("selected"),$.each(this.$options,(function(key,option){$(option).data("graduation")>0&&$(option).data("graduation")<=value&&$(option).addClass("selected"),$(option).data("graduation")<0&&$(option).data("graduation")>=value&&$(option).addClass("selected"),0==$(option).data("graduation")&&$(option).addClass("selected")}))),this.value=value},_handleTapEnd:function _handleTapEnd(ev){this.dragging&&(ev.preventDefault(),this.dragging=!1,this.onEnd())},positionToValue:function positionToValue(position){var scaleMin=-1*this.graduationsMin,scaleMax=-1*(this.graduationsMin-this.graduationsMax);return(this.$graduations.width()/2+-1*position)/this.graduationsCalculatedWidth*scaleMax-scaleMin},valueToPosition:function valueToPosition(value){var scaleMin=-1*this.graduationsMin,scaleMax=-1*(this.graduationsMin-this.graduationsMax);return-((value+scaleMin)*this.graduationsCalculatedWidth/scaleMax-this.$graduations.width()/2)},onStart:function onStart(){"function"==typeof this.settings.onChange&&this.settings.onStart(this)},onChange:function onChange(){"function"==typeof this.settings.onChange&&this.settings.onChange(this)},onEnd:function onEnd(){"function"==typeof this.settings.onChange&&this.settings.onEnd(this)},defaultSettings:{onStart:$.noop,onChange:$.noop,onEnd:$.noop}})},function(module,exports){Craft.SlugGenerator=Craft.BaseInputGenerator.extend({generateTargetValue:function generateTargetValue(sourceVal){sourceVal=(sourceVal=sourceVal.replace(/<(.*?)>/g,"")).replace(/['"‘’“”\[\]\(\)\{\}:]/g,""),Craft.allowUppercaseInSlug||(sourceVal=sourceVal.toLowerCase()),Craft.limitAutoSlugsToAscii&&(sourceVal=Craft.asciiString(sourceVal,this.settings.charMap));var words=Craft.filterArray(XRegExp.matchChain(sourceVal,[XRegExp("[\\p{L}\\p{N}\\p{M}]+")]));return words.length?words.join(Craft.slugWordSeparator):""}})},function(module,exports){Craft.Structure=Garnish.Base.extend({id:null,$container:null,state:null,structureDrag:null,init:function init(id,container,settings){this.id=id,this.$container=$(container),this.setSettings(settings,Craft.Structure.defaults),this.$container.data("structure")&&(Garnish.log("Double-instantiating a structure on an element"),this.$container.data("structure").destroy()),this.$container.data("structure",this),this.state={},this.settings.storageKey&&$.extend(this.state,Craft.getLocalStorage(this.settings.storageKey,{})),void 0===this.state.collapsedElementIds&&(this.state.collapsedElementIds=[]);for(var $parents=this.$container.find("ul").prev(".row"),i=0;i<$parents.length;i++){var $row=$($parents[i]),$li=$row.parent(),$toggle=$('<div class="toggle" title="'+Craft.t("app","Show/hide children")+'"/>').prependTo($row);-1!==$.inArray($row.children(".element").data("id"),this.state.collapsedElementIds)&&$li.addClass("collapsed"),this.initToggle($toggle)}this.settings.sortable&&(this.structureDrag=new Craft.StructureDrag(this,this.settings.maxLevels)),this.settings.newChildUrl&&this.initNewChildMenus(this.$container.find(".add"))},initToggle:function initToggle($toggle){var _this=this;$toggle.on("click",(function(ev){var $li=$(ev.currentTarget).closest("li"),elementId=$li.children(".row").find(".element:first").data("id"),viewStateKey=$.inArray(elementId,_this.state.collapsedElementIds);$li.hasClass("collapsed")?($li.removeClass("collapsed"),-1!==viewStateKey&&_this.state.collapsedElementIds.splice(viewStateKey,1)):($li.addClass("collapsed"),-1===viewStateKey&&_this.state.collapsedElementIds.push(elementId)),_this.settings.storageKey&&Craft.setLocalStorage(_this.settings.storageKey,_this.state)}))},initNewChildMenus:function initNewChildMenus($addBtns){this.addListener($addBtns,"click","onNewChildMenuClick")},onNewChildMenuClick:function onNewChildMenuClick(ev){var $btn=$(ev.currentTarget);if(!$btn.data("menubtn")){var elementId=$btn.parent().children(".element").data("id"),newChildUrl=Craft.getUrl(this.settings.newChildUrl,"parentId="+elementId),menuBtn;$('<div class="menu"><ul><li><a href="'+newChildUrl+'">'+Craft.t("app","New child")+"</a></li></ul></div>").insertAfter($btn),new Garnish.MenuBtn($btn).showMenu()}},getIndent:function getIndent(level){return Craft.Structure.baseIndent+(level-1)*Craft.Structure.nestedIndent},addElement:function addElement($element){var $li=$('<li data-level="1"/>').appendTo(this.$container),$row=$('<div class="row" style="margin-'+Craft.left+": -"+Craft.Structure.baseIndent+"px; padding-"+Craft.left+": "+Craft.Structure.baseIndent+'px;">').appendTo($li);if($row.append($element),this.settings.sortable&&($row.append('<a class="move icon" title="'+Craft.t("app","Move")+'"></a>'),this.structureDrag.addItems($li)),this.settings.newChildUrl){var $addBtn=$('<a class="add icon" title="'+Craft.t("app","New child")+'"></a>').appendTo($row);this.initNewChildMenus($addBtn)}$row.css("margin-bottom",-30),$row.velocity({"margin-bottom":0},"fast")},removeElement:function removeElement($element){var _this2=this,$li=$element.parent().parent(),$parentUl;this.settings.sortable&&this.structureDrag.removeItems($li),$li.siblings().length||($parentUl=$li.parent()),$li.css("visibility","hidden").velocity({marginBottom:-$li.height()},"fast",(function(){$li.remove(),void 0!==$parentUl&&_this2._removeUl($parentUl)}))},_removeUl:function _removeUl($ul){$ul.siblings(".row").children(".toggle").remove(),$ul.remove()}},{baseIndent:8,nestedIndent:35,defaults:{storageKey:null,sortable:!1,newChildUrl:null,maxLevels:null}})},function(module,exports){Craft.StructureDrag=Garnish.Drag.extend({structure:null,maxLevels:null,draggeeLevel:null,$helperLi:null,$targets:null,draggeeHeight:null,init:function init(structure,maxLevels){this.structure=structure,this.maxLevels=maxLevels,this.$insertion=$('<li class="draginsertion"/>');var $items=this.structure.$container.find("li");this.base($items,{handle:".element:first, .move:first",helper:this.getHelper.bind(this)})},getHelper:function getHelper($helper){this.$helperLi=$helper;var $ul=$('<ul class="structure draghelper"/>').append($helper);return $helper.css("padding-"+Craft.left,this.$draggee.css("padding-"+Craft.left)),$helper.find(".move").removeAttr("title"),$ul},onDragStart:function onDragStart(){var _this=this;this.$targets=$(),this.findTargets(this.structure.$container),this.draggeeLevel=0;var $level=this.$draggee;do{this.draggeeLevel++,$level=$level.find("> ul > li")}while($level.length);this.draggeeHeight=this.$draggee.height(),this.$draggee.velocity({height:0},"fast",(function(){_this.$draggee.addClass("hidden")})),this.base(),this.addListener(Garnish.$doc,"keydown",(function(ev){ev.keyCode===Garnish.ESC_KEY&&this.cancelDrag()}))},findTargets:function findTargets($ul){for(var $lis=$ul.children().not(this.$draggee),i=0;i<$lis.length;i++){var $li=$($lis[i]);this.$targets=this.$targets.add($li.children(".row")),$li.hasClass("collapsed")||this.findTargets($li.children("ul"))}},onDrag:function onDrag(){for(this._.$closestTarget&&(this._.$closestTarget.removeClass("draghover"),this.$insertion.remove()),this._.$closestTarget=null,this._.closestTargetPos=null,this._.closestTargetYDiff=null,this._.closestTargetOffset=null,this._.closestTargetHeight=null,this._.i=0;this._.i<this.$targets.length&&(this._.$target=$(this.$targets[this._.i]),this._.targetOffset=this._.$target.offset(),this._.targetHeight=this._.$target.outerHeight(),this._.targetYMidpoint=this._.targetOffset.top+this._.targetHeight/2,this._.targetYDiff=Math.abs(this.mouseY-this._.targetYMidpoint),0===this._.i||this.mouseY>=this._.targetOffset.top+5&&this._.targetYDiff<this._.closestTargetYDiff);this._.i++)this._.$closestTarget=this._.$target,this._.closestTargetPos=this._.i,this._.closestTargetYDiff=this._.targetYDiff,this._.closestTargetOffset=this._.targetOffset,this._.closestTargetHeight=this._.targetHeight;if(this._.$closestTarget)if(0===this._.closestTargetPos&&this.mouseY<this._.closestTargetOffset.top+5)this.$insertion.prependTo(this.structure.$container);else if(this._.$closestTargetLi=this._.$closestTarget.parent(),this._.closestTargetLevel=this._.$closestTargetLi.data("level"),this._.closestTargetPos<this.$targets.length-1?(this._.$nextTargetLi=$(this.$targets[this._.closestTargetPos+1]).parent(),this._.nextTargetLevel=this._.$nextTargetLi.data("level")):(this._.$nextTargetLi=null,this._.nextTargetLevel=null),this._.hoveringBetweenRows=this.mouseY>=this._.closestTargetOffset.top+this._.closestTargetHeight-5,this._.$nextTargetLi&&this._.nextTargetLevel==this._.closestTargetLevel)this._.hoveringBetweenRows?(!this.maxLevels||this.maxLevels>=this._.closestTargetLevel+this.draggeeLevel-1)&&this.$insertion.insertAfter(this._.$closestTargetLi):(!this.maxLevels||this.maxLevels>=this._.closestTargetLevel+this.draggeeLevel)&&this._.$closestTarget.addClass("draghover");else if(this._.$nextTargetLi&&this._.nextTargetLevel>this._.closestTargetLevel)(!this.maxLevels||this.maxLevels>=this._.nextTargetLevel+this.draggeeLevel-1)&&(this._.hoveringBetweenRows?this.$insertion.insertBefore(this._.$nextTargetLi):(this._.$closestTarget.addClass("draghover"),this.$insertion.appendTo(this._.$closestTargetLi.children("ul"))));else if(this._.hoveringBetweenRows){for(this._.draggeeX=this.mouseX-this.targetItemMouseDiffX,"rtl"===Craft.orientation&&(this._.draggeeX+=this.$helperLi.width()),this._.$parentLis=this._.$closestTarget.parentsUntil(this.structure.$container,"li"),this._.$closestParentLi=null,this._.closestParentLiXDiff=null,this._.closestParentLevel=null,this._.i=0;this._.i<this._.$parentLis.length;this._.i++)this._.$parentLi=$(this._.$parentLis[this._.i]),this._.parentLiX=this._.$parentLi.offset().left,"rtl"===Craft.orientation&&(this._.parentLiX+=this._.$parentLi.width()),this._.parentLiXDiff=Math.abs(this._.parentLiX-this._.draggeeX),this._.parentLevel=this._.$parentLi.data("level"),(!this.maxLevels||this.maxLevels>=this._.parentLevel+this.draggeeLevel-1)&&(!this._.$closestParentLi||this._.parentLiXDiff<this._.closestParentLiXDiff&&(!this._.$nextTargetLi||this._.parentLevel>=this._.nextTargetLevel))&&(this._.$closestParentLi=this._.$parentLi,this._.closestParentLiXDiff=this._.parentLiXDiff,this._.closestParentLevel=this._.parentLevel);this._.$closestParentLi&&this.$insertion.insertAfter(this._.$closestParentLi)}else(!this.maxLevels||this.maxLevels>=this._.closestTargetLevel+this.draggeeLevel)&&this._.$closestTarget.addClass("draghover")},cancelDrag:function cancelDrag(){this.$insertion.remove(),this._.$closestTarget&&this._.$closestTarget.removeClass("draghover"),this.onMouseUp()},onDragStop:function onDragStop(){var _this2=this;if(this._.$closestTarget&&(this.$insertion.parent().length||this._.$closestTarget.hasClass("draghover"))){var $draggeeParent,moved;if(this.$draggee.siblings().length||($draggeeParent=this.$draggee.parent()),this.$insertion.parent().length){var $closestSiblings=this.$insertion.next().add(this.$insertion.prev());-1===$.inArray(this.$draggee[0],$closestSiblings)?(this.$insertion.replaceWith(this.$draggee),moved=!0):(this.$insertion.remove(),moved=!1)}else{var $ul=this._.$closestTargetLi.children("ul");if($draggeeParent&&$ul.length&&$ul[0]===$draggeeParent[0])moved=!1;else{if($ul.length)this._.$closestTargetLi.hasClass("collapsed")&&this._.$closestTarget.children(".toggle").trigger("click");else{var $toggle=$('<div class="toggle" title="'+Craft.t("app","Show/hide children")+'"/>').prependTo(this._.$closestTarget);this.structure.initToggle($toggle),$ul=$("<ul>").appendTo(this._.$closestTargetLi)}this.$draggee.appendTo($ul),moved=!0}}if(this._.$closestTarget.removeClass("draghover"),moved){$draggeeParent&&this.structure._removeUl($draggeeParent);var newLevel=this.$draggee.parentsUntil(this.structure.$container,"li").length+1,animateCss;newLevel!=this.$draggee.data("level")&&(1==this.$draggee.data("level")?((animateCss={})["padding-"+Craft.left]=38,this.$helperLi.velocity(animateCss,"fast")):1==newLevel&&((animateCss={})["padding-"+Craft.left]=Craft.Structure.baseIndent,this.$helperLi.velocity(animateCss,"fast")),this.setLevel(this.$draggee,newLevel));var $element=this.$draggee.children(".row").children(".element"),data={structureId:this.structure.id,elementId:$element.data("id"),siteId:$element.data("site-id"),prevId:this.$draggee.prev().children(".row").children(".element").data("id"),parentId:this.$draggee.parent("ul").parent("li").children(".row").children(".element").data("id")};Craft.postActionRequest("structures/move-element",data,(function(response,textStatus){"success"===textStatus&&Craft.cp.displayNotice(Craft.t("app","New order saved."))}))}}this.$draggee.velocity("stop").removeClass("hidden").velocity({height:this.draggeeHeight},"fast",(function(){_this2.$draggee.css("height","auto")})),this.returnHelpersToDraggees(),this.base()},setLevel:function setLevel($li,level){$li.data("level",level);var indent=this.structure.getIndent(level),css={};css["margin-"+Craft.left]="-"+indent+"px",css["padding-"+Craft.left]=indent+"px",this.$draggee.children(".row").css(css);for(var $childLis=$li.children("ul").children(),i=0;i<$childLis.length;i++)this.setLevel($($childLis[i]),level+1)}})},function(module,exports){Craft.StructureTableSorter=Garnish.DragSort.extend({tableView:null,structureId:null,maxLevels:null,_basePadding:null,_helperMargin:null,_$firstRowCells:null,_$titleHelperCell:null,_titleHelperCellOuterWidth:null,_ancestors:null,_updateAncestorsFrame:null,_draggeeLevel:null,_draggeeLevelDelta:null,draggingLastElements:null,_loadingDraggeeLevelDelta:!1,_targetLevel:null,_targetLevelBounds:null,_positionChanged:null,init:function init(tableView,$elements,settings){this.tableView=tableView,this.structureId=this.tableView.$table.data("structure-id"),this.maxLevels=parseInt(this.tableView.$table.attr("data-max-levels")),this._basePadding=14+(this.tableView.elementIndex.actions?14:24),this._helperMargin=this.tableView.elementIndex.actions?54:0,settings=$.extend({},Craft.StructureTableSorter.defaults,settings,{handle:".move",collapseDraggees:!0,singleHelper:!0,helperSpacingY:2,magnetStrength:4,helper:this.getHelper.bind(this),helperLagBase:1.5,axis:Garnish.Y_AXIS}),this.base($elements,settings)},findDraggee:function findDraggee(){var _this=this;this._draggeeLevel=this._targetLevel=this.$targetItem.data("level"),this._draggeeLevelDelta=0;for(var $draggee=$(this.$targetItem),$nextRow=this.$targetItem.next();$nextRow.length;){var nextRowLevel=$nextRow.data("level");if(nextRowLevel<=this._draggeeLevel)break;var nextRowLevelDelta=nextRowLevel-this._draggeeLevel;nextRowLevelDelta>this._draggeeLevelDelta&&(this._draggeeLevelDelta=nextRowLevelDelta),$draggee=$draggee.add($nextRow),$nextRow=$nextRow.next()}if(this.draggingLastElements=!$nextRow.length,this.maxLevels&&this.draggingLastElements&&this.tableView.getMorePending()){this._loadingDraggeeLevelDelta=!0;var data=this._getAjaxBaseData(this.$targetItem);Craft.postActionRequest("structures/get-element-level-delta",data,(function(response,textStatus){"success"===textStatus&&(_this._loadingDraggeeLevelDelta=!1,_this.dragging&&(_this._draggeeLevelDelta=response.delta,_this.drag(!1)))}))}return $draggee},getHelper:function getHelper($helperRow){var $outerContainer=$('<div class="elements datatablesorthelper"/>').appendTo(Garnish.$bod),$innerContainer=$('<div class="tableview"/>').appendTo($outerContainer),$table=$('<table class="data"/>').appendTo($innerContainer),$tbody=$("<tbody/>").appendTo($table);$helperRow.appendTo($tbody),this._$firstRowCells=this.tableView.$elementContainer.children("tr:first").children();for(var $helperCells=$helperRow.children(),i=0;i<$helperCells.length;i++){var $helperCell=$($helperCells[i]);if($helperCell.hasClass("checkbox-cell"))$helperCell.remove();else{var $firstRowCell=$(this._$firstRowCells[i]),width=$firstRowCell[0].getBoundingClientRect().width;if($firstRowCell.css("width",width+"px"),$helperCell.css("width",width+"px"),Garnish.hasAttr($firstRowCell,"data-titlecell")){this._$titleHelperCell=$helperCell;var padding=parseInt($firstRowCell.css("padding-"+Craft.left));this._titleHelperCellOuterWidth=width,$helperCell.css("padding-"+Craft.left,this._basePadding)}}}return $outerContainer},canInsertBefore:function canInsertBefore($item){return!this._loadingDraggeeLevelDelta&&!1!==this._getLevelBounds($item.prev(),$item)},canInsertAfter:function canInsertAfter($item){return!this._loadingDraggeeLevelDelta&&!1!==this._getLevelBounds($item,$item.next())},onDragStart:function onDragStart(){this._ancestors=this._getAncestors(this.$targetItem,this.$targetItem.data("level")),this._setTargetLevelBounds(),this.tableView.maybeLoadMore(),this.base()},onDrag:function onDrag(){this.base(),this._updateIndent()},onInsertionPointChange:function onInsertionPointChange(){this._setTargetLevelBounds(),this._updateAncestorsBeforeRepaint(),this.base()},onDragStop:function onDragStop(){var _this2=this;if(this._positionChanged=!1,this.base(),this._targetLevel!=this._draggeeLevel){for(var levelDiff=this._targetLevel-this._draggeeLevel,i=0;i<this.$draggee.length;i++){var $draggee=$(this.$draggee[i]),oldLevel,newLevel=$draggee.data("level")+levelDiff,padding=this._basePadding+this._getLevelIndent(newLevel);$draggee.data("level",newLevel),$draggee.find(".element").data("level",newLevel),$draggee.children("[data-titlecell]:first").css("padding-"+Craft.left,padding)}this._positionChanged=!0}if(this._positionChanged){for(var data=this._getAjaxBaseData(this.$draggee),$prevRow=this.$draggee.first().prev();$prevRow.length;){var prevRowLevel=$prevRow.data("level");if(prevRowLevel==this._targetLevel){data.prevId=$prevRow.data("id");break}if(prevRowLevel<this._targetLevel){data.parentId=$prevRow.data("id");var $toggle=$prevRow.find("> th > .toggle");if(!$toggle.hasClass("expanded")){$toggle.addClass("expanded");var $spinnerRow=this.tableView._createSpinnerRowAfter($prevRow);this.tableView.elementSelect&&this.tableView.elementSelect.removeItems(this.$targetItem),this.removeItems(this.$targetItem),this.$targetItem.remove(),this.tableView._totalVisible--}break}$prevRow=$prevRow.prev()}Craft.postActionRequest("structures/move-element",data,(function(response,textStatus){if("success"===textStatus){if(!response.success)return Craft.cp.displayError(Craft.t("app","A server error occurred.")),void _this2.tableView.elementIndex.updateElements();Craft.cp.displayNotice(Craft.t("app","New position saved.")),_this2.onPositionChange(),$spinnerRow&&$spinnerRow.parent().length&&($spinnerRow.remove(),_this2.tableView._expandElement($toggle,!0)),Craft.cp.runQueue()}}))}},onSortChange:function onSortChange(){this.tableView.elementSelect&&this.tableView.elementSelect.resetItemOrder(),this._positionChanged=!0,this.base()},onPositionChange:function onPositionChange(){var _this3=this;Garnish.requestAnimationFrame((function(){_this3.trigger("positionChange"),_this3.settings.onPositionChange()}))},onReturnHelpersToDraggees:function onReturnHelpersToDraggees(){if(this._$firstRowCells.css("width",""),this.draggingLastElements&&this.tableView.getMorePending()){this.tableView._totalVisible+=this.newDraggeeIndexes[0]-this.oldDraggeeIndexes[0];var $postDraggeeItems=this.$draggee.last().nextAll();$postDraggeeItems.length&&(this.removeItems($postDraggeeItems),$postDraggeeItems.remove(),this.tableView.maybeLoadMore())}this.base()},_getLevelBounds:function _getLevelBounds($prevRow,$nextRow){if($nextRow&&$nextRow.length?this._getLevelBounds._minLevel=$nextRow.data("level"):this._getLevelBounds._minLevel=1,$prevRow&&$prevRow.length?this._getLevelBounds._maxLevel=$prevRow.data("level")+1:this._getLevelBounds._maxLevel=1,this.maxLevels){if(1!=this._getLevelBounds._minLevel&&this._getLevelBounds._minLevel+this._draggeeLevelDelta>this.maxLevels)return!1;this._getLevelBounds._maxLevel+this._draggeeLevelDelta>this.maxLevels&&(this._getLevelBounds._maxLevel=this.maxLevels-this._draggeeLevelDelta,this._getLevelBounds._maxLevel<this._getLevelBounds._minLevel&&(this._getLevelBounds._maxLevel=this._getLevelBounds._minLevel))}return{min:this._getLevelBounds._minLevel,max:this._getLevelBounds._maxLevel}},_setTargetLevelBounds:function _setTargetLevelBounds(){this._targetLevelBounds=this._getLevelBounds(this.$draggee.first().prev(),this.$draggee.last().next())},_updateIndent:function _updateIndent(forcePositionChange){this._updateIndent._mouseDist=this.realMouseX-this.mousedownX,"rtl"===Craft.orientation&&(this._updateIndent._mouseDist*=-1),this._updateIndent._indentationDist=Math.round(this._updateIndent._mouseDist/Craft.StructureTableSorter.LEVEL_INDENT),this._updateIndent._targetLevel=this._draggeeLevel+this._updateIndent._indentationDist,this._updateIndent._targetLevel<this._targetLevelBounds.min?(this._updateIndent._indentationDist+=this._targetLevelBounds.min-this._updateIndent._targetLevel,this._updateIndent._targetLevel=this._targetLevelBounds.min):this._updateIndent._targetLevel>this._targetLevelBounds.max&&(this._updateIndent._indentationDist-=this._updateIndent._targetLevel-this._targetLevelBounds.max,this._updateIndent._targetLevel=this._targetLevelBounds.max),this._targetLevel!==(this._targetLevel=this._updateIndent._targetLevel)&&this._updateAncestorsBeforeRepaint(),this._updateIndent._targetLevelMouseDiff=this._updateIndent._mouseDist-this._updateIndent._indentationDist*Craft.StructureTableSorter.LEVEL_INDENT,this._updateIndent._magnetImpact=Math.round(this._updateIndent._targetLevelMouseDiff/15),Math.abs(this._updateIndent._magnetImpact)>Craft.StructureTableSorter.MAX_GIVE&&(this._updateIndent._magnetImpact=(this._updateIndent._magnetImpact>0?1:-1)*Craft.StructureTableSorter.MAX_GIVE),this._updateIndent._closestLevelMagnetIndent=this._getLevelIndent(this._targetLevel)+this._updateIndent._magnetImpact,this.helpers[0].css("margin-"+Craft.left,this._updateIndent._closestLevelMagnetIndent+this._helperMargin),this._$titleHelperCell.css("width",this._titleHelperCellOuterWidth-this._updateIndent._closestLevelMagnetIndent)},_getLevelIndent:function _getLevelIndent(level){return(level-1)*Craft.StructureTableSorter.LEVEL_INDENT},_getAjaxBaseData:function _getAjaxBaseData($row){return{structureId:this.structureId,elementId:$row.data("id"),siteId:$row.find(".element:first").data("site-id")}},_getAncestors:function _getAncestors($row,targetLevel){if(this._getAncestors._ancestors=[],0!=targetLevel)for(this._getAncestors._level=targetLevel,this._getAncestors._$prevRow=$row.prev();this._getAncestors._$prevRow.length&&!(this._getAncestors._$prevRow.data("level")<this._getAncestors._level&&(this._getAncestors._ancestors.unshift(this._getAncestors._$prevRow),this._getAncestors._level=this._getAncestors._$prevRow.data("level"),0==this._getAncestors._level));)this._getAncestors._$prevRow=this._getAncestors._$prevRow.prev();return this._getAncestors._ancestors},_updateAncestorsBeforeRepaint:function _updateAncestorsBeforeRepaint(){this._updateAncestorsFrame&&Garnish.cancelAnimationFrame(this._updateAncestorsFrame),this._updateAncestorsFrame=Garnish.requestAnimationFrame(this._updateAncestors.bind(this))},_updateAncestors:function _updateAncestors(){for(this._updateAncestorsFrame=null,this._updateAncestors._i=0;this._updateAncestors._i<this._ancestors.length;this._updateAncestors._i++)this._updateAncestors._$ancestor=this._ancestors[this._updateAncestors._i],this._updateAncestors._$ancestor.data("descendants",this._updateAncestors._$ancestor.data("descendants")-1),0==this._updateAncestors._$ancestor.data("descendants")&&this._updateAncestors._$ancestor.find("> th > .toggle:first").remove();for(this._updateAncestors._newAncestors=this._getAncestors(this.$targetItem,this._targetLevel),this._updateAncestors._i=0;this._updateAncestors._i<this._updateAncestors._newAncestors.length;this._updateAncestors._i++)this._updateAncestors._$ancestor=this._updateAncestors._newAncestors[this._updateAncestors._i],this._updateAncestors._$ancestor.data("descendants",this._updateAncestors._$ancestor.data("descendants")+1),1==this._updateAncestors._$ancestor.data("descendants")&&$('<span class="toggle expanded" title="'+Craft.t("app","Show/hide children")+'"></span>').insertAfter(this._updateAncestors._$ancestor.find("> th .move:first"));this._ancestors=this._updateAncestors._newAncestors,delete this._updateAncestors._i,delete this._updateAncestors._$ancestor,delete this._updateAncestors._newAncestors}},{HELPER_MARGIN:0,LEVEL_INDENT:44,MAX_GIVE:22,defaults:{onPositionChange:$.noop}})},function(module,exports){Craft.TableElementIndexView=Craft.BaseElementIndexView.extend({$table:null,$selectedSortHeader:null,structureTableSort:null,_totalVisiblePostStructureTableDraggee:null,_morePendingPostStructureTableDraggee:!1,getElementContainer:function getElementContainer(){return this.$table=this.$container.find("table:first"),this.$table.children("tbody:first")},afterInit:function afterInit(){this.initTableHeaders(),"index"===this.elementIndex.settings.context&&"structure"===this.elementIndex.getSelectedSortAttribute()&&Garnish.hasAttr(this.$table,"data-structure-id")?this.structureTableSort=new Craft.StructureTableSorter(this,this.getAllElements()):this.structureTableSort=null,"structure"===this.elementIndex.getSelectedSortAttribute()&&this.addListener(this.$elementContainer,"click",(function(ev){var $target=$(ev.target);$target.hasClass("toggle")&&!1===this._collapseElement($target)&&this._expandElement($target)}))},initTableHeaders:function initTableHeaders(){for(var selectedSortAttr=this.elementIndex.getSelectedSortAttribute(),$tableHeaders=this.$table.children("thead").children().children("[data-attribute]"),i=0;i<$tableHeaders.length;i++){var $header=$tableHeaders.eq(i),attr=$header.attr("data-attribute");if(attr===selectedSortAttr){this.$selectedSortHeader=$header;var selectedSortDir=this.elementIndex.getSelectedSortDirection();$header.addClass("ordered "+selectedSortDir).on("click",this._handleSelectedSortHeaderClick.bind(this))}else{var $sortAttribute;this.elementIndex.getSortAttributeOption(attr).length&&$header.addClass("orderable").on("click",this._handleUnselectedSortHeaderClick.bind(this))}}},isVerticalList:function isVerticalList(){return!0},getTotalVisible:function getTotalVisible(){return this._isStructureTableDraggingLastElements()?this._totalVisiblePostStructureTableDraggee:this._totalVisible},setTotalVisible:function setTotalVisible(totalVisible){this._isStructureTableDraggingLastElements()?this._totalVisiblePostStructureTableDraggee=totalVisible:this._totalVisible=totalVisible},getMorePending:function getMorePending(){return this._isStructureTableDraggingLastElements()?this._morePendingPostStructureTableDraggee:this._morePending},setMorePending:function setMorePending(morePending){this._isStructureTableDraggingLastElements()?this._morePendingPostStructureTableDraggee=morePending:this._morePending=this._morePendingPostStructureTableDraggee=morePending},getLoadMoreParams:function getLoadMoreParams(){var params=this.base();return this._isStructureTableDraggingLastElements()&&(params.criteria.positionedAfter=this.structureTableSort.$targetItem.data("id")),params},appendElements:function appendElements($newElements){this.base($newElements),this.structureTableSort&&this.structureTableSort.addItems($newElements),Craft.cp.updateResponsiveTables()},createElementEditor:function createElementEditor($element){var _this=this;Craft.createElementEditor($element.data("type"),$element,{params:{includeTableAttributesForSource:this.elementIndex.sourceKey},onSaveElement:function onSaveElement(response){response.tableAttributes&&_this._updateTableAttributes($element,response.tableAttributes)},elementIndex:this.elementIndex})},_collapseElement:function _collapseElement($toggle,force){if(!force&&!$toggle.hasClass("expanded"))return!1;$toggle.removeClass("expanded");for(var $row=$toggle.parent().parent(),id=$row.data("id"),level=$row.data("level"),$nextRow=$row.next();$nextRow.length;){if(!Garnish.hasAttr($nextRow,"data-spinnerrow")){if($nextRow.data("level")<=level)break;this.elementSelect&&this.elementSelect.removeItems($nextRow),this.structureTableSort&&this.structureTableSort.removeItems($nextRow),this._totalVisible--}var $nextNextRow=$nextRow.next();$nextRow.remove(),$nextRow=$nextNextRow}this.elementIndex.instanceState.collapsedElementIds||(this.elementIndex.instanceState.collapsedElementIds=[]),this.elementIndex.instanceState.collapsedElementIds.push(id),this.elementIndex.setInstanceState("collapsedElementIds",this.elementIndex.instanceState.collapsedElementIds),this.maybeLoadMore()},_expandElement:function _expandElement($toggle,force){var _this2=this;if(!force&&$toggle.hasClass("expanded"))return!1;if($toggle.addClass("expanded"),this.elementIndex.instanceState.collapsedElementIds){var $row=$toggle.parent().parent(),id=$row.data("id"),index=$.inArray(id,this.elementIndex.instanceState.collapsedElementIds);if(-1!==index){this.elementIndex.instanceState.collapsedElementIds.splice(index,1),this.elementIndex.setInstanceState("collapsedElementIds",this.elementIndex.instanceState.collapsedElementIds);var $spinnerRow=this._createSpinnerRowAfter($row),data=$.extend(!0,{},this.settings.params);data.criteria.descendantOf=id,Craft.sendActionRequest("POST",this.settings.loadMoreElementsAction,{data:data}).then((function(response){if($spinnerRow.parent().length){var $newElements=$(response.data.html),totalVisible=_this2._totalVisible+$newElements.length,morePending=_this2.settings.batchSize&&$newElements.length===_this2.settings.batchSize;if(morePending){var $nextRows=$spinnerRow.nextAll();_this2.elementSelect&&_this2.elementSelect.removeItems($nextRows),_this2.structureTableSort&&_this2.structureTableSort.removeItems($nextRows),$nextRows.remove(),totalVisible-=$nextRows.length}else morePending=_this2._morePending;$spinnerRow.replaceWith($newElements),_this2.thumbLoader.load($newElements),(_this2.elementIndex.actions||_this2.settings.selectable)&&(_this2.elementSelect.addItems($newElements.filter(":not(.disabled)")),_this2.elementIndex.updateActionTriggers()),_this2.structureTableSort&&_this2.structureTableSort.addItems($newElements),Craft.appendHeadHtml(response.data.headHtml),Craft.appendFootHtml(response.data.footHtml),Craft.cp.updateResponsiveTables(),_this2.setTotalVisible(totalVisible),_this2.setMorePending(morePending),_this2.maybeLoadMore()}})).catch((function(e){Craft.cp.displayError(),$spinnerRow.parent().length}))}}},_createSpinnerRowAfter:function _createSpinnerRowAfter($row){return $('<tr data-spinnerrow><td class="centeralign" colspan="'+$row.children().length+'"><div class="spinner"/></td></tr>').insertAfter($row)},_isStructureTableDraggingLastElements:function _isStructureTableDraggingLastElements(){return this.structureTableSort&&this.structureTableSort.dragging&&this.structureTableSort.draggingLastElements},_handleSelectedSortHeaderClick:function _handleSelectedSortHeaderClick(ev){var $header=$(ev.currentTarget);if(!$header.hasClass("loading")){var selectedSortDir,newSortDir="asc"===this.elementIndex.getSelectedSortDirection()?"desc":"asc";this.elementIndex.setSortDirection(newSortDir),this._handleSortHeaderClick(ev,$header)}},_handleUnselectedSortHeaderClick:function _handleUnselectedSortHeaderClick(ev){var $header=$(ev.currentTarget);if(!$header.hasClass("loading")){var attr=$header.attr("data-attribute");this.elementIndex.setSortAttribute(attr),this._handleSortHeaderClick(ev,$header)}},_handleSortHeaderClick:function _handleSortHeaderClick(ev,$header){this.$selectedSortHeader&&this.$selectedSortHeader.removeClass("ordered asc desc"),$header.removeClass("orderable").addClass("ordered loading"),this.elementIndex.storeSortAttributeAndDirection(),this.elementIndex.updateElements(),this.elementIndex.setIndexAvailable()},_updateTableAttributes:function _updateTableAttributes($element,tableAttributes){var $tr=$element.closest("tr");for(var attr in tableAttributes)tableAttributes.hasOwnProperty(attr)&&$tr.children('[data-attr="'+attr+'"]:first').html(tableAttributes[attr])}})},function(module,exports){Craft.TagSelectInput=Craft.BaseElementSelectInput.extend({searchTimeout:null,searchMenu:null,$container:null,$elementsContainer:null,$elements:null,$addTagInput:null,$spinner:null,_ignoreBlur:!1,init:function init(settings){var _this=this;if(!$.isPlainObject(settings)){for(var normalizedSettings={},args=["id","name","tagGroupId","sourceElementId"],i=0;i<args.length&&void 0!==arguments[i];i++)normalizedSettings[args[i]]=arguments[i];settings=normalizedSettings}this.base($.extend({},Craft.TagSelectInput.defaults,settings)),this.$addTagInput=this.$container.children(".add").children(".text"),this.$spinner=this.$addTagInput.next(),this.addListener(this.$addTagInput,"input",(function(){_this.searchTimeout&&clearTimeout(_this.searchTimeout),_this.searchTimeout=setTimeout(_this.searchForTags.bind(_this),500)})),this.addListener(this.$addTagInput,"keydown",(function(ev){var $option;switch(ev.keyCode===Garnish.RETURN_KEY&&ev.preventDefault(),ev.keyCode){case Garnish.RETURN_KEY:return ev.preventDefault(),void(this.searchMenu&&this.selectTag(this.searchMenu.$options.filter(".hover")));case Garnish.DOWN_KEY:if(ev.preventDefault(),this.searchMenu){var $hoverOption=this.searchMenu.$options.filter(".hover");if($hoverOption.length){var $nextOption=$hoverOption.parent().nextAll().find("a:not(.disabled)").first();$nextOption.length&&this.focusOption($nextOption)}else this.focusOption(this.searchMenu.$options.eq(0))}return;case Garnish.UP_KEY:if(ev.preventDefault(),this.searchMenu){var _$hoverOption=this.searchMenu.$options.filter(".hover");if(_$hoverOption.length){var $prevOption=_$hoverOption.parent().prevAll().find("a:not(.disabled)").last();$prevOption.length&&this.focusOption($prevOption)}else this.focusOption(this.searchMenu.$options.eq(this.searchMenu.$options.length-1))}return}})),this.addListener(this.$addTagInput,"focus",(function(){this.searchMenu&&this.searchMenu.show()})),this.addListener(this.$addTagInput,"blur",(function(){var _this2=this;this._ignoreBlur?this._ignoreBlur=!1:setTimeout((function(){_this2.searchMenu&&_this2.searchMenu.hide()}),1)}))},focusOption:function focusOption($option){this.searchMenu.$options.removeClass("hover"),$option.addClass("hover"),this.searchMenu.$menuList.attr("aria-activedescendant",$option.attr("id"))},getAddElementsBtn:$.noop,getElementSortAxis:function getElementSortAxis(){return null},searchForTags:function searchForTags(){var _this3=this,val;if(this.searchMenu&&this.killSearchMenu(),this.$addTagInput.val()){this.$spinner.removeClass("hidden");for(var excludeIds=[],i=0;i<this.$elements.length;i++){var id=$(this.$elements[i]).data("id");id&&excludeIds.push(id)}this.settings.sourceElementId&&excludeIds.push(this.settings.sourceElementId);var data={search:this.$addTagInput.val(),tagGroupId:this.settings.tagGroupId,excludeIds:excludeIds};Craft.postActionRequest("tags/search-for-tags",data,(function(response,textStatus){if(_this3.searchMenu&&_this3.killSearchMenu(),_this3.$spinner.addClass("hidden"),"success"===textStatus){for(var $menu=$('<div class="menu tagmenu"/>').appendTo(Garnish.$bod),$ul=$("<ul/>").appendTo($menu),$li,i=0;i<response.tags.length;i++)$li=$("<li/>").appendTo($ul),$('<a data-icon="tag"/>').appendTo($li).text(response.tags[i].title).data("id",response.tags[i].id).addClass(response.tags[i].exclude?"disabled":"");response.exactMatch||($li=$("<li/>").appendTo($ul),$('<a data-icon="plus"/>').appendTo($li).text(data.search)),$ul.find("a:not(.disabled):first").addClass("hover"),_this3.searchMenu=new Garnish.Menu($menu,{attachToElement:_this3.$addTagInput,onOptionSelect:_this3.selectTag.bind(_this3)}),_this3.addListener($menu,"mousedown",(function(){_this3._ignoreBlur=!0})),_this3.searchMenu.show()}}))}else this.$spinner.addClass("hidden")},selectTag:function selectTag(option){var _this4=this,$option=$(option);if(!$option.hasClass("disabled")){var id=$option.data("id"),title=$option.text(),$element=$("<div/>",{class:"element small removable","data-id":id,"data-site-id":this.settings.targetSiteId,"data-label":title,"data-editable":"1"}).appendTo(this.$elementsContainer),$input=$("<input/>",{type:"hidden",name:this.settings.name+"[]",value:id}).appendTo($element);$("<a/>",{class:"delete icon",title:Craft.t("app","Remove")}).appendTo($element);var $titleContainer=$("<div/>",{class:"label"}).appendTo($element);$("<span/>",{class:"title",text:title}).appendTo($titleContainer);var margin=-($element.outerWidth()+10);this.$addTagInput.css("margin-"+Craft.left,margin+"px");var animateCss={};if(animateCss["margin-"+Craft.left]=0,this.$addTagInput.velocity(animateCss,"fast"),this.$elements=this.$elements.add($element),this.addElements($element),this.killSearchMenu(),this.$addTagInput.val(""),this.$addTagInput.trigger("focus"),!id){$element.addClass("loading disabled");var data={groupId:this.settings.tagGroupId,title:title};Craft.postActionRequest("tags/create-tag",data,(function(response,textStatus){"success"===textStatus&&response.success?($element.attr("data-id",response.id),$input.val(response.id),$element.removeClass("loading disabled")):(_this4.removeElement($element),"success"===textStatus&&Craft.cp.displayError(Craft.t("app","A server error occurred.")))}))}}},killSearchMenu:function killSearchMenu(){this.searchMenu.hide(),this.searchMenu.destroy(),this.searchMenu=null}},{defaults:{tagGroupId:null}})},function(module,exports){Craft.ThumbsElementIndexView=Craft.BaseElementIndexView.extend({getElementContainer:function getElementContainer(){return this.$container.children("ul")}})},function(module,exports){Craft.ui={createTextInput:function createTextInput(config){config=$.extend({autocomplete:!1},config);var $input=$("<input/>",{attr:{class:"text",type:config.type||"text",inputmode:config.inputmode,id:config.id,size:config.size,name:config.name,value:config.value,maxlength:config.maxlength,autofocus:this.getAutofocusValue(config.autofocus),autocomplete:"boolean"==typeof config.autocomplete?config.autocomplete?"on":"off":config.autocomplete,disabled:this.getDisabledValue(config.disabled),readonly:config.readonly,title:config.title,placeholder:config.placeholder,step:config.step,min:config.min,max:config.max}});return config.class&&$input.addClass(config.class),config.placeholder&&$input.addClass("nicetext"),"password"===config.type&&$input.addClass("password"),config.disabled&&$input.addClass("disabled"),config.size||$input.addClass("fullwidth"),config.showCharsLeft&&config.maxlength&&$input.attr("data-show-chars-left").css("padding-"+("ltr"===Craft.orientation?"right":"left"),7.2*config.maxlength.toString().length+14+"px"),(config.placeholder||config.showCharsLeft)&&new Garnish.NiceText($input),"password"===config.type?$('<div class="passwordwrapper"/>').append($input):$input},createTextField:function createTextField(config){return config.id||(config.id="text"+Math.floor(1e9*Math.random())),this.createField(this.createTextInput(config),config)},createCopyTextInput:function createCopyTextInput(config){var id=config.id||"copytext"+Math.floor(1e9*Math.random()),buttonId=config.buttonId||"".concat(id,"-btn"),$container=$("<div/>",{class:"copytext"}),$input=this.createTextInput($.extend({},config,{readonly:!0})).appendTo($container),$btn;return $("<button/>",{type:"button",id:buttonId,class:"btn","data-icon":"clipboard",title:Craft.t("app","Copy to clipboard"),"aria-label":Craft.t("app","Copy to clipboard")}).appendTo($container).on("click",(function(){$input[0].select(),document.execCommand("copy"),Craft.cp.displayNotice(Craft.t("app","Copied to clipboard.")),$container.trigger("copy"),$input[0].setSelectionRange(0,0)})),$container},createCopyTextField:function createCopyTextField(config){return config.id||(config.id="copytext"+Math.floor(1e9*Math.random())),this.createField(this.createCopyTextInput(config),config)},createCopyTextPrompt:function createCopyTextPrompt(config){var $container=$("<div/>",{class:"modal fitted"}),$body=$("<div/>",{class:"body"}).appendTo($container);this.createCopyTextField($.extend({size:Math.max(Math.min(config.value.length,50),25)},config)).appendTo($body);var modal=new Garnish.Modal($container,{closeOtherModals:!1});return $container.on("copy",(function(){modal.hide()})),$container},createTextarea:function createTextarea(config){var $textarea=$("<textarea/>",{class:"text",rows:config.rows||2,cols:config.cols||50,id:config.id,name:config.name,maxlength:config.maxlength,autofocus:config.autofocus&&!Garnish.isMobileBrowser(!0),disabled:!!config.disabled,placeholder:config.placeholder,html:config.value});return config.showCharsLeft&&$textarea.attr("data-show-chars-left",""),config.class&&$textarea.addClass(config.class),config.size||$textarea.addClass("fullwidth"),$textarea},createTextareaField:function createTextareaField(config){return config.id||(config.id="textarea"+Math.floor(1e9*Math.random())),this.createField(this.createTextarea(config),config)},createSelect:function createSelect(config){var $container=$("<div/>",{class:"select"});config.class&&$container.addClass(config.class);var $select=$("<select/>",{id:config.id,name:config.name,autofocus:config.autofocus&&Garnish.isMobileBrowser(!0),disabled:config.disabled,"data-target-prefix":config.targetPrefix}).appendTo($container);if($.isPlainObject(config.options)){var options=[];for(var key in config.options)if(config.options.hasOwnProperty(key)){var option=config.options[key];$.isPlainObject(option)?void 0!==option.optgroup?options.push(option):options.push({label:option.label,value:void 0!==option.value?option.value:key,disabled:void 0!==option.disabled&&option.disabled}):options.push({label:option,value:key})}config.options=options}for(var $optgroup=null,i=0;i<config.options.length;i++){var _option=config.options[i];void 0!==_option.optgroup?$optgroup=$("<optgroup/>",{label:_option.label}).appendTo($select):$("<option/>",{value:_option.value,selected:_option.value==config.value,disabled:void 0!==_option.disabled&&_option.disabled,html:_option.label}).appendTo($optgroup||$select)}return config.toggle&&($select.addClass("fieldtoggle"),new Craft.FieldToggle($select)),$container},createSelectField:function createSelectField(config){return config.id||(config.id="select"+Math.floor(1e9*Math.random())),this.createField(this.createSelect(config),config)},createCheckbox:function createCheckbox(config){var id=config.id||"checkbox"+Math.floor(1e9*Math.random()),$input=$("<input/>",{type:"checkbox",value:void 0!==config.value?config.value:"1",id:id,class:"checkbox",name:config.name,checked:config.checked?"checked":null,autofocus:this.getAutofocusValue(config.autofocus),disabled:this.getDisabledValue(config.disabled),"data-target":config.toggle,"data-reverse-target":config.reverseToggle});config.class&&$input.addClass(config.class),(config.toggle||config.reverseToggle)&&($input.addClass("fieldtoggle"),new Craft.FieldToggle($input));var $label=$("<label/>",{for:id,html:config.label});return config.name&&(config.name.length<3||"[]"!==config.name.substr(-2))?$([$("<input/>",{type:"hidden",name:config.name,value:""})[0],$input[0],$label[0]]):$([$input[0],$label[0]])},createCheckboxField:function createCheckboxField(config){config.id||(config.id="checkbox"+Math.floor(1e9*Math.random()));var $field=$('<div class="field checkboxfield"/>',{id:"".concat(config.id,"-field")});return config.first&&$field.addClass("first"),config.instructions&&$field.addClass("has-instructions"),this.createCheckbox(config).appendTo($field),config.instructions&&$('<div class="instructions"/>').text(config.instructions).appendTo($field),$field},createCheckboxSelect:function createCheckboxSelect(config){var $container=$('<fieldset class="checkbox-select"/>'),allValue,allChecked;config.class&&$container.addClass(config.class),config.showAllOption?(allValue=config.allValue||"*",allChecked=config.values==allValue,$("<div/>").appendTo($container).append(this.createCheckbox({id:config.id,class:"all",label:"<b>"+(config.allLabel||Craft.t("app","All"))+"</b>",name:config.name,value:allValue,checked:allChecked,autofocus:config.autofocus}))):allChecked=!1;for(var i=0;i<config.options.length;i++){var option=config.options[i];option.value!=allValue&&$("<div/>").appendTo($container).append(this.createCheckbox({label:option.label,name:config.name?config.name+"[]":null,value:option.value,checked:allChecked||(config.values||[]).includes(option.value),disabled:allChecked}))}return new Garnish.CheckboxSelect($container),$container},createCheckboxSelectField:function createCheckboxSelectField(config){return config.fieldset=!0,config.id||(config.id="checkboxselect"+Math.floor(1e9*Math.random())),this.createField(this.createCheckboxSelect(config),config)},createLightswitch:function createLightswitch(config){var value=config.value||"1",indeterminateValue=config.indeterminateValue||"-",$container=$("<button/>",{type:"button",class:"lightswitch","data-value":value,"data-indeterminate-value":indeterminateValue,id:config.id,role:"checkbox","aria-checked":config.on?"true":config.indeterminate?"mixed":"false","aria-labelledby":config.labelId,"data-target":config.toggle,"data-reverse-target":config.reverseToggle});return config.on?$container.addClass("on"):config.indeterminate&&$container.addClass("indeterminate"),config.small&&$container.addClass("small"),config.disabled&&$container.addClass("disabled"),$('<div class="lightswitch-container"><div class="handle"></div></div>').appendTo($container),config.name&&$("<input/>",{type:"hidden",name:config.name,value:config.on?value:config.indeterminate?indeterminateValue:"",disabled:config.disabled}).appendTo($container),(config.toggle||config.reverseToggle)&&($container.addClass("fieldtoggle"),new Craft.FieldToggle($container)),new Craft.LightSwitch($container,{onChange:config.onChange||$.noop}),$container},createLightswitchField:function createLightswitchField(config){return config.id||(config.id="lightswitch"+Math.floor(1e9*Math.random())),this.createField(this.createLightswitch(config),config).addClass("lightswitch-field")},createColorInput:function createColorInput(config){var id=config.id||"color"+Math.floor(1e9*Math.random()),containerId=config.containerId||id+"-container",name=config.name||null,value=config.value||null,small=config.small||!1,autofocus=config.autofocus&&Garnish.isMobileBrowser(!0),disabled=config.disabled||!1,$container=$("<div/>",{id:containerId,class:"flex color-container"}),$colorPreviewContainer=$("<div/>",{class:"color static"+(small?" small":"")}).appendTo($container),$colorPreview=$("<div/>",{class:"color-preview",style:config.value?{backgroundColor:config.value}:null}).appendTo($colorPreviewContainer),$inputContainer=$("<div/>",{class:"color-input-container"}).append($("<div/>",{class:"color-hex-indicator light code","aria-hidden":"true",text:"#"})).appendTo($container),$input=this.createTextInput({id:id,name:name,value:Craft.ltrim(value,"#"),size:10,class:"color-input",autofocus:autofocus,disabled:disabled,"aria-label":Craft.t("app","Color hex value")}).appendTo($inputContainer);return new Craft.ColorInput($container),$container},createColorField:function createColorField(config){return config.fieldset=!0,o,config.id||(config.id="color"+Math.floor(1e9*Math.random())),this.createField(this.createColorInput(config),config)},createDateInput:function createDateInput(config){var id=(config.id||"date"+Math.floor(1e9*Math.random()))+"-date",name=config.name||null,inputName=name?name+"[date]":null,value=config.value&&"function"==typeof config.value.getMonth?config.value:null,formattedValue=value?Craft.formatDate(value):null,autofocus=config.autofocus&&Garnish.isMobileBrowser(!0),disabled=config.disabled||!1,$container=$("<div/>",{class:"datewrapper"}),$input=this.createTextInput({id:id,name:inputName,value:formattedValue,placeholder:" ",autocomplete:!1,autofocus:autofocus,disabled:disabled}).appendTo($container);return $('<div data-icon="date"></div>').appendTo($container),name&&$("<input/>",{type:"hidden",name:name+"[timezone]",val:Craft.timezone}).appendTo($container),$input.datepicker($.extend({defaultDate:value||new Date},Craft.datepickerOptions)),$container},createDateField:function createDateField(config){return config.id||(config.id="date"+Math.floor(1e9*Math.random())),this.createField(this.createDateInput(config),config)},createDateRangePicker:function createDateRangePicker(config){var now=new Date,today=new Date(now.getFullYear(),now.getMonth(),now.getDate());config=$.extend({class:"",options:["today","thisWeek","thisMonth","thisYear","past7Days","past30Days","past90Days","pastYear"],onChange:$.noop,selected:null,startDate:null,endDate:null},config);var $menu=$("<div/>",{class:"menu"}),$ul=$("<ul/>",{class:"padded"}).appendTo($menu),$allOption=$("<a/>").addClass("sel").text(Craft.t("app","All")).data("handle","all"),option,selectedOption;$("<li/>").append($allOption).appendTo($ul);for(var i=0;i<config.options.length;i++){var handle=config.options[i];switch(handle){case"today":option={label:Craft.t("app","Today"),startDate:today,endDate:today};break;case"thisWeek":var firstDayOffset=now.getDay()-Craft.datepickerOptions.firstDay;firstDayOffset<0&&(firstDayOffset+=7),option={label:Craft.t("app","This week"),startDate:new Date(now.getFullYear(),now.getMonth(),now.getDate()-firstDayOffset),endDate:today};break;case"thisMonth":option={label:Craft.t("app","This month"),startDate:new Date(now.getFullYear(),now.getMonth()),endDate:today};break;case"thisYear":option={label:Craft.t("app","This year"),startDate:new Date(now.getFullYear(),0),endDate:today};break;case"past7Days":option={label:Craft.t("app","Past {num} days",{num:7}),startDate:new Date(now.getFullYear(),now.getMonth(),now.getDate()-7),endDate:today};break;case"past30Days":option={label:Craft.t("app","Past {num} days",{num:30}),startDate:new Date(now.getFullYear(),now.getMonth(),now.getDate()-30),endDate:today};break;case"past90Days":option={label:Craft.t("app","Past {num} days",{num:90}),startDate:new Date(now.getFullYear(),now.getMonth(),now.getDate()-90),endDate:today};break;case"pastYear":option={label:Craft.t("app","Past year"),startDate:new Date(now.getFullYear(),now.getMonth(),now.getDate()-365),endDate:today}}var $li=$("<li/>"),$a=$("<a/>",{text:option.label}).data("handle",handle).data("startDate",option.startDate).data("endDate",option.endDate).data("startTime",option.startDate?option.startDate.getTime():null).data("endTime",option.endDate?option.endDate.getTime():null);config.selected&&handle==config.selected&&(selectedOption=$a[0]),$li.append($a),$li.appendTo($ul)}$("<hr/>").appendTo($menu);var $flex=$("<div/>",{class:"flex flex-nowrap padded"}).appendTo($menu),$startDate=this.createDateField({label:Craft.t("app","From")}).appendTo($flex).find("input"),$endDate=this.createDateField({label:Craft.t("app","To")}).appendTo($flex).find("input"),$dateInputs=$startDate.add($endDate);$dateInputs.on("keyup",(function(ev){ev.keyCode===Garnish.ESC_KEY&&$(this).data("datepicker").dpDiv.is(":visible")&&ev.stopPropagation()})),$startDate.data("datepicker").dpDiv.on("mousedown",(function(ev){ev.stopPropagation()})),$endDate.data("datepicker").dpDiv.on("mousedown",(function(ev){ev.stopPropagation()}));var menu=new Garnish.Menu($menu,{onOptionSelect:function onOptionSelect(option){var $option=$(option);$btn.text($option.text()),menu.setPositionRelativeToAnchor(),$menu.find(".sel").removeClass("sel"),$option.addClass("sel"),$startDate.datepicker("setDate",$option.data("startDate")),$endDate.datepicker("setDate",$option.data("endDate")),config.onChange($option.data("startDate")||null,$option.data("endDate")||null,$option.data("handle"))}});$dateInputs.on("change",(function(){for(var startDate=$startDate.datepicker("getDate"),endDate=$endDate.datepicker("getDate"),startTime=startDate?startDate.getTime():null,endTime=endDate?endDate.getTime():null,$options=$ul.find("a"),$option,foundOption=!1,_i=0;_i<$options.length;_i++)if(startTime===(($option=$options.eq(_i)).data("startTime")||null)&&endTime===($option.data("endTime")||null)){menu.selectOption($option[0]),foundOption=!0,config.onChange(null,null,$option.data("handle"));break}foundOption||($menu.find(".sel").removeClass("sel"),$flex.addClass("sel"),startTime||endTime?startTime&&endTime?$btn.text($startDate.val()+" - "+$endDate.val()):startTime?$btn.text(Craft.t("app","From {date}",{date:$startDate.val()})):$btn.text(Craft.t("app","To {date}",{date:$endDate.val()})):$btn.text(Craft.t("app","All")),menu.setPositionRelativeToAnchor(),config.onChange(startDate,endDate,"custom"))})),menu.on("hide",(function(){$startDate.datepicker("hide"),$endDate.datepicker("hide")}));var btnClasses="btn menubtn";config.class&&(btnClasses=btnClasses+" "+config.class);var $btn=$("<button/>",{type:"button",class:btnClasses,"data-icon":"date",text:Craft.t("app","All")});return new Garnish.MenuBtn($btn,menu),selectedOption&&menu.selectOption(selectedOption),config.startDate&&$startDate.datepicker("setDate",config.startDate),config.endDate&&$endDate.datepicker("setDate",config.endDate),(config.startDate||config.endDate)&&$dateInputs.trigger("change"),$btn},createTimeInput:function createTimeInput(config){var id=(config.id||"time"+Math.floor(1e9*Math.random()))+"-time",name=config.name||null,inputName=name?name+"[time]":null,value=config.value&&"function"==typeof config.value.getMonth?config.value:null,autofocus=config.autofocus&&Garnish.isMobileBrowser(!0),disabled=config.disabled||!1,$container=$("<div/>",{class:"timewrapper"}),$input=this.createTextInput({id:id,name:inputName,placeholder:" ",autocomplete:!1,autofocus:autofocus,disabled:disabled}).appendTo($container);return $('<div data-icon="time"></div>').appendTo($container),name&&$("<input/>",{type:"hidden",name:name+"[timezone]",val:Craft.timezone}).appendTo($container),$input.timepicker(Craft.timepickerOptions),value&&$input.timepicker("setTime",3600*value.getHours()+60*value.getMinutes()+value.getSeconds()),$container},createTimeField:function createTimeField(config){return config.id||(config.id="time"+Math.floor(1e9*Math.random())),this.createField(this.createTimeInput(config),config)},createField:function createField(input,config){var label=config.label&&"__blank__"!==config.label?config.label:null,siteId=Craft.isMultiSite&&config.siteId?config.siteId:null,$field=$(config.fieldset?"<fieldset/>":"<div/>",{class:"field",id:config.fieldId||(config.id?config.id+"-field":null)});if(config.first&&$field.addClass("first"),label)var $heading=$('<div class="heading"/>').appendTo($field),$label=$(config.fieldset?"<legend/>":"<label/>",{id:config.labelId||(config.id?"".concat(config.id,"-").concat(config.fieldset?"legend":"label"):null),class:config.required?"required":null,for:!config.fieldset&&config.id,text:label}).appendTo($heading);return config.instructions&&$('<div class="instructions"/>').text(config.instructions).appendTo($field),$('<div class="input"/>').append(input).appendTo($field),config.warning&&$('<p class="warning"/>').text(config.warning).appendTo($field),config.errors&&this.addErrorsToField($field,config.errors),$field},createErrorList:function createErrorList(errors){var $list=$('<ul class="errors"/>');return errors&&this.addErrorsToList($list,errors),$list},addErrorsToList:function addErrorsToList($list,errors){for(var i=0;i<errors.length;i++)$("<li/>").text(errors[i]).appendTo($list)},addErrorsToField:function addErrorsToField($field,errors){if(errors){$field.addClass("has-errors"),$field.children(".input").addClass("errors");var $errors=$field.children("ul.errors");$errors.length||($errors=this.createErrorList().appendTo($field)),this.addErrorsToList($errors,errors)}},clearErrorsFromField:function clearErrorsFromField($field){$field.removeClass("has-errors"),$field.children(".input").removeClass("errors"),$field.children("ul.errors").remove()},getAutofocusValue:function getAutofocusValue(autofocus){return autofocus&&!Garnish.isMobileBrowser(!0)?"autofocus":null},getDisabledValue:function getDisabledValue(disabled){return disabled?"disabled":null}}},function(module,exports){Craft.Uploader=Garnish.Base.extend({uploader:null,allowedKinds:null,$element:null,settings:null,_rejectedFiles:{},_extensionList:null,_totalFileCounter:0,_validFileCounter:0,init:function init($element,settings){this._rejectedFiles={size:[],type:[],limit:[]},this.$element=$element,this.allowedKinds=null,this._extensionList=null,this._totalFileCounter=0,this._validFileCounter=0;var events=(settings=$.extend({},Craft.Uploader.defaults,settings)).events;for(var event in delete settings.events,settings.allowedKinds&&settings.allowedKinds.length&&("string"==typeof settings.allowedKinds&&(settings.allowedKinds=[settings.allowedKinds]),this.allowedKinds=settings.allowedKinds,delete settings.allowedKinds),settings.autoUpload=!1,this.uploader=this.$element.fileupload(settings),events)events.hasOwnProperty(event)&&this.uploader.on(event,events[event]);this.settings=settings,this.uploader.on("fileuploadadd",this.onFileAdd.bind(this))},setParams:function setParams(paramObject){void 0!==Craft.csrfTokenName&&void 0!==Craft.csrfTokenValue&&(paramObject[Craft.csrfTokenName]=Craft.csrfTokenValue),this.uploader.fileupload("option",{formData:paramObject})},getInProgress:function getInProgress(){return this.uploader.fileupload("active")},isLastUpload:function isLastUpload(){return this.getInProgress()<2},onFileAdd:function onFileAdd(e,data){var _this=this;e.stopPropagation();var validateExtension=!1;return this.allowedKinds&&(this._extensionList||this._createExtensionList(),validateExtension=!0),data.process().done((function(){var file=data.files[0],pass=!0;if(validateExtension){var matches,fileExtension=file.name.match(/\.([a-z0-4_]+)$/i)[1];-1===$.inArray(fileExtension.toLowerCase(),_this._extensionList)&&(pass=!1,_this._rejectedFiles.type.push("“"+file.name+"”"))}file.size>_this.settings.maxFileSize&&(_this._rejectedFiles.size.push("“"+file.name+"”"),pass=!1),pass&&"function"==typeof _this.settings.canAddMoreFiles&&!_this.settings.canAddMoreFiles(_this._validFileCounter)&&(_this._rejectedFiles.limit.push("“"+file.name+"”"),pass=!1),pass&&(_this._validFileCounter++,data.submit()),++_this._totalFileCounter===data.originalFiles.length&&(_this._totalFileCounter=0,_this._validFileCounter=0,_this.processErrorMessages())})),!0},processErrorMessages:function processErrorMessages(){var str;this._rejectedFiles.type.length&&(str=1===this._rejectedFiles.type.length?"The file {files} could not be uploaded. The allowed file kinds are: {kinds}.":"The files {files} could not be uploaded. The allowed file kinds are: {kinds}.",str=Craft.t("app",str,{files:this._rejectedFiles.type.join(", "),kinds:this.allowedKinds.join(", ")}),this._rejectedFiles.type=[],alert(str)),this._rejectedFiles.size.length&&(str=1===this._rejectedFiles.size.length?"The file {files} could not be uploaded, because it exceeds the maximum upload size of {size}.":"The files {files} could not be uploaded, because they exceeded the maximum upload size of {size}.",str=Craft.t("app",str,{files:this._rejectedFiles.size.join(", "),size:this.humanFileSize(Craft.maxUploadSize)}),this._rejectedFiles.size=[],alert(str)),this._rejectedFiles.limit.length&&(str=1===this._rejectedFiles.limit.length?"The file {files} could not be uploaded, because the field limit has been reached.":"The files {files} could not be uploaded, because the field limit has been reached.",str=Craft.t("app",str,{files:this._rejectedFiles.limit.join(", ")}),this._rejectedFiles.limit=[],alert(str))},humanFileSize:function humanFileSize(bytes){var threshold=1024;if(bytes<1024)return bytes+" B";var units=["kB","MB","GB","TB","PB","EB","ZB","YB"],u=-1;do{bytes/=1024,++u}while(bytes>=1024);return bytes.toFixed(1)+" "+units[u]},_createExtensionList:function _createExtensionList(){this._extensionList=[];for(var i=0;i<this.allowedKinds.length;i++){var allowedKind=this.allowedKinds[i];if(void 0!==Craft.fileKinds[allowedKind])for(var j=0;j<Craft.fileKinds[allowedKind].extensions.length;j++){var ext=Craft.fileKinds[allowedKind].extensions[j];this._extensionList.push(ext)}}},destroy:function destroy(){this.$element.fileupload("destroy"),this.base()}},{defaults:{dropZone:null,pasteZone:null,fileInput:null,sequentialUploads:!0,maxFileSize:Craft.maxUploadSize,allowedKinds:null,events:{},canAddMoreFiles:null,headers:{Accept:"application/json;q=0.9,*/*;q=0.8"},paramName:"assets-upload"}})},function(module,exports){Craft.UriFormatGenerator=Craft.BaseInputGenerator.extend({generateTargetValue:function generateTargetValue(sourceVal){sourceVal=(sourceVal=sourceVal.replace("/<(.*?)>/g","")).toLowerCase(),sourceVal=(sourceVal=(sourceVal=Craft.asciiString(sourceVal)).replace(/^[^a-z]+/,"")).replace(/[^a-z0-9]+$/,"");var words,uriFormat=Craft.filterArray(sourceVal.split(/[^a-z0-9]+/)).join(Craft.slugWordSeparator);return uriFormat&&this.settings.suffix&&(uriFormat+=this.settings.suffix),uriFormat}})}]);
//# sourceMappingURL=Craft.min.js.map