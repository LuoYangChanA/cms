!function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}__webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{enumerable:!0,get:getter})},__webpack_require__.r=function(exports){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(exports,"__esModule",{value:!0})},__webpack_require__.t=function(value,mode){if(1&mode&&(value=__webpack_require__(value)),8&mode)return value;if(4&mode&&"object"==typeof value&&value&&value.__esModule)return value;var ns=Object.create(null);if(__webpack_require__.r(ns),Object.defineProperty(ns,"default",{enumerable:!0,value:value}),2&mode&&"string"!=typeof value)for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module.default}:function getModuleExports(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p="/",__webpack_require__(__webpack_require__.s=0)}([function(module,exports){!function($){Craft.MatrixInput=Garnish.Base.extend({id:null,blockTypes:null,blockTypesByHandle:null,inputNamePrefix:null,inputIdPrefix:null,showingAddBlockMenu:!1,addBlockBtnGroupWidth:null,addBlockBtnContainerWidth:null,$container:null,$blockContainer:null,$addBlockBtnContainer:null,$addBlockBtnGroup:null,$addBlockBtnGroupBtns:null,blockSort:null,blockSelect:null,totalNewBlocks:0,init:function init(id,blockTypes,inputNamePrefix,settings){var _this=this,i;for(this.id=id,this.blockTypes=blockTypes,this.inputNamePrefix=inputNamePrefix,this.inputIdPrefix=Craft.formatInputId(this.inputNamePrefix),"number"==typeof settings&&(settings={maxBlocks:settings}),this.setSettings(settings,Craft.MatrixInput.defaults),this.$container=$("#"+this.id),this.$blockContainer=this.$container.children(".blocks"),this.$addBlockBtnContainer=this.$container.children(".buttons"),this.$addBlockBtnGroup=this.$addBlockBtnContainer.children(".btngroup"),this.$addBlockBtnGroupBtns=this.$addBlockBtnGroup.children(".btn"),this.$addBlockMenuBtn=this.$addBlockBtnContainer.children(".menubtn"),this.$container.data("matrix",this),this.setNewBlockBtn(),this.blockTypesByHandle={},i=0;i<this.blockTypes.length;i++){var blockType=this.blockTypes[i];this.blockTypesByHandle[blockType.handle]=blockType}var $blocks=this.$blockContainer.children(),collapsedBlocks=Craft.MatrixInput.getCollapsedBlockIds();for(this.blockSort=new Garnish.DragSort($blocks,{handle:"> .actions > .move",axis:"y",filter:function filter(){return _this.blockSort.$targetItem.hasClass("sel")?_this.blockSelect.getSelectedItems():_this.blockSort.$targetItem},collapseDraggees:!0,magnetStrength:4,helperLagBase:1.5,helperOpacity:.9,onSortChange:function onSortChange(){_this.blockSelect.resetItemOrder()}}),this.blockSelect=new Garnish.Select(this.$blockContainer,$blocks,{multi:!0,vertical:!0,handle:"> .checkbox, > .titlebar",checkboxMode:!0}),i=0;i<$blocks.length;i++){var $block=$($blocks[i]),blockId=$block.data("id"),newMatch="string"==typeof blockId&&blockId.match(/new(\d+)/);newMatch&&newMatch[1]>this.totalNewBlocks&&(this.totalNewBlocks=parseInt(newMatch[1]));var block=new MatrixBlock(this,$block);block.id&&-1!==$.inArray(""+block.id,collapsedBlocks)&&block.collapse()}this.addListener(this.$addBlockBtnGroupBtns,"click",(function(ev){var type=$(ev.target).data("type");this.addBlock(type)})),new Garnish.MenuBtn(this.$addBlockMenuBtn,{onOptionSelect:function onOptionSelect(option){_this.addBlock($(option).data("type"))}}),this.updateAddBlockBtn(),this.addListener(this.$container,"resize","setNewBlockBtn"),Garnish.$doc.ready(this.setNewBlockBtn.bind(this)),this.trigger("afterInit")},setNewBlockBtn:function setNewBlockBtn(){var _this2=this;(this.addBlockBtnGroupWidth||(this.addBlockBtnGroupWidth=this.$addBlockBtnGroup.width(),this.addBlockBtnGroupWidth))&&this.addBlockBtnContainerWidth!==(this.addBlockBtnContainerWidth=this.$addBlockBtnContainer.width())&&(this.addBlockBtnGroupWidth>this.addBlockBtnContainerWidth?this.showingAddBlockMenu||(this.$addBlockBtnGroup.addClass("hidden"),this.$addBlockMenuBtn.removeClass("hidden"),this.showingAddBlockMenu=!0):this.showingAddBlockMenu&&(this.$addBlockMenuBtn.addClass("hidden"),this.$addBlockBtnGroup.removeClass("hidden"),this.showingAddBlockMenu=!1,-1!==navigator.userAgent.indexOf("Safari")&&Garnish.requestAnimationFrame((function(){_this2.$addBlockBtnGroup.css("opacity",.99),Garnish.requestAnimationFrame((function(){_this2.$addBlockBtnGroup.css("opacity","")}))}))))},canAddMoreBlocks:function canAddMoreBlocks(){return!this.maxBlocks||this.$blockContainer.children().length<this.maxBlocks},updateAddBlockBtn:function updateAddBlockBtn(){var i,block;if(this.canAddMoreBlocks())for(this.$addBlockBtnGroup.removeClass("disabled"),this.$addBlockMenuBtn.removeClass("disabled"),i=0;i<this.blockSelect.$items.length;i++)(block=this.blockSelect.$items.eq(i).data("block"))&&block.$actionMenu.find("a[data-action=add]").parent().removeClass("disabled");else for(this.$addBlockBtnGroup.addClass("disabled"),this.$addBlockMenuBtn.addClass("disabled"),i=0;i<this.blockSelect.$items.length;i++)(block=this.blockSelect.$items.eq(i).data("block"))&&block.$actionMenu.find("a[data-action=add]").parent().addClass("disabled")},addBlock:function addBlock(type,$insertBefore,autofocus){var _this3=this;if(this.canAddMoreBlocks()){this.totalNewBlocks++;var id="new"+this.totalNewBlocks,html='\n<div class="matrixblock" data-id="'.concat(id,'" data-type="').concat(type,'">\n  <input type="hidden" name="').concat(this.inputNamePrefix,'[sortOrder][]" value="').concat(id,'"/>\n  <input type="hidden" name="').concat(this.inputNamePrefix,"[blocks][").concat(id,'][type]" value="').concat(type,'"/>\n  <input type="hidden" name="').concat(this.inputNamePrefix,"[blocks][").concat(id,'][enabled]" value="1"/>\n  <div class="titlebar">\n    <div class="blocktype">').concat(this.getBlockTypeByHandle(type).name,'</div>\n    <div class="preview"></div>\n  </div>\n  <div class="checkbox" title="').concat(Craft.t("app","Select"),'"></div>\n  <div class="actions">\n    <div class="status off" title="').concat(Craft.t("app","Disabled"),'"></div>\n    <a class="settings icon menubtn" title="').concat(Craft.t("app","Actions"),'" role="button"></a> \n    <div class="menu">\n      <ul class="padded">\n        <li><a data-icon="collapse" data-action="collapse">').concat(Craft.t("app","Collapse"),'</a></li>\n        <li class="hidden"><a data-icon="expand" data-action="expand">').concat(Craft.t("app","Expand"),'</a></li>\n        <li><a data-icon="disabled" data-action="disable">').concat(Craft.t("app","Disable"),'</a></li>\n        <li class="hidden"><a data-icon="enabled" data-action="enable">').concat(Craft.t("app","Enable"),'</a></li>\n        <li><a data-icon="uarr" data-action="moveUp">').concat(Craft.t("app","Move up"),'</a></li>\n        <li><a data-icon="darr" data-action="moveDown">').concat(Craft.t("app","Move down"),"</a></li>\n      </ul>");if(!this.settings.staticBlocks){html+='\n      <hr class="padded"/>\n      <ul class="padded">\n        <li><a class="error" data-icon="remove" data-action="delete">'.concat(Craft.t("app","Delete"),'</a></li>\n      </ul>\n      <hr class="padded"/>\n      <ul class="padded">');for(var i=0;i<this.blockTypes.length;i++){var blockType=this.blockTypes[i];html+='\n        <li><a data-icon="plus" data-action="add" data-type="'.concat(blockType.handle,'">').concat(Craft.t("app","Add {type} above",{type:blockType.name}),"</a></li>")}html+="\n      </ul>"}html+='\n    </div>\n    <a class="move icon" title="'.concat(Craft.t("app","Reorder"),'" role="button"></a>\n  </div>\n</div>');var $block=$(html);window.draftEditor&&window.draftEditor.pause(),$insertBefore?$block.insertBefore($insertBefore):$block.appendTo(this.$blockContainer);var $fieldsContainer=$('<div class="fields"/>').appendTo($block),bodyHtml=this.getParsedBlockHtml(this.blockTypesByHandle[type].bodyHtml,id),footHtml=this.getParsedBlockHtml(this.blockTypesByHandle[type].footHtml,id);$(bodyHtml).appendTo($fieldsContainer),this.trigger("blockAdded",{$block:$block}),$block.css(this.getHiddenBlockCss($block)).velocity({opacity:1,"margin-bottom":10},"fast",(function(){$block.css("margin-bottom",""),Garnish.$bod.append(footHtml),Craft.initUiElements($fieldsContainer),new MatrixBlock(_this3,$block),_this3.blockSort.addItems($block),_this3.blockSelect.addItems($block),_this3.updateAddBlockBtn(),Garnish.requestAnimationFrame((function(){(void 0===autofocus||autofocus)&&(Garnish.scrollContainerToElement($block),$block.find(".text,[contenteditable]").first().trigger("focus")),window.draftEditor&&window.draftEditor.resume()}))}))}},getBlockTypeByHandle:function getBlockTypeByHandle(handle){for(var i=0;i<this.blockTypes.length;i++)if(this.blockTypes[i].handle===handle)return this.blockTypes[i]},collapseSelectedBlocks:function collapseSelectedBlocks(){this.callOnSelectedBlocks("collapse")},expandSelectedBlocks:function expandSelectedBlocks(){this.callOnSelectedBlocks("expand")},disableSelectedBlocks:function disableSelectedBlocks(){this.callOnSelectedBlocks("disable")},enableSelectedBlocks:function enableSelectedBlocks(){this.callOnSelectedBlocks("enable")},deleteSelectedBlocks:function deleteSelectedBlocks(){this.callOnSelectedBlocks("selfDestruct")},callOnSelectedBlocks:function callOnSelectedBlocks(fn){for(var i=0;i<this.blockSelect.$selectedItems.length;i++)this.blockSelect.$selectedItems.eq(i).data("block")[fn]()},getHiddenBlockCss:function getHiddenBlockCss($block){return{opacity:0,marginBottom:-$block.outerHeight()}},getParsedBlockHtml:function getParsedBlockHtml(html,id){return"string"==typeof html?html.replace(new RegExp("__BLOCK_".concat(this.settings.placeholderKey,"__"),"g"),id):""},get maxBlocks(){return this.settings.maxBlocks}},{defaults:{placeholderKey:null,maxBlocks:null,staticBlocks:!1},collapsedBlockStorageKey:"Craft-"+Craft.systemUid+".MatrixInput.collapsedBlocks",getCollapsedBlockIds:function getCollapsedBlockIds(){return"string"==typeof localStorage[Craft.MatrixInput.collapsedBlockStorageKey]?Craft.filterArray(localStorage[Craft.MatrixInput.collapsedBlockStorageKey].split(",")):[]},setCollapsedBlockIds:function setCollapsedBlockIds(ids){localStorage[Craft.MatrixInput.collapsedBlockStorageKey]=ids.join(",")},rememberCollapsedBlockId:function rememberCollapsedBlockId(id){if("undefined"!=typeof Storage){var collapsedBlocks=Craft.MatrixInput.getCollapsedBlockIds();-1===$.inArray(""+id,collapsedBlocks)&&(collapsedBlocks.push(id),Craft.MatrixInput.setCollapsedBlockIds(collapsedBlocks))}},forgetCollapsedBlockId:function forgetCollapsedBlockId(id){if("undefined"!=typeof Storage){var collapsedBlocks=Craft.MatrixInput.getCollapsedBlockIds(),collapsedBlocksIndex=$.inArray(""+id,collapsedBlocks);-1!==collapsedBlocksIndex&&(collapsedBlocks.splice(collapsedBlocksIndex,1),Craft.MatrixInput.setCollapsedBlockIds(collapsedBlocks))}}});var MatrixBlock=Garnish.Base.extend({matrix:null,$container:null,$titlebar:null,$fieldsContainer:null,$previewContainer:null,$actionMenu:null,$collapsedInput:null,isNew:null,id:null,collapsed:!1,init:function init(matrix,$container){var _this4=this;this.matrix=matrix,this.$container=$container,this.$titlebar=$container.children(".titlebar"),this.$previewContainer=this.$titlebar.children(".preview"),this.$fieldsContainer=$container.children(".fields"),this.$container.data("block",this),this.id=this.$container.data("id"),this.isNew=!this.id||"string"==typeof this.id&&"new"===this.id.substr(0,3);var $menuBtn=this.$container.find("> .actions > .settings"),menuBtn=new Garnish.MenuBtn($menuBtn);this.$actionMenu=menuBtn.menu.$container,menuBtn.menu.settings.onOptionSelect=this.onMenuOptionSelect.bind(this),menuBtn.menu.on("show",(function(){_this4.$container.addClass("active"),_this4.$container.prev(".matrixblock").length?_this4.$actionMenu.find("a[data-action=moveUp]:first").parent().removeClass("hidden"):_this4.$actionMenu.find("a[data-action=moveUp]:first").parent().addClass("hidden"),_this4.$container.next(".matrixblock").length?_this4.$actionMenu.find("a[data-action=moveDown]:first").parent().removeClass("hidden"):_this4.$actionMenu.find("a[data-action=moveDown]:first").parent().addClass("hidden")})),menuBtn.menu.on("hide",(function(){_this4.$container.removeClass("active")})),Garnish.hasAttr(this.$container,"data-collapsed")&&this.collapse(),this._handleTitleBarClick=function(ev){ev.preventDefault(),this.toggle()},this.addListener(this.$titlebar,"doubletap",this._handleTitleBarClick)},toggle:function toggle(){this.collapsed?this.expand():this.collapse(!0)},collapse:function collapse(animate){var _this5=this;if(!this.collapsed){this.$container.addClass("collapsed");for(var previewHtml="",$fields=this.$fieldsContainer.children().children(),i=0;i<$fields.length;i++){for(var $field,$inputs=$($fields[i]).children(".input").find('select,input[type!="hidden"],textarea,.label'),inputPreviewText="",j=0;j<$inputs.length;j++){var $input=$($inputs[j]),value;if($input.hasClass("label")){var $maybeLightswitchContainer=$input.parent().parent();if($maybeLightswitchContainer.hasClass("lightswitch")&&($maybeLightswitchContainer.hasClass("on")&&$input.hasClass("off")||!$maybeLightswitchContainer.hasClass("on")&&$input.hasClass("on")))continue;value=$input.text()}else value=Craft.getText(Garnish.getInputPostVal($input));value instanceof Array&&(value=value.join(", ")),value&&(value=Craft.trim(value))&&(inputPreviewText&&(inputPreviewText+=", "),inputPreviewText+=value)}inputPreviewText&&(previewHtml+=(previewHtml?" <span>|</span> ":"")+inputPreviewText)}this.$previewContainer.html(previewHtml),this.$fieldsContainer.velocity("stop"),this.$container.velocity("stop"),animate?(this.$fieldsContainer.velocity("fadeOut",{duration:"fast"}),this.$container.velocity({height:16},"fast")):(this.$previewContainer.show(),this.$fieldsContainer.hide(),this.$container.css({height:16})),setTimeout((function(){_this5.$actionMenu.find("a[data-action=collapse]:first").parent().addClass("hidden"),_this5.$actionMenu.find("a[data-action=expand]:first").parent().removeClass("hidden")}),200),this.isNew?this.$collapsedInput?this.$collapsedInput.val("1"):this.$collapsedInput=$('<input type="hidden" name="'+this.matrix.inputNamePrefix+"[blocks]["+this.id+'][collapsed]" value="1"/>').appendTo(this.$container):Craft.MatrixInput.rememberCollapsedBlockId(this.id),this.collapsed=!0}},expand:function expand(){var _this6=this;if(this.collapsed){this.$container.removeClass("collapsed"),this.$fieldsContainer.velocity("stop"),this.$container.velocity("stop");var collapsedContainerHeight=this.$container.height();this.$container.height("auto"),this.$fieldsContainer.show();var expandedContainerHeight=this.$container.height(),displayValue=this.$fieldsContainer.css("display")||"block";if(this.$container.height(collapsedContainerHeight),this.$fieldsContainer.hide().velocity("fadeIn",{duration:"fast",display:displayValue}),this.$container.velocity({height:expandedContainerHeight},"fast",(function(){_this6.$previewContainer.html(""),_this6.$container.height("auto")})),setTimeout((function(){_this6.$actionMenu.find("a[data-action=collapse]:first").parent().removeClass("hidden"),_this6.$actionMenu.find("a[data-action=expand]:first").parent().addClass("hidden")}),200),!this.isNew&&"undefined"!=typeof Storage){var collapsedBlocks=Craft.MatrixInput.getCollapsedBlockIds(),collapsedBlocksIndex=$.inArray(""+this.id,collapsedBlocks);-1!==collapsedBlocksIndex&&(collapsedBlocks.splice(collapsedBlocksIndex,1),Craft.MatrixInput.setCollapsedBlockIds(collapsedBlocks))}this.isNew?this.$collapsedInput&&this.$collapsedInput.val(""):Craft.MatrixInput.forgetCollapsedBlockId(this.id),this.collapsed=!1}},disable:function disable(){var _this7=this;this.$container.children('input[name$="[enabled]"]:first').val(""),this.$container.addClass("disabled"),setTimeout((function(){_this7.$actionMenu.find("a[data-action=disable]:first").parent().addClass("hidden"),_this7.$actionMenu.find("a[data-action=enable]:first").parent().removeClass("hidden")}),200),this.collapse(!0)},enable:function enable(){var _this8=this;this.$container.children('input[name$="[enabled]"]:first').val("1"),this.$container.removeClass("disabled"),setTimeout((function(){_this8.$actionMenu.find("a[data-action=disable]:first").parent().removeClass("hidden"),_this8.$actionMenu.find("a[data-action=enable]:first").parent().addClass("hidden")}),200)},moveUp:function moveUp(){var $prev=this.$container.prev(".matrixblock");$prev.length&&(this.$container.insertBefore($prev),this.matrix.blockSelect.resetItemOrder())},moveDown:function moveDown(){var $next=this.$container.next(".matrixblock");$next.length&&(this.$container.insertAfter($next),this.matrix.blockSelect.resetItemOrder())},onMenuOptionSelect:function onMenuOptionSelect(option){var batchAction=this.matrix.blockSelect.totalSelected>1&&this.matrix.blockSelect.isSelected(this.$container),$option=$(option);switch($option.data("action")){case"collapse":batchAction?this.matrix.collapseSelectedBlocks():this.collapse(!0);break;case"expand":batchAction?this.matrix.expandSelectedBlocks():this.expand();break;case"disable":batchAction?this.matrix.disableSelectedBlocks():this.disable();break;case"enable":batchAction?this.matrix.enableSelectedBlocks():(this.enable(),this.expand());break;case"moveUp":this.moveUp();break;case"moveDown":this.moveDown();break;case"add":var type=$option.data("type");this.matrix.addBlock(type,this.$container);break;case"delete":batchAction?confirm(Craft.t("app","Are you sure you want to delete the selected blocks?"))&&this.matrix.deleteSelectedBlocks():this.selfDestruct()}},selfDestruct:function selfDestruct(){var _this9=this;window.draftEditor&&window.draftEditor.pause(),this.$container.velocity(this.matrix.getHiddenBlockCss(this.$container),"fast",(function(){_this9.$container.remove(),_this9.matrix.updateAddBlockBtn(),window.draftEditor&&window.draftEditor.resume(),_this9.matrix.trigger("blockDeleted",{$block:_this9.$container})}))}})}(jQuery)}]);
//# sourceMappingURL=MatrixInput.min.js.map